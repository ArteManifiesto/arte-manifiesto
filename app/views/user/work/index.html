{% extends '../../partials/base.html' %}

{% block styles %}
	<link rel="stylesheet" href="/css/photoswipe.css">
	<link rel="stylesheet" href="/css/default-skin/default-skin.css">
{% endblock %}

{% block elements %}
{% set element = element.toJSON() %}
	<div class="grid-container u-margin-top-15 u-margin-bottom-15">
		<div class="grid-100">
			<div class="works-nav">
				<div style="min-width: 100px;">
					{% if neighbors.prev %}
						<a href='/user/{{neighbors.prev.User.username}}/work/{{neighbors.prev.nameSlugify}}' class="nav prev-btn">
							<i class="bi_interface-left"></i>
							<p>&nbsp;&nbsp;ANTERIOR</p>
						</a>
					{% endif %}
				</div>
				<a href="/user/{{element.User.username}}" class="nav">
					<i class="bi_media-image-b"></i>
					<p>&nbsp;&nbsp;IR AL PORTAFOLIO</p>
				</a>
				<div style="min-width: 100px;">
					{% if neighbors.next %}
						<a href='/user/{{neighbors.next.User.username}}/work/{{neighbors.next.nameSlugify}}' class="nav next-btn">
							<p>SIGUIENTE&nbsp;&nbsp;</p>
							<i class="bi_interface-right"></i>
						</a>
					{% endif %}
				</div>
			</div>
		</div>
	</div>

	<div class="u-separator" style="background: #eee;"></div>

	<div class="grid-container u-margin-top-20">
		<div class="grid-100">
			<div class="single-info">
				<div class="single-image">
					<div class="single-image-inner">
						<div class="work-photo-container">
							<!-- <div class="cover"></div> -->
							<img src="{{element.photo|addFilter('w_700,h_800,q_80,c_limit')}}" class="work-photo" id="work-image">
						</div>

						<!-- <div style="width: 100%; display: flex; justify-content: space-between; align-items: center;"> -->

							<!-- <div class="actions">
								<a class="action prev-btn" style="padding: 0; cursor: pointer;">
									<div class="">
										<i class="arrow bi_interface-left"></i>
										<p class="text desktop">VALORAR</p>
									</div>
								</a>
							</div> -->
							<div class="actions u-padding-top-10">
								<a class="action {% if element.liked %} active {% endif %}">
									<div class="like-btn">
										<i class="icon bi_ecommerce-diamon  valuation"></i>
										<p class="text">VALORAR</p>
									</div>
								</a>
								<a id="go-share-modal" href="#share-modal" class="action">
									<i class="icon bi_web-share share"></i>
									<p class="text">COMPARTIR</p>
								</a>
								{% if owner %}
									<a id="go-share-modal" href="/user/{{element.User.username}}/work/{{element.nameSlugify}}/edit" class="action">
										<i class="icon bi_editorial-compose"></i>
										<p class="text">EDITAR</p>
									</a>
								{% endif %}
							</div>
							<!-- <div class="actions">
								<a class="action next-btn" style="padding: 0; cursor: pointer;">
									<div class="">
										<i class="arrow bi_interface-right"></i>
										<p class="text desktop">VALORAR</p>
									</div>
								</a>
							</div> -->

						<!-- </div> -->

						<div class="actions-box after-like {% if !element.liked %} hide {% endif %}">

							<i class="bi_interface-top arrow" {% if owner %} style="left: 32px;" {% endif %}></i>

							<a id="go-collection-modal" href="#collection-modal" >
								<button class="color-blue bg-gray">AÑADIR A LA COLECCIÓN</button>
							</a>
							{% if !owner %}
							<button class="u-margin-top-10 am-Follow-button">+ SEGUIR</button>
							{% endif %}
							<div class="hide">
								<button class="u-margin-top-10 follow-loading">
									<i class="load fa fa-spinner"></i>
								</button>
							</div>
							<div class="hide">
								<button class="following u-margin-top-10">
									<i class="fa fa-check-circle"></i>&nbsp;SIGUIENDO
								</button>
							</div>
						</div>
						<div class="u-margin-top-10">&nbsp;</div>
					</div>
				</div>
				<div class="single-data u-padding-bottom-40">
					<div class="FollowArtist u-padding-bottom-10">
						<div style="width: 100%;">
							<a href="/user/{{element.User.username}}">
								<p class="u-padding-bottom-7 big uppercase"><strong>{{element.User.fullname}}</strong></p>
							</a>
							<div class="button-container">
								{% if !owner %}
									<button class="am-Follow-button">+ SEGUIR</button>
								{% endif %}
								{% if owner %}
									<!-- <a id="go-edit-modal" href="#edit-modal"><i class="bi_editorial-compose"></i></a> -->
								{% endif %}
							</div>
						</div>
					</div>
					<div class="u-separator"></div>
					<p class="am-Single-title-text u-margin-top-15 work-name" style="font-size: 15px;">{{element.name}}</p>
					<p class="am-collection-desc u-margin-top-10 work-description">
						{{element.description}}
					</p>
					<p class="am-Single-text u-margin-top-20">Categoría:</p>
					<div class='work-category'>
						<a href='/works/category/{{element.Category.nameSlugify}}/page-1/'>
							<span class="am-Category-box u-margin-top-7 uppercase">{{element.Category.name}}</span>
						</a>
					</div>
					<div class="info-box u-margin-top-25">
						<div class="header">
							<p class="selected">COMPRAR</p>
						</div>
						<div class="body u-text-center">
							<div class="ask-requester {% if element.requested %} hide {% endif %}">
								<p class="title large">Puedes preguntar al artista la disponibilidad</p>
									<button class="am-View-button expand u-margin-top-20 ask-availability">PREGUNTAR</button>
									<p class="msg u-padding-top-15 u-padding-bottom-4">Muy pronto la tienda en línea</p>
							</div>
							<div class="thanks-requester {% if !element.requested %} hide {% endif %}">
								<p class="title large">Gracias por preguntar la disponibilidad</p>
								<p class="msg u-padding-top-15 u-padding-bottom-4">te avisaremos cuando el artista ponga en venta esta obra</p>
							</div>
						</div>
					</div>
					<p class="am-stats-text u-margin-top-40">ESTADÍSTICAS</p>
					<div class="u-separator"></div>
					<div class="u-center">
						<table class="am-Single-stats u-margin-top-10">
						  <tr>
						    <td><i class="bi_interface-view"></i></td>
						    <td><p>VISTAS</p></td>
						    <td><span>{{element.views}}</span></td>
						  </tr>
						  <tr>
						    <td><i class="bi_ecommerce-diamon"></i></td>
						    <td><p>VALORACIONES</p></td>
						    <td><span class="likes">{{element.likes || 0}}</span></td>
						  </tr>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="am-SingleMenu u-margin-top-20">
	  <div class="grid-container">
	    <div class="grid-100">
	      <div class="single-menu">
	        <div class="artist">
	          <div class="FollowArtist">
	            <a href="/user/{{element.User.username}}">
	              <img src="{{element.User.photo}}">
	            </a>
	            <div>
								<a href="/user/{{element.User.username}}">
		              <p class="u-padding-bottom-4 uppercase" style="font-weight: bold;">{{element.User.fullname}}</p>
		              <p class="u-padding-bottom-7"> <strong></strong> {{element.User.city}}, {{element.User.country}}</p>
	            	</a>
	              {% if !owner %}
	              <button class="am-Follow-button">+ SEGUIR</button>
	              {% endif %}
	            </div>
	          </div>
	        </div>
	        <div class="menu">
	          <div class="carousel">
	            <div class="single-tabs">
	              <div class="single-tab index">
									<p>+ OBRAS</p>
	                <i class="bi_misc-cube"></i>
	              </div>
	              <div class="single-tab reviews">
	                <p>REVIEWS</p>
	                <span>{{reviews.length}}</span>
	              </div>
	              <div class="single-tab tags">
	                <p>TAGS</p>
	                <i class="bi_editorial-left-align"></i>
	              </div>
	            </div>
	          </div>
	        </div>
	      </div>
	    </div>
	  </div>
	</div>

	<!--=========================== WORKS-PRODUCTS'S RELATED AND SIMILAR ===========================-->
	<div class="index-container {% if currentPath !== 'index' %} hide {% endif %}">
	  <div class="grid-container u-margin-top-60">
	    <div class="grid-100">
				<p class="am-more-text u-text-center u-padding-bottom-10">Otras obras del artista</p>
	      <div class="u-separator-center"></div>
	    </div>
	  </div>

	  <div class="grid-container">
	    <div class="grid-100">
	    	<div class="more-carousel js-more-carousel">
					<p class="empty-profile-text empty-message bare-message hide u-margin-top-30">El artista no tiene mas obras<br><br>
						<a href="/works/category/all/page-1/">Descubre todas las obras de AM</a>
					</p>

					<button class="nextButton"><i class="bi_interface-right"></i></button>
					<button class="prevButton"><i class="bi_interface-left"></i></button>

	        <div class="more-images more">
	        </div>
	      </div>
	    </div>
	  </div>

		<div class="u-separator u-margin-top-60"></div>

	  <div class="grid-container u-margin-top-60">
	    <div class="grid-100">
				<p class="am-more-text u-text-center u-padding-bottom-10">Obras relacionadas</p>
	      <div class="u-separator-center"></div>
	    </div>
	  </div>
	  <div class="grid-container">
	    <div class="grid-100">
	      <div class="more-carousel js-similar-carousel">
					<p class="empty-profile-text empty-message bare-message hide u-margin-top-30">No existen obras relacionadas<br><br>
						<a href="/works/category/all/page-1/">Descubre todas las obras de AM</a>
					</p>

					<button class="nextButton"><i class="bi_interface-right"></i></button>
					<button class="prevButton"><i class="bi_interface-left"></i></button>

	        <div class="more-images similar"></div>

	      </div>
	    </div>
	  </div>
	</div>
	<!--=================================================================================
			=================================================================================
			=================================================================================-->

	<!--=========================== WORK'S REVIEWS  ===========================-->
	<div class="grid-container reviews-container {% if currentPath !== 'reviews' %} hide {% endif %}">
	  <div class="grid-100">
	    <div class="reviews">
	      <p class="title" style="margin-top: 30px;">Reviews &nbsp;&nbsp;<span>{{reviews.length}}</span></p>
	      <div class="u-separator"></div>
	      <div class='reviews-items-container'>
	      </div>

        {% if user %}
	      	<div class="review">
	          <div class="avatar"><img src="{{user.photo}}"></div>
	          <form class="content review-form">
	            <input type="hidden" name='id{{entity|capitalize}}' value="{{element.id}}"/>
	            <textarea class='value-input' name="value"></textarea>
	            <button>AGREGAR REVIEW</button>
	          </form>
	      	</div>
        {% else %}
        	<p class="empty-profile-text  empty-message bare-message u-margin-top-30" style="display: block;">
        		<a href="/auth/login">Logeate, para agregar review</a>
        	</p>
        {% endif %}
	    </div>
	  </div>
	</div>
	<!--=================================================================================
			=================================================================================
			=================================================================================-->

	<!--=========================== WORK-PRODUCT'S TAGS ===========================-->
  <div class="grid-container tags-container {% if currentPath !== 'tags' %} hide {% endif %}">
    <div class="grid-100">
      <div class="tags-container">
        <p class="title" style="margin-top: 30px;">Tags&nbsp;&nbsp;<span class="tags-number">{{tags.length}}</span></p>
        <div class="u-separator"></div>
				{% if tags.length > 1 %}
					<div class="tags work-tags">
	          {% for tag in tags %}
	          {% set url = "#" + tag.name %}
							<div class="tag uppercase"><a href='/works/category/all/page-1/?term={{url|url_encode}}'>{{tag.name}}</a></div>
	          {% endfor %}
	        </div>
				{% else %}
					<p class="empty-profile-text  empty-message bare-message hide u-margin-top-30" style="display: block;">Esta obra aun no tiene tags<br><br>
						<a href="/works/category/all/page-1/">Descubre todas las obras de AM</a>
					</p>
				{% endif %}
      </div>
    </div>
  </div>
	<!--=================================================================================
			=================================================================================
			=================================================================================-->
{% include '../../partials/report.html' %}

	<div id="collection-modal" style="display:none;">
		<i class="closed-modal fa fa-times"></i>

		<div class="actions-box add-collection">
			<p class="title">Añadir a las colecciones</p>
			<div class="u-separator u-margin-top-7"></div>

			<form class="add-collection-form">
				<input class="u-margin-top-10" type="text" name='name' required placeholder="Crear una colección nueva">
				<button class="u-margin-top-10 color-black bg-gray wd-auto">AÑADIR</button>
			</form>
			<ul class="collections u-margin-top-20">
			</ul>
			<div class="u-separator u-margin-top-20"></div>
			<div class="buttons u-margin-top-20">
				<button class="wd-auto bg-blue color-white save-collections">GUARDAR</button>
				<div class="hide save-collections-loading">
					<button class="wd-auto bg-blue color-white">
						<i class="load fa fa-spinner"></i>
					</button>
				</div>
			</div>
		</div>
	</div>

	<div id="share-modal" style="display:none;">
		<i class="closed-modal fa fa-times"></i>

		<div class="actions-box social-share">
			<p class="title">Compartir obras</p>
			<div class="u-separator u-margin-top-7"></div>
			<div class="share share-fb">
				<i class="fa fa-facebook"></i>Compartir en facebook
			</div>
			<div class="share share-tw">
				<i class="fa fa-twitter"></i>Compartir en twitter
			</div>
		</div>
	</div>

	<a id="go-preload-modal" href="#preload-modal"></a>
	<div id="preload-modal" style="display:none;">
		<div class="loader small"></div>
	</div>

	<div id="fb-root"></div>

	<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

	    <div class="pswp__bg"></div>

	    <div class="pswp__scroll-wrap">

	        <div class="pswp__container">
	            <div class="pswp__item"></div>
	            <div class="pswp__item"></div>
	            <div class="pswp__item"></div>
	        </div>

	        <div class="pswp__ui pswp__ui--hidden">

	            <div class="pswp__top-bar">


	                <div class="pswp__counter"></div>

	                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

	                <button class="pswp__button pswp__button--share" title="Share"></button>

	                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

	                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

	                <div class="pswp__preloader">
	                    <div class="pswp__preloader__icn">
	                      <div class="pswp__preloader__cut">
	                        <div class="pswp__preloader__donut"></div>
	                      </div>
	                    </div>
	                </div>
	            </div>

	            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
	                <div class="pswp__share-tooltip"></div>
	            </div>

	            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
	            </button>

	            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
	            </button>

	            <div class="pswp__caption">
	                <div class="pswp__caption__center"></div>
	            </div>

	          </div>

	        </div>

	</div>

{% endblock %}

{% block scripts %}

	<script src="/photoswipe.js"></script>
	<script src="/photoswipe-ui-default.js"></script>

	<script>
		(function (d, s, id) {
			var js;
			var fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) return;
			js = d.createElement(s);
			js.id = id;
			js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=1473636902857068";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
		var owner = {{owner|json|safe}};
		var entity = {{entity|json|safe}};
		var element = {{element|json|safe}};
		var currentPath = {{currentPath|json|safe}};
		var reviews = {{reviews|json|safe}};
		var more = {{more|json|safe}};
		var similar = {{similar|json|safe}};
		$(function() {
			$("#go-collection-modal").leanModal();
			$("#go-share-modal").leanModal();
			$("#go-preload-modal").leanModal();
		});
		function Carousel (el , container) {
			var nextButton = el.querySelector('.nextButton'),
					prevButton = el.querySelector('.prevButton'),
					carousel = el.querySelector('.more-images'),
					interval;


					var checkArrows = function () {
						clearTimeout(timeout);
						if (container[0].scrollWidth > $(container).innerWidth()) {
								$(nextButton).show();
								$(prevButton).show();
			        } else {
								$(nextButton).hide();
								$(prevButton).hide();
			        }
					}
					var timeout = setTimeout(function() {
						checkArrows();
						$(carousel).scroll();
					},1000);


			function setup () {
				var completeAnimation = function () {
					if(this.scrollLeft <=0 ) {
						$(prevButton).hide();
					}else {
						$(prevButton).show();
					}
					console.log(this.scrollLeft , this.scrollLeft + $(this).innerWidth())
					if(this.scrollLeft +  $(this).innerWidth() >= this.scrollWidth) {
						$(nextButton).hide();
					}else {
						$(nextButton).show();
					}
				}
				$(nextButton).click(function () {
						$(carousel).animate({
							scrollLeft: (carousel.scrollLeft + 230)
						},400, completeAnimation);
				});

				$(prevButton).click(function () {
					$(carousel).animate({
						scrollLeft: (carousel.scrollLeft - 230)
					},400,completeAnimation);
				});
				$(carousel).scroll(completeAnimation);
				$( window ).resize(checkArrows);
			}
			setup()
		}
		var carousel = new Carousel (document.querySelector('.js-more-carousel') , $('.more'));
		var carousel = new Carousel (document.querySelector('.js-similar-carousel'), $('.similar'));


		var meta;
		var zoom = false;

		setTimeout(function () {

			$('#work-image').click(function () {

				if( !zoom ) {

					$('#go-preload-modal').trigger( "click" );

					$("<img/>").load(function() {

						$('#lean_overlay').trigger( "click" );

						var width = this.width, height = this.height;
						meta = { width: width, height: height }

						document.getElementById('work-image').onclick = openPhotoSwipe;

						$('#work-image').trigger( "click" );

					}).attr("src", Utils.addImageFilter(element.photo, 'w_1500,h_800,c_limit,q_80'));

					zoom = true
				}
			})

		}, 3000)

		var openPhotoSwipe = function() {
	    var pswpElement = document.querySelectorAll('.pswp')[0];
	    var items = [
				{
					// src: element.photo,
					src: Utils.addImageFilter(element.photo, 'w_1500,h_800,c_limit,q_80'),
					w: meta.width,
					h: meta.height
				}
	    ];
	    var options = {
	    	getThumbBoundsFn: function () {
	    		return {
	    			x: $('#work-image')[0].offsetLeft ,y: $('#work-image')[0].offsetTop, w: $('#work-image')[0].width}
	    	}
	    };
	    window.gallery = new PhotoSwipe( pswpElement, PhotoSwipeUI_Default, items, options);
	    gallery.init();
		};

	</script>

	<script src='/work-product.js'></script>
{% endblock %}
