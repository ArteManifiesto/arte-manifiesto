{% extends '../../partials/base.html' %}

{% block elements %}
<div class="am-upload-work">
	<div class="am-upload-work-box grid-container">
		<p class="main-title">SUBIR NUEVA OBRA A MI PORTAFOLIO</p>
		<form class="add-work">
			<div class="grid-100">
				<div class="separator">
					<span class="line"></span><span class="text">IMAGEN DE LA OBRA</span><span class="line"></span>
				</div>
				<div class="image-uploader" style="position:relative;">
					{{cloudinary.uploader.image_upload_tag('photo', { callback: cloudinary_cors, return_delete_token: true})}}
				</div>
				<div class="separator">
					<span class="line"></span><span class="text">DATOS DE LA OBRA</span><span class="line"></span>
				</div>
				<p class="title">Título de la obra</p>
				<input name='name' class="input" type="text" placeholder="Ingrese el nombre"/>
			</div>

			<div class="grid-100 mobile-grid-100">
				<p class="title">Categoría de la obra</p>
				<select class="input select" name='categoryId'>
					{% for category in categories %}
					<option value="{{category.id}}">{{category.name}}</option>
					{% endfor %}
				</select>
			</div>

			<div class="grid-100 mobile-grid-100">
				<p class="title">Descripcion de la obra</p>
				<textarea name='description' class='input' placeholder="Descripcion" maxlength='140'></textarea>
			</div>

			<div class="grid-100 mobile-grid-100">
				<p class="title">Tags de la obra</p>
				<input name='tags' class="input tags" type="text"/>
				<div class="separator">
					<span class="line"></span><span class="text">CARACTERÍSTICAS</span><span class="line"></span>
				</div>
				<div class="switch u-margin-top-10">
					<p class="title">Público</p>
					<span class="value">On</span>
					<div class="am-Switch-button">
						<i class="fa fa-bars"></i>
					</div>
				</div>
				<button class="button u-margin-top-30" data-color="blue">SUBIR OBRA</button>
			</div>
		</form>
	</div>
</div>
{% endblock %}

{{ cloudinary.config() }}

{% block scripts %}
<script src='/jquery.tagsinput.js' type='text/javascript'></script>
<script src='/jquery.ui.widget.js' type='text/javascript'></script>
<script src='/jquery.iframe-transport.js' type='text/javascript'></script>
<script src='/jquery.fileupload.js' type='text/javascript'></script>
<script src='/jquery.cloudinary.js' type='text/javascript'></script>
<script>

$(document).ready(function() {
	var uploaderImage = new APP.UploaderImage({template:'avatarImage'});
	$('.image-uploader').append(uploaderImage.view);

	$('.tags').tagsInput({
		height:'50px', width:'100%', defaultText:'+ Etiqueta'
	});
	$('.add-work').submit(function(event){
		event.preventDefault();
		var formData = {
			photo              : uploaderImage.photo,
			name             : $('input[name=name]').val(),
			categories    : [parseInt($('select[name=categoryId]').val(),10)],
			tags             : $('input[name=tags]').val().split(','),
			description             : $('textarea[name=description]').val(),
			public: 1
		};
		$.ajax({
			method: 'POST',
			url: DataApp.currentUser.url + '/work/create',
			data: {data: JSON.stringify(formData)}
		}).then(function(response) {
			if(response.status === 200) {
				var work = response.data.work;
				location.href = DataApp.currentUser.url + '/work/' + work.nameSlugify + '/published';
			}
		});
	});
});
</script>
{% endblock %}
