{% extends '../partials/report.html' %}

{% block content %}
<h2 class="sub-header">Datos Generales <span class="total"></span></h2>

<div class="row">
  <div class="col-lg-2">
    <div class="input-group date start" data-provide="datepicker">
      <input type="text" placeholder="Fecha Inicio" class="form-control">
        <div class="input-group-addon">
          <span class="fa fa-calendar"></span>
        </div>
    </div>
  </div>
  <div class="col-lg-2">
    <div class="input-group date end" data-provide="datepicker">
      <input type="text" placeholder="Fecha Fin" class="form-control">
        <div class="input-group-addon">
          <span class="fa fa-calendar"></span>
        </div>
    </div>
  </div>

  <div class="col-lg-1">
    <button type="submit" class="btn search-btn btn-default">Buscar</button>
  </div>
</div>
</br>

<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>obras creadas</th>
        <th>likes a obras</th>
        <th>colecciones creadas</th>
        <th>obras coleccionadas</th>
        <th>preguntas por obra</th>
      </tr>
    </thead>
    <tbody class="container-items">
      <tr>
        {% for number in numbers %}
          <td>{{number}}</td>
        {% endfor %}
      </tr>
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script>
  var data = {{data|json|safe}};
  var viewer , term, start, end;
  var options = {format: 'mm/dd/yyyy', clearBtn: true};

  $(function() {
      new APP.AM();

    if(Utils.getUrlParameter('start')) {
      var startValue  = Utils.getUrlParameter('start');
      start = new Date(startValue);
      $('.start').find('input').val(startValue.replace(/-/gi, '/'));
    };

    if(Utils.getUrlParameter('end')) {
      var endValue  = Utils.getUrlParameter('end');
      end = new Date(endValue);
      $('.end').find('input').val(endValue.replace(/-/gi, '/'));
    };

    $('.start').datepicker(options).on('changeDate', function(e) {
      start = e.date;
    });

    $('.end').datepicker(options).on('changeDate', function(e) {
      end = e.date;
    });

    $('.search-btn').click(function() {
      if(start) {
        if(!end) {
          return alert('Ingresa una fecha de fin');
        }
        var startStr = (start.getMonth()+1) + "-" + start.getDate()  + "-" + start.getFullYear();
        DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'start', startStr);
      }else {
        DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'start');
      }

      if(end) {
        if(!start) {
          return alert('Ingresa una fecha de inicio');
        }
        var endStr = (end.getMonth()+1) + "-" + end.getDate()  + "-" + end.getFullYear();
        DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'end', endStr);
      }else {
        DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'end');
      }

      if(DataApp.currentUrl !== window.location.href)
        window.location.href = DataApp.currentUrl;
    });
  });

</script>
{% endblock %}
