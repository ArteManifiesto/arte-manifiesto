<<<<<<< HEAD
var APP=APP||{};APP.AM=function(){this.setupData(),this.setupUI(),this.listeners()},APP.AM.constructor=APP.AM,APP.AM.prototype.setupData=function(){new APP.RestClientManager,new APP.TemplateManager,$("."+path+"-menu").addClass("selected"),DataApp.currentUser=user||null,null!==DataApp.currentUser&&(DataApp.currentUser.url="/user/"+DataApp.currentUser.username);var e,t;errorMessage.length>0&&(e=$(".error"),t=errorMessage[0]),successMessage.length>0&&(e=$(".succes"),t=successMessage[0]),e&&(e.find(".content-text").text(t),e.addClass("fadeIn"))},APP.AM.prototype.setupUI=function(){this.signInBtn=$(".am-Signin-button"),this.closeFlashBtn=$(".close-flash"),this.flashMessage=$(".flash-message"),this.closeModalBtn=$(".closed-modal"),this.generalSearch=$(".general-search"),this.generalSearchBtn=$(".search-general-btn"),this.generalSearchOptions=$(".general-search-options"),this.subscriptionForm=$(".subscription-form"),this.subscriptionBtn=$(".subscription-btn"),this.body=$(".body"),this.searchBox=$(".search-box"),this.headerBars=$(".am-header-mobile .bars"),this.headerAvatar=$(".am-header-mobile .avatar"),this.headerCover=$(".body-inner .cover"),this.worksOption=this.generalSearchOptions.find(".works-option"),this.usersOption=this.generalSearchOptions.find(".users-option"),this.collectionsOption=this.generalSearchOptions.find(".collections-option"),this.emailSubscription=this.subscriptionForm.find("input[name=email]")},APP.AM.prototype.listeners=function(){this.generalSearch.focus(this.searchFocusHandler.bind(this)),this.generalSearch.blur(this.searchBlurHandler.bind(this)),this.generalSearch.keyup(this.searchKeyUpHandler.bind(this)),this.generalSearchBtn.click(this.generalSearchBtnClickHandler.bind(this)),this.subscriptionForm.submit(this.subscriptionFormHandler.bind(this)),this.subscriptionBtn.click(this.subscriptionHandler.bind(this)),this.signInBtn.click(this.signInHandler),this.closeFlashBtn.click(this.closeFlashHandler.bind(this)),this.headerBars.click(this.headerBarsHandler.bind(this)),this.headerAvatar.click(this.headerAvatarHandler.bind(this)),this.headerCover.click(this.headerCoverHandler.bind(this)),this.closeModalBtn.click(this.closeModal.bind(this)),this.searchBox.submit(this.searchBoxHandler.bind(this)),$(document).keyup(this.escapeHandler.bind(this))},APP.AM.prototype.headerCoverHandler=function(e){this.body.removeClass("open-right"),this.body.removeClass("open-left")},APP.AM.prototype.headerAvatarHandler=function(e){e.preventDefault(),this.body.removeClass("open-left"),this.body.toggleClass("open-right")},APP.AM.prototype.headerBarsHandler=function(e){e.preventDefault(),this.body.removeClass("open-right"),this.body.toggleClass("open-left")},APP.AM.prototype.searchBoxHandler=function(e){e.preventDefault(),window.location.href=DataApp.discoverWorks+"?term="+$(".search-box-value").val()},APP.AM.prototype.escapeHandler=function(e){27==e.keyCode&&this.closeModal()},APP.AM.prototype.closeModal=function(){$("#lean_overlay").trigger("click")},APP.AM.prototype.signInHandler=function(e){e.preventDefault(),Utils.checkAuthentication()},APP.AM.prototype.closeFlashHandler=function(e){e.preventDefault(),this.flashMessage.css("visibility","hidden")},APP.AM.prototype.subscriptionHandler=function(e){e.preventDefault(),this.subscriptionForm.submit()},APP.AM.prototype.subscriptionFormHandler=function(e){e.preventDefault();var t=[],s=this.emailSubscription.val();return Validations.notBlank(s)&&t.push("Ingrese un correo"),Validations.email(s)||t.push("Formato de correo no valido"),t.length>0?APP.BaseScreen.prototype.showFlash.call(this,"error",t):void $.post("/subscribe",{email:s}).then(this.subscriptionComplete.bind(this))},APP.AM.prototype.subscriptionComplete=function(e){e.data.created?APP.BaseScreen.prototype.showFlash.call(this,"succes","Suscripcion exitosa"):APP.BaseScreen.prototype.showFlash.call(this,"error",["Ya estas Suscrito"])},APP.AM.prototype.searchFocusHandler=function(e){this.generalSearchOptions.show()},APP.AM.prototype.searchBlurHandler=function(e){var t=this,s=setTimeout(function(){clearTimeout(s),t.generalSearchOptions.hide()},200)},APP.AM.prototype.generalSearchBtnClickHandler=function(e){var t=this.getBaseUrl();window.location.href="/works/category"+t},APP.AM.prototype.searchKeyUpHandler=function(e){var t=this.generalSearch.val();this.generalSearchOptions.show(),this.worksOption.text(t),this.usersOption.text(t),this.collectionsOption.text(t);var s=this.getBaseUrl();this.worksOption.parent().attr("href","/works/category"+s),this.usersOption.parent().attr("href","/users/specialty"+s),this.collectionsOption.parent().attr("href","/collections/category"+s)},APP.AM.prototype.getBaseUrl=function(){var e="/all/page-1",t=this.generalSearch.val();return t.length>0&&(e+="?term="+encodeURIComponent(t)),e};
var APP=APP||{};APP.BaseElement=function(e,t,a){this.options=a||{context:"normal"},this.template=APP.TemplateManager.instance.getFromDoc(t),this.data=e,this.id=t;var s={addFilter:Utils.addImageFilter,formatDate:function(e){return moment(e).fromNow()},viewer:DataApp.currentUser};_.extend(this.data,this.options),_.extend(this.data,s),this.view=$(this.template(this.data)),this.rawView=this.view[0],this.listeners()},APP.BaseElement.prototype=Object.create(EventDispatcher.prototype),APP.BaseElement.constructor=APP.BaseElement,APP.BaseElement.prototype.listeners=function(){this.featuredBtn=this.view.find(".featured"),this.featuredBtn.click(this.featuredHandler.bind(this))},APP.BaseElement.prototype.featuredHandler=function(){var e,t=this.id;"table-work"===this.id&&(t="work"),"table-user"===this.id&&(t="user"),e=this.data.featured?"user"===t?"/user/"+this.data.username+"/unfeatured":"/user/"+this.data.User.username+"/"+t+"/unfeatured":"user"===t?"/user/"+this.data.username+"/featured":"/user/"+this.data.User.username+"/"+t+"/featured";var a=this,s={};s["id"+Utils.capitalize(t)]=this.data.id,$.post(e,s,function(e){200===e.status&&(e.data[t].featured?a.id.indexOf("table")>-1?a.featuredBtn.removeClass("btn-default").addClass("btn-primary"):a.featuredBtn.removeClass("disabled"):a.id.indexOf("table")>-1?a.featuredBtn.removeClass("btn-primary").addClass("btn-default"):a.featuredBtn.addClass("disabled"),a.data.featured=e.data[t].featured)})},APP.BaseElement.prototype.callToApi=function(e){return APP.RestClientManager.instance.execute(e)},APP.BaseElement.prototype.isLogged=function(){return Utils.checkAuthentication(),null!==DataApp.currentUser};
var APP=APP||{};APP.BaseScreen=function(e){this.id=e,this.setupUI(),this.listeners()},APP.BaseScreen.prototype=Object.create(Object.prototype),APP.BaseScreen.constructor=APP.BaseScreen,APP.BaseScreen.prototype.setupUI=function(){},APP.BaseScreen.prototype.listeners=function(){},APP.BaseScreen.prototype.requestHandler=function(e,t,s,o,r){!r&&Utils.checkAuthentication(),$.post(e,t).then(this.requestComplete.bind(this,s,o))},APP.BaseScreen.prototype.requestComplete=function(e,t,s){if(200!==s.status){var o=s.data.errors||["Algo sucedió mal"];return t&&t.bind(this)(),this.showFlash("error",o)}e.bind(this)(s)},APP.BaseScreen.prototype.showFlash=function(e,t){var s=$("."+e);$(".flash-message").css("visibility","hidden");var o=s.find(".content-text");if(o.empty(),"error"===e)for(var r=0;r<t.length;r++)o.append($("<p>").text("✘ "+t[r]));else o.text(t);s.css("visibility","visible"),s.removeClass("fadeIn");var n=setTimeout(function(){clearTimeout(n),s.addClass("fadeIn")},100)},APP.BaseScreen.prototype.getTemplate=function(e){var t="";return-1!==["followings","followers"].indexOf(e)&&(t="user"),"portfolio"===e&&(t="work"),"store"===e&&(t="product"),"collections"===e&&(t="collection"),t},APP.BaseScreen.prototype.clean=function(){};
var DataApp={};DataApp.currentUser=null,DataApp.baseUrl=window.location.origin+"/",DataApp.baseTitle="Arte Manifiesto | ",DataApp.loginUrl=DataApp.baseUrl+"auth/login",DataApp.discoverWorks=DataApp.baseUrl+"works/category/all/page-1/",DataApp.discoverUsers=DataApp.baseUrl+"users/specialties/all/page-1/",DataApp.discoverProducts=DataApp.baseUrl+"products/type/all/page-1/",DataApp.searchCollections=DataApp.baseUrl+"artjam/collections/page-1",DataApp.currentUrl=window.location.href.replace(/\/$/g,""),DataApp.currentUrl=DataApp.currentUrl.replace(/#_=_$/g,""),DataApp.fbAppID="1473636902857068";var Events={};Events.LOAD_START="loadStart",Events.LOAD_END="loadEnd",Events.COLLECTION_ITEM_SELECTED="collectionItemSelected",Events.ADD_COLLECTION="addCollection",Events.SHARE="share",Events.FILTER_CHANGED="filterChanged",Events.CREATOR_READY="creatorReady";var Validations={notBlank:function(a){return a?""===a.replace(/^\s+/g,"").replace(/\s+$/g,""):!0},username:function(a){var e=new RegExp(/^[a-zA-Z0-9]+$/);return e.test(a)},email:function(a){var e=new RegExp(/^\w+@\w+\.\w{2,3}$/);return e.test(a)}};
var APP=APP||{};APP.NavigationManager=function(a){switch(this.navigator,a){case APP.NavigationManager.PAGINATION:this.navigator=new APP.PaginationNavigation;break;case APP.NavigationManager.INFINITE:default:this.navigator=new APP.InfiniteNavigation}},APP.NavigationManager.INFINITE="infinite",APP.NavigationManager.PAGINATION="pagination",APP.NavigationManager.prototype=Object.create(Object.prototype),APP.NavigationManager.constructor=APP.NavigationManager;
var APP=APP||{};APP.RestClientManager=function(){APP.RestClientManager.instance=this},APP.RestClientManager.prototype=Object.create(Object.prototype),APP.RestClientManager.constructor=APP.RestClientManager,APP.RestClientManager.prototype.execute=function(e){return e.method=e.method||"post",$.ajax(e)};
var APP=APP||{};APP.TemplateManager=function(){APP.TemplateManager.instance=this,this.templates={}},APP.TemplateManager.prototype=Object.create(Object.prototype),APP.TemplateManager.constructor=APP.TemplateManager,APP.TemplateManager.prototype.loadTemplates=function(t){var e,a=this,p=[];for(e=0;e<t.length;e++)p.push($.get(DataApp.templatesUrl+t[e]+".html"));return $.when.apply(null,p).done(function(){if(t.length<=1)return a.templates[t[0]]=arguments[0];for(e=0;e<t.length;e++)a.templates[t[e]]=_.template(arguments[e][0])})},APP.TemplateManager.prototype.getFromDoc=function(t){return this.templates[t]?this.templates[t]:(this.templates[t]=_.template($("#template-"+t).html()),this.templates[t])};
var APP=APP||{};APP.Carrousel=function(t,i){this.view=t,this.container=i,this.nextBtn=this.view.find(".nextButton"),this.prevBtn=this.view.find(".prevButton"),this.carrousel=this.view.find(".more-images"),this.setup()},APP.Carrousel.constructor=APP.Carrousel,APP.Carrousel.prototype.checkArrows=function(){clearTimeout(this.timeout),this.container[0].scrollWidth>this.container.innerWidth()?(this.nextBtn.show(),this.prevBtn.show()):(this.nextBtn.hide(),this.prevBtn.hide()),this.animationComplete()},APP.Carrousel.prototype.setup=function(){this.nextBtn.click(this.nextHandler.bind(this)),this.prevBtn.click(this.prevHandler.bind(this)),this.carrousel.scroll(this.animationComplete.bind(this)),$(window).resize(this.checkArrows.bind(this)),this.timeout=setTimeout(this.checkArrows.bind(this),1e3)},APP.Carrousel.prototype.nextHandler=function(){this.carrousel.animate({scrollLeft:this.carrousel.scrollLeft()+230},400,this.animationComplete.bind(this))},APP.Carrousel.prototype.prevHandler=function(){this.carrousel.animate({scrollLeft:this.carrousel.scrollLeft()-230},400,this.animationComplete.bind(this))},APP.Carrousel.prototype.animationComplete=function(){this.carrousel.scrollLeft()<=0?this.prevBtn.hide():this.prevBtn.show();var t=this.carrousel.scrollLeft()+this.carrousel.innerWidth();t>=this.carrousel[0].scrollWidth?this.nextBtn.hide():this.nextBtn.show()};
var APP=APP||{};APP.CarrouselItem=function(e,t){APP.BaseElement.call(this,e,"carrousel-item",t)},APP.CarrouselItem.prototype=Object.create(APP.BaseElement.prototype),APP.CarrouselItem.constructor=APP.CarrouselItem;
var APP=APP||{};APP.Collection=function(o,t){APP.BaseElement.call(this,o,"collection",t)},APP.Collection.prototype=Object.create(APP.BaseElement.prototype),APP.Collection.constructor=APP.Collection;
var APP=APP||{};APP.CollectionItem=function(t,e){APP.BaseElement.call(this,t,"collection-item",e)},APP.CollectionItem.prototype=Object.create(APP.BaseElement.prototype),APP.CollectionItem.constructor=APP.CollectionItem,APP.CollectionItem.prototype.listeners=function(){this.view.click(this.clickViewHandler.bind(this))},APP.CollectionItem.prototype.clickViewHandler=function(){this.view.toggleClass("selected"),this.dispatchEvent({type:Events.COLLECTION_ITEM_SELECTED})};
var APP=APP||{};APP.FeedUserFollow=function(e,l){var o=e.element.friends;o.length>0?e.element.currentFriend=o[_.random(0,o.length-1)]:e.element.currentFriend=null,APP.BaseElement.call(this,e,"feed-user-follow",l)},APP.FeedUserFollow.prototype=Object.create(APP.BaseElement.prototype),APP.FeedUserFollow.constructor=APP.FeedUserFollow,APP.FeedUserFollow.prototype.listeners=function(){this.followBtn=this.view.find(".am-Follow-button"),this.followBtn.click(this.followClickHandler.bind(this))},APP.FeedUserFollow.prototype.followClickHandler=function(){var e=this;if(this.data.element.following){var l=DataApp.currentUser.url+"/unfollow/";$.post(l,{idUser:this.data.element.id},function(l){200===l.status&&(e.data.element.following=!1,$(".am-Follow-button").removeClass("following").text("+Seguir"))})}else{var l=DataApp.currentUser.url+"/follow/";$.post(l,{idUser:this.data.element.id},function(l){200===l.status&&(e.data.element.following=!0,$(".am-Follow-button").addClass("following").text("Siguiendo"))})}console.log("following")};
var APP=APP||{};APP.FeedWorkCreated=function(e,t){APP.BaseElement.call(this,e,"feed-work-created",t)},APP.FeedWorkCreated.prototype=Object.create(APP.BaseElement.prototype),APP.FeedWorkCreated.constructor=APP.FeedWorkCreated,APP.FeedWorkCreated.prototype.listeners=function(){this.addCollectionBtn=this.view.find(".add-collection"),this.likeBtn=this.view.find(".like"),this.shareBtn=this.view.find(".share"),this.afterLike=this.view.find(".after-like"),this.followBtn=this.view.find(".am-Follow-button"),this.data.element.User.following&&this.followBtn.addClass("following").text("Siguiendo"),this.addCollectionBtn.click(this.addCollectionHandler.bind(this)),this.likeBtn.click(this.likeHandler.bind(this)),this.shareBtn.click(this.shareHandler.bind(this)),this.followBtn.click(this.followHandler.bind(this))},APP.FeedWorkCreated.prototype.addCollectionHandler=function(){$("#go-collection-modal").click(),Broadcaster.dispatchEvent(Events.ADD_COLLECTION,{data:{work:this.data.element}})},APP.FeedWorkCreated.prototype.likeHandler=function(){if(!this.likeBtn.hasClass("active")){var e=DataApp.currentUser.url+"/work/like",t=this;$.post(e,{idWork:this.data.element.id},function(e){200===e.status&&(t.likeBtn.addClass("active"),t.afterLike.show())})}},APP.FeedWorkCreated.prototype.shareHandler=function(){$("#go-share-modal").click(),Broadcaster.dispatchEvent(Events.SHARE,{data:{work:this.data.element}})},APP.FeedWorkCreated.prototype.followHandler=function(){var e=this;if(this.data.element.User.following){var t=DataApp.currentUser.url+"/unfollow/";$.post(t,{idUser:this.data.element.User.id},function(t){200===t.status&&(e.data.element.User.following=!1,$(".am-Follow-button").removeClass("following").text("+Seguir"))})}else{var t=DataApp.currentUser.url+"/follow/";$.post(t,{idUser:this.data.element.User.id},function(t){200===t.status&&(e.data.element.User.following=!0,$(".am-Follow-button").addClass("following").text("Siguiendo"))})}};
var APP=APP||{};APP.NotificationFollow=function(o,t){APP.BaseElement.call(this,o,"notification-follow",t)},APP.NotificationFollow.prototype=Object.create(APP.BaseElement.prototype),APP.NotificationFollow.constructor=APP.NotificationFollow;
var APP=APP||{};APP.NotificationLike=function(i,t){APP.BaseElement.call(this,i,"notification-like",t)},APP.NotificationLike.prototype=Object.create(APP.BaseElement.prototype),APP.NotificationLike.constructor=APP.NotificationLike;
var APP=APP||{};APP.NotificationRequest=function(t,e){APP.BaseElement.call(this,t,"notification-request",e)},APP.NotificationRequest.prototype=Object.create(APP.BaseElement.prototype),APP.NotificationRequest.constructor=APP.NotificationRequest;
var APP=APP||{};APP.NotificationReview=function(i,t){APP.BaseElement.call(this,i,"notification-review",t)},APP.NotificationReview.prototype=Object.create(APP.BaseElement.prototype),APP.NotificationReview.constructor=APP.NotificationReview;
var APP=APP||{};APP.PhotoSwipe=function(){this.filter="w_1500,h_800,c_limit,q_80",this.isLoading=!1,this.zoom=!1,this.meta=null,this.setupUI(),this.listeners()},APP.PhotoSwipe.constructor=APP.PhotoSwipe,APP.PhotoSwipe.prototype.setupUI=function(){this.image=$("#work-image"),this.pswp=$(".pswp")[0],this.modal=$("#go-preload-modal")},APP.PhotoSwipe.prototype.listeners=function(){this.image.click(this.imageHandler.bind(this))},APP.PhotoSwipe.prototype.imageHandler=function(){if(this.zoom)this.isLoading&&this.modal.click();else{this.modal.click(),this.isLoading=!0;var i=Utils.addImageFilter(work.photo,this.filter),t=this;$("<img>").load(function(){t.imageLoadHandler(this)}).attr("src",i),this.zoom=!0}},APP.PhotoSwipe.prototype.imageLoadHandler=function(i){$("#lean_overlay").click(),this.isLoading=!1,this.meta={width:i.width,height:i.height},this.image.click(this.openPhotoSwipeHandler.bind(this)),this.image.click()},APP.PhotoSwipe.prototype.openPhotoSwipeHandler=function(){var i=[{src:Utils.addImageFilter(work.photo,this.filter),w:this.meta.width,h:this.meta.height}],t=this,o={getThumbBoundsFn:function(){return{x:t.image.offset.left,y:t.image.offset.top+50,w:t.image.width()}}};new PhotoSwipe(this.pswp,PhotoSwipeUI_Default,i,o).init()};
var APP=APP||{};APP.Post=function(P,t){APP.BaseElement.call(this,P,"post",t)},APP.Post.prototype=Object.create(APP.BaseElement.prototype),APP.Post.constructor=APP.Post;
var APP=APP||{};APP.PostMinimal=function(P,t){APP.BaseElement.call(this,P,"post-minimal",t)},APP.PostMinimal.prototype=Object.create(APP.BaseElement.prototype),APP.PostMinimal.constructor=APP.PostMinimal;
var APP=APP||{};APP.Product=function(t,e){APP.BaseElement.call(this,t,"product",e)},APP.Product.prototype=Object.create(APP.BaseElement.prototype),APP.Product.constructor=APP.Product,APP.Product.prototype.listeners=function(){APP.BaseElement.prototype.listeners.call(this),this.view.find(".delete").click(this.deleteHandler.bind(this)),this.view.find(".edit").click(this.editHandler.bind(this))},APP.Product.prototype.deleteHandler=function(){var t="/user/"+this.data.User.username+"/product/delete",e=this;$.post(t,{idProduct:this.data.id},function(t){200===t.status&&$(e.view.parent()).masonry("remove",e.view).masonry()})},APP.Product.prototype.editHandler=function(){location.href="/user/"+this.data.User.username+"/product/"+this.data.nameSlugify+"/edit"};
var APP=APP||{};APP.Review=function(e,P){APP.BaseElement.call(this,e,"review",P)},APP.Review.prototype=Object.create(APP.BaseElement.prototype),APP.Review.constructor=APP.Review;
var APP=APP||{};APP.TableBlog=function(e,P){APP.BaseElement.call(this,e,"table-blog",P)},APP.TableBlog.prototype=Object.create(APP.BaseElement.prototype),APP.TableBlog.constructor=APP.TableBlog;
var APP=APP||{};APP.TableUser=function(e,t){APP.BaseElement.call(this,e,"table-user",t)},APP.TableUser.prototype=Object.create(APP.BaseElement.prototype),APP.TableUser.constructor=APP.TableUser,APP.TableUser.prototype.listeners=function(){this.featuredBtn=this.view.find(".featured-btn"),this.featuredBtn.click(this.featuredHandler.bind(this))};
var APP=APP||{};APP.TableWork=function(e,t){APP.BaseElement.call(this,e,"table-work",t)},APP.TableWork.prototype=Object.create(APP.BaseElement.prototype),APP.TableWork.constructor=APP.TableWork,APP.TableWork.prototype.listeners=function(){this.featuredBtn=this.view.find(".featured-btn"),this.featuredBtn.click(this.featuredHandler.bind(this))};
var APP=APP||{};APP.UploaderImage=function(e,i,o){this.$view=e,this.photo=null,this.options=o||{uploader:$(".cloudinary-fileupload")},this.uploader=this.options.uploader,this.listeners(),this.onComplete=i},APP.UploaderImage.constructor=APP.UploaderImage,APP.UploaderImage.prototype.listeners=function(){var e=this;this.uploader.fileupload({start:function(i){e.$view.find(".upload").hide(),$(this).hide(),e.$view.find(".preload").removeClass("hide"),e.$view.find(".preload").show()},fail:function(i,o){e.$view.find(".upload").show(),$(this).show(),e.$view.find(".preload").hide()}}).off("cloudinarydone").on("cloudinarydone",function(i,o){if(console.log("data======>"),console.log(o),e.$view.find(".preload").hide(),e.$view.find(".preview").html(""),e.photo=o.result.url,e.onComplete)e.onComplete(o.result.public_id);else{var l=Utils.addImageFilter(o.result.url,"w_200,h_200,c_thumb");this.$view.find(".preview").append($("<img>",{src:l}))}})};
var APP=APP||{};APP.User=function(t,o){APP.BaseElement.call(this,t,"user",o)},APP.User.prototype=Object.create(APP.BaseElement.prototype),APP.User.constructor=APP.User,APP.User.prototype.listeners=function(){APP.BaseElement.prototype.listeners.call(this),this.view.find(".am-Follow-button").click(this.followHandler.bind(this))},APP.User.prototype.followHandler=function(){if(this.isLogged()){var t=this.data.following?"unfollow":"follow",o={url:DataApp.currentUser.url+"/"+t,data:{idUser:this.data.id}};Utils.getData(o).then(this.followHandlerComplete.bind(this))}},APP.User.prototype.followHandlerComplete=function(t){200===t.status&&(this.data.following?this.view.find(".am-Follow-button").removeClass("following").text("+Seguir"):this.view.find(".am-Follow-button").addClass("following").text("Siguiendo"),this.data.following=!this.data.following)};
var APP=APP||{};APP.Work=function(e,t){APP.BaseElement.call(this,e,"work",t)},APP.Work.prototype=Object.create(APP.BaseElement.prototype),APP.Work.constructor=APP.Work,APP.Work.prototype.listeners=function(){APP.BaseElement.prototype.listeners.call(this),this.view.find(".delete").click(this.deleteHandler.bind(this)),this.view.find(".delete-force").click(this.deleteForceHandler.bind(this)),this.view.find(".cancel").click(this.cancelHandler.bind(this)),this.view.find(".edit").click(this.editHandler.bind(this))},APP.Work.prototype.deleteHandler=function(){this.view.find(".delete").hide(),this.view.find(".delete-confirm").show()},APP.Work.prototype.deleteForceHandler=function(){if("single-collection"===this.options.context){var e="/user/"+this.data.User.username+"/work/remove_from_collection",t=this;$.post(e,{idWork:this.data.id,idCollection:collection.id},function(e){200===e.status&&$(t.view.parent()).masonry("remove",t.view).masonry()})}else{var e="/user/"+this.data.User.username+"/work/delete",t=this;$.post(e,{idWork:this.data.id},function(e){200===e.status&&$(t.view.parent()).masonry("remove",t.view).masonry()})}},APP.Work.prototype.cancelHandler=function(){this.view.find(".delete").show(),this.view.find(".delete-confirm").hide()},APP.Work.prototype.editHandler=function(){location.href="/user/"+this.data.User.username+"/work/"+this.data.nameSlugify+"/edit"};
var APP=APP||{};APP.BaseNavigation=function(){this.currentPage=0,this.totalPages=null,this.currentPageData,this.listeners(),this.needChangeUrl=!1},APP.BaseNavigation.constructor=APP.BaseNavigation,APP.BaseNavigation.prototype=Object.create(EventDispatcher.prototype),APP.BaseNavigation.prototype.start=function(){},APP.BaseNavigation.prototype.listeners=function(){},APP.BaseNavigation.prototype.suspend=function(){},APP.BaseNavigation.prototype.restart=function(){},APP.BaseNavigation.prototype.gotoPage=function(t,a){var e=t||this.currentPage+1;if(!a){if(this.currentPage===e)return;0===this.currentPage&&(this.currentPage=1)}this.totalPages&&e>this.totalPages||(this.dispatchEvent({type:Events.LOAD_START}),this.newPageUrl(e),Utils.getData({url:DataApp.currentUrl}).done(this.afterGetData.bind(this)))},APP.BaseNavigation.prototype.afterGetData=function(t){console.log(t),this.currentPage=t.pagination.page,this.totalPages=t.pagination.pages,this.currentPageData=t,this.dispatchEvent({type:Events.LOAD_END,data:t})},APP.BaseNavigation.prototype.newPageUrl=function(t){DataApp.currentUrl=DataApp.currentUrl.replace(/\/$/g,""),-1===DataApp.currentUrl.indexOf("/page-")&&(DataApp.currentUrl+="/page-"+this.currentPage),DataApp.currentUrl=DataApp.currentUrl.replace("page-"+this.currentPage,"page-"+t)},APP.BaseNavigation.prototype.reset=function(){this.currentPageData=null,this.gotoPage(1,!0),Utils.changeUrl("",DataApp.currentUrl)};
var APP=APP||{};APP.InfiniteNavigation=function(){APP.BaseNavigation.call(this),this.counter=0},APP.InfiniteNavigation.prototype=Object.create(APP.BaseNavigation.prototype),APP.InfiniteNavigation.constructor=APP.InfiniteNavigation,APP.InfiniteNavigation.prototype.listeners=function(){this.scrollHandler=this.scrollHandler.bind(this),$(window).on("scroll",this.scrollHandler)},APP.InfiniteNavigation.prototype.scrollHandler=function(){$(window).scrollTop()>=$(document).height()-$(window).height()-$(".am-Footer").height()&&(++this.counter,1===this.counter&&(this.suspend(),this.gotoPage(this.currentPage+1)))},APP.InfiniteNavigation.prototype.suspend=function(){$(window).off("scroll",this.scrollHandler)},APP.InfiniteNavigation.prototype.restart=function(){this.counter=0,$(window).on("scroll",this.scrollHandler)};
var APP=APP||{};APP.PaginationNavigation=function(){this.maxButtons=6,APP.BaseNavigation.call(this)},APP.PaginationNavigation.prototype=Object.create(APP.BaseNavigation.prototype),APP.PaginationNavigation.constructor=APP.PaginationNavigation,APP.PaginationNavigation.prototype.start=function(){this.makeButtons()},APP.PaginationNavigation.prototype.listeners=function(){$(document).on("click",".np-page-button",this.pagesHandler.bind(this))},APP.PaginationNavigation.prototype.pagesHandler=function(t){t.preventDefault();var a=$(t.currentTarget).attr("id");this.gotoPage(a)},APP.PaginationNavigation.prototype.build=function(){this.makeButtons()},APP.PaginationNavigation.prototype.makeButtons=function(){$(".am-Pagination").empty();var t=Utils.paginationButtons(this.currentPage,this.totalPages,this.maxButtons);if(t){var a=0;for(a;a<t.length;a++){var i=DataApp.currentUrl.replace("page-"+ +this.currentPage,"page-"+t[a]),n=$('<li style="display:inline-block;margin:10px;"><a class="np-page-button" href="'+i+'">'+t[a]+"</a></li>");$(".am-Pagination").append(n)}}};
var APP=APP||{};APP.AccountIndexScreen=function(){APP.BaseScreen.call(this,"accountIndex"),this.timeout=null,this.isUserAvailable=!0},APP.AccountIndexScreen.constructor=APP.AccountIndexScreen,APP.AccountIndexScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AccountIndexScreen.prototype.setupUI=function(){this.uploaderImage=new APP.UploaderImage($(".uploader-profile"),this.uploaderImageComplete),this.uploaderImage.photo=DataApp.currentUser.photo,this.save=$(".save"),this.saveLoading=$(".save-loading"),this.isArtist=$("input[name=isArtist]"),this.firstname=$("input[name=firstname]"),this.lastname=$("input[name=lastname]"),this.pseudonimo=$("input[name=pseudonimo]"),this.username=$("input[name=username]"),this.gender=$("select[name=gender]"),this.birthday=$("input[name=birthday]"),this.country=$("select[name=country]"),this.city=$("input[name=city]"),this.biography=$("textarea[name=biography]"),this.completeForm=$(".complete-form"),this.artistData=$(".artist-data"),this.gender.find("option:contains("+DataApp.currentUser.gender+")").attr("selected",!0),this.country.find("option:contains("+DataApp.currentUser.country+")").attr("selected",!0),this.typeName=$("select[name=typeName]");var e=DataApp.currentUser.isArtist?1:0;$("input[name=isArtist][value="+e+"]").attr("checked",!0);for(var t=0;t<interests.length;t++)$("input[type=checkbox][value="+interests[t].id+"]").attr("checked",!0);this.typeName.val(DataApp.currentUser.typeName),$("#date").mask("99/99/9999")},APP.AccountIndexScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.username.keyup(this.usernameKeyUpHandler.bind(this)),this.completeForm.submit(this.completeFormHandler.bind(this)),this.isArtist.change(this.isArtistHandler.bind(this))},APP.AccountIndexScreen.prototype.isArtistHandler=function(e){var t=parseInt($(e.target).val(),10);this.artistData[0===t?"hide":"show"]()},APP.AccountIndexScreen.prototype.usernameKeyUpHandler=function(e){Validations.notBlank(this.username.val())||(clearTimeout(this.timeout),this.timeout=setTimeout(this.timeoutHandler.bind(this),100))},APP.AccountIndexScreen.prototype.timeoutHandler=function(){var e={property:"username",value:this.username.val()};this.requestHandler("/auth/check",e,this.checkUsernameComplete)},APP.AccountIndexScreen.prototype.checkUsernameComplete=function(e){this.isUserAvailable=e.data.available},APP.AccountIndexScreen.prototype.completeFormHandler=function(e){e.preventDefault();var t=[],a=this;Validations.notBlank(this.firstname.val())&&t.push("Ingrese sus nombre"),Validations.notBlank(this.lastname.val())&&t.push("Ingrese sus apellidos"),Validations.notBlank(this.username.val())&&t.push("Ingrese su nombre de usuario"),Validations.username(this.username.val())||t.push("Nombre de usuario solo acepta numeros y letras"),Validations.notBlank(this.gender.val())&&t.push("Ingrese su genero"),Validations.notBlank(this.birthday.val())&&t.push("Ingrese su cumpleaños"),Validations.notBlank(this.country.val())&&t.push("Ingrese su pais"),Validations.notBlank(this.city.val())&&t.push("Ingrese su ciudad"),"2"===this.typeName.val()&&Validations.notBlank(this.pseudonimo.val())&&t.push("Ingrese su pseudonimo");var n=[];if($("input[name=interests]:checked").each(function(){n.push(parseInt($(this).val(),10))}),n.length<2&&t.push("Seleccione al menos 2 intereses"),this.isUserAvailable||t.push("Usuario no disponible"),t.length>0)return this.showFlash("error",t);this.saveLoading.show(),this.save.hide();var s=this.completeForm.serializeArray();$.each(s,function(e,t){if("photo"===t.name){var n="w_150,h_150,c_thumb,d_am_avatar.jpg";t.value=Utils.addImageFilter(a.uploaderImage.photo,n)}"typeName"===t.name&&(t.value=parseInt(t.value,10))});var i="/user/"+profile.username+"/account/update";this.requestHandler(i,s,this.afterSaveHandler)},APP.AccountIndexScreen.prototype.afterSaveHandler=function(e){this.showFlash("succes","Se actualizo su perfil"),this.saveLoading.hide(),this.save.show();var t=e.data.user,a=setTimeout(function(){clearTimeout(a),window.location.href="/user/"+t.username},1e3)},APP.AccountIndexScreen.prototype.uploaderImageComplete=function(e){this.$view.find(".upload").show(),$(".cloudinary-fileupload").show();var t={width:150,height:150,crop:"thumb"};$.cloudinary.image(e,t).appendTo(this.$view.find(".preview"))};
var APP=APP||{};APP.AccountPasswordScreen=function(){APP.BaseScreen.call(this,"accountPassword"),this.timeout=null,this.isUserAvailable=!0},APP.AccountPasswordScreen.constructor=APP.AccountPasswordScreen,APP.AccountPasswordScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AccountPasswordScreen.prototype.setupUI=function(){this.uploaderImage=new APP.UploaderImage($(".uploader-profile"),this.uploaderImageComplete),this.uploaderImage.photo=DataApp.currentUser.photo,this.save=$(".save"),this.saveLoading=$(".save-loading"),this.password=$(".password"),this.rePassword=$(".rePassword"),this.form=$(".password-form"),this.form.submit(this.formHandler.bind(this))},APP.AccountPasswordScreen.prototype.formHandler=function(s){if(s.preventDefault(),this.password.val()!==this.rePassword.val())return this.showFlash("error","Las contraseñas no coinciden");var e="/user/"+profile.username+"/account/password";this.requestHandler(e,this.form.serialize(),this.changePasswordHandler)},APP.AccountPasswordScreen.prototype.changePasswordHandler=function(s){this.showFlash("succes","Contraseña cambiada")};
var APP=APP||{};APP.AddWorkScreen=function(){APP.BaseScreen.call(this,"addWork"),this.work=null},APP.AddWorkScreen.constructor=APP.AddWorkScreen,APP.AddWorkScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AddWorkScreen.prototype.setupUI=function(){this.workForm=$(".work-form"),this.uploader=$(".uploader-work"),this.name=$("input[name=name]"),this.category=$("select[name=category]"),this.description=$("textarea[name=description]"),this.tags=$("input[name=tags]"),this.tags.tagsInput({height:"50px",width:"100%",defaultText:"+Etiqueta"}),this.send=$(".send"),this.sendLoading=$(".send-loading"),this.workDelete=$(".work-delete"),this.workDeleteConfirm=$(".work-delete-confirm"),this.workDeleteCancel=$(".work-delete-cancel"),this.workDeleteForce=$(".work-delete-force"),this.workPhotoPublished=$(".work-photo-published"),this.workNamePublished=$(".work-name-published"),this.workUserPublished=$(".work-user-published"),this.workPublished=$(".work-published"),this.workView=$(".work-view"),this.workNew=$(".work-new"),this.workEdit=$(".work-edit"),this.uploaderImage=new APP.UploaderImage(this.uploader,this.imgComplete)},APP.AddWorkScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.workForm.submit(this.workFormSubmitHandler.bind(this)),this.workDelete.click(this.deleteHandler.bind(this)),this.workDeleteForce.click(this.workDeleteForceHandler.bind(this)),this.workDeleteCancel.click(this.deleteCancel.bind(this)),$("input[type=checkbox]").change(this.publicHandler)},APP.AddWorkScreen.prototype.publicHandler=function(){$(this).parent().find(".value").text(this.checked?"On":"Off")},APP.AddWorkScreen.prototype.workFormSubmitHandler=function(e){e.preventDefault();var t=[],r=this;if(this.uploaderImage.photo||t.push("Ingrese una foto"),Validations.notBlank(this.name.val())&&t.push("Ingrese un nombre"),Validations.notBlank(this.category.val())&&t.push("Ingrese una categoria"),Validations.notBlank(this.description.val())&&t.push("Ingrese una descripcion"),this.tags.val().split(",")[0].length<1&&t.push("Ingrese etiquetas"),t.length>0)return this.showFlash("error",t);this.sendLoading.show(),this.send.hide();var o=this.workForm.serializeArray();$.each(o,function(e,t){"photo"===t.name&&(t.value=r.uploaderImage.photo),("nsfw"===t.name||"public"===t.name)&&(t.value="on"===t.value)});var i=DataApp.currentUser.url+"/work/create";this.requestHandler(i,o,this.workCreatedComplete)},APP.AddWorkScreen.prototype.workCreatedComplete=function(e){this.showFlash("succes","Su obra se subió exitosamente"),this.work=e.data.work,this.workForm.hide(),this.sendLoading.hide(),this.send.show();var t=DataApp.currentUser.url+"/work/"+this.work.nameSlugify,r=Utils.addImageFilter(this.work.photo,"w_300,c_limit");this.workView.attr("href",t),this.workNew.attr("href",DataApp.currentUser.url+"/work/add"),this.workEdit.attr("href",t+"/edit"),this.workPhotoPublished.attr("src",r),this.workNamePublished.text(this.work.name),this.workUserPublished.text(DataApp.currentUser.fullname),this.workPublished.show()},APP.AddWorkScreen.prototype.deleteHandler=function(e){this.workDelete.hide(),this.workDeleteConfirm.show()},APP.AddWorkScreen.prototype.workDeleteForceHandler=function(){var e=DataApp.currentUser.url+"/work/delete";this.requestHandler(e,{idWork:this.work.id},this.forceComplete)},APP.AddWorkScreen.prototype.forceComplete=function(){this.showFlash("succes","Se elimino tu obra"),setTimeout(function(){window.location.href=DataApp.currentUser.url},1e3)},APP.AddWorkScreen.prototype.deleteCancel=function(e){this.workDelete.show(),this.workDeleteConfirm.hide()},APP.AddWorkScreen.prototype.imgComplete=function(e){this.$view.find(".upload").show();var t={format:"jpg",width:300,crop:"limit"};img=$.cloudinary.image(e,t).appendTo(this.$view.find(".preview")),$(".cloudinary-fileupload").show()};
var APP=APP||{};APP.AdminBlogScreen=function(){APP.BaseScreen.call(this,"adminBlog")},APP.AdminBlogScreen.constructor=APP.AdminBlogScreen,APP.AdminBlogScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AdminBlogScreen.prototype.setupUI=function(){if(this.searchBtn=$(".search-btn"),this.start=$(".start"),this.end=$(".end"),this.startValue=null,this.endValue=null,this.term=null,Utils.getUrlParameter("start")){var t=Utils.getUrlParameter("start");this.startValue=new Date(t),this.start.find("input").val(t.replace(/-/gi,"/"))}if(Utils.getUrlParameter("end")){var e=Utils.getUrlParameter("end");this.endValue=new Date(e),this.end.find("input").val(e.replace(/-/gi,"/"))}this.viewer=new APP.Viewer("tableWork",$(".container-items"),"infinite",data,{getTotal:function(t){$(".total").text("("+t+")")}}),this.searchBox=$(".search-box")},APP.AdminBlogScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.start.datepicker().on("changeDate",this.startDateChange.bind(this)),this.end.datepicker().on("changeDate",this.endDateChange.bind(this)),this.searchBtn.click(this.searchHander.bind(this)),$(".dropdown-menu li a").click(this.dropdownChange.bind(this)),Utils.getUrlParameter("term")&&(this.term=Utils.getUrlParameter("term"),$("."+this.term).click()),Utils.getUrlParameter("termValue")&&this.searchBox.val(decodeURI(Utils.getUrlParameter("termValue")))},APP.AdminBlogScreen.prototype.startDateChange=function(t){this.startValue=t.date},APP.AdminBlogScreen.prototype.endDateChange=function(t){this.endValue=t.date},APP.AdminBlogScreen.prototype.dropdownChange=function(t){var e=$(t.target).text();switch($(".btn-drop .property").text(e),$(".btn-drop .property").val(e),e){case"publicado":this.term="published"}},APP.AdminBlogScreen.prototype.searchHander=function(){var t=this.searchBox.val().trim();if(this.term&&this.term.trim().length>0){if("featured"===this.term&&t.length>0&&isNaN(parseInt(t,10)))return this.showFlash("error",["El valor necesita ser 1 o 0"]);t.length>0?(DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"term",this.term),DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"termValue",t)):(DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"term"),DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"termValue"))}else if(DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"term"),DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"termValue"),t.length>0)return this.showFlash("error",["Necesitas seleccionar una propiedad"]);if(this.startValue){if(!this.endValue)return this.showFlash("error",["Ingresa una fecha de fin"]);var e=this.startValue.getMonth()+1+"-"+this.startValue.getDate()+"-"+this.startValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"start",e)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"start");if(this.endValue){if(!this.startValue)return this.showFlash("error",["Ingresa una fecha de inicio"]);var r=this.endValue.getMonth()+1+"-"+this.endValue.getDate()+"-"+this.endValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"end",r)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"end");DataApp.currentUrl!==window.location.href&&(Utils.changeUrl(this.id,DataApp.currentUrl),this.viewer.reset())};
var APP=APP||{};APP.AdminEditBannerScreen=function(){APP.BaseScreen.call(this,"adminEditBanner")},APP.AdminEditBannerScreen.constructor=APP.AdminEditBannerScreen,APP.AdminEditBannerScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AdminEditBannerScreen.prototype.setupUI=function(){this.uploader=$(".uploader-image"),this.uploaderImage=new APP.UploaderImage(this.uploader,this.imgComplete),this.sendBtn=$(".send-btn"),this.uploaderImage.photo=banner.image},APP.AdminEditBannerScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.sendBtn.click(this.sendHandler.bind(this))},APP.AdminEditBannerScreen.prototype.sendHandler=function(e){e.preventDefault();var n=[];if(Validations.notBlank($("input[name=link]").val())&&n.push("Ingrese un link"),this.uploaderImage.photo||n.push("Ingrese una foto"),n.length>0)return this.showFlash("error",n);var t=this,i=$("form").serializeArray();$.each(i,function(e,n){"image"===n.name&&(n.value=t.uploaderImage.photo)});var r="/report/banners/update";this.requestHandler(r,i,this.updateComplete)},APP.AdminEditBannerScreen.prototype.updateComplete=function(e){this.showFlash("succes","Se edito el banner"),setTimeout(function(){window.location.href="/report/banners/"},1e3)},APP.AdminEditBannerScreen.prototype.imgComplete=function(e){this.$view.find(".upload").show(),$(".cloudinary-fileupload").show();var n={width:300,crop:"limit"};$.cloudinary.image(e,n).appendTo(this.$view.find(".preview"))};
var APP=APP||{};APP.AdminEditUserScreen=function(){APP.BaseScreen.call(this,"adminEditUser")},APP.AdminEditUserScreen.constructor=APP.AdminEditUserScreen,APP.AdminEditUserScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AdminEditUserScreen.prototype.setupUI=function(){this.amBtn=$(".am-btn"),this.deleteBtn=$(".delete-btn"),this.updateBtn=$(".update-btn")},APP.AdminEditUserScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.amBtn.click(this.amHandler.bind(this)),this.deleteBtn.click(this.deleteHandler.bind(this)),this.updateBtn.click(this.updateHandler.bind(this))},APP.AdminEditUserScreen.prototype.amHandler=function(e){e.preventDefault();var t="/user/"+userToEdit.username+"/"+(userToEdit.featured?"unfeatured":"featured");this.requestHandler(t,{idUser:userToEdit.id},this.featuredComplete)},APP.AdminEditUserScreen.prototype.featuredComplete=function(e){userToEdit=e.data.user,userToEdit.featured?this.amBtn.addClass("btn-primary").val("Recomendado"):this.amBtn.removeClass("btn-primary").val("Recomendar"),this.showFlash("succes","Se actualizo el usuario")},APP.AdminEditUserScreen.prototype.deleteHandler=function(e){e.preventDefault();var t=confirm("Quiero eliminar este usuario?");if(t){var r="/user/"+userToEdit.username+"/delete";this.requestHandler(r,{idUser:userToEdit.id},this.deleteComplete)}},APP.AdminEditUserScreen.prototype.deleteComplete=function(){this.showFlash("succes","Se elimino el usuario"),setTimeout(function(){window.location.href="/report"},1e3)},APP.AdminEditUserScreen.prototype.updateHandler=function(e){e.preventDefault();var t="/user/"+userToEdit.username+"/account/update";this.requestHandler(t,$("form").serialize(),this.updateComplete)},APP.AdminEditUserScreen.prototype.updateComplete=function(e){this.showFlash("succes","Se actualizo el usuario")};
var APP=APP||{};APP.AdminGeneralScreen=function(){APP.BaseScreen.call(this,"adminGeneral")},APP.AdminGeneralScreen.constructor=APP.AdminGeneralScreen,APP.AdminGeneralScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AdminGeneralScreen.prototype.setupUI=function(){if(this.searchBtn=$(".search-btn"),this.start=$(".start"),this.end=$(".end"),this.startValue=null,this.endValue=null,Utils.getUrlParameter("start")){var e=Utils.getUrlParameter("start");this.startValue=new Date(e),this.start.find("input").val(e.replace(/-/gi,"/"))}if(Utils.getUrlParameter("end")){var t=Utils.getUrlParameter("end");this.endValue=new Date(t),this.end.find("input").val(t.replace(/-/gi,"/"))}},APP.AdminGeneralScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.start.datepicker().on("changeDate",this.startDateChange.bind(this)),this.end.datepicker().on("changeDate",this.endDateChange.bind(this)),this.searchBtn.click(this.searchHander.bind(this))},APP.AdminGeneralScreen.prototype.startDateChange=function(e){this.startValue=e.date},APP.AdminGeneralScreen.prototype.endDateChange=function(e){this.endValue=e.date},APP.AdminGeneralScreen.prototype.searchHander=function(){if(this.startValue){if(!this.endValue)return this.showFlash("error",["Ingresa una fecha de fin"]);var e=this.startValue.getMonth()+1+"-"+this.startValue.getDate()+"-"+this.startValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"start",e)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"start");if(this.endValue){if(!this.startValue)return this.showFlash("error",["Ingresa una fecha de inicio"]);var t=this.endValue.getMonth()+1+"-"+this.endValue.getDate()+"-"+this.endValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"end",t)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"end");DataApp.currentUrl!==window.location.href&&(window.location.href=DataApp.currentUrl)};
var APP=APP||{};APP.AdminUsersScreen=function(){APP.BaseScreen.call(this,"adminUsers")},APP.AdminUsersScreen.constructor=APP.AdminUsersScreen,APP.AdminUsersScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AdminUsersScreen.prototype.setupUI=function(){if(this.searchBtn=$(".search-btn"),this.start=$(".start"),this.end=$(".end"),this.startValue=null,this.endValue=null,this.term=null,Utils.getUrlParameter("start")){var e=Utils.getUrlParameter("start");this.startValue=new Date(e),this.start.find("input").val(e.replace(/-/gi,"/"))}if(Utils.getUrlParameter("end")){var t=Utils.getUrlParameter("end");this.endValue=new Date(t),this.end.find("input").val(t.replace(/-/gi,"/"))}this.viewer=new APP.Viewer("tableUser",$(".container-items"),"infinite",data,{getTotal:function(e){$(".total").text("("+e+")")}}),this.searchBox=$(".search-box")},APP.AdminUsersScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.start.datepicker().on("changeDate",this.startDateChange.bind(this)),this.end.datepicker().on("changeDate",this.endDateChange.bind(this)),this.searchBtn.click(this.searchHander.bind(this)),$(".dropdown-menu li a").click(this.dropdownChange.bind(this)),Utils.getUrlParameter("term")&&(this.term=Utils.getUrlParameter("term"),$("."+this.term).click()),Utils.getUrlParameter("termValue")&&this.searchBox.val(decodeURI(Utils.getUrlParameter("termValue")))},APP.AdminUsersScreen.prototype.startDateChange=function(e){this.startValue=e.date},APP.AdminUsersScreen.prototype.endDateChange=function(e){this.endValue=e.date},APP.AdminUsersScreen.prototype.dropdownChange=function(e){var t=$(e.target).text();switch($(".btn-drop .property").text(t),$(".btn-drop .property").val(t),t){case"username":this.term="username";break;case"email":this.term="email";break;case"ciudad":this.term="city";break;case"pais":this.term="country";break;case"artista":this.term="isArtist";break;case"verificado":this.term="verified";break;case"completo":this.term="filled";break;case"recomendado":this.term="featured"}},APP.AdminUsersScreen.prototype.searchHander=function(){var e=this.searchBox.val().trim();if(this.term&&this.term.trim().length>0){if(("isArtist"===this.term||"verified"===this.term||"filled"===this.term)&&isNaN(parseInt(e,10)))return this.showFlash("error",["El valor necesita ser 1 o 0"]);e.length>0?(DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"term",this.term),DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"termValue",e)):(DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"term"),DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"termValue"))}else if(DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"term"),DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"termValue"),e.length>0)return this.showFlash("error",["Necesitas seleccionar una propiedad"]);if(this.startValue){if(!this.endValue)return this.showFlash("error",["Ingresa una fecha de fin"]);var t=this.startValue.getMonth()+1+"-"+this.startValue.getDate()+"-"+this.startValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"start",t)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"start");if(this.endValue){if(!this.startValue)return this.showFlash("error",["Ingresa una fecha de inicio"]);var r=this.endValue.getMonth()+1+"-"+this.endValue.getDate()+"-"+this.endValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"end",r)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"end");DataApp.currentUrl!==window.location.href&&(Utils.changeUrl(this.id,DataApp.currentUrl),this.viewer.reset())};
var APP=APP||{};APP.AdminWorksScreen=function(){APP.BaseScreen.call(this,"adminWorks")},APP.AdminWorksScreen.constructor=APP.AdminWorksScreen,APP.AdminWorksScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AdminWorksScreen.prototype.setupUI=function(){if(this.searchBtn=$(".search-btn"),this.start=$(".start"),this.end=$(".end"),this.startValue=null,this.endValue=null,this.term=null,Utils.getUrlParameter("start")){var e=Utils.getUrlParameter("start");this.startValue=new Date(e),this.start.find("input").val(e.replace(/-/gi,"/"))}if(Utils.getUrlParameter("end")){var t=Utils.getUrlParameter("end");this.endValue=new Date(t),this.end.find("input").val(t.replace(/-/gi,"/"))}this.viewer=new APP.Viewer("tableWork",$(".container-items"),"infinite",data,{getTotal:function(e){$(".total").text("("+e+")")}}),this.searchBox=$(".search-box")},APP.AdminWorksScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.start.datepicker().on("changeDate",this.startDateChange.bind(this)),this.end.datepicker().on("changeDate",this.endDateChange.bind(this)),this.searchBtn.click(this.searchHander.bind(this)),$(".dropdown-menu li a").click(this.dropdownChange.bind(this)),Utils.getUrlParameter("term")&&(this.term=Utils.getUrlParameter("term"),$("."+this.term).click()),Utils.getUrlParameter("termValue")&&this.searchBox.val(decodeURI(Utils.getUrlParameter("termValue")))},APP.AdminWorksScreen.prototype.startDateChange=function(e){this.startValue=e.date},APP.AdminWorksScreen.prototype.endDateChange=function(e){this.endValue=e.date},APP.AdminWorksScreen.prototype.dropdownChange=function(e){var t=$(e.target).text();switch($(".btn-drop .property").text(t),$(".btn-drop .property").val(t),t){case"nombre":this.term="name";break;case"recomendado":this.term="featured"}},APP.AdminWorksScreen.prototype.searchHander=function(){var e=this.searchBox.val().trim();if(this.term&&this.term.trim().length>0){if("featured"===this.term&&e.length>0&&isNaN(parseInt(e,10)))return this.showFlash("error",["El valor necesita ser 1 o 0"]);e.length>0?(DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"term",this.term),DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"termValue",e)):(DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"term"),DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"termValue"))}else if(DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"term"),DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"termValue"),e.length>0)return this.showFlash("error",["Necesitas seleccionar una propiedad"]);if(this.startValue){if(!this.endValue)return this.showFlash("error",["Ingresa una fecha de fin"]);var t=this.startValue.getMonth()+1+"-"+this.startValue.getDate()+"-"+this.startValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"start",t)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"start");if(this.endValue){if(!this.startValue)return this.showFlash("error",["Ingresa una fecha de inicio"]);var r=this.endValue.getMonth()+1+"-"+this.endValue.getDate()+"-"+this.endValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"end",r)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"end");DataApp.currentUrl!==window.location.href&&(Utils.changeUrl(this.id,DataApp.currentUrl),this.viewer.reset())};
var APP=APP||{};APP.AuthScreen=function(e){this.meta=e,APP.BaseScreen.call(this,"auth"),console.log(Cookies.get("return_to"))},APP.AuthScreen.constructor=APP.AuthScreen,APP.AuthScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AuthScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),$(".fb").click(this.fbHandler.bind(this)),$(".auth-form").submit(this.formHandler.bind(this))},APP.AuthScreen.prototype.fbHandler=function(){$(".fb").hide(),$(".fb-loading").show()},APP.AuthScreen.prototype.formHandler=function(e){e.preventDefault(),$(".submit").hide(),$(".submit-loading").show();var t="/auth/"+this.meta,r=$(".auth-form").serialize();this.requestHandler(t,r,this.requestAuthComplete,this.requestAuthError,!0)},APP.AuthScreen.prototype.requestAuthError=function(e){"signup"===this.meta&&grecaptcha.reset(),$(".submit").show(),$(".submit-loading").hide()},APP.AuthScreen.prototype.requestAuthComplete=function(e){if($(".submit").show(),$(".submit-loading").hide(),"reset"===this.meta){this.showFlash("succes","Contraseña cambiada");var t=setTimeout(function(){return clearTimeout(t),location.href="/auth/login"},1e3)}else{if("forgot"!==this.meta)return location.href=e.data.returnTo;this.showFlash("succes","Se envio el correo")}};
var APP=APP||{};APP.BlogScreen=function(){APP.BaseScreen.call(this,"blog")},APP.BlogScreen.constructor=APP.BlogScreen,APP.BlogScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.BlogScreen.prototype.setupUI=function(){this.viewer=new APP.Viewer("post",$(".articles-container"),"infinite",posts)};
var APP=APP||{};APP.CollectionScreen=function(){APP.BaseScreen.call(this,"collection")},APP.CollectionScreen.constructor=APP.CollectionScreen,APP.CollectionScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.CollectionScreen.prototype.setupUI=function(){this.viewer=new APP.Viewer("work",$(".grid"),null,works,{context:"single-collection"}),this.workDelete=$(".work-delete"),this.workDeleteConfirm=$(".work-delete-confirm"),this.workDeleteCancel=$(".work-delete-cancel"),this.workDeleteForce=$(".work-delete-force"),this.collectionForm=$(".collection-form"),this.collectionName=$(".collection-name"),this.collectionDescription=$(".collection-description"),this.save=$(".save"),this.saveLoading=$(".save-loading"),this["public"]=$("input[name=public]"),$("#go-collection-modal").leanModal()},APP.CollectionScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.workDelete.click(this.workDeleteHandler.bind(this)),this.workDeleteForce.click(this.workDeleteForceHandler.bind(this)),this.workDeleteCancel.click(this.workDeleteCancelHandler.bind(this)),this.save.click(this.saveHandler.bind(this)),this.collectionForm.submit(this.collectionFormHandler.bind(this)),this["public"].change(this.publicChangeHandler),this["public"].change()},APP.CollectionScreen.prototype.saveHandler=function(){this.collectionForm.submit()},APP.CollectionScreen.prototype.publicChangeHandler=function(){$(this).parent().find(".value").text(this.checked?"On":"Off")},APP.CollectionScreen.prototype.collectionFormHandler=function(e){e.preventDefault(),this.save.hide(),this.saveLoading.show();var t=DataApp.currentUser.url+"/collection/update",o={name:$("input[name=name]").val(),description:$("textarea[name=description]").val(),"public":void 0!==$("input[name=public]:checked").val(),idCollection:collection.id};this.requestHandler(t,o,this.collectionUpdateComplete)},APP.CollectionScreen.prototype.collectionUpdateComplete=function(e){this.save.show(),this.saveLoading.hide();var t=e.data.collection,o="/user/"+collection.User.username+"/collection/"+t.nameSlugify;this.collectionName.text(t.name),this.collectionDescription.text(t.description),$("#lean_overlay").trigger("click"),this.showFlash("succes","Se actualizo tu coleccion"),Utils.changeUrl(collection.name,o)},APP.CollectionScreen.prototype.workDeleteCancelHandler=function(){this.workDelete.show(),this.workDeleteConfirm.hide()},APP.CollectionScreen.prototype.workDeleteHandler=function(){this.workDelete.hide(),this.workDeleteConfirm.show()},APP.CollectionScreen.prototype.workDeleteForceHandler=function(){var e=DataApp.currentUser.url+"/collection/delete";this.requestHandler(e,{idCollection:collection.id},this.collectionDeleteComplete)},APP.CollectionScreen.prototype.collectionDeleteComplete=function(){$("#lean_overlay").trigger("click"),this.showFlash("succes","Se elimino tu coleccion"),setTimeout(function(){window.location.href="/user/"+collection.User.username+"/collections"},1e3)};
var APP=APP||{};APP.ConfirmEmailScreen=function(){APP.BaseScreen.call(this,"confirmEmail")},APP.ConfirmEmailScreen.constructor=APP.ConfirmEmailScreen,APP.ConfirmEmailScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.ConfirmEmailScreen.prototype.setupUI=function(){this.messageSuccess=$(".msg-succes"),this.resend=$(".resend-btn"),this.resendLoading=$(".resend-loading")},APP.ConfirmEmailScreen.prototype.listeners=function(){this.resend.click(this.resendHandler.bind(this))},APP.ConfirmEmailScreen.prototype.resendHandler=function(){this.messageSuccess.hide(),this.resendLoading.show(),this.resend.hide(),this.requestHandler("/auth/resend",{},this.resendComplete)},APP.ConfirmEmailScreen.prototype.resendComplete=function(e){this.messageSuccess.show(),this.resendLoading.hide(),this.resend.show()};
var APP=APP||{},scope,timeout;APP.CreatorPostScreen=function(){APP.BaseScreen.call(this,"creatorPost"),scope=this},APP.CreatorPostScreen.constructor=APP.CreatorPostScreen,APP.CreatorPostScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.CreatorPostScreen.prototype.setupUI=function(){this.category=$("select[name=category]"),this.name=$("input[name=name]"),this.status=$(".status"),this["delete"]=$(".delete-btn"),this.deleteConfirm=$(".delete-confirm"),this.deleteForce=$(".delete-force"),this.cancel=$(".cancel"),this.previewBtn=$(".preview-btn"),this.publishBtn=$(".publish-btn"),this.amBtn=$(".am-btn"),this.cover=new APP.UploaderImage($(".uploader-cover"),this.coverComplete,{uploader:$(".editor-cover")}),edit&&(this.category.find("option[value="+post.Category.id+"]").attr("selected",!0),this.cover.photo=post.photo),this.editable=$(".editable"),this.editor=new MediumEditor(".editable",{buttonLabels:"fontawesome",targetBlank:!0,imageDragging:!1,placeholder:{text:"Ingresa el contenido del post :)"},toolbar:{buttons:["h2","h3","bold","italic","quote","anchor","justifyLeft","justifyCenter","justifyRight"]}}),this.editable.mediumInsert({editor:this.editor,addons:{embeds:{placeholder:"Inserta el código de embebido de youtube y luego presiona enter"}}}),this.isUploading=!1},APP.CreatorPostScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),Broadcaster.addEventListener("imageStarted",this.imageStarted.bind(this)),Broadcaster.addEventListener("imageProgressComplete",this.progressComplete.bind(this)),Broadcaster.addEventListener("imageLoaded",this.imageLoaded.bind(this));var e=MediumEditor.util.throttle(this.autoSave.bind(this),2e3);this.editor.subscribe("editableInput",e),window.onbeforeunload=this.beforeUnLoad.bind(this),this.category.change(this.inputChange.bind(this)),this.name.keyup(this.nameKeyUp.bind(this)),this["delete"].click(this.deleteHandler.bind(this)),this.cancel.click(this.cancelHandler.bind(this)),this.deleteForce.click(this.deleteForceHandler.bind(this)),this.publishBtn.click(this.publishHandler.bind(this)),this.amBtn.click(this.featuredHandler.bind(this))},APP.CreatorPostScreen.prototype.publishHandler=function(){if(!post)return this.showFlash("error",["Rellena todos los campos del post"]);var e="/blog/post/"+(post.published?"unpublish":"publish");this.requestHandler(e,{idPost:post.id},this.publishComplete)},APP.CreatorPostScreen.prototype.publishComplete=function(e){post=e.data.post,post.published?this.publishBtn.addClass("publish").text("PUBLICADO"):this.publishBtn.removeClass("publish").text("PUBLICAR")},APP.CreatorPostScreen.prototype.featuredHandler=function(){if(!post)return this.showFlash("error",["Rellena todos los campos del post"]);var e="/blog/post/"+(post.featured?"unfeatured":"featured");this.requestHandler(e,{idPost:post.id},this.featuredComplete)},APP.CreatorPostScreen.prototype.featuredComplete=function(e){post=e.data.post,post.featured?this.amBtn.addClass("am"):this.amBtn.removeClass("am")},APP.CreatorPostScreen.prototype.imageStarted=function(){this.isUploading=!0,this.status.text("Cargando imagenes....")},APP.CreatorPostScreen.prototype.progressComplete=function(){this.status.text("Procesando imagenes....")},APP.CreatorPostScreen.prototype.imageLoaded=function(){this.isUploading=!1,this.autoSave(null,this.editable),this.status.text("Imagenes cargadas")},APP.CreatorPostScreen.prototype.autoSave=function(e,t){if(this.isUploading)return this.showFlash("error",["Las imágenes aún se estan cargando"]);var o=[],s=this.name.val(),i=this.category.val();if(this.editable=t,s.trim().length<1&&o.push("Agrega un titulo"),null===i&&o.push("Selecciona una categoria"),null===this.cover.photo&&o.push("Selecciona una imagen de cover"),o.length>0)return this.showFlash("error",o);var r=this.editor.serialize()["element-0"].value;t=$(t);var a={body:r,name:s,category:i,description:t.find("p").text().substr(0,180),photo:this.cover.photo};this.status.text("Guardando.....");var n;post?(n="/blog/post/update",a.idPost=post.id):n="/blog/post/create",this.requestHandler(n,a,this.saveRequestComplete)},APP.CreatorPostScreen.prototype.saveRequestComplete=function(e){post=e.data.post;var t="/blog/post/"+post.nameSlugify;edit&&Utils.changeUrl(post.name,t+"/edit"),this.previewBtn.attr("href",t),this.status.text("✓ guardado")},APP.CreatorPostScreen.prototype.beforeUnLoad=function(e){if(this.isUploading){var t="Aun no se han guardado tus cambios!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=t),t}},APP.CreatorPostScreen.prototype.coverComplete=function(e){this.$view.find(".upload").show(),$(".cloudinary-fileupload").show();var t={format:"jpg",width:1600,crop:"limit",quality:80},o=$.cloudinary.image(e,t);o.addClass("am-Profile-banner-img").appendTo(this.$view.find(".preview")),this.photo=o.attr("src"),scope.autoSave(null,scope.editable)},APP.CreatorPostScreen.prototype.inputChange=function(){this.autoSave(null,this.editable)},APP.CreatorPostScreen.prototype.nameKeyUp=function(){clearTimeout(timeout),timeout=setTimeout(function(){scope.autoSave(null,scope.editable)},1e3)},APP.CreatorPostScreen.prototype.deleteHandler=function(e){e.preventDefault(),this["delete"].hide(),this.previewBtn.hide(),this.publishBtn.hide(),this.amBtn.hide(),this.deleteConfirm.show()},APP.CreatorPostScreen.prototype.cancelHandler=function(e){e.preventDefault(),this["delete"].show(),this.previewBtn.show(),this.publishBtn.show(),this.amBtn.show(),this.deleteConfirm.hide()},APP.CreatorPostScreen.prototype.deleteForceHandler=function(e){e.preventDefault();var t="/blog/post/delete";this.requestHandler(t,{idPost:post.id},this.deleteForceComplete)},APP.CreatorPostScreen.prototype.deleteForceComplete=function(){this.showFlash("succes","Se elimino tu post"),setTimeout(function(){window.location.href="/blog"},1e3)};
var APP=APP||{};APP.DiscoverScreen=function(t,e,i,r){this.container=e,this.navigation=i,this.data=r,APP.BaseScreen.call(this,t)},APP.DiscoverScreen.constructor=APP.DiscoverScreen,APP.DiscoverScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.DiscoverScreen.prototype.setupUI=function(){DataApp.currentUrl=this.data.url,Utils.changeUrl(this.id,this.data.url),this.searchText=$(".search-text"),this.featuredText=$(".featured-text"),this.viewer=new APP.Viewer(this.id,this.container,this.navigation,this.data),this.filters=new APP.Filters(this.data.filters)},APP.DiscoverScreen.prototype.listeners=function(){Broadcaster.addEventListener(Events.FILTER_CHANGED,this.filterChangedHandler.bind(this)),this.filters.start()},APP.DiscoverScreen.prototype.filterChangedHandler=function(t){t.meta&&$("."+t.meta+"-text").text(t.newValue),this.filters.term&&this.filters.term.length>0?(this.searchText.show(),this.searchText.text(decodeURIComponent(this.filters.term))):(this.searchText.hide(),this.searchText.text("")),this.filters.isFeatured?(this.featuredText.show(),this.featuredText.text("AM")):(this.featuredText.hide(),this.featuredText.text(""));var e=[];$(".navigation > span").filter(function(t,i){"none"!==$(i).css("display")&&e.push($(i))});var i;for(i=0;i<e.length;i++)-1!==e[i].text().indexOf(" >")&&e[i].text(e[i].text().replace(" >","")).removeClass("link");for(i=0;i<e.length-1;i++)e[i].text(e[i].text()+" >").addClass("link");DataApp.currentUrl!==window.location.href&&(Utils.changeUrl(this.id,DataApp.currentUrl),this.filters.isInitialized&&this.viewer.reset())};
var APP=APP||{};APP.EditWorkScreen=function(){APP.BaseScreen.call(this,"editWork"),this.work=work,this.userWork=work.User},APP.EditWorkScreen.constructor=APP.EditWorkScreen,APP.EditWorkScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.EditWorkScreen.prototype.setupUI=function(){this.workForm=$(".work-form"),this.uploaderImage=new APP.UploaderImage($(".uploader-work"),this.uploaderImageComplete),this.uploaderImage.photo=work.photo,this.name=$("input[name=name]"),this.category=$("select[name=category]"),$("select[name=category]").find("option[value="+category.id+"]").attr("selected",!0),$("input[name=public]").attr("checked",work["public"]),$("input[name=nsfw]").attr("checked",work.nsfw),this.description=$("textarea[name=description]"),this.tags=$("input[name=tags]"),this.tags.tagsInput({height:"50px",width:"100%",defaultText:"+Etiqueta"}),this.send=$(".send"),this.sendLoading=$(".send-loading"),this.workDelete=$(".work-delete"),this.workDeleteConfirm=$(".work-delete-confirm"),this.workDeleteCancel=$(".work-delete-cancel"),this.workDeleteForce=$(".work-delete-force")},APP.EditWorkScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.workForm.submit(this.workFormSubmitHandler.bind(this)),this.workDelete.click(this.workDeleteHandler.bind(this)),this.workDeleteForce.click(this.workDeleteForceHandler.bind(this)),this.workDeleteCancel.click(this.workDeleteCancelHandler.bind(this)),$("input[type=checkbox]").change(this.checkPublicHandler),$("input[type=checkbox]").change()},APP.EditWorkScreen.prototype.checkPublicHandler=function(){$(this).parent().find(".value").text(this.checked?"On":"Off")},APP.EditWorkScreen.prototype.workFormSubmitHandler=function(e){e.preventDefault();var t=[],o=this;if(this.uploaderImage.photo||t.push("Ingrese una foto"),Validations.notBlank(this.name.val())&&t.push("Ingrese un nombre"),Validations.notBlank(this.category.val())&&t.push("Ingrese una categoria"),Validations.notBlank(this.description.val())&&t.push("Ingrese una descripcion"),this.tags.val().split(",")[0].length<1&&t.push("Ingrese etiquetas"),t.length>0)return this.showFlash("error",t);this.sendLoading.show(),this.send.hide();var r=this.workForm.serializeArray();$.each(r,function(e,t){"photo"===t.name&&(t.value=o.uploaderImage.photo),("nsfw"===t.name||"public"===t.name)&&(t.value="on"===t.value)}),console.log(r);var i=DataApp.currentUser.url+"/work/update";this.requestHandler(i,r,this.workUpdatedComplete)},APP.EditWorkScreen.prototype.workUpdatedComplete=function(e){this.showFlash("succes","Su obra se actualizo exitosamente"),this.work=e.data.work,this.sendLoading.hide(),this.send.show();var t="/user/"+this.userWork.username+"/work/"+this.work.nameSlugify,o=setTimeout(function(){clearTimeout(o),window.location.href=t},1e3)},APP.EditWorkScreen.prototype.workDeleteHandler=function(e){e.preventDefault(),this.workDelete.hide(),this.workDeleteConfirm.show()},APP.EditWorkScreen.prototype.workDeleteForceHandler=function(){var e=DataApp.currentUser.url+"/work/delete";this.requestHandler(e,{idWork:this.work.id},this.workDeleteForceComplete)},APP.EditWorkScreen.prototype.workDeleteForceComplete=function(){this.showFlash("succes","Se elimino tu obra");var e=setTimeout(function(){clearTimeout(e),DataApp.currentUser.isAdmin?window.location.href="/":window.location.href=DataApp.currentUser.url},1e3)},APP.EditWorkScreen.prototype.workDeleteCancelHandler=function(e){this.workDelete.show(),this.workDeleteConfirm.hide()},APP.EditWorkScreen.prototype.uploaderImageComplete=function(e){this.$view.find(".upload").show(),$(".cloudinary-fileupload").show();var t={width:300,crop:"limit"};$.cloudinary.image(e,t).appendTo(this.$view.find(".preview"))};
var APP=APP||{};APP.EditorScreen=function(){APP.BaseScreen.call(this,"home")},APP.EditorScreen.constructor=APP.EditorScreen,APP.EditorScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.EditorScreen.prototype.setupUI=function(){var t={scaleFactor:5,width:567,height:211,offsetX:0,offsetY:60},e="000000",r=new fabric.Canvas("c1",{backgroundColor:e,width:t.width+2*t.offsetX,height:t.height+2*t.offsetY}),o=new fabric.Rect({width:t.width,height:t.offsetY,left:0,top:0,fill:"red",opacity:.5}),c=new fabric.Rect({width:t.width,height:t.offsetY,left:0,top:t.height+t.offsetY,fill:"red",opacity:.5});o.selectable=c.selectable=!1;var a,_=function(t,e){return t.replace("upload/","upload/"+e+"/")},i="http://res.cloudinary.com/hackdudes/image/upload/v1449719700/prueba2_e4tx4f.jpg",h=i.replace(/^.*\/|\.[^.]*$/g,"");url=_(i,"w_0.2,h_0.2"),fabric.Image.fromURL(url,function(t){a=t,r.add(t),r.calcOffset(),r.sendToBack(t),r.setActiveObject(r.item(0)),r.item(0).lockRotation=!0,r.item(0).hasRotatingPoint=!1,r.item(0).lockUniScaling=!0,r.centerObject(t),t.setCoords()},{crossOrigin:"Anonymous"}),r.add(o),r.add(c),$("input[type=color]").change(function(){e=$(this).val().replace("#",""),r.backgroundColor="#"+e,r.renderAll()});var n,l,s,d,g=function(){var e=r.toDataURL({top:t.offsetY,left:t.offsetX,height:t.height,width:t.weight});$(".preview").attr("src",e)},u=function(){var r=a.getBoundingRect(),o=Math.round(r.left*t.scaleFactor),c=Math.round(r.top*t.scaleFactor)-60*t.scaleFactor,g=Math.round(t.width*t.scaleFactor),u=Math.round(t.height*t.scaleFactor),f=Math.round(a.getWidth()*t.scaleFactor),w=Math.round(a.getHeight()*t.scaleFactor),p=Math.round(g/3),b="w_"+g+",h_"+u+",e_colorize,co_rgb:"+e+"/l_"+h+",b_rgb:"+e+",w_"+f+",h_"+w+",x_"+o+",y_"+c+",g_north_west/x_"+(0>o?-1*o:0)+",y_"+(0>c?-1*c:0)+",w_"+g+",h_"+u+",c_crop,g_north_west";n=_(i,b),t.scaleFactor=1.5,o=Math.round(r.left*t.scaleFactor),c=Math.round(r.top*t.scaleFactor)-60*t.scaleFactor,g=Math.round(t.width*t.scaleFactor),u=Math.round(t.height*t.scaleFactor),f=Math.round(a.getWidth()*t.scaleFactor),w=Math.round(a.getHeight()*t.scaleFactor),p=Math.round(g/3);var y=8,P=-13;b="w_"+g+",h_"+u+",e_colorize,co_rgb:"+e+"/l_"+h+",b_rgb:"+e+",w_"+f+",h_"+w+",x_"+o+",y_"+c+",g_north_west/x_"+(0>o?-1*o:0)+",y_"+(0>c?-1*c:0)+",w_"+p+",h_"+u+",c_crop,g_north_west/e_distort:0:0:"+p+":0:"+(p-y)+":"+u+":"+y+":"+u+"/c_pad,h_2.0,w_1.0/l_radial,e_displace,y_"+P+"/e_trim/u_mugleft/w_0.7",l=_(i,b),b="w_"+g+",h_"+u+",e_colorize,co_rgb:"+e+"/l_"+h+",b_rgb:"+e+",w_"+f+",h_"+w+",x_"+o+",y_"+c+",g_north_west/x_"+((0>o?-1*o:0)+1*Math.round(p))+",y_"+(0>c?-1*c:0)+",w_"+p+",h_"+u+",c_crop,g_north_west/e_distort:0:0:"+p+":0:"+(p-y)+":"+u+":"+y+":"+u+"/c_pad,h_2.0,w_1.0/l_radial,e_displace,y_"+P+"/e_trim/u_mugcenter/w_0.7",s=_(i,b),b="w_"+g+",h_"+u+",e_colorize,co_rgb:"+e+"/l_"+h+",b_rgb:"+e+",w_"+f+",h_"+w+",x_"+o+",y_"+c+",g_north_west/x_"+((0>o?-1*o:0)+2*Math.round(p))+",y_"+(0>c?-1*c:0)+",w_"+p+",h_"+u+",c_crop,g_north_west/e_distort:0:0:"+p+":0:"+(p-y)+":"+u+":"+y+":"+u+"/c_pad,h_2.0,w_1.0/l_radial,e_displace,y_"+P+"/e_trim/u_mugright/w_0.7",d=_(i,b),$(".original").attr("src",n),$(".left").attr("src",l),$(".center").attr("src",s),$(".right").attr("src",d)};$(".save-btn").click(u),r.on({"mouse:up":g,"object:resizing":g})};
var APP=APP||{};APP.FeedScreen=function(){APP.BaseScreen.call(this,"feed"),this.idCollections=[],this.collections=[],this.currentWork=null},APP.FeedScreen.constructor=APP.FeedScreen,APP.FeedScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.FeedScreen.prototype.setupUI=function(){APP.BaseScreen.prototype.setupUI.call(this),this.saveBtn=$(".save-collections"),this.saveBtnLoading=$(".save-collections-loading"),this.collectionsContainer=$(".collections"),this.collectionForm=$(".add-collection-form"),this.shareFB=$(".share-fb"),this.viewer=new APP.Viewer("action",$(".feed-inner"),"infinite",actions),new Clipboard(".copy",{text:this.copyHandler.bind(this)})},APP.FeedScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.saveBtn.click(this.saveClickHandler.bind(this));var e=DataApp.currentUser.url+"/collection/all";this.requestHandler(e,{},this.collectionsHandlerComplete),this.collectionForm.submit(this.collectionFormHandler.bind(this));var t=this.addCollectionHandler.bind(this);Broadcaster.addEventListener(Events.ADD_COLLECTION,t);var i=this.feedShareHandler.bind(this);Broadcaster.addEventListener(Events.SHARE,i),this.shareFB.click(this.shareFBHandler.bind(this))},APP.FeedScreen.prototype.copyHandler=function(e){return $("#lean_overlay").trigger("click"),this.showFlash("succes","Link Copiado"),DataApp.baseUrl+"user/"+this.currentWork.User.username+"/work/"+this.currentWork.nameSlugify},APP.FeedScreen.prototype.feedShareHandler=function(e){this.currentWork=e.data.work},APP.FeedScreen.prototype.shareFBHandler=function(){Utils.shareFBWork(this.currentWork)},APP.FeedScreen.prototype.collectionFormHandler=function(e){e.preventDefault();var t=DataApp.currentUser.url+"/collection/create";this.requestHandler(t,$(e.target).serialize(),this.collectionFormComplete)},APP.FeedScreen.prototype.collectionFormComplete=function(e){var t=new APP.CollectionItem(e.data.collection);t.addEventListener(Events.COLLECTION_ITEM_SELECTED,this.collectionItemSelected.bind(this)),this.collections.push(t),this.collectionsContainer.append(t.view)},APP.FeedScreen.prototype.addCollectionHandler=function(e){this.currentWork=e.data.work;var t=DataApp.currentUser.url+"/work/inside_collection",i={idWork:this.currentWork.id};this.requestHandler(t,i,this.insideCollectionHandler)},APP.FeedScreen.prototype.insideCollectionHandler=function(e){var t,i,o=e.data.collections;for(t=0;t<this.collections.length;t++)this.collections[t].view.removeClass("selected");for(this.idCollections=[],t=0;t<o.length;t++)for(i=0;i<this.collections.length;i++)o[t].id===this.collections[i].data.id&&(this.idCollections.push(o[t].id),this.collections[i].view.addClass("selected"))},APP.FeedScreen.prototype.saveClickHandler=function(){this.saveBtn.hide(),this.saveBtnLoading.show();var e=DataApp.currentUser.url+"/work/add_to_collection",t={collections:JSON.stringify(this.idCollections),idWork:this.currentWork.id};this.requestHandler(e,t,this.saveRequestComplete)},APP.FeedScreen.prototype.saveRequestComplete=function(){this.saveBtn.show(),this.saveBtnLoading.hide(),this.showFlash("succes","Su actualizo tus colecciones"),$("#lean_overlay").trigger("click")},APP.FeedScreen.prototype.collectionsHandlerComplete=function(e){var t,i,o=e.data.collections;for(t=0;t<o.length;t++)i=new APP.CollectionItem(o[t]),this.collections.push(i),i.addEventListener(Events.COLLECTION_ITEM_SELECTED,this.collectionItemSelected.bind(this)),this.collectionsContainer.append(i.view)},APP.FeedScreen.prototype.collectionItemSelected=function(e){var t=e.target,i=this.idCollections.indexOf(t.data.id);-1===i?this.idCollections.push(t.data.id):this.idCollections.splice(i,1)};
var APP=APP||{};APP.Filters=function(t){this.filters=t,this.oldCategory=this.filters.currentCategory,this.oldOrder=this.filters.currentOrder,this.isFeatured=void 0!==Utils.getUrlParameter("featured"),this.term=Utils.getUrlParameter("term"),this.currentCategory=this.currentOrder=null,this.setupUI(),this.listeners(),this.isInitialized=!1},APP.Filters.constructor=APP.Filters,APP.Filters.prototype.setupUI=function(){function t(t){function e(){return r}var r=window.innerWidth<1e3?"mobile":"desktop",i=t.toDesktop,a=t.toMobile;return window.addEventListener("resize",function(){var t=r;r=window.innerWidth<1e3?"mobile":"desktop","mobile"==t&&"desktop"==r&&i(),"desktop"==t&&"mobile"==r&&a()}),{getVal:e}}var e,r=$(".filter.right"),i=$(".filter.right .am-Select");setTimeout(function(){e=$(".filter.right .am-Filter-item"),$(e).click(function(){setTimeout(function(){$(i).trigger("click")},300)})},500),$(i).click(function(){var t=r.attr("data-state");"closed"==t?r.attr("data-state","open"):r.attr("data-state","closed")});var a=$(".filter.left"),s=$(".filter.left .am-Select"),n=$(".discover-content");$(s).click(function(){var t=a.attr("data-state");"closed"==t?(a.attr("data-state","open"),n.attr("data-state","expand").trigger("resetLayout")):(a.attr("data-state","closed"),n.attr("data-state","reduce").trigger("resetLayout"))});var l=new t({toDesktop:function(){console.log("toDesktop!")},toMobile:function(){console.log("toMobile!"),$(".filter.left .left-menu").css("display","block")}});"mobile"==l.getVal()&&($(s).trigger("click"),$(".filter.left .left-menu").css("display","block")),this.filters.categories.unshift({name:"Todo",nameSlugify:"all"}),this.itemFilterRenderer(this.filters.categories,"category"),this.itemFilterRenderer(this.filters.order,"order"),this.featuredBtn=$(".am-Switch-button"),this.searchInput=$(".am-Search-input input"),this.searchBtn=$(".search-btn"),this.closeBtn=$(".close-btn"),this.categories=$("[data-meta=category]"),this.orders=$("[data-meta=order]"),$("[data-value="+this.oldCategory+"]").parent().addClass("selected"),$("[data-value="+this.oldOrder+"]").parent().addClass("selected"),this.isFeatured&&$("input[type=checkbox]").prop("checked",!0),this.navigation=$(".am-navigation-text"),this.needsToClose=!1},APP.Filters.prototype.itemFilterRenderer=function(t,e){var r=APP.TemplateManager.instance.getFromDoc("filter-item");$.each(t,function(t,i){i.meta=e,$(".filter-"+e).append(r(i))})},APP.Filters.prototype.listeners=function(){this.categories.on("click",this.filterItemHandler.bind(this,"category")),this.orders.on("click",this.filterItemHandler.bind(this,"order")),this.featuredBtn.on("click",this.featuredHandler.bind(this)),this.term=void 0===this.term?"":this.term,this.searchInput.val(decodeURIComponent(this.term)),this.searchBtn.click(this.searchHandler.bind(this)),this.searchInput.keyup(this.searchKeyUpHandler.bind(this)),this.searchInput.keypress(this.searchKeyPressHandler.bind(this)),this.navigation.click(this.navigationClickHandler.bind(this)),this.closeBtn.click(this.closeClickHandler.bind(this)),this.searchInput.keyup()},APP.Filters.prototype.searchKeyUpHandler=function(t){this.searchInput.val().length>0?this.closeBtn.show():this.closeBtn.hide()},APP.Filters.prototype.closeClickHandler=function(t){this.searchInput.val(""),this.closeBtn.hide(),this.needsToClose=!0,this.searchBtn.click()},APP.Filters.prototype.navigationClickHandler=function(t){var e,r=$(t.target),i=DataApp.currentUrl;this.navigation.each(function(t,a){var s=$(a).attr("id");$(a).hasClass("link")&&r.attr("id")===s&&(e=t),t>e&&(i=Utils.removeURLParameter(i,s))}),window.location.href=i},APP.Filters.prototype.searchKeyPressHandler=function(t){if(13===t.which){var e=encodeURIComponent($(t.target).val());return e.length>0?(this.term?DataApp.currentUrl=DataApp.currentUrl.replace("term="+this.term,"term="+e):DataApp.currentUrl=DataApp.currentUrl+"&term="+e,this.term=e):(DataApp.currentUrl.indexOf("&term="+this.term)>-1&&(DataApp.currentUrl=DataApp.currentUrl.replace("&term="+this.term,"")),DataApp.currentUrl.indexOf("term="+this.term)>-1&&(DataApp.currentUrl=DataApp.currentUrl.replace("term="+this.term,"")),this.term=void 0),this.needsToClose?window.location.href=DataApp.currentUrl:void Broadcaster.dispatchEvent(Events.FILTER_CHANGED)}},APP.Filters.prototype.searchHandler=function(t){t.preventDefault(),this.searchInput.trigger({type:"keypress",which:13,keyCode:13})},APP.Filters.prototype.featuredHandler=function(){this.isFeatured?DataApp.currentUrl=DataApp.currentUrl.replace("&featured=1",""):DataApp.currentUrl=DataApp.currentUrl+"&featured=1",this.isFeatured=!this.isFeatured,Broadcaster.dispatchEvent(Events.FILTER_CHANGED)},APP.Filters.prototype.start=function(){$("[data-value="+this.oldCategory+"]").click(),$("[data-value="+this.oldOrder+"]").click(),this.isInitialized=!0},APP.Filters.prototype.filterItemHandler=function(t,e){var r=Utils.capitalize(t),i="old"+r,a="current"+r,s=$(e.currentTarget).find(".am-Filter-option");this[a]=s.attr("data-value"),$("[data-value="+this[i]+"]").parent().removeClass("selected"),$("[data-value="+this[a]+"]").parent().addClass("selected"),DataApp.currentUrl=DataApp.currentUrl.replace(this[i],this[a]),this[i]=this[a];var n=$(e.target).attr("data-name");Broadcaster.dispatchEvent(Events.FILTER_CHANGED,{meta:t,newValue:n})};
var APP=APP||{};APP.HomeScreen=function(){APP.BaseScreen.call(this,"home"),this.usersViewer=new APP.Viewer("user",$(".grid"),null,users),this.worksViewer=new APP.Viewer("work",$(".grid-works"),null,works);var e=$(".banner-user").detach();this.usersViewer.container.append(e).masonry("appended",e),this.slider=new Slider(document.querySelector(".slider"),{slideClass:"js-slide",sliderNavItemClass:"js-slideNavItem"})},APP.HomeScreen.constructor=APP.HomeScreen,APP.HomeScreen.prototype=Object.create(APP.BaseScreen.prototype);
var APP=APP||{};APP.NotificationsScreen=function(){APP.BaseScreen.call(this,"notifications")},APP.NotificationsScreen.constructor=APP.NotificationsScreen,APP.NotificationsScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.NotificationsScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this)};
var APP=APP||{};APP.PostScreen=function(){APP.BaseScreen.call(this,"post"),this.following=!1},APP.PostScreen.constructor=APP.PostScreen,APP.PostScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.PostScreen.prototype.setupUI=function(){this.viewer=new APP.Viewer("post",$(".blog-articles-container"),null,posts),this.loginReview=$(".login-review"),this.followBtn=$(".following"),this.shareFb=$(".share-fb"),this.shareTw=$(".share-tw"),this.editor=new MediumEditor(".editable",{buttonLabels:"fontawesome",toolbar:!1,spellcheck:!1,disableEditing:!0}),this.reviewForm=$(".review-form"),this.reviewContainer=$(".reviews-items-container");for(var e=0;e<reviews.length;e++)this.reviewContainer.append(new APP.Review(reviews[e]).view);if(this.likeBtn=$(".like-btn"),DataApp.currentUser){if(DataApp.currentUser.id===post.User.id)return this.followBtn.hide();var t=DataApp.currentUser.url+"/isFollowing";this.requestHandler(t,{idUser:post.User.id},this.isFollowingComplete)}},APP.PostScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.reviewForm.submit(this.reviewFormHandler.bind(this)),this.likeBtn.click(this.likeBtnHandler.bind(this)),this.loginReview.click(this.loginReviewHandler.bind(this)),this.followBtn.click(this.followHandler.bind(this)),this.shareFb.click(this.shareFBHandler.bind(this)),this.shareTw.click(this.shareTWHandler.bind(this))},APP.PostScreen.prototype.shareFBHandler=function(){Utils.shareFBPost(post)},APP.PostScreen.prototype.shareTWHandler=function(){Utils.shareTWPost(post)},APP.PostScreen.prototype.followHandler=function(){Utils.checkAuthentication();var e=DataApp.currentUser.url+(this.isFollowing?"/unfollow/":"/follow/");this.requestHandler(e,{idUser:post.User.id},this.followComplete)},APP.PostScreen.prototype.followComplete=function(e){this.isFollowing?this.followBtn.removeClass("following").text("+ SEGUIR"):this.followBtn.addClass("following").text("Siguiendo"),this.isFollowing=!this.isFollowing},APP.PostScreen.prototype.likeBtnHandler=function(e){if(e.preventDefault(),Utils.checkAuthentication(),!post.liked){var t="/blog/post/like";this.requestHandler(t,{idPost:post.id},this.likeComplete)}},APP.PostScreen.prototype.loginReviewHandler=function(){Utils.checkAuthentication()},APP.PostScreen.prototype.isFollowingComplete=function(e){this.isFollowing=e.data.following,this.isFollowing&&this.followBtn.addClass("following").text("Siguiendo")},APP.PostScreen.prototype.likeComplete=function(e){post.liked=!post.liked,$(".likes").text(e.data.likes),this.likeBtn.addClass("liked")},APP.PostScreen.prototype.reviewFormHandler=function(e){e.preventDefault();var t="/blog/post/review/create";this.requestHandler(t,$(e.target).serialize(),this.reviewComplete)},APP.PostScreen.prototype.reviewComplete=function(e){$(".value-input").val(""),this.reviewContainer.append(new APP.Review(e.data.review).view)};
var APP=APP||{};APP.ProfileScreen=function(){this.currentItem,this.oldItem,this.currentSection,this.oldSection,this.currentViewer,this.oldViewer,this.paths=[],this.viewers=[],this.uploaderCover=new APP.UploaderImage($(".uploader-cover"),this.uploadComplete),APP.BaseScreen.call(this,"profile")},APP.ProfileScreen.constructor=APP.ProfileScreen,APP.ProfileScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.ProfileScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),$(".am-Profile-menu-item").click(this.menuItemClickHandler.bind(this)),$(".am-Follow-button").click(this.followClickHandler.bind(this)),$(".cancel-icon").click(this.cancelClickHandler.bind(this)),$(".save-icon").click(this.saveClickHandler.bind(this)),$(".am-Profile-menu-item[data-name="+currentPath+"]").click()},APP.ProfileScreen.prototype.saveClickHandler=function(){var e=DataApp.currentUser.url+"/account/update_cover";this.requestHandler(e,{cover:this.uploaderCover.photo},this.updateCoverComplete),$(".save-icon, .cancel-icon").hide(),$(".cloudinary-fileupload, .upload").show()},APP.ProfileScreen.prototype.followClickHandler=function(){Utils.checkAuthentication();var e=DataApp.currentUser.url+(profile.following?"/unfollow/":"/follow/");this.requestHandler(e,{idUser:profile.id},this.followComplete)},APP.ProfileScreen.prototype.menuItemClickHandler=function(e){this.currentItem=$(e.currentTarget);var t=this.currentItem.data("name"),i="/user/"+profile.username+"/"+("portfolio"===t?"":t);if(Utils.changeUrl(DataApp.baseTitle+Utils.capitalize(t),i),this.currentSection=$("."+t+"-wrapper"),this.oldItem&&this.oldItem.removeClass("selected"),this.oldViewer&&this.oldViewer.suspend(),this.oldSection&&this.oldSection.hide(),this.currentItem.addClass("selected"),this.currentSection.show(),-1===this.paths.indexOf(t)){var r=this.getTemplate(t),o=$("."+t+"-container");this.currentViewer=new APP.Viewer(r,o,"infinite",null),this.currentViewer.navigationManager.navigator.needChangeUrl=!0,this.viewers.push(this.currentViewer),this.paths.push(t)}else this.currentViewer=this.viewers[this.paths.indexOf(t)],this.currentViewer.restart();this.oldItem=this.currentItem,this.oldViewer=this.currentViewer,this.oldSection=this.currentSection},APP.ProfileScreen.prototype.updateCoverComplete=function(e){DataApp.currentUser.cover=this.uploaderCover.photo,$(".save-icon, .cancel-icon").hide(),$(".cloudinary-fileupload, .upload").show()},APP.ProfileScreen.prototype.cancelClickHandler=function(){$(".preview > img").attr("src",DataApp.currentUser.cover),$(".save-icon, .cancel-icon").hide(),$(".cloudinary-fileupload, .upload").show()},APP.ProfileScreen.prototype.followComplete=function(e){profile.following?$(".am-Follow-button").text("+Seguir").removeClass("following"):$(".am-Follow-button").text("Siguiendo").addClass("following"),profile.following=!profile.following},APP.ProfileScreen.prototype.uploadComplete=function(e){var t={format:"jpg",width:1600,crop:"limit",quality:80},i=$.cloudinary.image(e,t);i.addClass("am-Profile-banner-img").appendTo(this.$view.find(".preview")),this.photo=i.attr("src"),$(".save-icon , .cancel-icon").show()};
var APP=APP||{};APP.Viewer=function(i,t,a,n,e){this.container=t,this.options=e,"carrouselItem"===i||"action"===i||"notificationItem"===i||"tableUser"===i||"tableWork"===i||"post"===i||"postMinimal"===i||this.setupMasonry(),this.id=i,this.navigation=a,this.initialize=!0,this.fromExternal=!1,this.navigation?(this.navigationManager=new APP.NavigationManager(a),n?(this.navigationManager.navigator.currentPage=n.pagination.page,this.navigationManager.navigator.totalPages=n.pagination.pages):(this.navigationManager.navigator.currentPage=1,this.navigationManager.navigator.totalPages=1),this.navigationManager.navigator.start(),this.listeners(),n?this.addItems(n.items):(this.fromExternal=!0,this.navigationManager.navigator.gotoPage(1,!0))):n?this.addItems(n):(this.fromExternal=!0,this.navigationManager.navigator.gotoPage(1,!0))},APP.Viewer.constructor=APP.Viewer,APP.Viewer.prototype.setupMasonry=function(){var i=this;i.container.masonry({itemSelector:".grid-item",columnWidth:".grid-sizer",percentPosition:!0}),$(".discover-content").on("resetLayout",function(){console.log("expand"),i.container.masonry()})},APP.Viewer.prototype.listeners=function(){this.pageStart=this.pageLoadStartHandler.bind(this),this.navigationManager.navigator.addEventListener(Events.LOAD_START,this.pageStart),this.pageEnd=this.pageLoadEndHandler.bind(this),this.navigationManager.navigator.addEventListener(Events.LOAD_END,this.pageEnd)},APP.Viewer.prototype.pageLoadStartHandler=function(){this.container.parent().find(".bare-message").hide(),this.container.parent().find(".loading").show()},APP.Viewer.prototype.pageLoadEndHandler=function(i){this.fromExternal?this.initialize=!0:this.initialize=!1,this.addItems(i.data.items),this.options&&this.options.getTotal&&this.options.getTotal(i.data.pagination.total)},APP.Viewer.prototype.addItems=function(i){if(this.container.parent().find(".loading").show(),this.navigation!==APP.NavigationManager.PAGINATION||this.initialize||this.clean(),i.length<1){this.container.parent().find(".bare-message").hasClass("hide")&&this.container.parent().find(".bare-message").removeClass("hide");var t=this.container.parent().find(".bare-message").show().css("display");this.container.parent().find(".bare-message").show().css("display",t),this.container.parent().height("auto"),this.container.parent().find(".loading").hide()}var a,n=this,e=0,o=0,s=[];for(e;e<i.length;e++)if("action"===this.id?(("create-work"===i[e].verb||"like-work"===i[e].verb)&&(a=new APP.FeedWorkCreated(i[e],this.options)),"follow-user"===i[e].verb&&(a=new APP.FeedUserFollow(i[e],this.options))):"notificationItem"===this.id?("review-work"===i[e].verb&&(a=new APP.NotificationReview(i[e],this.options)),"follow-user"===i[e].verb&&(a=new APP.NotificationFollow(i[e],this.options)),"like-work"===i[e].verb&&(a=new APP.NotificationLike(i[e],this.options)),"request-work"===i[e].verb&&(a=new APP.NotificationRequest(i[e],this.options))):a=new(APP[Utils.capitalize(this.id)])(i[e],this.options),a.view.children().hasClass("work-card")){var r=a.view;r.attr("id",a.data.id),r.hide(),this.container.append(r),s.push(a.data.id);var h=this.container;r.imagesLoaded().progress(function(t,a){if(++o,$(a.img).parents(".grid-item"),o===i.length)var r=setTimeout(function(){for(clearTimeout(r),e=0;e<s.length;e++){var i=$("#"+s[e]);i.show(),h.masonry("appended",i),h.masonry(),n.navigationManager&&n.navigationManager.navigator.restart(),h.parent().find(".loading").hide()}},1e3)})}else"carrouselItem"===this.id||"action"===this.id||"notificationItem"===this.id||"post"===this.id||"postMinimal"===this.id||"tableUser"===this.id||"tableWork"===this.id?this.container.append(a.view):(this.container.append(a.view).masonry("appended",a.view),this.container.masonry()),n.navigationManager&&n.navigationManager.navigator.restart(),this.container.parent().find(".loading").hide()},APP.Viewer.prototype.reset=function(){this.clean(),this.navigationManager.navigator.reset()},APP.Viewer.prototype.clean=function(){"carrouselItem"===this.id||"action"===this.id||"notificationItem"===this.id||"post"===this.id||"postMinimal"===this.id||"tableUser"===this.id||"tableWork"===this.id?this.container.empty():this.container.masonry("remove",this.container.find(".grid-item")).masonry(),this.initialize=!1},APP.Viewer.prototype.suspend=function(){this.navigationManager.navigator.suspend(),this.navigationManager.navigator.removeEventListener(Events.LOAD_START,this.pageStart),this.navigationManager.navigator.removeEventListener(Events.LOAD_END,this.pageEnd)},APP.Viewer.prototype.restart=function(){this.navigationManager.navigator.addEventListener(Events.LOAD_START,this.pageStart),this.navigationManager.navigator.addEventListener(Events.LOAD_END,this.pageEnd),this.navigationManager.navigator.restart(),this.container.masonry()};
var APP=APP||{};APP.WorkScreen=function(){APP.BaseScreen.call(this,"work"),this.currentItem=this.oldItem,this.currentSection,this.oldSection,this.collections=[],this.idCollections=[],this.following=!1},APP.WorkScreen.constructor=APP.WorkScreen,APP.WorkScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.WorkScreen.prototype.setupUI=function(){new APP.Viewer("carrouselItem",$(".more"),null,more),new APP.Viewer("carrouselItem",$(".similar"),null,similar),new APP.Carrousel($(".js-more-carousel"),$(".more")),new APP.Carrousel($(".js-similar-carousel"),$(".similar")),new APP.PhotoSwipe,this.reviewsContainer=$(".reviews-items-container");for(var e=0;e<reviews.length;e++)this.reviewsContainer.append(new APP.Review(reviews[e]).view);this.shareFb=$(".share-fb"),this.askBtn=$(".ask-availability"),this.loginReview=$(".login-review"),this.askRequester=$(".ask-requester"),this.thanksRequester=$(".thanks-requester"),this.likeBtn=$(".like-btn"),this.afterLike=$(".after-like"),this.saveBtn=$(".save-collections"),this.saveBtnLoading=$(".save-collections-loading"),this.followBtn=$(".am-Follow-button"),this.collectionsContainer=$(".collections"),this.collectionForm=$(".add-collection-form"),this.reviewForm=$(".review-form"),this.reviewContainer=$(".reviews-items-container"),this.prevBtn=$(".prev-btn"),this.nextBtn=$(".next-btn"),new Clipboard(".copy",{text:this.copyHandler.bind(this)})},APP.WorkScreen.prototype.listeners=function(){if(APP.BaseScreen.prototype.listeners.call(this),this.shareFb.click(this.shareFBHandler.bind(this)),$(".menu-item").click(this.menuItemHandler.bind(this)),$(".menu-item[data-name="+currentPath+"]").click(),this.askBtn.click(this.askAvailabilityHandler.bind(this)),this.loginReview.click(this.loginReviewHandler.bind(this)),this.saveBtn.click(this.saveClickHandler.bind(this)),DataApp.currentUser){var e=DataApp.currentUser.url+"/collection/all";if(this.requestHandler(e,{},this.collectionsHandlerComplete),!owner){var t=DataApp.currentUser.url+"/isFollowing";this.requestHandler(t,{idUser:work.User.id},this.isFollowingComplete)}}this.likeBtn.click(this.likeBtnHandler.bind(this)),this.followBtn.click(this.followHandler.bind(this)),this.collectionForm.submit(this.collectionFormHandler.bind(this)),this.reviewForm.submit(this.reviewFormHandler.bind(this)),$(document).bind("keyup",this.documentKeyupHandler.bind(this))},APP.WorkScreen.prototype.documentKeyupHandler=function(e){39===e.keyCode&&this.prevBtn.length>0&&(window.location.href=this.prevBtn.attr("href")),37===e.keyCode&&this.nextBtn.length>0&&(window.location.href=this.nextBtn.attr("href"))},APP.WorkScreen.prototype.copyHandler=function(e){return $("#lean_overlay").trigger("click"),this.showFlash("succes","Link Copiado"),window.location.href},APP.WorkScreen.prototype.reviewFormHandler=function(e){e.preventDefault();var t=DataApp.currentUser.url+"/work/review/create";this.requestHandler(t,$(e.target).serialize(),this.reviewComplete)},APP.WorkScreen.prototype.reviewComplete=function(e){$(".value-input").val(""),this.reviewContainer.append(new APP.Review(e.data.review).view)},APP.WorkScreen.prototype.followHandler=function(){Utils.checkAuthentication();var e=DataApp.currentUser.url+(this.isFollowing?"/unfollow/":"/follow/");this.requestHandler(e,{idUser:work.User.id},this.followComplete)},APP.WorkScreen.prototype.followComplete=function(e){console.log(e),this.isFollowing?this.followBtn.removeClass("following").text("+ SEGUIR"):this.followBtn.addClass("following").text("Siguiendo"),this.isFollowing=!this.isFollowing},APP.WorkScreen.prototype.isFollowingComplete=function(e){this.isFollowing=e.data.following,this.isFollowing&&this.followBtn.addClass("following").text("Siguiendo")},APP.WorkScreen.prototype.saveClickHandler=function(){this.saveBtn.hide(),this.saveBtnLoading.show();var e=DataApp.currentUser.url+"/work/add_to_collection",t={collections:JSON.stringify(this.idCollections),idWork:work.id};this.requestHandler(e,t,this.saveRequestComplete)},APP.WorkScreen.prototype.saveRequestComplete=function(){this.saveBtn.show(),this.saveBtnLoading.hide(),this.showFlash("succes","Su actualizo tus colecciones"),$("#lean_overlay").trigger("click")},APP.WorkScreen.prototype.collectionFormHandler=function(e){e.preventDefault();var t=DataApp.currentUser.url+"/collection/create";this.requestHandler(t,$(e.target).serialize(),this.collectionFormComplete)},APP.WorkScreen.prototype.collectionFormComplete=function(e){var t=new APP.CollectionItem(e.data.collection);t.addEventListener(Events.COLLECTION_ITEM_SELECTED,this.collectionItemSelected.bind(this)),this.collections.push(t),this.collectionsContainer.append(t.view)},APP.WorkScreen.prototype.likeBtnHandler=function(){if(Utils.checkAuthentication(),!work.liked){var e=DataApp.currentUser.url+"/work/like";this.requestHandler(e,{idWork:work.id},this.likeComplete)}},APP.WorkScreen.prototype.likeComplete=function(e){console.log(e),work.liked=!work.liked,$(".likes").text(e.data.likes),this.likeBtn.parent().addClass("active"),this.afterLike.show()},APP.WorkScreen.prototype.collectionsHandlerComplete=function(e){var t,i,o=e.data.collections;for(t=0;t<o.length;t++)i=new APP.CollectionItem(o[t]),this.collections.push(i),i.addEventListener(Events.COLLECTION_ITEM_SELECTED,this.collectionItemSelected.bind(this)),this.collectionsContainer.append(i.view);var r=DataApp.currentUser.url+"/work/inside_collection";this.requestHandler(r,{idWork:work.id},this.insideCollectionHandler)},APP.WorkScreen.prototype.insideCollectionHandler=function(e){var t,i,o=e.data.collections;for(t=0;t<this.collections.length;t++)this.collections[t].view.removeClass("selected");for(this.idCollections=[],t=0;t<o.length;t++)for(i=0;i<this.collections.length;i++)o[t].id===this.collections[i].data.id&&(this.idCollections.push(o[t].id),this.collections[i].view.addClass("selected"))},APP.WorkScreen.prototype.collectionItemSelected=function(e){var t=e.target,i=this.idCollections.indexOf(t.data.id);-1===i?this.idCollections.push(t.data.id):this.idCollections.splice(i,1)},APP.WorkScreen.prototype.askAvailabilityHandler=function(e){Utils.checkAuthentication();var t=DataApp.currentUser.url+"/work/availability";this.requestHandler(t,{idWork:work.id},this.askAvailabilityComplete)},APP.WorkScreen.prototype.loginReviewHandler=function(){Utils.checkAuthentication()},APP.WorkScreen.prototype.askAvailabilityComplete=function(e){this.askRequester.hide(),this.thanksRequester.show()},APP.WorkScreen.prototype.menuItemHandler=function(e){this.currentItem=$(e.currentTarget);var t=this.currentItem.data("name");this.currentSection=$("."+t+"-container"),this.currentSection.show();var i="/user/"+work.User.username+"/work/"+work.nameSlugify+"/"+("index"===t?"":t);$(".menu-item").removeClass("selected"),this.currentItem.addClass("selected"),this.oldSection&&this.oldSection.hide(),this.oldSection=this.currentSection,Utils.changeUrl(DataApp.baseTitle+Utils.capitalize(t),i)},APP.WorkScreen.prototype.shareFBHandler=function(){Utils.shareFBWork(work)};
Utils={isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return Utils.isMobile.Android()||Utils.isMobile.BlackBerry()||Utils.isMobile.iOS()||Utils.isMobile.Opera()||Utils.isMobile.Windows()}},paginationButtons:function(e,t,n){var i,r=[1],a=Math.floor(n/2);if(e>t)return null;if(n>t){for(i=2;t+1>i;i++)r.push(i);return r}if(a>=e&&e>0)for(i=2;n>i;i++)r.push(i);var o=t-a;if(e>a&&o>e){var s=(n-3)/2;for(i=e-s;e+s+1>i;i++)r.push(i)}if(e>=o&&t>=e)for(i=t-(n-2);t>i;i++)r.push(i);return r.push(t),r},getUrlParameter:function(e){for(var t=window.location.search.substring(1),n=t.split("&"),i=0;i<n.length;i++){var r=n[i].split("=");if(r[0]==e)return r[1]}},capitalize:function(e){return e.charAt(0).toUpperCase()+e.substring(1)},getData:function(e){return APP.RestClientManager.instance.execute(e)},changeUrl:function(e,t){if(DataApp.currentUrl=t,"undefined"!=typeof history.pushState){var n={page:e,url:t};history.replaceState(n,n.page,n.url)}else window.location.href="/"},addImageFilter:function(e,t){return e.indexOf("upload")>-1?e.replace("upload/","upload/"+t+"/"):void 0},checkAuthentication:function(){DataApp.currentUser||(-1===window.location.href.indexOf("auth")&&Cookies.set("return_to",window.location.href,{maxAge:36e5,domain:"."+document.domain}),window.location.href=DataApp.loginUrl)},share:{facebook:function(e,t){e.method="feed",window.FB&&FB.ui(e,t)}},shareFBWork:function(e){$("#lean_overlay").trigger("click"),Utils.share.facebook({link:DataApp.baseUrl+"user/"+e.User.username+"/work/"+e.nameSlugify,picture:Utils.addImageFilter(e.photo,"w_1200,h_630,q_60,c_crop"),name:e.name,caption:"Arte Manifiesto",description:e.description})},shareTWWork:function(e){var t=DataApp.baseUrl+"user/"+e.User.username+"/work/"+e.nameSlugify,n=encodeURIComponent(e.name+" vía (@artemanifiesto)"),i="https://twitter.com/intent/tweet?text="+n;i+="&url="+encodeURIComponent(t),window.open(i,"_blank","height=300,width=550,resizable=1")},shareFBPost:function(e){Utils.share.facebook({link:DataApp.baseUrl+"blog/post/"+e.nameSlugify,picture:Utils.addImageFilter(e.photo,"w_1200,h_630,q_60,c_crop"),name:e.name,caption:"Arte Manifiesto | Blog",description:e.description})},shareTWPost:function(e){var t=DataApp.baseUrl+"blog/post/"+e.nameSlugify,n=encodeURIComponent(e.name+" vía (@artemanifiesto)"),i="https://twitter.com/intent/tweet?text="+n;i+="&url="+encodeURIComponent(t),window.open(i,"_blank","height=300,width=550,resizable=1")},removeURLParameter:function(e,t){var n=e.split("?");if(n.length>=2){for(var i=encodeURIComponent(t)+"=",r=n[1].split(/[&;]/g),a=r.length;a-- >0;)-1!==r[a].lastIndexOf(i,0)&&r.splice(a,1);return e=n[0]+"?"+r.join("&")}return e},updateQueryStringParameter:function(e,t,n){var i=new RegExp("([?&])"+t+"=.*?(&|$)","i"),r=-1!==e.indexOf("?")?"&":"?";return e.match(i)?e.replace(i,"$1"+t+"="+n+"$2"):e+r+t+"="+n}};
=======
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};
APP.AM = function() {
  this.setupData();
  this.setupUI();
  this.listeners();
};

APP.AM.constructor = APP.AM;

APP.AM.prototype.setupData = function() {
  new APP.RestClientManager();
  new APP.TemplateManager();

  $('.' + path + '-menu').addClass('selected');

  DataApp.currentUser = user || null;
  if (DataApp.currentUser !== null)
    DataApp.currentUser.url = '/user/' + DataApp.currentUser.username;

  var flash, flashMessage;
  errorMessage.length > 0 && (flash = $('.error'), flashMessage = errorMessage[0]);
  successMessage.length > 0 && (flash = $('.succes'), flashMessage = successMessage[0]);

  if (flash) {
    flash.find('.content-text').text(flashMessage);
    flash.addClass('fadeIn');
  }
};

APP.AM.prototype.setupUI = function() {
  this.signInBtn = $('.am-Signin-button');
  this.closeFlashBtn = $('.close-flash');
  this.flashMessage = $('.flash-message');
  this.closeModalBtn = $('.closed-modal');

  this.generalSearch = $('.general-search');
  this.generalSearchBtn = $('.search-general-btn');
  this.generalSearchOptions = $('.general-search-options');

  this.subscriptionForm = $('.subscription-form');
  this.subscriptionBtn = $('.subscription-btn');

  this.body = $('.body');
  this.searchBox = $('.search-box');
  this.headerBars = $('.am-header-mobile .bars');
  this.headerAvatar = $('.am-header-mobile .avatar');
  this.headerCover = $('.body-inner .cover');

  this.worksOption = this.generalSearchOptions.find('.works-option');
  this.usersOption = this.generalSearchOptions.find('.users-option');
  this.collectionsOption = this.generalSearchOptions.find('.collections-option');
  this.emailSubscription = this.subscriptionForm.find('input[name=email]');
};

APP.AM.prototype.listeners = function() {
  this.generalSearch.focus(this.searchFocusHandler.bind(this));
  this.generalSearch.blur(this.searchBlurHandler.bind(this));
  this.generalSearch.keyup(this.searchKeyUpHandler.bind(this));
  this.generalSearchBtn.click(this.generalSearchBtnClickHandler.bind(this));

  this.subscriptionForm.submit(this.subscriptionFormHandler.bind(this));
  this.subscriptionBtn.click(this.subscriptionHandler.bind(this));

  this.signInBtn.click(this.signInHandler);
  this.closeFlashBtn.click(this.closeFlashHandler.bind(this));

  this.headerBars.click(this.headerBarsHandler.bind(this));

  this.headerAvatar.click(this.headerAvatarHandler.bind(this));

  this.headerCover.click(this.headerCoverHandler.bind(this));
  this.closeModalBtn.click(this.closeModal.bind(this));
  this.searchBox.submit(this.searchBoxHandler.bind(this));
  $(document).keyup(this.escapeHandler.bind(this));
};

APP.AM.prototype.headerCoverHandler = function(event) {
  this.body.removeClass('open-right');
  this.body.removeClass('open-left');
};
APP.AM.prototype.headerAvatarHandler = function(event) {
  event.preventDefault();
  this.body.removeClass('open-left');
  this.body.toggleClass('open-right');
};
APP.AM.prototype.headerBarsHandler = function(event) {
  event.preventDefault();
  this.body.removeClass('open-right');
  this.body.toggleClass('open-left');
};
APP.AM.prototype.searchBoxHandler = function(event) {
  event.preventDefault();
  window.location.href = DataApp.discoverWorks + '?term=' + $('.search-box-value').val();
};

APP.AM.prototype.escapeHandler = function(event) {
  if (event.keyCode == 27)
    this.closeModal();
};

APP.AM.prototype.closeModal = function() {
  $('#lean_overlay').trigger("click");
};

APP.AM.prototype.signInHandler = function(event) {
  event.preventDefault();
  Utils.checkAuthentication();
};

APP.AM.prototype.closeFlashHandler = function(event) {
  event.preventDefault();
  this.flashMessage.css('visibility', 'hidden');
};

APP.AM.prototype.subscriptionHandler = function(event) {
  event.preventDefault();
  this.subscriptionForm.submit();
};

APP.AM.prototype.subscriptionFormHandler = function(event) {
  event.preventDefault();

  var errors = [],
    emailValue = this.emailSubscription.val();
  if (Validations.notBlank(emailValue)) errors.push('Ingrese un correo');
  if (!Validations.email(emailValue)) errors.push('Formato de correo no valido');
  if (errors.length > 0) return APP.BaseScreen.prototype.showFlash.call(this, 'error', errors);

  $.post('/subscribe', {
    email: emailValue
  }).then(this.subscriptionComplete.bind(this));
};

APP.AM.prototype.subscriptionComplete = function(response) {
  if (response.data.created)
    APP.BaseScreen.prototype.showFlash.call(this, 'succes', 'Suscripcion exitosa');
  else
    APP.BaseScreen.prototype.showFlash.call(this, 'error', ['Ya estas Suscrito']);
};

APP.AM.prototype.searchFocusHandler = function(event) {
  this.generalSearchOptions.show();
};

APP.AM.prototype.searchBlurHandler = function(event) {
  var scope = this;
  var timeout = setTimeout(function() {
    clearTimeout(timeout);
    scope.generalSearchOptions.hide();
  }, 200);
};

APP.AM.prototype.generalSearchBtnClickHandler = function(event) {
  var baseUrl = this.getBaseUrl();
  window.location.href = '/works/category' + baseUrl;
};

APP.AM.prototype.searchKeyUpHandler = function(event) {
  var currentValue = this.generalSearch.val();
  this.generalSearchOptions.show();

  this.worksOption.text(currentValue);
  this.usersOption.text(currentValue);
  this.collectionsOption.text(currentValue);

  var baseUrl = this.getBaseUrl();

  this.worksOption.parent().attr('href', '/works/category' + baseUrl);
  this.usersOption.parent().attr('href', '/users/specialty' + baseUrl);
  this.collectionsOption.parent().attr('href', '/collections/category' + baseUrl);
};

APP.AM.prototype.getBaseUrl = function() {
  var baseUrl = '/all/page-1';
  var value = this.generalSearch.val();
  if (value.length > 0)
    baseUrl += '?term=' + encodeURIComponent(value);
  return baseUrl;
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};
APP.BaseElement = function(data, id, options) {
  this.options = options || {
    context: 'normal'
  };
  this.template = APP.TemplateManager.instance.getFromDoc(id);
  this.data = data;
  this.id = id;
  var viewHelpers = {
    addFilter: Utils.addImageFilter,
    formatDate: function(date) {
      return moment(date).fromNow();
    },
    viewer: DataApp.currentUser
  };
  _.extend(this.data, this.options);
  _.extend(this.data, viewHelpers);

  console.log(this.data);
  
  this.view = $(this.template(this.data));
  this.rawView = this.view[0];
  this.listeners();
};

APP.BaseElement.prototype = Object.create(EventDispatcher.prototype);

APP.BaseElement.constructor = APP.BaseElement;

APP.BaseElement.prototype.listeners = function() {
  this.featuredBtn = this.view.find('.featured');
  this.featuredBtn.click(this.featuredHandler.bind(this));
};

APP.BaseElement.prototype.featuredHandler = function() {
  var url, tempId = this.id;
  if (this.id === 'table-work') tempId = 'work';
  if (this.id === 'table-user') tempId = 'user';

  if (this.data.featured) {
    if (tempId === 'user') {
      url = '/user/' + this.data.username + '/unfeatured';
    } else {
      url = '/user/' + this.data.User.username + '/' + tempId + '/unfeatured';
    }
  } else {
    if (tempId === 'user') {
      url = '/user/' + this.data.username + '/featured';
    } else {
      url = '/user/' + this.data.User.username + '/' + tempId + '/featured';
    }
  }
  var scope = this,
    payload = {};
  payload['id' + Utils.capitalize(tempId)] = this.data.id;
  $.post(url, payload, function(response) {
    if (response.status === 200) {
      if (response.data[tempId].featured) {
        if (scope.id.indexOf('table') > -1)
          scope.featuredBtn.removeClass('btn-default').addClass('btn-primary');
        else
          scope.featuredBtn.removeClass('disabled');
      } else {
        if (scope.id.indexOf('table') > -1)
          scope.featuredBtn.removeClass('btn-primary').addClass('btn-default');
        else
          scope.featuredBtn.addClass('disabled');
      }
      scope.data.featured = response.data[tempId].featured;
    }
  });
};

APP.BaseElement.prototype.callToApi = function(params) {
  return APP.RestClientManager.instance.execute(params);
}

APP.BaseElement.prototype.isLogged = function() {
  Utils.checkAuthentication();
  return DataApp.currentUser !== null;
};

/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.BaseScreen = function(id) {
  this.id = id;

  this.setupUI();
  this.listeners();
};

APP.BaseScreen.prototype = Object.create(Object.prototype);

APP.BaseScreen.constructor = APP.BaseScreen;
APP.BaseScreen.prototype.setupUI = function() {

};

APP.BaseScreen.prototype.listeners = function() {

};

APP.BaseScreen.prototype.requestHandler = function(url, payload, next, error, free) {
  !free && Utils.checkAuthentication();
  $.post(url, payload).then(this.requestComplete.bind(this, next, error));
};

APP.BaseScreen.prototype.requestComplete = function(next, error, response) {
  console.log('response ===>', response);
  if (response.status !== 200) {
    var errors = response.data.errors || ['Algo sucedió mal'];
    error && error.bind(this)();
    return this.showFlash('error', errors);
  }
  next.bind(this)(response);
};

APP.BaseScreen.prototype.showFlash = function(meta, data) {
  var element = $('.' + meta);
  $('.flash-message').css('visibility', 'hidden');
  var container = element.find('.content-text');
  container.empty();
  if (meta === 'error') {
    for (var i = 0; i < data.length; i++) {
      container.append($('<p>').text('✘ ' + data[i]));
    }
  } else {
    container.text(data);
  }
  element.css('visibility', 'visible');
  element.removeClass('fadeIn');
  var timeout = setTimeout(function() {
    clearTimeout(timeout);
    element.addClass('fadeIn');
  }, 100);
};

APP.BaseScreen.prototype.getTemplate = function(path) {
  var temp = '';
  if (['followings', 'followers'].indexOf(path) !== -1) temp = 'user';
  if ('portfolio' === path) temp = 'work';
  if ('products' === path) temp = 'product';
  if ('collections' === path) temp = 'collection';
  return temp;
};

APP.BaseScreen.prototype.clean = function() {

};
/**
 * @author www.juliocanares.com/cv
 * @email juliocanares@gmail.com
 */

var DataApp = {};
DataApp.currentUser = null;
DataApp.baseUrl = window.location.origin + '/';
DataApp.baseTitle = 'Arte Manifiesto | ';
DataApp.loginUrl = DataApp.baseUrl + 'auth/login';
DataApp.discoverWorks = DataApp.baseUrl + 'works/category/all/page-1/';
DataApp.discoverUsers = DataApp.baseUrl + 'users/specialties/all/page-1/';
DataApp.discoverProducts = DataApp.baseUrl + 'products/type/all/page-1/';
DataApp.searchCollections = DataApp.baseUrl + 'artjam/collections/page-1';

DataApp.currentUrl = window.location.href.replace(/\/$/g, '');
DataApp.currentUrl = DataApp.currentUrl.replace(/#_=_$/g, '');
DataApp.fbAppID = '1473636902857068';


var Events = {};
Events.LOAD_START = 'loadStart';
Events.LOAD_END = 'loadEnd';
Events.COLLECTION_ITEM_SELECTED = 'collectionItemSelected';
Events.ADD_COLLECTION = 'addCollection';
Events.SHARE = 'share';
Events.FILTER_CHANGED = 'filterChanged';
Events.CREATOR_READY = 'creatorReady';


var Validations = {
  notBlank: function(value) {
    if (!value) {
      return true
    };
    return '' === value.replace(/^\s+/g, '').replace(/\s+$/g, '')
  },
  username: function(value) {
    var re = new RegExp(/^[a-zA-Z0-9]+$/);
    return re.test(value);
  },
  email: function(value) {
    var re = new RegExp(/^\w+@\w+\.\w{2,3}$/);
    return re.test(value);
  }
}
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};
APP.Carrousel = function(view, container) {
  this.view = view;
  this.container = container;
  this.nextBtn = this.view.find('.nextButton');
  this.prevBtn = this.view.find('.prevButton');
  this.carrousel = this.view.find('.more-images');
  this.setup();
};

APP.Carrousel.constructor = APP.Carrousel;

APP.Carrousel.prototype.checkArrows = function() {
  clearTimeout(this.timeout);

  if (this.container[0].scrollWidth > this.container.innerWidth()) {
    this.nextBtn.show();
    this.prevBtn.show();
  } else {
    this.nextBtn.hide();
    this.prevBtn.hide();
  }

  this.animationComplete();
};

APP.Carrousel.prototype.setup = function() {
  this.nextBtn.click(this.nextHandler.bind(this));
  this.prevBtn.click(this.prevHandler.bind(this));

  this.carrousel.scroll(this.animationComplete.bind(this));

  $(window).resize(this.checkArrows.bind(this));

  this.timeout = setTimeout(this.checkArrows.bind(this), 1000);
};

APP.Carrousel.prototype.nextHandler = function() {
  this.carrousel.animate({
    scrollLeft: (this.carrousel.scrollLeft() + 230)
  }, 400, this.animationComplete.bind(this));
};

APP.Carrousel.prototype.prevHandler = function() {
  this.carrousel.animate({
    scrollLeft: (this.carrousel.scrollLeft() - 230)
  }, 400, this.animationComplete.bind(this));
};

APP.Carrousel.prototype.animationComplete = function() {
  if (this.carrousel.scrollLeft() <= 0)
    this.prevBtn.hide();
  else
    this.prevBtn.show();

  var totalWidth = this.carrousel.scrollLeft() + this.carrousel.innerWidth();

  if (totalWidth >= this.carrousel[0].scrollWidth)
    this.nextBtn.hide();
  else
    this.nextBtn.show();
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.CarrouselItem = function(data, options) {
  options = options || {};
  if (!options.worked) options.worked = false;

  APP.BaseElement.call(this, data, 'carrousel-item', options);
};

APP.CarrouselItem.prototype = Object.create(APP.BaseElement.prototype);

APP.CarrouselItem.constructor = APP.CarrouselItem;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.Collection = function(data, options) {
  APP.BaseElement.call(this, data, 'collection', options);
};

APP.Collection.prototype = Object.create(APP.BaseElement.prototype);

APP.Collection.constructor = APP.Collection;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.CollectionItem = function(data, options) {
  APP.BaseElement.call(this, data, 'collection-item', options);
};

APP.CollectionItem.prototype = Object.create(APP.BaseElement.prototype);

APP.CollectionItem.constructor = APP.CollectionItem;

APP.CollectionItem.prototype.listeners = function() {
  this.view.click(this.clickViewHandler.bind(this));
};

APP.CollectionItem.prototype.clickViewHandler = function() {
  this.view.toggleClass('selected');
  this.dispatchEvent({
    type: Events.COLLECTION_ITEM_SELECTED
  });
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.CreatorProductItem = function(index, data) {
  this.index = index;
  this.view = $('.grid-product-' + index);
  this.header = $('div[data-prod=' + index + ']');

  this.data = data;
  this.currentPhoto;
  this.currentRenderPhoto;
  this.currentPrintPhoto;

  if (this.data) {
    this.config = JSON.parse(this.data.subCategories[0].data);
    $('#canvas-product' + index).attr('width', this.config.widthView);
    $('#canvas-product' + index).attr('height', this.config.heightView);

    this.canvasColor = '#FFFFFF';
    this.canvas = new fabric.Canvas('canvas-product' + index, {
      backgroundColor: this.canvasColor
    });

    this.header.find('.background').find('img').attr('src', this.config.renderImage);
  }

  if (this.data) {
    this.setup();
  }
  this.listeners();
};

APP.CreatorProductItem.constructor = APP.CreatorProductItem;

APP.CreatorProductItem.prototype.listeners = function() {
  var scope = this;

  this.view.find('.part-btn-1').click(this.partBtn1Handler.bind(this));
  this.view.find('.part-btn-2').click(this.partBtn2Handler.bind(this));

  this.view.find('.vertical-align').click(this.verticalAlign.bind(this));
  this.view.find('.horizontal-align').click(this.horizontalAlign.bind(this));
  this.view.find('input[type=range]').change(this.productScaleHandler.bind(this));

  this.view.find('.save-btn-kek').click(this.saveBtnHandler.bind(this));

  var scope = this;
  this.view.find('.cloudinary-fileupload').fileupload({
      start: function(e) {},
      fail: function(e, data) {}
    })
    .off('cloudinarydone').on('cloudinarydone', function(e, data) {
      var image = scope.canvas.item(0);
      work.photo = data.result.url;
      var scale = scope.config.scaleFactor / 10,
        url;
      if (this.data) {
        url = Utils.addImageFilter(work.photo, 'w_' + scale + ',h_' + scale);
      } else {
        url = Utils.addImageFilter(work.photo, 'w_0.5,h_0.5');
      }
      image.setSrc(url, function() {
        image.setCoords();
        scope.canvas.renderAll();
        scope.renderCanvas();
      }, {
        crossOrigin: 'Anonymous'
      });
    });

  var scope = this;
  this.view.find('.margen-input').keyup(function() {
    var index = $(this).data('index');
    var baseprice = $(this).data('baseprice');
    var currentValue = $(this).val();
    var percentage = (currentValue / 100) * baseprice;
    var finalprice = baseprice + percentage;

    scope.data.subCategories[index].finalPrice = finalprice;
    scope.data.subCategories[index].margen = currentValue;

    $($(this).parent().find('p')[1]).text('S/.' + finalprice);
  });
  this.view.find('.margen-input').keyup();
};

APP.CreatorProductItem.prototype.saveBtnHandler = function(e) {
  e.preventDefault();
  this.view.addClass('hide');
};

APP.CreatorProductItem.prototype.productScaleHandler = function(e) {
  var value = e.target.value / 100;
  var image = this.canvas.item(0);
  image.scaleX = image.scaleY = value;
  image.setCoords();
  this.canvas.renderAll();

  this.renderCanvas();
};

APP.CreatorProductItem.prototype.verticalAlign = function(e) {
  e.preventDefault();
  var image = this.canvas.item(0);
  this.canvas.centerObjectV(image);
  image.setCoords();
  this.canvas.renderAll();
  this.renderCanvas();
};

APP.CreatorProductItem.prototype.horizontalAlign = function(e) {
  e.preventDefault();
  var image = this.canvas.item(0);
  this.canvas.centerObjectH(image);
  image.setCoords();
  this.canvas.renderAll();
  this.renderCanvas();
};

APP.CreatorProductItem.prototype.partBtn1Handler = function(e) {
  this.view.find('.part-btn-1').addClass('selected');
  this.view.find('.part-btn-2').removeClass('selected');
  this.view.find('.sales-right-1').show();
  this.view.find('.sales-right-2').hide();
};

APP.CreatorProductItem.prototype.partBtn2Handler = function(e) {
  this.view.find('.part-btn-1').removeClass('selected');
  this.view.find('.part-btn-2').addClass('selected');
  this.view.find('.sales-right-1').hide();
  this.view.find('.sales-right-2').show();
};

APP.CreatorProductItem.prototype.colorChangeHandler = function(color) {
  this.canvasColor = color.toHexString();
  this.canvas.backgroundColor = this.canvasColor;
  this.canvas.renderAll();
  this.renderCanvas();
};

APP.CreatorProductItem.prototype.setup = function() {
  var colorsConf = {
    showPaletteOnly: true,
    showPalette: true,
    color: 'white',
    palette: [
      ['black', 'white', 'blanchedalmond',
        'rgb(255, 128, 0);', 'hsv 100 70 50'
      ],
      ['red', 'yellow', 'green', 'blue', 'violet']
    ],
    change: this.colorChangeHandler.bind(this)
  }
  this.view.find("#colorPicker").spectrum(colorsConf);


  var scope = this;
  var url;
  if (this.data) {
    var scale = 1 / this.config.scaleFactor;
    url = Utils.addImageFilter(work.photo, 'w_' + scale + ',h_' + scale);
  } else {
    url = Utils.addImageFilter(work.photo, 'w_0.5,h_0.5');
  }

  console.log(url);

  var imageTemp;


  fabric.Image.fromURL(url, function(image) {
    imageTemp = image;
    // var ratio = image.width / image.height;
    // if(image.width > 560) image.width = 560; image.height = 560 / ratio;

    scope.canvas.add(image);
    scope.canvas.calcOffset();
    scope.canvas.sendToBack(image);
    scope.canvas.setActiveObject(scope.canvas.item(0));
    scope.canvas.item(0).lockRotation = true;
    scope.canvas.item(0).hasRotatingPoint = false;
    scope.canvas.item(0).lockUniScaling = true;

    scope.canvas.centerObject(image);
    image.setCoords();

    scope.renderCanvas();

    fabric.Image.fromURL(scope.config.guideImage, function(img) {
      console.log(scope.canvas.width);
      console.log('width =>');
      console.log(img.width);
      console.log('height =>');
      console.log(img.height);
      img.evented = img.selectable = false;
      img.left = img.top = -1;
      scope.canvas.add(img);
      console.log('width =>', img.width);

      // scope.canvas.centerObject(image);
      img.setCoords();
      scope.canvas.renderAll();
    }, {
      crossOrigin: 'Anonymous'
    });
  }, {
    crossOrigin: 'Anonymous'
  });

  // this.canvas.loadFromJSON(data,  this.canvas.renderAll.bind(this.canvas), function(o, object) {
  //   fabric.log(o, object);
  // });
  this.canvas.on('mouse:up', function(options) {
    scope.renderCanvas(options);
  });
};

APP.CreatorProductItem.prototype.renderCanvas = function() {
  var image = this.canvas.item(0);
  image.hasBorders = image.hasControls = false;

  if (this.canvas.item(1)) {
    this.canvas.item(1).opacity = 0;
  }

  this.canvas.renderAll();
  var url = this.canvas.toDataURL({
    left: this.config.offsetX,
    top: this.config.offsetY,
    width: this.config.widthRender,
    height: this.config.heightRender
  });

  this.header.find('.image-preview').attr('src', url);

  // .css('width', 'auto').css('height', this.config.heightRender /2);

  var urlImage = work.photo;
  var baseName = urlImage.replace(/^.*\/|\.[^.]*$/g, '')

  var boundaries = image.getBoundingRect();
  var x = Math.round(boundaries.left * this.config.scaleFactor);
  var y = Math.round(boundaries.top * this.config.scaleFactor);
  var stageW = Math.round(this.config.widthView * this.config.scaleFactor);
  var stageH = Math.round(this.config.heightView * this.config.scaleFactor);
  var imageW = Math.round(image.getWidth() * this.config.scaleFactor);
  var imageH = Math.round(image.getHeight() * this.config.scaleFactor);
  var rgbColor = this.canvasColor.replace('#', '');
  var filters =
    'w_' + stageW + ',' +
    'h_' + stageH + ',e_colorize,co_rgb:' + rgbColor + '/' +
    'l_' + baseName + ',b_rgb:' + rgbColor + ',' +
    'w_' + imageW + ',' +
    'h_' + imageH + ',' +
    'x_' + x + ',' +
    'y_' + y + ',g_north_west/' +
    'x_' + (x < 0 ? (x * -1) : 0) + ',' +
    'y_' + (y < 0 ? (y * -1) : 0) + ',' +
    'w_' + stageW + ',' +
    'h_' + stageH + ',c_crop,g_north_west';

  this.currentPrintPhoto = Utils.addImageFilter(urlImage, filters);
  console.log('print : ', this.currentPrintPhoto);

  x = Math.round((boundaries.left * this.config.scaleFactor) - (this.config.offsetX * this.config.scaleFactor));
  y = Math.round((boundaries.top * this.config.scaleFactor) - (this.config.offsetY * this.config.scaleFactor));

  var renderName = this.config.renderImage.replace(/^.*\/|\.[^.]*$/g, '')

  filters =
    'w_' + stageW + ',' +
    'h_' + stageH + ',e_colorize,co_rgb:' + rgbColor + '/' +
    'l_' + baseName + ',b_rgb:' + rgbColor + ',' +
    'w_' + imageW + ',' +
    'h_' + imageH + ',' +
    'x_' + x + ',' +
    'y_' + y + ',g_north_west/' +
    'x_' + ((x < 0 ? (x * -1) : 0)) + ',' +
    'y_' + (y < 0 ? (y * -1) : 0) + ',' +
    'w_' + Math.round(this.config.widthRender * this.config.scaleFactor) + ',' +
    'h_' + Math.round(this.config.heightRender * this.config.scaleFactor) +
    ',c_crop,g_north_west/';

  if (this.index === 2) {
    filters += 'w_' + Math.round(this.config.widthRender) + ',h_' +
      Math.round(this.config.heightRender) + '/l_' + renderName;
  }

  if (this.index === 3) {
    filters += 'w_230/e_distort:-15:90:220:60:215:360:-15:382/c_pad,h_2,w_1.0/' +
      'l_radial,e_displace,y_-20/e_trim/' + '/l_' + renderName + '/c_crop,x_90,y_10,w_500,h_500';
  }

  if (this.index === 4) {
    filters += 'w_' + Math.round(this.config.widthRender) + ',h_' +
      Math.round(this.config.heightRender) + '/l_' + renderName;
  }

  this.currentRenderPhoto = Utils.addImageFilter(urlImage, filters);
  console.log('render', this.currentRenderPhoto);


  image.hasBorders = image.hasControls = true;
  if (this.canvas.item(1)) {
    this.canvas.item(1).opacity = 1;
  }
  this.canvas.renderAll();
};

APP.CreatorProductItem.prototype.open = function() {
  this.view.removeClass('hide');
};

APP.CreatorProductItem.prototype.getPayload = function() {
  if(this.index === 0) {
    return [];
  }

  var checked = this.view.find('input[type=checkbox]:checked');
  var result = [];
  for (var i = 0; i < checked.length; i++) {
    var index = $(checked[i]).data('index');
    var subcategory = this.data.subCategories[index];
    var item = {
      WorkId: work.id,
      CategoryId: this.data.subCategories[index].id,
      name: work.name,
      photo: this.currentRenderPhoto,
      printPhoto: this.currentPrintPhoto,
      finalPrice: subcategory.finalPrice.toString(),
      description: work.description,
      canvas: JSON.stringify(this.canvas.toJSON()),
      config: JSON.stringify({
        data: JSON.parse(this.data.subCategories[index].data),
        margen: subcategory.margen,
        range: this.view.find('input[type=range]').val(),
        bgCanvas: this.canvas.backgroundColor
      })
    };
    result.push(item);
  }
  return result;
};

APP.CreatorProductItem.prototype.close = function() {
  this.view.addClass('hide');
};

/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.FeedUserFollow = function(data, options) {
  var friends = data.element.friends;
  if (friends.length > 0) {
    data.element.currentFriend = friends[_.random(0, friends.length - 1)];
  } else {
    data.element.currentFriend = null;
  }
  APP.BaseElement.call(this, data, 'feed-user-follow', options);
};

APP.FeedUserFollow.prototype = Object.create(APP.BaseElement.prototype);

APP.FeedUserFollow.constructor = APP.FeedUserFollow;

APP.FeedUserFollow.prototype.listeners = function() {
  this.followBtn = this.view.find('.am-Follow-button');
  this.followBtn.click(this.followClickHandler.bind(this));
}

APP.FeedUserFollow.prototype.followClickHandler = function() {
  var scope = this;
  if (this.data.element.following) {
    var url = DataApp.currentUser.url + '/unfollow/';
    $.post(url, {
      idUser: this.data.element.id
    }, function(response) {
      if (response.status === 200) {
        scope.data.element.following = false;
        $('.am-Follow-button').removeClass('following').text('+Seguir');
      }
    });
  } else {
    var url = DataApp.currentUser.url + '/follow/';
    $.post(url, {
      idUser: this.data.element.id
    }, function(response) {
      if (response.status === 200) {
        scope.data.element.following = true;
        $('.am-Follow-button').addClass('following').text('Siguiendo');
      }
    });
  }
  console.log('following');
}
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.FeedWorkCreated = function(data, options) {
  APP.BaseElement.call(this, data, 'feed-work-created', options);
};

APP.FeedWorkCreated.prototype = Object.create(APP.BaseElement.prototype);

APP.FeedWorkCreated.constructor = APP.FeedWorkCreated;
APP.FeedWorkCreated.prototype.listeners = function() {
  this.addCollectionBtn = this.view.find('.add-collection');
  this.likeBtn = this.view.find('.like');
  this.shareBtn = this.view.find('.share');
  this.afterLike = this.view.find('.after-like');
  this.followBtn = this.view.find('.am-Follow-button');

  if (this.data.element.User.following) {
    this.followBtn.addClass('following').text('Siguiendo');
  }
  this.addCollectionBtn.click(this.addCollectionHandler.bind(this));
  this.likeBtn.click(this.likeHandler.bind(this));
  this.shareBtn.click(this.shareHandler.bind(this));
  this.followBtn.click(this.followHandler.bind(this));
};

APP.FeedWorkCreated.prototype.addCollectionHandler = function() {
  $('#go-collection-modal').click();
  Broadcaster.dispatchEvent(Events.ADD_COLLECTION, {
    data: {
      work: this.data.element
    }
  });
};

APP.FeedWorkCreated.prototype.likeHandler = function() {
  if (!this.likeBtn.hasClass('active')) {
    var url = DataApp.currentUser.url + '/work/like';
    var scope = this;
    $.post(url, {
      idWork: this.data.element.id
    }, function(response) {
      if (response.status === 200) {
        scope.likeBtn.addClass('active');
        scope.afterLike.show();
      }
    });
  }
};

APP.FeedWorkCreated.prototype.shareHandler = function() {
  $('#go-share-modal').click();
  Broadcaster.dispatchEvent(Events.SHARE, {
    data: {
      work: this.data.element
    }
  });
};

APP.FeedWorkCreated.prototype.followHandler = function() {
  var scope = this;
  if (this.data.element.User.following) {
    var url = DataApp.currentUser.url + '/unfollow/';
    $.post(url, {
      idUser: this.data.element.User.id
    }, function(response) {
      if (response.status === 200) {
        scope.data.element.User.following = false;
        $('.am-Follow-button').removeClass('following').text('+Seguir');
      }
    });
  } else {
    var url = DataApp.currentUser.url + '/follow/';
    $.post(url, {
      idUser: this.data.element.User.id
    }, function(response) {
      if (response.status === 200) {
        scope.data.element.User.following = true;
        $('.am-Follow-button').addClass('following').text('Siguiendo');
      }
    });
  }
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.NotificationAcceptedProduct = function(data, options) {
  APP.BaseElement.call(this, data, 'notification-accepted-product', options);
};

APP.NotificationAcceptedProduct.prototype = Object.create(APP.BaseElement.prototype);

APP.NotificationAcceptedProduct.constructor = APP.NotificationAcceptedProduct;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.NotificationDeniedProduct = function(data, options) {
  data.data = JSON.parse(data.data);
  APP.BaseElement.call(this, data, 'notification-denied-product', options);
};

APP.NotificationDeniedProduct.prototype = Object.create(APP.BaseElement.prototype);

APP.NotificationDeniedProduct.constructor = APP.NotificationDeniedProduct;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.NotificationFollow = function(data, options) {
  APP.BaseElement.call(this, data, 'notification-follow', options);
};

APP.NotificationFollow.prototype = Object.create(APP.BaseElement.prototype);

APP.NotificationFollow.constructor = APP.NotificationFollow;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.NotificationLike = function(data, options) {
  APP.BaseElement.call(this, data, 'notification-like', options);
};

APP.NotificationLike.prototype = Object.create(APP.BaseElement.prototype);

APP.NotificationLike.constructor = APP.NotificationLike;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.NotificationRequest = function(data, options) {
  APP.BaseElement.call(this, data, 'notification-request', options);
};

APP.NotificationRequest.prototype = Object.create(APP.BaseElement.prototype);

APP.NotificationRequest.constructor = APP.NotificationRequest;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.NotificationReview = function(data, options) {
  APP.BaseElement.call(this, data, 'notification-review', options);
};

APP.NotificationReview.prototype = Object.create(APP.BaseElement.prototype);

APP.NotificationReview.constructor = APP.NotificationReview;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};
APP.PhotoSwipe = function(tag) {
  this.tag = tag;
  this.filter = 'w_1500,h_800,c_limit,q_80';

  this.isLoading = false;
  this.zoom = false;
  this.meta = null;

  this.setupUI();
  this.listeners();
};

APP.PhotoSwipe.constructor = APP.PhotoSwipe;

APP.PhotoSwipe.prototype.setupUI = function() {
  this.image = $('#work-image');
  this.pswp = $('.pswp')[0];
  this.modal = $('#go-preload-modal');
};


APP.PhotoSwipe.prototype.listeners = function() {
  this.image.click(this.imageHandler.bind(this));
};

APP.PhotoSwipe.prototype.imageHandler = function() {
  if (!this.zoom) {
    this.modal.click();

    this.isLoading = true;
    var src;
    if (this.tag === 'work') {
      src = Utils.addImageFilter(work.photo, this.filter);
    } else {
      src = Utils.addImageFilter(product.photo, this.filter);
    }

    var scope = this;
    $('<img>').load(function() {
      scope.imageLoadHandler(this);
    }).attr('src', src);

    this.zoom = true;

  } else {
    if (this.isLoading) {
      this.modal.click();
    }
  }
};

APP.PhotoSwipe.prototype.imageLoadHandler = function(image) {
  $('#lean_overlay').click();

  this.isLoading = false;
  this.meta = {
    width: image.width,
    height: image.height
  };
  this.image.click(this.openPhotoSwipeHandler.bind(this));
  this.image.click();
};

APP.PhotoSwipe.prototype.openPhotoSwipeHandler = function() {
  var src;
  if (this.tag === 'work') {
    src = Utils.addImageFilter(work.photo, this.filter);
  } else {
    src = Utils.addImageFilter(product.photo, this.filter);
  }
  var items = [{
    src: src,
    w: this.meta.width,
    h: this.meta.height
  }];

  var scope = this;
  var options = {
    getThumbBoundsFn: function() {
      return {
        x: scope.image.offset.left,
        y: scope.image.offset.top + 50,
        w: scope.image.width()
      }
    }
  };
  new PhotoSwipe(this.pswp, PhotoSwipeUI_Default, items, options).init();
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.Post = function(data, options) {
  APP.BaseElement.call(this, data, 'post', options);
};

APP.Post.prototype = Object.create(APP.BaseElement.prototype);

APP.Post.constructor = APP.Post;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.PostMinimal = function(data, options) {
  APP.BaseElement.call(this, data, 'post-minimal', options);
};

APP.PostMinimal.prototype = Object.create(APP.BaseElement.prototype);

APP.PostMinimal.constructor = APP.PostMinimal;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.Product = function(data, options) {
  APP.BaseElement.call(this, data, 'product', options);
};

APP.Product.prototype = Object.create(APP.BaseElement.prototype);

APP.Product.constructor = APP.Product;


APP.Product.prototype.listeners = function() {
  APP.BaseElement.prototype.listeners.call(this);
  this.view.find('.delete').click(this.deleteHandler.bind(this));
  this.view.find('.edit').click(this.editHandler.bind(this));
};

APP.Product.prototype.deleteHandler = function() {
  var url = '/user/' + this.data.User.username + '/product/delete';
  var scope = this;
  $.post(url, {
    idProduct: this.data.id
  }, function(response) {
    if (response.status === 200)
      $(scope.view.parent()).masonry('remove', scope.view).masonry();
  });
};

APP.Product.prototype.editHandler = function() {
  location.href = '/user/' + this.data.User.username + '/product/' + this.data.nameSlugify + '/edit';
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.RequestItem = function(data, options) {
  data.from = data.from || null;
  data.data = JSON.parse(data.data);
  data.Product.config = JSON.parse(data.Product.config);
  data.artistRevenue = (Number(data.Product.config.margen) / 100 *  data.Product.finalPrice);
  data.amRevenue = data.Product.finalPrice - data.artistRevenue;
  data.subtotal = data.artistRevenue + data.amRevenue;
  data.shipping = data.data.shipping;
  data.total = data.subtotal + data.shipping;

  APP.BaseElement.call(this, data, 'request-item', options);

  var scope = this;
  var step1 = this.view.find('.step-1');
  var step2 = this.view.find('.step-2');
  var step3 = this.view.find('.step-3');
  var step4 = this.view.find('.step-4');
  var step5 = this.view.find('.step-5');

  this.currentStep = this.data.status;

  if (this.currentStep === 'recibido') {
    step1.removeClass('hide');
  }
  if(this.currentStep === "paso2") {
    step2.removeClass('hide');
  }
  if(this.currentStep === "paso3") {
    step3.removeClass('hide');
  }
  if(this.currentStep === "paso4") {
    step4.removeClass('hide');
  }

  if(this.currentStep === "paso5") {
    step5.removeClass('hide');
  }

  var scope = this;

  step1.find('.yes').click(function(e) {
    e.preventDefault();

    scope.nextStepCaller({idOrder: data.id, currentStatus: scope.currentStep});

    step1.addClass('hide');
    step2.removeClass('hide');
  });

  step1.find('.no').click(function(e) {
    e.preventDefault();
    scope.nextStepCaller({idOrder: data.id, currentStatus: 'declined'});
  });

  step2.find('.done').click(function(e) {
    e.preventDefault();
    scope.nextStepCaller({idOrder: data.id, currentStatus: scope.currentStep});
    step2.addClass('hide');
    step3.removeClass('hide');
  });

  step3.find('.done').click(function(e) {
    e.preventDefault();
    scope.nextStepCaller({idOrder: data.id, currentStatus: scope.currentStep});
    step3.addClass('hide');
    step4.removeClass('hide');
  });

  step4.find('.upload').click(function() {
    scope.nextStepCaller({idOrder: data.id, currentStatus: scope.currentStep});
    step4.addClass('hide');
    step5.removeClass('hide');
  });

  // this.view.find('.cloudinary-fileupload').fileupload({
  //     start: function(e) {},
  //     fail: function(e, data) {}
  //   })
  // .off('cloudinarydone').on('cloudinarydone', function(e, data) {
  //   console.log(data);
  //   });
};

APP.RequestItem.prototype = Object.create(APP.BaseElement.prototype);

APP.RequestItem.constructor = APP.RequestItem;

APP.RequestItem.prototype.nextStepCaller = function(payload) {
  var url = DataApp.currentUser.url + '/account/next_step';
  $.post(url, payload).then(this.nextStepHandler.bind(this));
};

APP.RequestItem.prototype.nextStepHandler = function(response) {
  console.log(response);
  this.currentStep = response.data.order.status;
  console.log(this.currentStep);
};

/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.Review = function(data, options) {
  APP.BaseElement.call(this, data, 'review', options);
};

APP.Review.prototype = Object.create(APP.BaseElement.prototype);

APP.Review.constructor = APP.Review;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.TableBlog = function(data, options) {
  APP.BaseElement.call(this, data, 'table-blog', options);
};

APP.TableBlog.prototype = Object.create(APP.BaseElement.prototype);

APP.TableBlog.constructor = APP.TableBlog;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.TableProduct = function(data, options) {
  APP.BaseElement.call(this, data, 'table-product', options);
};

APP.TableProduct.prototype = Object.create(APP.BaseElement.prototype);

APP.TableProduct.constructor = APP.TableProduct;

APP.TableProduct.prototype.listeners = function() {
  this.featuredBtn = this.view.find('.featured-btn');
  this.featuredBtn.click(this.featuredHandler.bind(this));
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.TableProductApplying = function(data, options) {
  APP.BaseElement.call(this, data, 'table-product-applying', options);
};

APP.TableProductApplying.prototype = Object.create(APP.BaseElement.prototype);

APP.TableProductApplying.constructor = APP.TableProductApplying;

APP.TableProductApplying.prototype.listeners = function() {};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.TableUser = function(data, options) {
  APP.BaseElement.call(this, data, 'table-user', options);
};

APP.TableUser.prototype = Object.create(APP.BaseElement.prototype);

APP.TableUser.constructor = APP.TableUser;

APP.TableUser.prototype.listeners = function() {
  this.featuredBtn = this.view.find('.featured-btn');
  this.featuredBtn.click(this.featuredHandler.bind(this));
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.TableWork = function(data, options) {
  APP.BaseElement.call(this, data, 'table-work', options);
};

APP.TableWork.prototype = Object.create(APP.BaseElement.prototype);

APP.TableWork.constructor = APP.TableWork;

APP.TableWork.prototype.listeners = function() {
  this.featuredBtn = this.view.find('.featured-btn');
  this.featuredBtn.click(this.featuredHandler.bind(this));
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.UploaderImage = function(view, onComplete, options) {
  this.$view = view;
  this.photo = null;
  this.options = options || {
    uploader: $('.cloudinary-fileupload')
  };
  this.uploader = this.options.uploader;
  this.listeners();
  this.onComplete = onComplete;
};

APP.UploaderImage.constructor = APP.UploaderImage;

APP.UploaderImage.prototype.listeners = function() {
  var scope = this;
  this.uploader.fileupload({
      start: function(e) {
        scope.$view.find('.upload').hide();
        $(this).hide();
        scope.$view.find('.preload').removeClass('hide');
        scope.$view.find('.preload').show();
      },
      fail: function(e, data) {
        scope.$view.find('.upload').show();
        $(this).show();
        scope.$view.find('.preload').hide();
      }
    })
    .off('cloudinarydone').on('cloudinarydone', function(e, data) {
      scope.$view.find('.preload').hide();
      scope.$view.find('.preview').html('');
      scope.photo = data.result.url;
      if (!scope.onComplete) {
        var filters = {
          format: data.result.format,
          width: 200,
          height: 200,
          crop: "thumb"
        };
        $.cloudinary.image(data.result.public_id, filters).appendTo(scope.$view.find('.preview'));
      } else {
        scope.onComplete(data.result.public_id);
      }
    });
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.User = function(data, options) {
  APP.BaseElement.call(this, data, 'user', options);
};

APP.User.prototype = Object.create(APP.BaseElement.prototype);

APP.User.constructor = APP.User;

APP.User.prototype.listeners = function() {
  APP.BaseElement.prototype.listeners.call(this);
  this.view.find('.am-Follow-button').click(this.followHandler.bind(this));
};

APP.User.prototype.followHandler = function() {
  if (this.isLogged()) {
    var action = this.data.following ? 'unfollow' : 'follow';
    var options = {
      url: DataApp.currentUser.url + '/' + action,
      data: {
        idUser: this.data.id
      }
    };
    Utils.getData(options).then(this.followHandlerComplete.bind(this));
  }
};

APP.User.prototype.followHandlerComplete = function(response) {
  if (response.status === 200) {
    if (this.data.following) {
      this.view.find('.am-Follow-button').removeClass('following').text('+Seguir');
    } else {
      this.view.find('.am-Follow-button').addClass('following').text('Siguiendo');
    }
    this.data.following = !this.data.following;
  }
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.Work = function(data, options) {
  APP.BaseElement.call(this, data, 'work', options);
};

APP.Work.prototype = Object.create(APP.BaseElement.prototype);

APP.Work.constructor = APP.Work;


APP.Work.prototype.listeners = function() {
  APP.BaseElement.prototype.listeners.call(this);
  this.view.find('.delete-new').click(this.deleteHandler.bind(this));
  this.view.find('.delete-force').click(this.deleteForceHandler.bind(this));
  this.view.find('.cancel').click(this.cancelHandler.bind(this));
  this.view.find('.edit').click(this.editHandler.bind(this));
  this.view.find('.settings-btn').click(this.settingsHandler.bind(this));
};

APP.Work.prototype.settingsHandler = function() {
  if(this.view.find('.menu-settings').hasClass('hide')) {
    this.view.find('.menu-settings').removeClass('hide');
  }else {
    this.view.find('.menu-settings').addClass('hide');
  }
};

APP.Work.prototype.deleteHandler = function(e) {
  e.preventDefault();
  this.view.find('.menu-settings').addClass('hide');
  this.view.find('.delete-confirm').show();
};

APP.Work.prototype.deleteForceHandler = function() {
  if (this.options.context === 'single-collection') {
    var url = '/user/' + this.data.User.username + '/work/remove_from_collection';
    var scope = this;
    $.post(url, {
      idWork: this.data.id,
      idCollection: collection.id
    }, function(response) {
      if (response.status === 200)
        $(scope.view.parent()).masonry('remove', scope.view).masonry();
    });
  } else {
    var url = '/user/' + this.data.User.username + '/work/delete';
    var scope = this;
    $.post(url, {
      idWork: this.data.id
    }, function(response) {
      if (response.status === 200)
        $(scope.view.parent()).masonry('remove', scope.view).masonry();
    });
  }
};

APP.Work.prototype.cancelHandler = function() {
  this.view.find('.delete-confirm').hide();
};


APP.Work.prototype.editHandler = function() {
  location.href = '/user/' + this.data.User.username + '/work/' + this.data.nameSlugify + '/edit';
};

/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.NavigationManager = function(navigation) {
  this.navigator;
  switch (navigation) {
    case APP.NavigationManager.PAGINATION:
      this.navigator = new APP.PaginationNavigation();
      break;
    case APP.NavigationManager.INFINITE:
    default:
      this.navigator = new APP.InfiniteNavigation();
      break;
  }
};
APP.NavigationManager.INFINITE = 'infinite';
APP.NavigationManager.PAGINATION = 'pagination';

APP.NavigationManager.prototype = Object.create(Object.prototype);

APP.NavigationManager.constructor = APP.NavigationManager;
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.RestClientManager = function() {
  APP.RestClientManager.instance = this;
};

APP.RestClientManager.prototype = Object.create(Object.prototype);

APP.RestClientManager.constructor = APP.RestClientManager;

APP.RestClientManager.prototype.execute = function(config) {
  config.method = config.method || 'post';
  return $.ajax(config);
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.TemplateManager = function() {
  APP.TemplateManager.instance = this;
  this.templates = {};
};

APP.TemplateManager.prototype = Object.create(Object.prototype);

APP.TemplateManager.constructor = APP.TemplateManager;

APP.TemplateManager.prototype.loadTemplates = function(ids) {
  var scope = this,
    i, deferreds = [];
  for (i = 0; i < ids.length; i++)
    deferreds.push($.get(DataApp.templatesUrl + ids[i] + ".html"));

  return $.when.apply(null, deferreds).done(function() {
    if (ids.length <= 1) return scope.templates[ids[0]] = arguments[0];
    for (i = 0; i < ids.length; i++)
      scope.templates[ids[i]] = _.template(arguments[i][0]);
  });
};

APP.TemplateManager.prototype.getFromDoc = function(id) {
  if (this.templates[id])
    return this.templates[id];

  this.templates[id] = _.template($("#template-" + id).html());
  return this.templates[id];
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.BaseNavigation = function() {
  this.currentPage = 0;
  this.totalPages = null;

  this.currentPageData;
  this.listeners();

  this.needChangeUrl = false;
};

APP.BaseNavigation.constructor = APP.BaseNavigation;
APP.BaseNavigation.prototype = Object.create(EventDispatcher.prototype);

APP.BaseNavigation.prototype.start = function() {};

APP.BaseNavigation.prototype.listeners = function() {};

APP.BaseNavigation.prototype.suspend = function() {};

APP.BaseNavigation.prototype.restart = function() {};

APP.BaseNavigation.prototype.gotoPage = function(next, force) {
  var nextPage = next || this.currentPage + 1;
  if (!force) {
    if (this.currentPage === nextPage) return;
    if (this.currentPage === 0) this.currentPage = 1;
  }

  if (this.totalPages) {
    if (nextPage > this.totalPages) return;
  }

  this.dispatchEvent({
    type: Events.LOAD_START
  });

  this.newPageUrl(nextPage);

  Utils.getData({
    url: DataApp.currentUrl
  }).done(this.afterGetData.bind(this));
};

APP.BaseNavigation.prototype.afterGetData = function(response) {
  console.log(response);
  this.currentPage = response.pagination.page;
  this.totalPages = response.pagination.pages;
  this.currentPageData = response;
  this.dispatchEvent({
    type: Events.LOAD_END,
    data: response
  });
};

APP.BaseNavigation.prototype.newPageUrl = function(newPage) {
  DataApp.currentUrl = DataApp.currentUrl.replace(/\/$/g, '');
  if (DataApp.currentUrl.indexOf('/page-') === -1)
    DataApp.currentUrl += '/page-' + this.currentPage;
  DataApp.currentUrl = DataApp.currentUrl.replace('page-' + this.currentPage, 'page-' + newPage);
};

APP.BaseNavigation.prototype.reset = function() {
  this.currentPageData = null;
  this.gotoPage(1, true);
  Utils.changeUrl('', DataApp.currentUrl);
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.InfiniteNavigation = function() {
  APP.BaseNavigation.call(this);
  this.counter = 0;
};

APP.InfiniteNavigation.prototype = Object.create(APP.BaseNavigation.prototype);

APP.InfiniteNavigation.constructor = APP.InfiniteNavigation;

APP.InfiniteNavigation.prototype.listeners = function() {
  this.scrollHandler = this.scrollHandler.bind(this);
  $(window).on("scroll", this.scrollHandler);
};

APP.InfiniteNavigation.prototype.scrollHandler = function() {
  if ($(window).scrollTop() >= ($(document).height() - $(window).height() - $('.am-Footer').height())) {
    ++this.counter;
    if (this.counter === 1) {
      this.suspend();
      this.gotoPage(this.currentPage + 1);
    }
  }
}

APP.InfiniteNavigation.prototype.suspend = function() {
  $(window).off("scroll", this.scrollHandler);
}

APP.InfiniteNavigation.prototype.restart = function() {
  this.counter = 0;
  $(window).on("scroll", this.scrollHandler);
}
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.PaginationNavigation = function() {
  this.maxButtons = 6;
  APP.BaseNavigation.call(this);
};

APP.PaginationNavigation.prototype = Object.create(APP.BaseNavigation.prototype);

APP.PaginationNavigation.constructor = APP.PaginationNavigation;

APP.PaginationNavigation.prototype.start = function() {
  this.makeButtons();
};

APP.PaginationNavigation.prototype.listeners = function() {
  $(document).on('click', '.np-page-button', this.pagesHandler.bind(this));
};

APP.PaginationNavigation.prototype.pagesHandler = function(event) {
  event.preventDefault();
  var buttonPage = $(event.currentTarget).attr('id');
  this.gotoPage(buttonPage);
};

APP.PaginationNavigation.prototype.build = function() {
  this.makeButtons();
};

APP.PaginationNavigation.prototype.makeButtons = function() {
  $('.am-Pagination').empty();
  var numbers = Utils.paginationButtons(this.currentPage, this.totalPages, this.maxButtons);
  if (numbers) {
    var i = 0;
    for (i; i < numbers.length; i++) {
      var link = DataApp.currentUrl.replace('page-' + +this.currentPage, 'page-' + numbers[i]);
      var view = $('<li style="display:inline-block;margin:10px;"><a class="np-page-button" href="' + link + '">' + numbers[i] + '</a></li>');
      $('.am-Pagination').append(view);
    }
  }
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AccountConfigurationScreen = function() {
  APP.BaseScreen.call(this, 'accountConfiguration');
};

APP.AccountConfigurationScreen.constructor = APP.AccountConfigurationScreen;
APP.AccountConfigurationScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AccountConfigurationScreen.prototype.setupUI = function() {
  this.delete = $('.delete');
  this.deleteForce = $('.work-delete-force');
  this.cancel = $('.cancel-icon');
  $('.work-delete-confirm').hide();
};

APP.AccountConfigurationScreen.prototype.listeners = function() {
  this.delete.click(this.deleteStoreBtnHandler.bind(this));
  this.deleteForce.click(this.deleteForceHandler.bind(this));
  this.cancel.click(this.cancelBtnHandler.bind(this));
};

APP.AccountConfigurationScreen.prototype.cancelBtnHandler = function(e) {
  e.preventDefault();
  $('.work-delete-confirm').hide();
  this.delete.show();
};

APP.AccountConfigurationScreen.prototype.deleteForceHandler = function(e) {
  e.preventDefault();
  var url = '/user/' + user.username + '/account/deactivate';
  this.requestHandler(url, {}, this.afterUnSeller);
};

APP.AccountConfigurationScreen.prototype.deleteStoreBtnHandler = function(e) {
  e.preventDefault();
  this.delete.hide();
  $('.work-delete-confirm').show();
};
APP.AccountConfigurationScreen.prototype.afterUnSeller = function(e) {
  this.showFlash('succes', 'Se ha desactivado tu cuenta');
  var timeout = setTimeout(function() {
    clearTimeout(timeout);
    window.location.href = '/';
  }, 1000);
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AccountIndexScreen = function() {
  APP.BaseScreen.call(this, 'accountIndex');

  this.timeout = null;
  this.isUserAvailable = true;
};

APP.AccountIndexScreen.constructor = APP.AccountIndexScreen;
APP.AccountIndexScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AccountIndexScreen.prototype.setupUI = function() {
  this.uploaderImage = new APP.UploaderImage($('.uploader-profile'), this.uploaderImageComplete);
  this.uploaderImage.photo = DataApp.currentUser.photo;

  this.save = $('.save');
  this.saveLoading = $('.save-loading');
  this.isArtist = $('input[name=isArtist]');
  this.firstname = $('input[name=firstname]');
  this.lastname = $('input[name=lastname]');
  this.pseudonimo = $('input[name=pseudonimo]');
  this.username = $('input[name=username]');
  this.gender = $('select[name=gender]');
  this.birthday = $('input[name=birthday]');
  this.country = $('select[name=country]');
  this.city = $('input[name=city]');
  this.biography = $('textarea[name=biography]');
  this.completeForm = $('.complete-form');
  this.artistData = $('.artist-data');
  this.gender.find('option:contains(' + DataApp.currentUser.gender + ')').attr("selected", true);
  this.country.find('option:contains(' + DataApp.currentUser.country + ')').attr("selected", true);
  this.typeName = $('select[name=typeName]');

  var isArtist = DataApp.currentUser.isArtist ? 1 : 0;

  $('input[name=isArtist][value=' + isArtist + ']').attr('checked', true);
  for (var i = 0; i < interests.length; i++)
    $('input[type=checkbox][value=' + interests[i].id + ']').attr('checked', true);

  this.typeName.val(DataApp.currentUser.typeName);

  $("#date").mask("99/99/9999");
}


APP.AccountIndexScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);
  this.username.keyup(this.usernameKeyUpHandler.bind(this));
  this.completeForm.submit(this.completeFormHandler.bind(this));
  this.isArtist.change(this.isArtistHandler.bind(this));
};

APP.AccountIndexScreen.prototype.isArtistHandler = function(event) {
  var value = parseInt($(event.target).val(), 10);
  this.artistData[value === 0 ? 'hide' : 'show']();
};

APP.AccountIndexScreen.prototype.usernameKeyUpHandler = function(event) {
  if (!Validations.notBlank(this.username.val())) {
    clearTimeout(this.timeout);
    this.timeout = setTimeout(this.timeoutHandler.bind(this), 100);
  }
};

APP.AccountIndexScreen.prototype.timeoutHandler = function() {
  var payload = {
    property: 'username',
    value: this.username.val()
  };
  this.requestHandler('/auth/check', payload, this.checkUsernameComplete);
};

APP.AccountIndexScreen.prototype.checkUsernameComplete = function(response) {
  this.isUserAvailable = response.data.available;
};

APP.AccountIndexScreen.prototype.completeFormHandler = function(event) {
  event.preventDefault();

  var errors = [],
    scope = this;
  if (Validations.notBlank(this.firstname.val())) errors.push('Ingrese sus nombre');
  if (Validations.notBlank(this.lastname.val())) errors.push('Ingrese sus apellidos');
  if (Validations.notBlank(this.username.val())) errors.push('Ingrese su nombre de usuario');
  if (!Validations.username(this.username.val())) errors.push('Nombre de usuario solo acepta numeros y letras');
  if (Validations.notBlank(this.gender.val())) errors.push('Ingrese su genero');
  if (Validations.notBlank(this.birthday.val())) errors.push('Ingrese su cumpleaños');
  if (Validations.notBlank(this.country.val())) errors.push('Ingrese su pais');
  if (Validations.notBlank(this.city.val())) errors.push('Ingrese su ciudad');
  // if(Validations.notBlank(this.biography.val())) errors.push('Ingrese su biografia');

  if (this.typeName.val() === '2') {
    if (Validations.notBlank(this.pseudonimo.val())) errors.push('Ingrese su pseudonimo');
  }

  var interests = [];
  $('input[name=interests]:checked').each(function() {
    interests.push(parseInt($(this).val(), 10));
  });

  if (interests.length < 2) errors.push('Seleccione al menos 2 intereses');
  if (!this.isUserAvailable) errors.push('Usuario no disponible');

  if (errors.length > 0) return this.showFlash('error', errors);

  this.saveLoading.show();
  this.save.hide();

  var data = this.completeForm.serializeArray();
  $.each(data, function(index, value) {
    if (value.name === 'photo') {
      var filter = 'w_150,h_150,c_thumb,d_am_avatar.jpg';
      value.value = Utils.addImageFilter(scope.uploaderImage.photo, filter);
    }
    if (value.name === 'typeName') {
      value.value = parseInt(value.value, 10);
    }
  });
  var url = '/user/' + profile.username + '/account/update';
  this.requestHandler(url, data, this.afterSaveHandler);
}

APP.AccountIndexScreen.prototype.afterSaveHandler = function(response) {
  this.showFlash('succes', 'Se actualizo su perfil');
  this.saveLoading.hide();
  this.save.show();
  var user = response.data.user;
  var timeout = setTimeout(function() {
    clearTimeout(timeout);
    window.location.href = '/user/' + user.username;
  }, 1000);
}

APP.AccountIndexScreen.prototype.uploaderImageComplete = function(idImage) {
  this.$view.find('.upload').show();
  $('.cloudinary-fileupload').show();
  var filters = {
    width: 150,
    height: 150,
    crop: 'thumb'
  };
  $.cloudinary.image(idImage, filters).appendTo(this.$view.find('.preview'));
}
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AccountPasswordScreen = function() {
  APP.BaseScreen.call(this, 'accountPassword');

  this.timeout = null;
  this.isUserAvailable = true;
};

APP.AccountPasswordScreen.constructor = APP.AccountPasswordScreen;
APP.AccountPasswordScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AccountPasswordScreen.prototype.setupUI = function() {
  this.uploaderImage = new APP.UploaderImage($('.uploader-profile'), this.uploaderImageComplete);
  this.uploaderImage.photo = DataApp.currentUser.photo;

  this.save = $('.save');
  this.saveLoading = $('.save-loading');
  this.password = $('.password');
  this.rePassword = $('.rePassword');
  this.form = $('.password-form');

  this.form.submit(this.formHandler.bind(this));
};

APP.AccountPasswordScreen.prototype.formHandler = function(event) {
  event.preventDefault();
  if (this.password.val() !== this.rePassword.val())
    return this.showFlash('error', 'Las contraseñas no coinciden');

  var url = '/user/' + profile.username + '/account/password';
  this.requestHandler(url, this.form.serialize(), this.changePasswordHandler);
};

APP.AccountPasswordScreen.prototype.changePasswordHandler = function(response) {
  this.showFlash('succes', 'Contraseña cambiada');
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AccountSellerScreen = function() {
  APP.BaseScreen.call(this, 'accountSeller');
};

APP.AccountSellerScreen.constructor = APP.AccountSellerScreen;
APP.AccountSellerScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AccountSellerScreen.prototype.setupUI = function() {
  this.saveBtn = $('.save-btn');

  this.country = $('select[name=country]');
  this.city = $('input[name=city]');
  this.province = $('input[name=province]');
  this.zipcode = $('input[name=zipcode]');
  this.direction = $('input[name=direction]');
  this.phone = $('input[name=phone]');
  this.paypal = $('input[name=paypal]');

  this.document = $('select[name=document]');
  this.documentValue = $('input[name=documentValue]');
  this.businessName = $('input[name=businessName]');
  this.bank = $('input[name=bank]');
  this.cci = $('input[name=cci]');

  this.form = $('.complete-form');

  this.country.find('option:contains(' + user.country + ')').attr('selected', true);
  this.city.val(user.city);
  this.document.find('option:contains(' + user.document + ')').attr('selected', true);

  this.terms = $('input[name=terms]');

  this.direction.geocomplete();

  this.deleteStoreBtn = $('.delete-store');

  this.createStoreBtn = $('.create-store-btn');
};

APP.AccountSellerScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  this.form.submit(this.submitHandler.bind(this));
  this.deleteStoreBtn.click(this.deleteStoreBtnHandler.bind(this));
  this.createStoreBtn.click(this.createStoreBtnHandler.bind(this));
  this.country.change(this.countryChangeHandler.bind(this));
};

APP.AccountSellerScreen.prototype.countryChangeHandler = function(e) {
  this.country.val() === 'Peru' ? $('.country-container').show() : $('.country-container').hide();
};

APP.AccountSellerScreen.prototype.createStoreBtnHandler = function(e) {
  e.preventDefault();

  $('#seller-invitation').hide();
  $('#seller-validation').show();
};

APP.AccountSellerScreen.prototype.deleteStoreBtnHandler = function(e) {
  var url = '/user/' + user.username + '/account/unseller';
  this.requestHandler(url, {}, this.afterUnSeller);
};

APP.AccountSellerScreen.prototype.afterUnSeller = function(e) {
  this.showFlash('succes', 'Se ha desactivado tu tienda');
  var timeout = setTimeout(function() {
    clearTimeout(timeout);
    window.location.href = '/user/' + user.username;
  }, 1000);
};

APP.AccountSellerScreen.prototype.submitHandler = function(e) {
  e.preventDefault();
  var errors = [],
    scope = this;

  if (Validations.notBlank(this.country.val())) errors.push('Seleccione su pais');
  if (Validations.notBlank(this.city.val())) errors.push('Seleccione su ciudad');

  if (Validations.notBlank(this.province.val())) errors.push('Ingrese una provincia');
  if (Validations.notBlank(this.zipcode.val())) errors.push('Ingrese el código postal');

  if (Validations.notBlank(this.direction.val())) errors.push('Ingrese su dirección');
  if (Validations.notBlank(this.phone.val())) errors.push('Ingrese su teléfono');

  if (this.country.val() === 'Peru') {
    if (Validations.notBlank(this.document.val())) errors.push('Seleccione un documento');
    if (Validations.notBlank(this.documentValue.val())) errors.push('Ingrese el nro del documento');
    if (Validations.notBlank(this.businessName.val())) errors.push('Ingrese el nombre de la razón social');
    if (Validations.notBlank(this.bank.val())) errors.push('Ingrese el nombre de tú banco');
    if (Validations.notBlank(this.cci.val())) errors.push('Ingrese tu número de cuenta');
  }

  if (!user.isSeller)
    if (!this.terms.prop('checked')) errors.push('Acepta los términos y condiciones');

  if (errors.length > 0) return this.showFlash('error', errors);

  var data = this.form.serializeArray();
  var url = '/user/' + user.username + '/account/seller';
  this.requestHandler(url, data, this.afterSaveHandler);
};

APP.AccountSellerScreen.prototype.afterSaveHandler = function(response) {
  this.showFlash('succes', 'Se actualizo tu información');

  var timeout = setTimeout(function() {
    clearTimeout(timeout);
    if (!user.isSeller) {
      $('#go-share-modal').click();
    }
  }, 300);
}

/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AddWorkScreen = function() {
  APP.BaseScreen.call(this, 'addWork');
  this.work = null;
};

APP.AddWorkScreen.constructor = APP.AddWorkScreen;
APP.AddWorkScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AddWorkScreen.prototype.setupUI = function() {
  this.workForm = $('.work-form');
  this.uploader = $('.uploader-work');
  this.name = $('input[name=name]');
  this.category = $('select[name=category]');
  this.description = $('textarea[name=description]');
  this.tags = $('input[name=tags]');
  this.tags.tagsInput({
    height: '50px',
    width: '100%',
    defaultText: '+Etiqueta'
  });

  this.send = $('.send');
  this.sendLoading = $('.send-loading');

  this.workDelete = $('.work-delete');
  this.workDeleteConfirm = $('.work-delete-confirm');
  this.workDeleteCancel = $('.work-delete-cancel');
  this.workDeleteForce = $('.work-delete-force');

  this.workPhotoPublished = $('.work-photo-published');
  this.workNamePublished = $('.work-name-published');
  this.workUserPublished = $('.work-user-published');
  this.workPublished = $('.work-published');
  this.workView = $('.work-view');
  this.workNew = $('.work-new');
  this.workEdit = $('.work-edit');

  this.uploaderImage = new APP.UploaderImage(this.uploader, this.imgComplete);
};

APP.AddWorkScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);
  this.workForm.submit(this.workFormSubmitHandler.bind(this));

  this.workDelete.click(this.deleteHandler.bind(this));
  this.workDeleteForce.click(this.workDeleteForceHandler.bind(this));
  this.workDeleteCancel.click(this.deleteCancel.bind(this));
  $('input[type=checkbox]').change(this.publicHandler);
};

APP.AddWorkScreen.prototype.publicHandler = function() {
  $(this).parent().find('.value').text((this.checked ? 'On' : 'Off'));
}

APP.AddWorkScreen.prototype.workFormSubmitHandler = function(event) {
  event.preventDefault();
  var errors = [],
    scope = this;
  if (!this.uploaderImage.photo) errors.push('Ingrese una foto');
  if (Validations.notBlank(this.name.val())) errors.push('Ingrese un nombre');
  if (Validations.notBlank(this.category.val())) errors.push('Ingrese una categoria');
  if (Validations.notBlank(this.description.val())) errors.push('Ingrese una descripcion');
  if (this.tags.val().split(',')[0].length < 1) errors.push('Ingrese etiquetas');

  if (errors.length > 0) return this.showFlash('error', errors);

  this.sendLoading.show();
  this.send.hide();

  var data = this.workForm.serializeArray();
  $.each(data, function(index, value) {
    if (value.name === 'photo')
      value.value = scope.uploaderImage.photo;

    if (value.name === 'nsfw' || value.name === 'public')
      value.value = (value.value === 'on');
  });

  var url = DataApp.currentUser.url + '/work/create';
  this.requestHandler(url, data, this.workCreatedComplete);
};

APP.AddWorkScreen.prototype.workCreatedComplete = function(response) {
  this.showFlash('succes', 'Su obra se subió exitosamente')
  this.work = response.data.work;

  this.workForm.hide();

  this.sendLoading.hide();
  this.send.show();

  var url = DataApp.currentUser.url + '/work/' + this.work.nameSlugify
  var photo = Utils.addImageFilter(this.work.photo, 'w_300,c_limit');

  this.workView.attr('href', url);
  this.workNew.attr('href', DataApp.currentUser.url + '/work/add');
  this.workEdit.attr('href', url + '/edit');
  this.workPhotoPublished.attr('src', photo);
  this.workNamePublished.text(this.work.name);
  this.workUserPublished.text(DataApp.currentUser.fullname);
  this.workPublished.show();
};

APP.AddWorkScreen.prototype.deleteHandler = function(event) {
  this.workDelete.hide();
  this.workDeleteConfirm.show();
};

APP.AddWorkScreen.prototype.workDeleteForceHandler = function() {
  var url = DataApp.currentUser.url + '/work/delete';
  this.requestHandler(url, {
    idWork: this.work.id
  }, this.forceComplete);
};

APP.AddWorkScreen.prototype.forceComplete = function() {
  this.showFlash('succes', 'Se elimino tu obra');
  setTimeout(function() {
    window.location.href = DataApp.currentUser.url;
  }, 1000);
};

APP.AddWorkScreen.prototype.deleteCancel = function(response) {
  this.workDelete.show();
  this.workDeleteConfirm.hide();
};

APP.AddWorkScreen.prototype.imgComplete = function(idImage) {
  this.$view.find('.upload').show();
  $('.cloudinary-fileupload').show();
  var filters = {
    width: 300,
    crop: 'limit'
  };
  $.cloudinary.image(idImage, filters).appendTo(this.$view.find('.preview'));
};

/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AdminBlogScreen = function() {
  APP.BaseScreen.call(this, 'adminBlog');
};

APP.AdminBlogScreen.constructor = APP.AdminBlogScreen;
APP.AdminBlogScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AdminBlogScreen.prototype.setupUI = function() {
  this.searchBtn = $('.search-btn');
  this.start = $('.start');
  this.end = $('.end');

  this.startValue = null;
  this.endValue = null;

  this.term = null;

  if (Utils.getUrlParameter('start')) {
    var startParam = Utils.getUrlParameter('start');
    this.startValue = new Date(startParam);
    this.start.find('input').val(startParam.replace(/-/gi, '/'));
  }

  if (Utils.getUrlParameter('end')) {
    var endParam = Utils.getUrlParameter('end');
    this.endValue = new Date(endParam);
    this.end.find('input').val(endParam.replace(/-/gi, '/'));
  }

  this.viewer = new APP.Viewer('tableWork', $('.container-items'), 'infinite', data, {
    getTotal: function(total) {
      $('.total').text('(' + total + ')');
    }
  });

  this.searchBox = $('.search-box');
};

APP.AdminBlogScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  this.start.datepicker().on('changeDate', this.startDateChange.bind(this));
  this.end.datepicker().on('changeDate', this.endDateChange.bind(this));
  this.searchBtn.click(this.searchHander.bind(this));

  $(".dropdown-menu li a").click(this.dropdownChange.bind(this));

  if (Utils.getUrlParameter('term')) {
    this.term = Utils.getUrlParameter('term');
    $('.' + this.term).click();
  }

  if (Utils.getUrlParameter('termValue')) {
    this.searchBox.val(decodeURI(Utils.getUrlParameter('termValue')));
  }
};

APP.AdminBlogScreen.prototype.startDateChange = function(event) {
  this.startValue = event.date;
};

APP.AdminBlogScreen.prototype.endDateChange = function(event) {
  this.endValue = event.date;
};

APP.AdminBlogScreen.prototype.dropdownChange = function(event) {
  var text = $(event.target).text();

  $(".btn-drop .property").text(text);
  $(".btn-drop .property").val(text);

  switch (text) {
    case 'publicado':
      this.term = 'published';
      break;
  }
};
APP.AdminBlogScreen.prototype.searchHander = function() {
  var termValue = this.searchBox.val().trim();

  if (this.term && this.term.trim().length > 0) {

    if (this.term === 'featured') {
      if (termValue.length > 0 && isNaN(parseInt(termValue, 10)))
        return this.showFlash('error', ['El valor necesita ser 1 o 0']);
    }

    if (termValue.length > 0) {
      DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'term', this.term);
      DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'termValue', termValue);
    } else {
      DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'term');
      DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'termValue');
    }
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'term');
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'termValue');

    if (termValue.length > 0) {
      return this.showFlash('error', ['Necesitas seleccionar una propiedad']);
    }
  }

  if (this.startValue) {
    if (!this.endValue)
      return this.showFlash('error', ['Ingresa una fecha de fin']);

    var startStr = (this.startValue.getMonth() + 1) + "-" +
      this.startValue.getDate() + "-" +
      this.startValue.getFullYear();

    DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'start', startStr);
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'start');
  }

  if (this.endValue) {
    if (!this.startValue)
      return this.showFlash('error', ['Ingresa una fecha de inicio']);

    var endStr = (this.endValue.getMonth() + 1) + "-" +
      this.endValue.getDate() + "-" +
      this.endValue.getFullYear();

    DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'end', endStr);
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'end');
  }

  if (DataApp.currentUrl === window.location.href) return;

  Utils.changeUrl(this.id, DataApp.currentUrl);
  this.viewer.reset();
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AdminEditBannerScreen = function() {
  APP.BaseScreen.call(this, 'adminEditBanner');
};

APP.AdminEditBannerScreen.constructor = APP.AdminEditBannerScreen;
APP.AdminEditBannerScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AdminEditBannerScreen.prototype.setupUI = function() {
  this.uploader = $('.uploader-image');
  this.uploaderImage = new APP.UploaderImage(this.uploader, this.imgComplete);
  this.sendBtn = $('.send-btn');

  this.uploaderImage.photo = banner.image;
};

APP.AdminEditBannerScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);
  this.sendBtn.click(this.sendHandler.bind(this));
};

APP.AdminEditBannerScreen.prototype.sendHandler = function(event) {
  event.preventDefault();
  var errors = [];
  if (Validations.notBlank($('input[name=link]').val())) errors.push('Ingrese un link');
  if (!this.uploaderImage.photo) errors.push('Ingrese una foto');
  if (errors.length > 0) return this.showFlash('error', errors);

  var scope = this;
  var data = $('form').serializeArray();
  $.each(data, function(index, value) {
    if (value.name === 'image')
      value.value = scope.uploaderImage.photo;
  });

  var url = '/report/banners/update';
  this.requestHandler(url, data, this.updateComplete);
};

APP.AdminEditBannerScreen.prototype.updateComplete = function(response) {
  this.showFlash('succes', 'Se edito el banner');

  setTimeout(function() {
    window.location.href = '/report/banners/';
  }, 1000);
};


APP.AdminEditBannerScreen.prototype.imgComplete = function(idImage) {
  this.$view.find('.upload').show();
  $('.cloudinary-fileupload').show();
  var filters = {
    width: 300,
    crop: 'limit'
  };
  $.cloudinary.image(idImage, filters).appendTo(this.$view.find('.preview'));
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AdminEditUserScreen = function() {
  APP.BaseScreen.call(this, 'adminEditUser');
};

APP.AdminEditUserScreen.constructor = APP.AdminEditUserScreen;
APP.AdminEditUserScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AdminEditUserScreen.prototype.setupUI = function() {
  this.amBtn = $('.am-btn');
  this.deleteBtn = $('.delete-btn');
  this.updateBtn = $('.update-btn');
};

APP.AdminEditUserScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  this.amBtn.click(this.amHandler.bind(this));
  this.deleteBtn.click(this.deleteHandler.bind(this));
  this.updateBtn.click(this.updateHandler.bind(this));
};

APP.AdminEditUserScreen.prototype.amHandler = function(event) {
  event.preventDefault();
  var url = '/user/' + userToEdit.username + '/' + (userToEdit.featured ? 'unfeatured' : 'featured');
  this.requestHandler(url, {
    idUser: userToEdit.id
  }, this.featuredComplete);
};

APP.AdminEditUserScreen.prototype.featuredComplete = function(response) {
  userToEdit = response.data.user;
  if (userToEdit.featured)
    this.amBtn.addClass('btn-primary').val('Recomendado');
  else
    this.amBtn.removeClass('btn-primary').val('Recomendar');

  this.showFlash('succes', 'Se actualizo el usuario');
};

APP.AdminEditUserScreen.prototype.deleteHandler = function(event) {
  event.preventDefault();
  var result = confirm("Quiero eliminar este usuario?");
  if (result) {
    var url = '/user/' + userToEdit.username + '/delete';
    this.requestHandler(url, {
      idUser: userToEdit.id
    }, this.deleteComplete);
  }
};

APP.AdminEditUserScreen.prototype.deleteComplete = function() {
  this.showFlash('succes', 'Se elimino el usuario');
  setTimeout(function() {
    window.location.href = '/report';
  }, 1000);
};

APP.AdminEditUserScreen.prototype.updateHandler = function(event) {
  event.preventDefault();
  var url = '/user/' + userToEdit.username + '/account/update';
  this.requestHandler(url, $('form').serialize(), this.updateComplete);
};

APP.AdminEditUserScreen.prototype.updateComplete = function(response) {
  this.showFlash('succes', 'Se actualizo el usuario');
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AdminGeneralScreen = function() {
  APP.BaseScreen.call(this, 'adminGeneral');
};

APP.AdminGeneralScreen.constructor = APP.AdminGeneralScreen;
APP.AdminGeneralScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AdminGeneralScreen.prototype.setupUI = function() {
  this.searchBtn = $('.search-btn');
  this.start = $('.start');
  this.end = $('.end');

  this.startValue = null;
  this.endValue = null;

  if (Utils.getUrlParameter('start')) {
    var startParam = Utils.getUrlParameter('start');
    this.startValue = new Date(startParam);
    this.start.find('input').val(startParam.replace(/-/gi, '/'));
  }

  if (Utils.getUrlParameter('end')) {
    var endParam = Utils.getUrlParameter('end');
    this.endValue = new Date(endParam);
    this.end.find('input').val(endParam.replace(/-/gi, '/'));
  }
};

APP.AdminGeneralScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  this.start.datepicker().on('changeDate', this.startDateChange.bind(this));
  this.end.datepicker().on('changeDate', this.endDateChange.bind(this));
  this.searchBtn.click(this.searchHander.bind(this));
};

APP.AdminGeneralScreen.prototype.startDateChange = function(event) {
  this.startValue = event.date;
};

APP.AdminGeneralScreen.prototype.endDateChange = function(event) {
  this.endValue = event.date;
};

APP.AdminGeneralScreen.prototype.searchHander = function() {
  if (this.startValue) {
    if (!this.endValue)
      return this.showFlash('error', ['Ingresa una fecha de fin']);

    var startStr = (this.startValue.getMonth() + 1) + "-" +
      this.startValue.getDate() + "-" +
      this.startValue.getFullYear();

    DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'start', startStr);
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'start');
  }

  if (this.endValue) {
    if (!this.startValue)
      return this.showFlash('error', ['Ingresa una fecha de inicio']);

    var endStr = (this.endValue.getMonth() + 1) + "-" +
      this.endValue.getDate() + "-" +
      this.endValue.getFullYear();

    DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'end', endStr);
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'end');
  }

  if (DataApp.currentUrl !== window.location.href)
    window.location.href = DataApp.currentUrl;
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AdminProductRevisionScreen = function() {
  APP.BaseScreen.call(this, 'adminEditBanner');
};

APP.AdminProductRevisionScreen.constructor = APP.AdminProductRevisionScreen;
APP.AdminProductRevisionScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AdminProductRevisionScreen.prototype.setupUI = function() {
  this.deniedBtn = $('.btn-denied');
  this.acceptedBtn = $('.btn-accepted');

  this.reason = $('select[name=reason]');
  this.message = $('textarea[name=message]');

  this.deniedForm = $('.denied-form');
};

APP.AdminProductRevisionScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  this.deniedBtn.click(this.deniedHandler.bind(this));
  this.acceptedBtn.click(this.acceptedHandler.bind(this));
  this.deniedForm.submit(this.deniedFormSubmit.bind(this));
};

APP.AdminProductRevisionScreen.prototype.deniedFormSubmit = function(e) {
  e.preventDefault();

  var errors = [],
    scope = this;
  if (Validations.notBlank(this.reason.val())) errors.push('Ingrese un motivo');
  if (Validations.notBlank(this.message.val())) errors.push('Ingrese un mensaje');
  if (errors.length > 0) return this.showFlash('error', errors);

  var data = {
    idProduct: product.id,
    published: false,
    reason: this.reason.val(),
    message: this.message.val()
  };
  var url = '/report/products/update';
  this.requestHandler(url, data, this.productUpdateComplete);
};

APP.AdminProductRevisionScreen.prototype.productUpdateComplete = function(response) {
  this.showFlash('succes', 'Se respondio la solicitud del producto');
  setTimeout(function() {
    window.location.href = '/report/products_applying/page-1';
  }, 1000);
};

APP.AdminProductRevisionScreen.prototype.deniedHandler = function(e) {
  e.preventDefault();
  $('.form-container').removeClass('hide');
};

APP.AdminProductRevisionScreen.prototype.acceptedHandler = function(e) {
  e.preventDefault();
  var data = {
    idProduct: product.id,
    published: true
  };
  var url = '/report/products/update';
  this.requestHandler(url, data, this.productUpdateComplete);
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AdminProductsApplyingScreen = function() {
  APP.BaseScreen.call(this, 'adminProductsApplying');
};

APP.AdminProductsApplyingScreen.constructor = APP.AdminProductsApplyingScreen;
APP.AdminProductsApplyingScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AdminProductsApplyingScreen.prototype.setupUI = function() {
  this.searchBtn = $('.search-btn');
  this.start = $('.start');
  this.end = $('.end');

  this.startValue = null;
  this.endValue = null;

  if (Utils.getUrlParameter('start')) {
    var startParam = Utils.getUrlParameter('start');
    this.startValue = new Date(startParam);
    this.start.find('input').val(startParam.replace(/-/gi, '/'));
  }

  if (Utils.getUrlParameter('end')) {
    var endParam = Utils.getUrlParameter('end');
    this.endValue = new Date(endParam);
    this.end.find('input').val(endParam.replace(/-/gi, '/'));
  }

  this.viewer = new APP.Viewer('tableProductApplying', $('.container-items'), 'infinite', data, {
    getTotal: function(total) {
      $('.total').text('(' + total + ')');
    }
  });

  this.searchBox = $('.search-box');
};

APP.AdminProductsApplyingScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  this.start.datepicker().on('changeDate', this.startDateChange.bind(this));
  this.end.datepicker().on('changeDate', this.endDateChange.bind(this));
  this.searchBtn.click(this.searchHander.bind(this));
};

APP.AdminProductsApplyingScreen.prototype.startDateChange = function(event) {
  this.startValue = event.date;
};

APP.AdminProductsApplyingScreen.prototype.endDateChange = function(event) {
  this.endValue = event.date;
};

APP.AdminProductsApplyingScreen.prototype.searchHander = function() {
  if (this.startValue) {
    if (!this.endValue)
      return this.showFlash('error', ['Ingresa una fecha de fin']);

    var startStr = (this.startValue.getMonth() + 1) + "-" +
      this.startValue.getDate() + "-" +
      this.startValue.getFullYear();

    DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'start', startStr);
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'start');
  }

  if (this.endValue) {
    if (!this.startValue)
      return this.showFlash('error', ['Ingresa una fecha de inicio']);

    var endStr = (this.endValue.getMonth() + 1) + "-" +
      this.endValue.getDate() + "-" +
      this.endValue.getFullYear();

    DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'end', endStr);
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'end');
  }

  if (DataApp.currentUrl === window.location.href) return;

  Utils.changeUrl(this.id, DataApp.currentUrl);
  this.viewer.reset();
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AdminProductsScreen = function() {
  APP.BaseScreen.call(this, 'adminProducts');
};

APP.AdminProductsScreen.constructor = APP.AdminProductsScreen;
APP.AdminProductsScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AdminProductsScreen.prototype.setupUI = function() {
  this.searchBtn = $('.search-btn');
  this.start = $('.start');
  this.end = $('.end');

  this.startValue = null;
  this.endValue = null;

  this.term = null;

  if (Utils.getUrlParameter('start')) {
    var startParam = Utils.getUrlParameter('start');
    this.startValue = new Date(startParam);
    this.start.find('input').val(startParam.replace(/-/gi, '/'));
  }

  if (Utils.getUrlParameter('end')) {
    var endParam = Utils.getUrlParameter('end');
    this.endValue = new Date(endParam);
    this.end.find('input').val(endParam.replace(/-/gi, '/'));
  }

  this.viewer = new APP.Viewer('tableProduct', $('.container-items'), 'infinite', data, {
    getTotal: function(total) {
      $('.total').text('(' + total + ')');
    }
  });

  this.searchBox = $('.search-box');
};

APP.AdminProductsScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  this.start.datepicker().on('changeDate', this.startDateChange.bind(this));
  this.end.datepicker().on('changeDate', this.endDateChange.bind(this));
  this.searchBtn.click(this.searchHander.bind(this));

  $(".dropdown-menu li a").click(this.dropdownChange.bind(this));

  if (Utils.getUrlParameter('term')) {
    this.term = Utils.getUrlParameter('term');
    $('.' + this.term).click();
  }

  if (Utils.getUrlParameter('termValue')) {
    this.searchBox.val(decodeURI(Utils.getUrlParameter('termValue')));
  }
};

APP.AdminProductsScreen.prototype.startDateChange = function(event) {
  this.startValue = event.date;
};

APP.AdminProductsScreen.prototype.endDateChange = function(event) {
  this.endValue = event.date;
};

APP.AdminProductsScreen.prototype.dropdownChange = function(event) {
  var text = $(event.target).text();

  $(".btn-drop .property").text(text);
  $(".btn-drop .property").val(text);

  switch (text) {
    case 'nombre':
      this.term = 'name';
      break;
    case 'recomendado':
      this.term = 'featured';
      break;
  }
};
APP.AdminProductsScreen.prototype.searchHander = function() {
  var termValue = this.searchBox.val().trim();

  if (this.term && this.term.trim().length > 0) {

    if (this.term === 'featured') {
      if (termValue.length > 0 && isNaN(parseInt(termValue, 10)))
        return this.showFlash('error', ['El valor necesita ser 1 o 0']);
    }

    if (termValue.length > 0) {
      DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'term', this.term);
      DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'termValue', termValue);
    } else {
      DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'term');
      DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'termValue');
    }
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'term');
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'termValue');

    if (termValue.length > 0) {
      return this.showFlash('error', ['Necesitas seleccionar una propiedad']);
    }
  }

  if (this.startValue) {
    if (!this.endValue)
      return this.showFlash('error', ['Ingresa una fecha de fin']);

    var startStr = (this.startValue.getMonth() + 1) + "-" +
      this.startValue.getDate() + "-" +
      this.startValue.getFullYear();

    DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'start', startStr);
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'start');
  }

  if (this.endValue) {
    if (!this.startValue)
      return this.showFlash('error', ['Ingresa una fecha de inicio']);

    var endStr = (this.endValue.getMonth() + 1) + "-" +
      this.endValue.getDate() + "-" +
      this.endValue.getFullYear();

    DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'end', endStr);
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'end');
  }

  if (DataApp.currentUrl === window.location.href) return;

  Utils.changeUrl(this.id, DataApp.currentUrl);
  this.viewer.reset();
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AdminUsersScreen = function() {
  APP.BaseScreen.call(this, 'adminUsers');
};

APP.AdminUsersScreen.constructor = APP.AdminUsersScreen;
APP.AdminUsersScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AdminUsersScreen.prototype.setupUI = function() {
  this.searchBtn = $('.search-btn');
  this.start = $('.start');
  this.end = $('.end');

  this.startValue = null;
  this.endValue = null;

  this.term = null;

  if (Utils.getUrlParameter('start')) {
    var startParam = Utils.getUrlParameter('start');
    this.startValue = new Date(startParam);
    this.start.find('input').val(startParam.replace(/-/gi, '/'));
  }

  if (Utils.getUrlParameter('end')) {
    var endParam = Utils.getUrlParameter('end');
    this.endValue = new Date(endParam);
    this.end.find('input').val(endParam.replace(/-/gi, '/'));
  }

  this.viewer = new APP.Viewer('tableUser', $('.container-items'), 'infinite', data, {
    getTotal: function(total) {
      $('.total').text('(' + total + ')');
    }
  });

  this.searchBox = $('.search-box');
};

APP.AdminUsersScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  this.start.datepicker().on('changeDate', this.startDateChange.bind(this));
  this.end.datepicker().on('changeDate', this.endDateChange.bind(this));
  this.searchBtn.click(this.searchHander.bind(this));

  $(".dropdown-menu li a").click(this.dropdownChange.bind(this));

  if (Utils.getUrlParameter('term')) {
    this.term = Utils.getUrlParameter('term');
    $('.' + this.term).click();
  }

  if (Utils.getUrlParameter('termValue')) {
    this.searchBox.val(decodeURI(Utils.getUrlParameter('termValue')));
  }
};

APP.AdminUsersScreen.prototype.startDateChange = function(event) {
  this.startValue = event.date;
};

APP.AdminUsersScreen.prototype.endDateChange = function(event) {
  this.endValue = event.date;
};

APP.AdminUsersScreen.prototype.dropdownChange = function(event) {
  var text = $(event.target).text();

  $(".btn-drop .property").text(text);
  $(".btn-drop .property").val(text);

  switch (text) {
    case 'username':
      this.term = 'username';
      break;
    case 'email':
      this.term = 'email';
      break;
    case 'ciudad':
      this.term = 'city';
      break;
    case 'pais':
      this.term = 'country';
      break;
    case 'artista':
      this.term = 'isArtist';
      break;
    case 'verificado':
      this.term = 'verified';
      break;
    case 'completo':
      this.term = 'filled';
      break;
    case 'recomendado':
      this.term = 'featured';
      break;
  }
};
APP.AdminUsersScreen.prototype.searchHander = function() {
  var termValue = this.searchBox.val().trim();

  if (this.term && this.term.trim().length > 0) {

    if (this.term === 'isArtist' || this.term === 'verified' || this.term === 'filled') {
      if (isNaN(parseInt(termValue, 10)))
        return this.showFlash('error', ['El valor necesita ser 1 o 0']);
    }

    if (termValue.length > 0) {
      DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'term', this.term);
      DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'termValue', termValue);
    } else {
      DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'term');
      DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'termValue');
    }
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'term');
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'termValue');

    if (termValue.length > 0) {
      return this.showFlash('error', ['Necesitas seleccionar una propiedad']);
    }
  }

  if (this.startValue) {
    if (!this.endValue)
      return this.showFlash('error', ['Ingresa una fecha de fin']);

    var startStr = (this.startValue.getMonth() + 1) + "-" +
      this.startValue.getDate() + "-" +
      this.startValue.getFullYear();

    DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'start', startStr);
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'start');
  }

  if (this.endValue) {
    if (!this.startValue)
      return this.showFlash('error', ['Ingresa una fecha de inicio']);

    var endStr = (this.endValue.getMonth() + 1) + "-" +
      this.endValue.getDate() + "-" +
      this.endValue.getFullYear();

    DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'end', endStr);
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'end');
  }

  if (DataApp.currentUrl === window.location.href) return;

  Utils.changeUrl(this.id, DataApp.currentUrl);
  this.viewer.reset();
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AdminWorksScreen = function() {
  APP.BaseScreen.call(this, 'adminWorks');
};

APP.AdminWorksScreen.constructor = APP.AdminWorksScreen;
APP.AdminWorksScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AdminWorksScreen.prototype.setupUI = function() {
  this.searchBtn = $('.search-btn');
  this.start = $('.start');
  this.end = $('.end');

  this.startValue = null;
  this.endValue = null;

  this.term = null;

  if (Utils.getUrlParameter('start')) {
    var startParam = Utils.getUrlParameter('start');
    this.startValue = new Date(startParam);
    this.start.find('input').val(startParam.replace(/-/gi, '/'));
  }

  if (Utils.getUrlParameter('end')) {
    var endParam = Utils.getUrlParameter('end');
    this.endValue = new Date(endParam);
    this.end.find('input').val(endParam.replace(/-/gi, '/'));
  }

  this.viewer = new APP.Viewer('tableWork', $('.container-items'), 'infinite', data, {
    getTotal: function(total) {
      $('.total').text('(' + total + ')');
    }
  });

  this.searchBox = $('.search-box');
};

APP.AdminWorksScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  this.start.datepicker().on('changeDate', this.startDateChange.bind(this));
  this.end.datepicker().on('changeDate', this.endDateChange.bind(this));
  this.searchBtn.click(this.searchHander.bind(this));

  $(".dropdown-menu li a").click(this.dropdownChange.bind(this));

  if (Utils.getUrlParameter('term')) {
    this.term = Utils.getUrlParameter('term');
    $('.' + this.term).click();
  }

  if (Utils.getUrlParameter('termValue')) {
    this.searchBox.val(decodeURI(Utils.getUrlParameter('termValue')));
  }
};

APP.AdminWorksScreen.prototype.startDateChange = function(event) {
  this.startValue = event.date;
};

APP.AdminWorksScreen.prototype.endDateChange = function(event) {
  this.endValue = event.date;
};

APP.AdminWorksScreen.prototype.dropdownChange = function(event) {
  var text = $(event.target).text();

  $(".btn-drop .property").text(text);
  $(".btn-drop .property").val(text);

  switch (text) {
    case 'nombre':
      this.term = 'name';
      break;
    case 'recomendado':
      this.term = 'featured';
      break;
  }
};
APP.AdminWorksScreen.prototype.searchHander = function() {
  var termValue = this.searchBox.val().trim();

  if (this.term && this.term.trim().length > 0) {

    if (this.term === 'featured') {
      if (termValue.length > 0 && isNaN(parseInt(termValue, 10)))
        return this.showFlash('error', ['El valor necesita ser 1 o 0']);
    }

    if (termValue.length > 0) {
      DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'term', this.term);
      DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'termValue', termValue);
    } else {
      DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'term');
      DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'termValue');
    }
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'term');
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'termValue');

    if (termValue.length > 0) {
      return this.showFlash('error', ['Necesitas seleccionar una propiedad']);
    }
  }

  if (this.startValue) {
    if (!this.endValue)
      return this.showFlash('error', ['Ingresa una fecha de fin']);

    var startStr = (this.startValue.getMonth() + 1) + "-" +
      this.startValue.getDate() + "-" +
      this.startValue.getFullYear();

    DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'start', startStr);
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'start');
  }

  if (this.endValue) {
    if (!this.startValue)
      return this.showFlash('error', ['Ingresa una fecha de inicio']);

    var endStr = (this.endValue.getMonth() + 1) + "-" +
      this.endValue.getDate() + "-" +
      this.endValue.getFullYear();

    DataApp.currentUrl = Utils.updateQueryStringParameter(DataApp.currentUrl, 'end', endStr);
  } else {
    DataApp.currentUrl = Utils.removeURLParameter(DataApp.currentUrl, 'end');
  }

  if (DataApp.currentUrl === window.location.href) return;

  Utils.changeUrl(this.id, DataApp.currentUrl);
  this.viewer.reset();
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.AuthScreen = function(meta) {
  this.meta = meta;

  APP.BaseScreen.call(this, 'auth');

  console.log(Cookies.get('return_to'));
};

APP.AuthScreen.constructor = APP.AuthScreen;
APP.AuthScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.AuthScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);
  $('.fb').click(this.fbHandler.bind(this));
  $('.auth-form').submit(this.formHandler.bind(this));
};

APP.AuthScreen.prototype.fbHandler = function() {
  $('.fb').hide();
  $('.fb-loading').show();
};

APP.AuthScreen.prototype.formHandler = function(event) {
  event.preventDefault();
  $('.submit').hide();
  $('.submit-loading').show();

  var url = '/auth/' + this.meta,
    payload = $('.auth-form').serialize();
  this.requestHandler(url, payload, this.requestAuthComplete, this.requestAuthError, true);
};

APP.AuthScreen.prototype.requestAuthError = function(response) {
  this.meta === 'signup' && grecaptcha.reset();
  $('.submit').show();
  $('.submit-loading').hide();
};

APP.AuthScreen.prototype.requestAuthComplete = function(response) {
  $('.submit').show();
  $('.submit-loading').hide();

  if (this.meta === 'reset') {
    this.showFlash('succes', 'Contraseña cambiada');
    var timeout = setTimeout(function() {
      clearTimeout(timeout);
      return location.href = '/auth/login';
    }, 1000);
  } else if (this.meta === 'forgot') {
    this.showFlash('succes', 'Se envio el correo');
  } else {
    return location.href = response.data.returnTo;
  }
};

/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.BlogScreen = function() {
  APP.BaseScreen.call(this, 'blog');
};

APP.BlogScreen.constructor = APP.BlogScreen;
APP.BlogScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.BlogScreen.prototype.setupUI = function() {
  this.viewer = new APP.Viewer('post', $('.articles-container'), 'infinite', posts);
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

var normal = (function() {
  var from = "ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç",
    to = "AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc",
    mapping = {};

  for (var i = 0, j = from.length; i < j; i++)
    mapping[from.charAt(i)] = to.charAt(i);

  return function(str) {
    var ret = [];
    for (var i = 0, j = str.length; i < j; i++) {
      var c = str.charAt(i);
      if (mapping.hasOwnProperty(str.charAt(i)))
        ret.push(mapping[c]);
      else
        ret.push(c);
    }
    return ret.join('');
  }
})();

APP.BuyScreen = function() {
  this.productConfig = JSON.parse(product.config);
  APP.BaseScreen.call(this, 'buy');
  this.totalShipping;
  this.currentIgv;
  this.totalPrice;
};

APP.BuyScreen.constructor = APP.BuyScreen;
APP.BuyScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.BuyScreen.prototype.setupUI = function() {
  this.payBtn = $('.btn-pay');
  this.form = $('form[name=buy-form]');
};

APP.BuyScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  $('select[name=city]').change(this.cityChangeHandler.bind(this));
  $('select[name=city]').change();
  this.form.submit(this.submitHandler.bind(this));

  $('input[name=direction]').geocomplete();
};

APP.BuyScreen.prototype.submitHandler = function(e) {
  var firstname = $('input[name=firstname]').val();
  var lastname = $('input[name=lastname]').val();
  var direction = $('input[name=direction]').val();
  var departament = $('input[name=departament]').val();
  var city = $('select[name=city]').val();
  var province = $('input[name=province]').val();
  var zipcode = $('input[name=zipcode]').val();
  var country = $('select[name=country]').val();
  var phone = $('input[name=phone]').val();
  var email = $('input[name=email]').val();

  var errors = [];

  if (Validations.notBlank(firstname)) errors.push('Ingrese un nombre');
  if (Validations.notBlank(lastname)) errors.push('Ingrese tus apellidos');
  if (Validations.notBlank(direction)) errors.push('Ingrese una dirección');

  if (Validations.notBlank(city)) errors.push('Ingrese tú ciudad');
  if (Validations.notBlank(province)) errors.push('Ingrese tú provincia');
  if (Validations.notBlank(zipcode)) errors.push('Ingrese el código postal');
  if (Validations.notBlank(phone)) errors.push('Ingrese tú telefono');
  if (Validations.notBlank(email)) errors.push('Ingrese tú correo');

  if (errors.length > 0) return this.showFlash('error', errors);

  var data = {
    firstname: firstname,
    lastname: lastname,
    direction: direction,
    departament: departament,
    city: city,
    province: province,
    zipcode: zipcode,
    country: country,
    phone: phone,
    email: email,
  }

  $('<input type="hidden" name="data" value=' + JSON.stringify(data) + '>')
    .appendTo(this.form);

  $('<input type="hidden" name="shipping" value=' + this.totalShipping + '>')
    .appendTo(this.form);

  $('<input type="hidden" name="price" value=' + this.totalPrice + '>')
    .appendTo(this.form);

    data.shipping = this.totalShipping;
    data.price = this.price;

    Cookies.set('order_data', JSON.stringify(data), {
      maxAge: 3600000,
      domain: '.' + document.domain
    });
};

APP.BuyScreen.prototype.cityChangeHandler = function() {
  var name = normal($('select[name=city]').val());
  var url = '/user/' + product.User.username + '/product/shipping';
  if (name === 'Pucallpa') name = 'PUCALLPA (CALLERIA)';
  if (name === 'Chincha') name = 'CHINCHA ALTA';

  var payload = {
    "nom_destino": name.toUpperCase(),
    "peso": this.productConfig.pkgWeight,
    "servicio": "Atencion en Oficina",
    "options2": "Kilos",
    "largo": this.productConfig.pkgLarge,
    "ancho": this.productConfig.pkgWidth,
    "alto": this.productConfig.pkgHeight,
    "cantidad": 1,
    "m_largo": "cms",
    "m_ancho": "cms",
    "m_alto": "cms"
  }
  this.requestHandler(url, {
    config: JSON.stringify(payload)
  }, this.shippingHandler);
};

APP.BuyScreen.prototype.shippingHandler = function(response) {
  var data = response.data.data;

  this.totalShipping = Number(data.monto_total) + (6 / 100 * Number(data.monto_total));
  this.totalPrice = Number(product.finalPrice) + this.totalShipping;

  $('.subtotal').text(product.finalPrice);
  $('.baseprice').text(this.totalShipping);
  $('.totallity').text(this.totalPrice);
};

/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.CollectionScreen = function() {
  APP.BaseScreen.call(this, 'collection');
};

APP.CollectionScreen.constructor = APP.CollectionScreen;
APP.CollectionScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.CollectionScreen.prototype.setupUI = function() {
  this.viewer = null;
  if (collection.meta === 'works') {
    this.viewer = new APP.Viewer('work', $('.grid'), null, items, {
      context: 'single-collection'
    });
  } else {
    this.viewer = new APP.Viewer('product', $('.grid'), null, items, {
      context: 'single-collection'
    });
  }

  this.workDelete = $('.work-delete');
  this.workDeleteConfirm = $('.work-delete-confirm');
  this.workDeleteCancel = $('.work-delete-cancel');
  this.workDeleteForce = $('.work-delete-force');
  this.collectionForm = $('.collection-form');
  this.collectionName = $('.collection-name');
  this.collectionDescription = $('.collection-description');
  this.save = $('.save');
  this.saveLoading = $('.save-loading');
  this.public = $('input[name=public]');
  $('#go-collection-modal').leanModal();
};

APP.CollectionScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  this.workDelete.click(this.workDeleteHandler.bind(this));
  this.workDeleteForce.click(this.workDeleteForceHandler.bind(this));
  this.workDeleteCancel.click(this.workDeleteCancelHandler.bind(this));
  this.save.click(this.saveHandler.bind(this));
  this.collectionForm.submit(this.collectionFormHandler.bind(this));
  this.public.change(this.publicChangeHandler);
  this.public.change();
};

APP.CollectionScreen.prototype.saveHandler = function() {
  this.collectionForm.submit();
};

APP.CollectionScreen.prototype.publicChangeHandler = function() {
  $(this).parent().find('.value').text((this.checked ? 'On' : 'Off'));
}

APP.CollectionScreen.prototype.collectionFormHandler = function(event) {
  event.preventDefault();
  this.save.hide();
  this.saveLoading.show();

  var url = DataApp.currentUser.url + '/collection/update';
  var payload = {
    name: $('input[name=name]').val(),
    description: $('textarea[name=description]').val(),
    public: $('input[name=public]:checked').val() !== undefined,
    idCollection: collection.id
  }
  this.requestHandler(url, payload, this.collectionUpdateComplete);
};

APP.CollectionScreen.prototype.collectionUpdateComplete = function(response) {
  this.save.show();
  this.saveLoading.hide();

  var newCollection = response.data.collection;
  var newUrl = '/user/' + collection.User.username + '/collection/' + newCollection.nameSlugify;
  this.collectionName.text(newCollection.name);
  this.collectionDescription.text(newCollection.description);
  $('#lean_overlay').trigger('click');
  this.showFlash('succes', 'Se actualizo tu coleccion');
  Utils.changeUrl(collection.name, newUrl);
}

APP.CollectionScreen.prototype.workDeleteCancelHandler = function() {
  this.workDelete.show();
  this.workDeleteConfirm.hide();
};

APP.CollectionScreen.prototype.workDeleteHandler = function() {
  this.workDelete.hide();
  this.workDeleteConfirm.show();
};

APP.CollectionScreen.prototype.workDeleteForceHandler = function() {
  var url = DataApp.currentUser.url + '/collection/delete';
  this.requestHandler(url, {
    idCollection: collection.id
  }, this.collectionDeleteComplete);
};

APP.CollectionScreen.prototype.collectionDeleteComplete = function() {
  $('#lean_overlay').trigger('click');
  this.showFlash('succes', 'Se elimino tu coleccion');
  setTimeout(function() {
    window.location.href = '/user/' + collection.User.username + '/collections';
  }, 1000);
}
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.ConfirmEmailScreen = function() {
  APP.BaseScreen.call(this, 'confirmEmail');
};

APP.ConfirmEmailScreen.constructor = APP.ConfirmEmailScreen;
APP.ConfirmEmailScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.ConfirmEmailScreen.prototype.setupUI = function() {
  this.messageSuccess = $('.msg-succes');
  this.resend = $('.resend-btn');
  this.resendLoading = $('.resend-loading');
};

APP.ConfirmEmailScreen.prototype.listeners = function() {
  this.resend.click(this.resendHandler.bind(this));
};

APP.ConfirmEmailScreen.prototype.resendHandler = function() {
  this.messageSuccess.hide();
  this.resendLoading.show();
  this.resend.hide();

  this.requestHandler('/auth/resend', {}, this.resendComplete);
};

APP.ConfirmEmailScreen.prototype.resendComplete = function(response) {
  this.messageSuccess.show();
  this.resendLoading.hide();
  this.resend.show();
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};
var scope;
var timeout;

APP.CreatorPostScreen = function() {
  APP.BaseScreen.call(this, 'creatorPost');
  scope = this;
};

APP.CreatorPostScreen.constructor = APP.CreatorPostScreen;
APP.CreatorPostScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.CreatorPostScreen.prototype.setupUI = function() {
  this.category = $('select[name=category]');
  this.name = $('input[name=name]');
  this.status = $('.status');
  this.delete = $('.delete-btn');
  this.deleteConfirm = $('.delete-confirm');
  this.deleteForce = $('.delete-force');
  this.cancel = $('.cancel');

  this.previewBtn = $('.preview-btn');
  this.publishBtn = $('.publish-btn');
  this.amBtn = $('.am-btn');

  this.cover = new APP.UploaderImage($('.uploader-cover'), this.coverComplete, {
    uploader: $('.editor-cover')
  });

  if (edit) {
    this.category.find('option[value=' + post.Category.id + ']').attr('selected', true);
    this.cover.photo = post.photo;
  }

  this.editable = $('.editable');

  this.editor = new MediumEditor('.editable', {
    buttonLabels: 'fontawesome',
    targetBlank: true,
    imageDragging: false,
    placeholder: {
      text: 'Ingresa el contenido del post :)',
    },
    toolbar: {
      buttons: [
        'h2', 'h3', 'bold', 'italic', 'quote', 'anchor',
        'justifyLeft', 'justifyCenter', 'justifyRight'
      ]
    }
  });

  this.editable.mediumInsert({
    editor: this.editor,
    addons: {
      embeds: {
        placeholder: 'Inserta el código de embebido de youtube y luego presiona enter'
      }
    }
  });

  this.isUploading = false;
};

APP.CreatorPostScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);
  Broadcaster.addEventListener('imageStarted', this.imageStarted.bind(this));
  Broadcaster.addEventListener('imageProgressComplete', this.progressComplete.bind(this));
  Broadcaster.addEventListener('imageLoaded', this.imageLoaded.bind(this));

  var throttledAutoSave = MediumEditor.util.throttle(this.autoSave.bind(this), 2000);
  this.editor.subscribe('editableInput', throttledAutoSave);

  window.onbeforeunload = this.beforeUnLoad.bind(this);

  this.category.change(this.inputChange.bind(this));
  this.name.keyup(this.nameKeyUp.bind(this));

  this.delete.click(this.deleteHandler.bind(this));
  this.cancel.click(this.cancelHandler.bind(this));
  this.deleteForce.click(this.deleteForceHandler.bind(this));

  this.publishBtn.click(this.publishHandler.bind(this));
  this.amBtn.click(this.featuredHandler.bind(this));
};

APP.CreatorPostScreen.prototype.publishHandler = function() {
  if (!post) return this.showFlash('error', ['Rellena todos los campos del post']);
  var url = '/blog/post/' + (post.published ? 'unpublish' : 'publish');
  this.requestHandler(url, {
    idPost: post.id
  }, this.publishComplete);
};

APP.CreatorPostScreen.prototype.publishComplete = function(response) {
  post = response.data.post;
  if (post.published)
    this.publishBtn.addClass('publish').text('PUBLICADO');
  else
    this.publishBtn.removeClass('publish').text('PUBLICAR');
};

APP.CreatorPostScreen.prototype.featuredHandler = function() {
  if (!post) return this.showFlash('error', ['Rellena todos los campos del post']);
  var url = '/blog/post/' + (post.featured ? 'unfeatured' : 'featured');
  this.requestHandler(url, {
    idPost: post.id
  }, this.featuredComplete);
};

APP.CreatorPostScreen.prototype.featuredComplete = function(response) {
  post = response.data.post;
  if (post.featured)
    this.amBtn.addClass('am');
  else
    this.amBtn.removeClass('am');
};

APP.CreatorPostScreen.prototype.imageStarted = function() {
  this.isUploading = true;
  this.status.text('Cargando imagenes....');
};

APP.CreatorPostScreen.prototype.progressComplete = function() {
  this.status.text('Procesando imagenes....');
};

APP.CreatorPostScreen.prototype.imageLoaded = function() {
  this.isUploading = false;
  this.autoSave(null, this.editable);
  this.status.text('Imagenes cargadas');
};

APP.CreatorPostScreen.prototype.autoSave = function(event, editable) {
  if (this.isUploading) return this.showFlash('error', ['Las imágenes aún se estan cargando']);
  var errors = [];
  var nameValue = this.name.val(),
    categoryValue = this.category.val();

  this.editable = editable;

  if (nameValue.trim().length < 1)
    errors.push('Agrega un titulo');

  if (categoryValue === null)
    errors.push('Selecciona una categoria');

  if (this.cover.photo === null)
    errors.push('Selecciona una imagen de cover');

  if (errors.length > 0) return this.showFlash('error', errors);

  var body = this.editor.serialize()['element-0']['value'];

  editable = $(editable);

  var payload = {
    body: body,
    name: nameValue,
    category: categoryValue,
    description: editable.find('p').text().substr(0, 180),
    photo: this.cover.photo
  };

  this.status.text('Guardando.....');

  var url;
  if (!post) {
    url = '/blog/post/create';
  } else {
    url = '/blog/post/update';
    payload.idPost = post.id;
  }

  this.requestHandler(url, payload, this.saveRequestComplete);
};


APP.CreatorPostScreen.prototype.saveRequestComplete = function(response) {
  post = response.data.post;
  var url = '/blog/post/' + post.nameSlugify;
  if (edit)
    Utils.changeUrl(post.name, url + '/edit');
  this.previewBtn.attr('href', url);
  this.status.text('✓ guardado');
};

APP.CreatorPostScreen.prototype.beforeUnLoad = function(event) {
  if (this.isUploading) {
    var message = 'Aun no se han guardado tus cambios!';
    if (typeof event == 'undefined') {
      event = window.event;
    }
    if (event) {
      event.returnValue = message;
    }
    return message;
  }
};

APP.CreatorPostScreen.prototype.coverComplete = function(idImage) {
  this.$view.find('.upload').show();
  $('.cloudinary-fileupload').show();

  var filters = {
    format: 'jpg',
    width: 1600,
    crop: "limit",
    quality: 80
  };
  var img = $.cloudinary.image(idImage, filters);
  img.addClass('am-Profile-banner-img').appendTo(this.$view.find('.preview'));
  this.photo = img.attr('src');

  scope.autoSave(null, scope.editable);
};

APP.CreatorPostScreen.prototype.inputChange = function() {
  this.autoSave(null, this.editable);
};

APP.CreatorPostScreen.prototype.nameKeyUp = function() {
  clearTimeout(timeout);
  timeout = setTimeout(function() {
    scope.autoSave(null, scope.editable);
  }, 1000);
};

APP.CreatorPostScreen.prototype.deleteHandler = function(event) {
  event.preventDefault();
  this.delete.hide();
  this.previewBtn.hide();
  this.publishBtn.hide();
  this.amBtn.hide();
  this.deleteConfirm.show();
};

APP.CreatorPostScreen.prototype.cancelHandler = function(event) {
  event.preventDefault();
  this.delete.show();
  this.previewBtn.show();
  this.publishBtn.show();
  this.amBtn.show();
  this.deleteConfirm.hide();
};

APP.CreatorPostScreen.prototype.deleteForceHandler = function(event) {
  event.preventDefault();
  var url = '/blog/post/delete';
  this.requestHandler(url, {
    idPost: post.id
  }, this.deleteForceComplete);
};

APP.CreatorPostScreen.prototype.deleteForceComplete = function() {
  this.showFlash('succes', 'Se elimino tu post');
  setTimeout(function() {
    window.location.href = '/blog';
  }, 1000);
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.DiscoverScreen = function(id, container, navigation, data) {
  this.container = container;
  this.navigation = navigation;
  this.data = data;
  APP.BaseScreen.call(this, id);
};

APP.DiscoverScreen.constructor = APP.DiscoverScreen;
APP.DiscoverScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.DiscoverScreen.prototype.setupUI = function() {
  DataApp.currentUrl = this.data.url;
  Utils.changeUrl(this.id, this.data.url);

  this.searchText = $('.search-text');
  this.featuredText = $('.featured-text');

  this.viewer = new APP.Viewer(this.id, this.container, this.navigation, this.data);
  this.filters = new APP.Filters(this.data.filters);
};

APP.DiscoverScreen.prototype.listeners = function() {
  Broadcaster.addEventListener(Events.FILTER_CHANGED, this.filterChangedHandler.bind(this));
  this.filters.start();
};

APP.DiscoverScreen.prototype.filterChangedHandler = function(event) {

  if (event.meta) $('.' + event.meta + '-text').text(event.newValue);

  if (this.filters.term && this.filters.term.length > 0) {
    this.searchText.show();
    this.searchText.text(decodeURIComponent(this.filters.term));
  } else {
    this.searchText.hide();
    this.searchText.text('');
  }

  if (this.filters.isFeatured) {
    this.featuredText.show();
    this.featuredText.text('AM');
  } else {
    this.featuredText.hide();
    this.featuredText.text('');
  }

  var texts = [],
    currentText;
  $('.navigation > span').filter(function(index, value) {
    if ($(value).css('display') !== 'none')
      texts.push($(value));
  });

  var i;
  for (i = 0; i < texts.length; i++) {
    if (texts[i].text().indexOf(' >') !== -1)
      texts[i].text(texts[i].text().replace(' >', '')).removeClass('link');
  }

  for (i = 0; i < texts.length - 1; i++) {
    texts[i].text(texts[i].text() + ' >').addClass('link');
  }

  if (DataApp.currentUrl === window.location.href) return;

  Utils.changeUrl(this.id, DataApp.currentUrl);
  if (this.filters.isInitialized) this.viewer.reset();
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.EditWorkScreen = function() {
  APP.BaseScreen.call(this, 'editWork');
  this.work = work;
  this.userWork = work.User;
};

APP.EditWorkScreen.constructor = APP.EditWorkScreen;
APP.EditWorkScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.EditWorkScreen.prototype.setupUI = function() {
  this.workForm = $('.work-form');
  this.uploaderImage = new APP.UploaderImage($('.uploader-work'), this.uploaderImageComplete);
  this.uploaderImage.photo = work.photo;
  this.name = $('input[name=name]');
  this.category = $('select[name=category]');
  $('select[name=category]').find('option[value=' + category.id + ']').attr('selected', true);

  $('input[name=public]').attr('checked', work.public);
  $('input[name=nsfw]').attr('checked', work.nsfw);

  this.description = $('textarea[name=description]');
  this.tags = $('input[name=tags]');
  this.tags.tagsInput({
    height: '50px',
    width: '100%',
    defaultText: '+Etiqueta'
  });

  this.send = $('.send');
  this.sendLoading = $('.send-loading');

  this.workDelete = $('.work-delete');
  this.workDeleteConfirm = $('.work-delete-confirm');
  this.workDeleteCancel = $('.work-delete-cancel');
  this.workDeleteForce = $('.work-delete-force');
};

APP.EditWorkScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);
  this.workForm.submit(this.workFormSubmitHandler.bind(this));

  this.workDelete.click(this.workDeleteHandler.bind(this));
  this.workDeleteForce.click(this.workDeleteForceHandler.bind(this));
  this.workDeleteCancel.click(this.workDeleteCancelHandler.bind(this));

  $('input[type=checkbox]').change(this.checkPublicHandler);
  $('input[type=checkbox]').change();
};

APP.EditWorkScreen.prototype.checkPublicHandler = function() {
  $(this).parent().find('.value').text((this.checked ? 'On' : 'Off'));
}

APP.EditWorkScreen.prototype.workFormSubmitHandler = function(event) {
  event.preventDefault();
  var errors = [],
    scope = this;
  if (!this.uploaderImage.photo) errors.push('Ingrese una foto');
  if (Validations.notBlank(this.name.val())) errors.push('Ingrese un nombre');
  if (Validations.notBlank(this.category.val())) errors.push('Ingrese una categoria');
  if (Validations.notBlank(this.description.val())) errors.push('Ingrese una descripcion');
  if (this.tags.val().split(',')[0].length < 1) errors.push('Ingrese etiquetas');

  if (errors.length > 0) return this.showFlash('error', errors);

  this.sendLoading.show();
  this.send.hide();

  var data = this.workForm.serializeArray();
  $.each(data, function(index, value) {
    if (value.name === 'photo')
      value.value = scope.uploaderImage.photo;

    if (value.name === 'nsfw' || value.name === 'public')
      value.value = (value.value === 'on');
  });

  var url = DataApp.currentUser.url + '/work/update';
  this.requestHandler(url, data, this.workUpdatedComplete);
};

APP.EditWorkScreen.prototype.workUpdatedComplete = function(response) {
  this.showFlash('succes', 'Su obra se actualizo exitosamente')
  this.work = response.data.work;

  this.sendLoading.hide();
  this.send.show();

  var url = '/user/' + this.userWork.username + '/work/' + this.work.nameSlugify;
  var timeout = setTimeout(function() {
    clearTimeout(timeout);
    window.location.href = url;
  }, 1000);
};

APP.EditWorkScreen.prototype.workDeleteHandler = function(event) {
  event.preventDefault();
  this.workDelete.hide();
  this.workDeleteConfirm.show();
};

APP.EditWorkScreen.prototype.workDeleteForceHandler = function() {
  var url = DataApp.currentUser.url + '/work/delete';
  this.requestHandler(url, {
    idWork: this.work.id
  }, this.workDeleteForceComplete);
};

APP.EditWorkScreen.prototype.workDeleteForceComplete = function() {
  this.showFlash('succes', 'Se elimino tu obra');
  var timeout = setTimeout(function() {
    clearTimeout(timeout);
    if (DataApp.currentUser.isAdmin)
      window.location.href = '/';
    else
      window.location.href = DataApp.currentUser.url;
  }, 1000);
};

APP.EditWorkScreen.prototype.workDeleteCancelHandler = function(response) {
  this.workDelete.show();
  this.workDeleteConfirm.hide();
};

APP.EditWorkScreen.prototype.uploaderImageComplete = function(idImage) {
  this.$view.find('.upload').show();
  $('.cloudinary-fileupload').show();
  var filters = {
    width: 300,
    crop: 'limit'
  };
  $.cloudinary.image(idImage, filters).appendTo(this.$view.find('.preview'));
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.EditorScreen = function() {
  APP.BaseScreen.call(this, 'home');
};

APP.EditorScreen.constructor = APP.EditorScreen;
APP.EditorScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.EditorScreen.prototype.setupUI = function() {

  var config = {
    scaleFactor: 5,
    width: 567,
    height: 211,
    offsetX: 0,
    offsetY: 60
  };
  var color = '000000';

  var canvas = new fabric.Canvas('c1', {
    'backgroundColor': color,
    'width': config.width + (config.offsetX * 2),
    'height': config.height + (config.offsetY * 2)
  });

  var rect = new fabric.Rect({
    width: config.width,
    height: config.offsetY,
    left: 0,
    top: 0,
    fill: 'red',
    opacity: 0.5
  });
  var rect2 = new fabric.Rect({
    width: config.width,
    height: config.offsetY,
    left: 0,
    top: config.height + config.offsetY,
    fill: 'red',
    opacity: 0.5
  });

  rect.selectable = rect2.selectable = false;

  var imageTemp;


  var addImageFilter = function(url, filter) {
    return url.replace('upload/', 'upload/' + filter + '/');
  }

  var urlImage = 'http://res.cloudinary.com/hackdudes/image/upload/v1449719700/prueba2_e4tx4f.jpg';
  // var urlImage = 'http://res.cloudinary.com/hackdudes/image/upload/v1449596597/igw5cweq4gswvepaongi.jpg'
  var baseName = urlImage.replace(/^.*\/|\.[^.]*$/g, '')
  url = addImageFilter(urlImage, 'w_0.2,h_0.2');
  fabric.Image.fromURL(url, function(image) {
    imageTemp = image;
    //  image.scale(0.2);
    //  image.hasBorders = image.hasControls = image.hasRotatingPoint = false;
    canvas.add(image);
    canvas.calcOffset();

    canvas.sendToBack(image);
    canvas.setActiveObject(canvas.item(0));
    // canvas.item(0).hasBorders = false;
    canvas.item(0).lockRotation = true;
    canvas.item(0).hasRotatingPoint = false;
    canvas.item(0).lockUniScaling = true;
    canvas.centerObject(image);
    image.setCoords();
  }, {
    crossOrigin: 'Anonymous'
  });
  canvas.add(rect);
  canvas.add(rect2);

  $('input[type=color]').change(function() {
    color = $(this).val().replace('#', '');
    canvas.backgroundColor = '#' + color;
    canvas.renderAll();
  });

  var updateControls = function() {
    var source = canvas.toDataURL({
      top: config.offsetY,
      left: config.offsetX,
      height: config.height,
      width: config.weight
    });
    $('.preview').attr('src', source);
  }

  var original;
  var left;
  var center;
  var right;

  var lel = function() {
    var a = imageTemp.getBoundingRect();
    var x = Math.round(a.left * config.scaleFactor);
    var y = (Math.round(a.top * config.scaleFactor) - (60 * config.scaleFactor));
    var stageW = Math.round(config.width * config.scaleFactor);
    var stageH = Math.round(config.height * config.scaleFactor);
    var imageW = Math.round(imageTemp.getWidth() * config.scaleFactor);
    var imageH = Math.round(imageTemp.getHeight() * config.scaleFactor);
    var portion = Math.round(stageW / 3);

    var filters =
      'w_' + stageW + ',' +
      'h_' + stageH + ',e_colorize,co_rgb:' + color + '/' +
      'l_' + baseName + ',b_rgb:' + color + ',' +
      'w_' + imageW + ',' +
      'h_' + imageH + ',' +
      'x_' + x + ',' +
      'y_' + y + ',g_north_west/' +
      'x_' + (x < 0 ? (x * -1) : 0) + ',' +
      'y_' + (y < 0 ? (y * -1) : 0) + ',' +
      'w_' + stageW + ',' +
      'h_' + stageH + ',c_crop,g_north_west';
    original = addImageFilter(urlImage, filters);

    // var filters =
    // 'w_' + stageW + ',' +
    // 'h_' + stageH + ',e_colorize,co_rgb:' + color + '/' +
    // 'l_' + baseName + ',b_rgb:' + color + ',' +
    // 'w_' + imageW + ',' +
    // 'h_' + imageH + ',' +
    // 'x_' + x + ',' +
    // 'y_' + y + ',g_north_west/' +
    // 'x_' + (x < 0 ? (x * -1) : 0) + ',' +
    // 'y_' + (y < 0 ? (y * -1) : 0) + ',' +
    // 'w_' + stageW + ',' +
    // 'h_' + stageH + ',c_crop,g_north_west';
    // var temp = addImageFilter(urlImage, filters);
    // window.open(temp, '_blank');

    config.scaleFactor = 1.5;
    x = Math.round(a.left * config.scaleFactor);
    y = (Math.round(a.top * config.scaleFactor) - (60 * config.scaleFactor));
    stageW = Math.round(config.width * config.scaleFactor);
    stageH = Math.round(config.height * config.scaleFactor);
    imageW = Math.round(imageTemp.getWidth() * config.scaleFactor);
    imageH = Math.round(imageTemp.getHeight() * config.scaleFactor);
    portion = Math.round(stageW / 3);
    var stripe = 8;
    var distortion = -13;


    filters =
      'w_' + stageW + ',' +
      'h_' + stageH + ',e_colorize,co_rgb:' + color + '/' +
      'l_' + baseName + ',b_rgb:' + color + ',' +
      'w_' + imageW + ',' +
      'h_' + imageH + ',' +
      'x_' + x + ',' +
      'y_' + y + ',g_north_west/' +
      'x_' + ((x < 0 ? (x * -1) : 0)) + ',' +
      'y_' + (y < 0 ? (y * -1) : 0) + ',' +
      'w_' + portion + ',' +
      'h_' + stageH + ',c_crop,g_north_west/' +
      'e_distort:0:0:' + portion + ':0:' + (portion - stripe) + ':' + stageH + ':' + stripe + ':' + stageH + '/' +
      'c_pad,h_2.0,w_1.0/l_radial,e_displace,y_' + distortion + '/e_trim/u_mugleft/w_0.7';
    left = addImageFilter(urlImage, filters);

    filters =
      'w_' + stageW + ',' +
      'h_' + stageH + ',e_colorize,co_rgb:' + color + '/' +
      'l_' + baseName + ',b_rgb:' + color + ',' +
      'w_' + imageW + ',' +
      'h_' + imageH + ',' +
      'x_' + x + ',' +
      'y_' + y + ',g_north_west/' +
      'x_' + ((x < 0 ? (x * -1) : 0) + (Math.round(portion) * 1)) + ',' +
      'y_' + (y < 0 ? (y * -1) : 0) + ',' +
      'w_' + portion + ',' +
      'h_' + stageH + ',c_crop,g_north_west/' +
      'e_distort:0:0:' + portion + ':0:' + (portion - stripe) + ':' + stageH + ':' + stripe + ':' + stageH + '/' +
      'c_pad,h_2.0,w_1.0/l_radial,e_displace,y_' + distortion + '/e_trim/u_mugcenter/w_0.7';
    center = addImageFilter(urlImage, filters);

    filters =
      'w_' + stageW + ',' +
      'h_' + stageH + ',e_colorize,co_rgb:' + color + '/' +
      'l_' + baseName + ',b_rgb:' + color + ',' +
      'w_' + imageW + ',' +
      'h_' + imageH + ',' +
      'x_' + x + ',' +
      'y_' + y + ',g_north_west/' +
      'x_' + ((x < 0 ? (x * -1) : 0) + (Math.round(portion) * 2)) + ',' +
      'y_' + (y < 0 ? (y * -1) : 0) + ',' +
      'w_' + portion + ',' +
      'h_' + stageH + ',c_crop,g_north_west/' +
      'e_distort:0:0:' + portion + ':0:' + (portion - stripe) + ':' + stageH + ':' + stripe + ':' + stageH + '/' +
      'c_pad,h_2.0,w_1.0/l_radial,e_displace,y_' + distortion + '/e_trim/u_mugright/w_0.7';
    right = addImageFilter(urlImage, filters);


    $('.original').attr('src', original);
    $('.left').attr('src', left);
    $('.center').attr('src', center);
    $('.right').attr('src', right);

  };

  $('.save-btn').click(lel);

  canvas.on({
    'mouse:up': updateControls,
    'object:resizing': updateControls
  });
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.FeedScreen = function() {
  APP.BaseScreen.call(this, 'feed');

  this.idCollections = [];
  this.collections = [];
  this.currentWork = null;
};

APP.FeedScreen.constructor = APP.FeedScreen;
APP.FeedScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.FeedScreen.prototype.setupUI = function() {
  APP.BaseScreen.prototype.setupUI.call(this);

  this.saveBtn = $('.save-collections');
  this.saveBtnLoading = $('.save-collections-loading');

  this.collectionsContainer = $('.collections');
  this.collectionForm = $('.add-collection-form');
  this.shareFB = $('.share-fb');

  this.viewer = new APP.Viewer('action', $('.feed-inner'), 'infinite', actions);

  new Clipboard('.copy', {
    text: this.copyHandler.bind(this)
  });
};

APP.FeedScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  this.saveBtn.click(this.saveClickHandler.bind(this));

  var collectionsUrl = DataApp.currentUser.url + '/collection/all';
  this.requestHandler(collectionsUrl, {}, this.collectionsHandlerComplete);

  this.collectionForm.submit(this.collectionFormHandler.bind(this));

  var addCollectionHandler = this.addCollectionHandler.bind(this);
  Broadcaster.addEventListener(Events.ADD_COLLECTION, addCollectionHandler);

  var feedShareHandler = this.feedShareHandler.bind(this);
  Broadcaster.addEventListener(Events.SHARE, feedShareHandler);

  this.shareFB.click(this.shareFBHandler.bind(this));
};


APP.FeedScreen.prototype.copyHandler = function(trigger) {
  $('#lean_overlay').trigger("click");
  this.showFlash('succes', 'Link Copiado');
  return DataApp.baseUrl + 'user/' + this.currentWork.User.username +
    '/work/' + this.currentWork.nameSlugify;
};


APP.FeedScreen.prototype.feedShareHandler = function(event) {
  this.currentWork = event.data.work;
};

APP.FeedScreen.prototype.shareFBHandler = function() {
  Utils.shareFBWork(this.currentWork);
};

APP.FeedScreen.prototype.collectionFormHandler = function(event) {
  event.preventDefault();
  var url = DataApp.currentUser.url + '/collection/create';
  this.requestHandler(url, $(event.target).serialize(), this.collectionFormComplete);
};

APP.FeedScreen.prototype.collectionFormComplete = function(response) {
  var item = new APP.CollectionItem(response.data.collection);
  item.addEventListener(Events.COLLECTION_ITEM_SELECTED, this.collectionItemSelected.bind(this));
  this.collections.push(item);
  this.collectionsContainer.append(item.view);
};

APP.FeedScreen.prototype.addCollectionHandler = function(event) {
  this.currentWork = event.data.work;
  var url = DataApp.currentUser.url + '/work/inside_collection';
  var payload = {
    idWork: this.currentWork.id
  };
  this.requestHandler(url, payload, this.insideCollectionHandler);
};

APP.FeedScreen.prototype.insideCollectionHandler = function(response) {
  var collections = response.data.collections;
  var i, j;
  for (i = 0; i < this.collections.length; i++)
    this.collections[i].view.removeClass('selected');

  this.idCollections = [];
  for (i = 0; i < collections.length; i++) {
    for (j = 0; j < this.collections.length; j++) {
      if (collections[i].id === this.collections[j].data.id) {
        this.idCollections.push(collections[i].id);
        this.collections[j].view.addClass('selected');
      }
    }
  }
};

APP.FeedScreen.prototype.saveClickHandler = function() {
  this.saveBtn.hide();
  this.saveBtnLoading.show();

  var url = DataApp.currentUser.url + '/work/add_to_collection';
  var payload = {
    collections: JSON.stringify(this.idCollections),
    idWork: this.currentWork.id
  };
  this.requestHandler(url, payload, this.saveRequestComplete);
};

APP.FeedScreen.prototype.saveRequestComplete = function() {
  this.saveBtn.show();
  this.saveBtnLoading.hide();
  this.showFlash('succes', 'Su actualizo tus colecciones');

  $('#lean_overlay').trigger('click');
};

APP.FeedScreen.prototype.collectionsHandlerComplete = function(response) {
  var collections = response.data.collections;
  var i, item;
  for (i = 0; i < collections.length; i++) {
    item = new APP.CollectionItem(collections[i]);
    this.collections.push(item);
    item.addEventListener(Events.COLLECTION_ITEM_SELECTED, this.collectionItemSelected.bind(this));
    this.collectionsContainer.append(item.view);
  }
};

APP.FeedScreen.prototype.collectionItemSelected = function(event) {
  var item = event.target;
  var index = this.idCollections.indexOf(item.data.id);
  if (index === -1)
    this.idCollections.push(item.data.id);
  else
    this.idCollections.splice(index, 1);
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.Filters = function(filters) {
  this.filters = filters;

  this.oldCategory = this.filters.currentCategory;
  this.oldOrder = this.filters.currentOrder;

  this.isFeatured = Utils.getUrlParameter('featured') !== undefined;
  this.term = Utils.getUrlParameter('term');
  this.currentCategory = this.currentOrder = null;

  this.setupUI();
  this.listeners();

  this.isInitialized = false;
};

APP.Filters.constructor = APP.Filters;


APP.Filters.prototype.setupUI = function() {
  var filterRight = $('.filter.right');
  var rightSelect = $('.filter.right .am-Select')

  var rightFilterItems

  setTimeout(function() {
    rightFilterItems = $('.filter.right .am-Filter-item')
    $(rightFilterItems).click(function() {
      setTimeout(function() {
        $(rightSelect).trigger("click")
      }, 300)
    })
  }, 500)

  $(rightSelect).click(function() {
    var state = filterRight.attr('data-state')
    if (state == 'closed') filterRight.attr('data-state', 'open')
    else filterRight.attr('data-state', 'closed')
  })

  var filterLeft = $('.filter.left')
  var leftSelect = $('.filter.left .am-Select')
  var discoverContent = $('.discover-content')

  $(leftSelect).click(function() {
    var state = filterLeft.attr('data-state')
    if (state == 'closed') {
      filterLeft.attr('data-state', 'open')
      discoverContent.attr('data-state', 'expand').trigger('resetLayout')
    } else {
      filterLeft.attr('data-state', 'closed')
      discoverContent.attr('data-state', 'reduce').trigger('resetLayout')
    }
  })

  var device = new Device({
    toDesktop: function() {
      console.log('toDesktop!')
    },
    toMobile: function() {
      console.log('toMobile!')
      $('.filter.left .left-menu').css('display', 'block')
    }
  })

  if (device.getVal() == "mobile") {
    $(leftSelect).trigger("click")
    $('.filter.left .left-menu').css('display', 'block')
  }


  function Device(options) {

    var val = window.innerWidth < 1000 ? 'mobile' : 'desktop',
      toDesktop = options.toDesktop,
      toMobile = options.toMobile;


    window.addEventListener('resize', function() {

      var temp = val;

      val = window.innerWidth < 1000 ? 'mobile' : 'desktop';

      if (temp == 'mobile' && val == 'desktop') toDesktop();
      if (temp == 'desktop' && val == 'mobile') toMobile();
    });

    function getVal() {
      return val;
    }

    return {
      getVal: getVal
    };
  }

  this.filters.categories.unshift({
    name: 'Todo',
    nameSlugify: 'all'
  });

  this.itemFilterRenderer(this.filters.categories, 'category');
  this.itemFilterRenderer(this.filters.order, 'order');

  this.featuredBtn = $('.am-Switch-button');
  this.searchInput = $('.am-Search-input input');
  this.searchBtn = $('.search-btn');
  this.closeBtn = $('.close-btn');

  this.categories = $('[data-meta=category]');
  this.orders = $('[data-meta=order]');

  $('[data-value=' + this.oldCategory + ']').parent().addClass('selected');
  $('[data-value=' + this.oldOrder + ']').parent().addClass('selected');

  if (this.isFeatured) $('input[type=checkbox]').prop('checked', true);
  this.navigation = $('.am-navigation-text');

  this.needsToClose = false;
};

APP.Filters.prototype.itemFilterRenderer = function(data, meta) {
  var item = APP.TemplateManager.instance.getFromDoc('filter-item');
  $.each(data, function(index, value) {
    value.meta = meta;
    $('.filter-' + meta).append(item(value));
  });
};

APP.Filters.prototype.listeners = function() {
  this.categories.on('click', this.filterItemHandler.bind(this, 'category'));
  this.orders.on('click', this.filterItemHandler.bind(this, 'order'));
  this.featuredBtn.on('click', this.featuredHandler.bind(this));

  this.term = this.term === undefined ? '' : this.term;
  this.searchInput.val(decodeURIComponent(this.term));

  this.searchBtn.click(this.searchHandler.bind(this));

  this.searchInput.keyup(this.searchKeyUpHandler.bind(this));
  this.searchInput.keypress(this.searchKeyPressHandler.bind(this));

  this.navigation.click(this.navigationClickHandler.bind(this));

  this.closeBtn.click(this.closeClickHandler.bind(this));
  this.searchInput.keyup();
};

APP.Filters.prototype.searchKeyUpHandler = function(event) {
  this.searchInput.val().length > 0 ? this.closeBtn.show() : this.closeBtn.hide();
};

APP.Filters.prototype.closeClickHandler = function(event) {
  this.searchInput.val('');
  this.closeBtn.hide();
  this.needsToClose = true;
  this.searchBtn.click();
};

APP.Filters.prototype.navigationClickHandler = function(event) {
  var obj = $(event.target);
  var currentIndex, url = DataApp.currentUrl;
  this.navigation.each(function(index, value) {
    var idValue = $(value).attr('id');
    if ($(value).hasClass('link')) {
      if (obj.attr('id') === idValue) currentIndex = index;
    }
    if (index > currentIndex) {
      url = Utils.removeURLParameter(url, idValue);
    }
  });
  window.location.href = url;
};

APP.Filters.prototype.searchKeyPressHandler = function(event) {
  if (event.which !== 13) return;
  var value = encodeURIComponent($(event.target).val());
  if (value.length > 0) {
    if (this.term) {
      DataApp.currentUrl = DataApp.currentUrl.replace('term=' + this.term, 'term=' + value);
    } else {
      DataApp.currentUrl = DataApp.currentUrl + '&term=' + value;
    }
    this.term = value;
  } else {
    if (DataApp.currentUrl.indexOf('&term=' + this.term) > -1) {
      DataApp.currentUrl = DataApp.currentUrl.replace('&term=' + this.term, '');
    }
    if (DataApp.currentUrl.indexOf('term=' + this.term) > -1) {
      DataApp.currentUrl = DataApp.currentUrl.replace('term=' + this.term, '');
    }
    this.term = undefined;
  }
  if (this.needsToClose)
    return window.location.href = DataApp.currentUrl;

  Broadcaster.dispatchEvent(Events.FILTER_CHANGED);
};

APP.Filters.prototype.searchHandler = function(event) {
  event.preventDefault();
  this.searchInput.trigger({
    type: 'keypress',
    which: 13,
    keyCode: 13
  });
}

APP.Filters.prototype.featuredHandler = function() {
  if (this.isFeatured)
    DataApp.currentUrl = DataApp.currentUrl.replace('&featured=1', '');
  else
    DataApp.currentUrl = DataApp.currentUrl + '&featured=1';
  this.isFeatured = !this.isFeatured;
  Broadcaster.dispatchEvent(Events.FILTER_CHANGED);
};

APP.Filters.prototype.start = function() {
  $('[data-value=' + this.oldCategory + ']').click();
  $('[data-value=' + this.oldOrder + ']').click();

  this.isInitialized = true;
};

APP.Filters.prototype.filterItemHandler = function(meta, event) {
  var filterCapitalized = Utils.capitalize(meta);
  var oldFilter = 'old' + filterCapitalized;
  var currentFilter = 'current' + filterCapitalized;

  var current = $(event.currentTarget).find('.am-Filter-option');
  this[currentFilter] = current.attr('data-value');

  $('[data-value=' + this[oldFilter] + ']').parent().removeClass('selected');
  $('[data-value=' + this[currentFilter] + ']').parent().addClass('selected');

  DataApp.currentUrl = DataApp.currentUrl.replace(this[oldFilter], this[currentFilter]);
  this[oldFilter] = this[currentFilter];
  var newValue = $(event.target).attr('data-name');

  Broadcaster.dispatchEvent(Events.FILTER_CHANGED, {
    meta: meta,
    newValue: newValue
  });
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.HomeScreen = function() {
  APP.BaseScreen.call(this, 'home');

  this.usersViewer = new APP.Viewer('user', $('.grid'), null, users);
  this.worksViewer = new APP.Viewer('work', $('.grid-works'), null, works);

  var $banner = $('.banner-user').detach();
  this.usersViewer.container.append($banner).masonry('appended', $banner);


  this.slider = new Slider(document.querySelector('.slider'), {
    slideClass: 'js-slide',
    sliderNavItemClass: 'js-slideNavItem'
  });
};

APP.HomeScreen.constructor = APP.HomeScreen;
APP.HomeScreen.prototype = Object.create(APP.BaseScreen.prototype);
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.NotificationsScreen = function() {
  APP.BaseScreen.call(this, 'notifications');
};

APP.NotificationsScreen.constructor = APP.NotificationsScreen;
APP.NotificationsScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.NotificationsScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.PostScreen = function() {
  APP.BaseScreen.call(this, 'post');

  this.following = false;
};

APP.PostScreen.constructor = APP.PostScreen;
APP.PostScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.PostScreen.prototype.setupUI = function() {
  this.viewer = new APP.Viewer('post', $('.blog-articles-container'), null, posts);
  this.loginReview = $('.login-review');
  this.followBtn = $('.following');
  this.shareFb = $('.share-fb');
  this.shareTw = $('.share-tw');

  this.editor = new MediumEditor('.editable', {
    buttonLabels: 'fontawesome',
    toolbar: false,
    spellcheck: false,
    disableEditing: true
  });

  this.reviewForm = $('.review-form');
  this.reviewContainer = $('.reviews-items-container');
  for (var i = 0; i < reviews.length; i++)
    this.reviewContainer.append(new APP.Review(reviews[i]).view);

  this.likeBtn = $('.like-btn');

  if (DataApp.currentUser) {
    if (DataApp.currentUser.id === post.User.id)
      return this.followBtn.hide();

    var followingUrl = DataApp.currentUser.url + '/isFollowing';
    this.requestHandler(followingUrl, {
      idUser: post.User.id
    }, this.isFollowingComplete);
  }
};


APP.PostScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);

  this.reviewForm.submit(this.reviewFormHandler.bind(this));
  this.likeBtn.click(this.likeBtnHandler.bind(this));
  this.loginReview.click(this.loginReviewHandler.bind(this));
  this.followBtn.click(this.followHandler.bind(this));
  this.shareFb.click(this.shareFBHandler.bind(this));
  this.shareTw.click(this.shareTWHandler.bind(this));
};

APP.PostScreen.prototype.shareFBHandler = function() {
  Utils.shareFBPost(post);
};
APP.PostScreen.prototype.shareTWHandler = function() {
  Utils.shareTWPost(post);
};

APP.PostScreen.prototype.followHandler = function() {
  Utils.checkAuthentication();
  var url = DataApp.currentUser.url + (this.isFollowing ? '/unfollow/' : '/follow/');
  this.requestHandler(url, {
    idUser: post.User.id
  }, this.followComplete);
};

APP.PostScreen.prototype.followComplete = function(response) {
  if (this.isFollowing) {
    this.followBtn.removeClass('following').text('+ SEGUIR');
  } else {
    this.followBtn.addClass('following').text('Siguiendo');
  }
  this.isFollowing = !this.isFollowing;
};

APP.PostScreen.prototype.likeBtnHandler = function(event) {
  event.preventDefault();
  Utils.checkAuthentication();

  if (!post.liked) {
    var url = '/blog/post/like';
    this.requestHandler(url, {
      idPost: post.id
    }, this.likeComplete);
  }
};

APP.PostScreen.prototype.loginReviewHandler = function() {
  Utils.checkAuthentication();
};

APP.PostScreen.prototype.isFollowingComplete = function(response) {
  this.isFollowing = response.data.following;
  this.isFollowing && this.followBtn.addClass('following').text('Siguiendo');
};

APP.PostScreen.prototype.likeComplete = function(response) {
  post.liked = !post.liked;
  $('.likes').text(response.data.likes);
  this.likeBtn.addClass('liked');
};


APP.PostScreen.prototype.reviewFormHandler = function(event) {
  event.preventDefault();
  var url = '/blog/post/review/create';
  this.requestHandler(url, $(event.target).serialize(), this.reviewComplete);
};

APP.PostScreen.prototype.reviewComplete = function(response) {
  $('.value-input').val('');
  this.reviewContainer.append(new APP.Review(response.data.review).view);
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.ProductScreen = function() {
  APP.BaseScreen.call(this, 'product');

  this.currentItem = this.oldItem;
  this.currentSection, this.oldSection;
  this.collections = [];
  this.idCollections = [];

  this.following = false;
};

APP.ProductScreen.constructor = APP.ProductScreen;
APP.ProductScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.ProductScreen.prototype.setupUI = function() {

  for (var i = 0; i < categories.length; i++) {
    var category = categories[i],
      products = [];
    for (var j = 0; j < category.subCategories.length; j++) {
      var subCategory = category.subCategories[j];
      for (var k = 0; k < subCategory.innerCategories.length; k++) {
        var innerCategory = subCategory.innerCategories[k];
        for (var l = 0; l < innerCategory.Products.length; l++) {
          products.push(innerCategory.Products[l]);
        }
      }
    }
    new APP.Viewer('carrouselItem', $('.' + category.nameSlugify), null, products);
  }

  new APP.Viewer('carrouselItem', $('.more'), null, more, {
    worked: true
  });
  new APP.Viewer('carrouselItem', $('.similar'), null, similar, {
    worked: true
  });

  new APP.Carrousel($('.js-more-carousel'), $('.more'));
  new APP.Carrousel($('.js-similar-carousel'), $('.similar'));

  new APP.PhotoSwipe('product');

  this.reviewsContainer = $('.reviews-items-container');
  for (var i = 0; i < reviews.length; i++)
    this.reviewsContainer.append(new APP.Review(reviews[i]).view);

  this.shareFb = $('.share-fb');
  this.askBtn = $('.ask-availability');
  this.loginReview = $('.login-review');
  this.askRequester = $('.ask-requester');
  this.thanksRequester = $('.thanks-requester');
  this.likeBtn = $('.like-btn');
  this.afterLike = $('.after-like');
  this.saveBtn = $('.save-collections');
  this.saveBtnLoading = $('.save-collections-loading');
  this.followBtn = $('.am-Follow-button');
  this.collectionsContainer = $('.collections');
  this.collectionForm = $('.add-collection-form');
  this.reviewForm = $('.review-form');
  this.reviewContainer = $('.reviews-items-container');

  this.prevBtn = $('.prev-btn');
  this.nextBtn = $('.next-btn');

  new Clipboard('.copy', {
    text: this.copyHandler.bind(this)
  });
}

APP.ProductScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);
  this.shareFb.click(this.shareFBHandler.bind(this));

  $('.menu-item').click(this.menuItemHandler.bind(this));
  $('.menu-item[data-name=' + currentPath + ']').click();

  this.loginReview.click(this.loginReviewHandler.bind(this));
  this.saveBtn.click(this.saveClickHandler.bind(this));

  if (DataApp.currentUser) {
    var collectionsUrl = DataApp.currentUser.url + '/collection/all';
    this.requestHandler(collectionsUrl, {
      meta: 'products'
    }, this.collectionsHandlerComplete);

    if (!owner) {
      var followingUrl = DataApp.currentUser.url + '/isFollowing';
      this.requestHandler(followingUrl, {
        idUser: product.User.id
      }, this.isFollowingComplete);
    }
  }

  this.likeBtn.click(this.likeBtnHandler.bind(this));

  this.followBtn.click(this.followHandler.bind(this));
  this.collectionForm.submit(this.collectionFormHandler.bind(this));
  this.reviewForm.submit(this.reviewFormHandler.bind(this));

  $(document).bind('keyup', this.documentKeyupHandler.bind(this));
};

APP.ProductScreen.prototype.documentKeyupHandler = function(event) {
  if (event.keyCode === 39 && this.prevBtn.length > 0)
    window.location.href = this.prevBtn.attr('href');

  if (event.keyCode === 37 && this.nextBtn.length > 0)
    window.location.href = this.nextBtn.attr('href');
};

APP.ProductScreen.prototype.copyHandler = function(trigger) {
  $('#lean_overlay').trigger("click");
  this.showFlash('succes', 'Link Copiado');
  return window.location.href;
};

APP.ProductScreen.prototype.reviewFormHandler = function(event) {
  event.preventDefault();
  var url = DataApp.currentUser.url + '/product/review/create';
  this.requestHandler(url, $(event.target).serialize(), this.reviewComplete);
};

APP.ProductScreen.prototype.reviewComplete = function(response) {
  $('.value-input').val('');
  this.reviewContainer.append(new APP.Review(response.data.review).view);
}


APP.ProductScreen.prototype.followHandler = function() {
  Utils.checkAuthentication();
  var url = DataApp.currentUser.url + (this.isFollowing ? '/unfollow/' : '/follow/');
  this.requestHandler(url, {
    idUser: product.User.id
  }, this.followComplete);
};

APP.ProductScreen.prototype.followComplete = function(response) {
  console.log(response);
  if (this.isFollowing) {
    this.followBtn.removeClass('following').text('+ SEGUIR');
  } else {
    this.followBtn.addClass('following').text('Siguiendo');
  }

  this.isFollowing = !this.isFollowing;
}

APP.ProductScreen.prototype.isFollowingComplete = function(response) {
  this.isFollowing = response.data.following;
  this.isFollowing && this.followBtn.addClass('following').text('Siguiendo');
}

APP.ProductScreen.prototype.saveClickHandler = function() {
  this.saveBtn.hide();
  this.saveBtnLoading.show();

  var url = DataApp.currentUser.url + '/product/add_to_collection';
  var payload = {
    collections: JSON.stringify(this.idCollections),
    idProduct: product.id
  };
  this.requestHandler(url, payload, this.saveRequestComplete);
};

APP.ProductScreen.prototype.saveRequestComplete = function() {
  this.saveBtn.show();
  this.saveBtnLoading.hide();
  this.showFlash('succes', 'Su actualizo tus colecciones');

  $('#lean_overlay').trigger('click');
};


APP.ProductScreen.prototype.collectionFormHandler = function(event) {
  event.preventDefault();
  var url = DataApp.currentUser.url + '/collection/create';
  this.requestHandler(url, $(event.target).serialize(), this.collectionFormComplete);
};

APP.ProductScreen.prototype.collectionFormComplete = function(response) {
  var item = new APP.CollectionItem(response.data.collection);
  item.addEventListener(Events.COLLECTION_ITEM_SELECTED, this.collectionItemSelected.bind(this));
  this.collections.push(item);
  this.collectionsContainer.append(item.view);
};


APP.ProductScreen.prototype.likeBtnHandler = function() {
  Utils.checkAuthentication();
  if (!product.liked) {
    var url = DataApp.currentUser.url + '/product/like';
    this.requestHandler(url, {
      idProduct: product.id
    }, this.likeComplete);
  }
};

APP.ProductScreen.prototype.likeComplete = function(response) {
  product.liked = !product.liked;
  $('.likes').text(response.data.likes);
  this.likeBtn.parent().addClass('active');
  this.afterLike.show();
};

APP.ProductScreen.prototype.collectionsHandlerComplete = function(response) {
  var collections = response.data.collections;
  var i, item;
  for (i = 0; i < collections.length; i++) {
    item = new APP.CollectionItem(collections[i]);
    this.collections.push(item);
    item.addEventListener(Events.COLLECTION_ITEM_SELECTED, this.collectionItemSelected.bind(this));
    this.collectionsContainer.append(item.view);
  }

  var url = DataApp.currentUser.url + '/product/inside_collection';
  this.requestHandler(url, {
    idProduct: product.id
  }, this.insideCollectionHandler);
};

APP.ProductScreen.prototype.insideCollectionHandler = function(response) {
  var collections = response.data.collections;
  var i, j;
  for (i = 0; i < this.collections.length; i++)
    this.collections[i].view.removeClass('selected');

  this.idCollections = [];
  for (i = 0; i < collections.length; i++) {
    for (j = 0; j < this.collections.length; j++) {
      if (collections[i].id === this.collections[j].data.id) {
        this.idCollections.push(collections[i].id);
        this.collections[j].view.addClass('selected');
      }
    }
  }
};

APP.ProductScreen.prototype.collectionItemSelected = function(event) {
  var item = event.target;
  var index = this.idCollections.indexOf(item.data.id);
  if (index === -1)
    this.idCollections.push(item.data.id);
  else
    this.idCollections.splice(index, 1);
};

APP.ProductScreen.prototype.loginReviewHandler = function() {
  Utils.checkAuthentication();
};

APP.ProductScreen.prototype.menuItemHandler = function(event) {
  this.currentItem = $(event.currentTarget);
  var path = this.currentItem.data('name');
  this.currentSection = $('.' + path + '-container');
  this.currentSection.show();
  var url = '/user/' + product.User.username + '/product/' + product.nameSlugify +
    '/' + (path === 'index' ? '' : path);

  $('.menu-item').removeClass('selected');
  this.currentItem.addClass('selected');

  this.oldSection && this.oldSection.hide();
  this.oldSection = this.currentSection;
  Utils.changeUrl(DataApp.baseTitle + Utils.capitalize(path), url);
};

APP.ProductScreen.prototype.shareFBHandler = function() {
  Utils.shareFBWork(product);
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.ProfileScreen = function() {
  this.currentItem, this.oldItem;
  this.currentSection, this.oldSection;
  this.currentViewer, this.oldViewer;

  this.paths = [];
  this.viewers = [];
  this.uploaderCover = new APP.UploaderImage($('.uploader-cover'), this.uploadComplete);

  APP.BaseScreen.call(this, 'profile');
};

APP.ProfileScreen.constructor = APP.ProfileScreen;
APP.ProfileScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.ProfileScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);
  $('.am-Profile-menu-item').click(this.menuItemClickHandler.bind(this));
  $('.am-Follow-button').click(this.followClickHandler.bind(this));
  $('.cancel-icon').click(this.cancelClickHandler.bind(this));
  $('.save-icon').click(this.saveClickHandler.bind(this));

  $('.am-Profile-menu-item[data-name=' + currentPath + ']').click();
};

APP.ProfileScreen.prototype.saveClickHandler = function() {
  var url = DataApp.currentUser.url + '/account/update_cover';
  this.requestHandler(url, {
    cover: this.uploaderCover.photo
  }, this.updateCoverComplete);
  $('.save-icon, .cancel-icon').hide();
  $('.cloudinary-fileupload, .upload').show();
};

APP.ProfileScreen.prototype.followClickHandler = function() {
  Utils.checkAuthentication();
  var url = DataApp.currentUser.url + (profile.following ? '/unfollow/' : '/follow/');
  this.requestHandler(url, {
    idUser: profile.id
  }, this.followComplete);
};

APP.ProfileScreen.prototype.menuItemClickHandler = function(event) {
  this.currentItem = $(event.currentTarget);
  var path = this.currentItem.data('name');

  var url = '/user/' + profile.username + '/' + (path === 'portfolio' ? '' : path)
  Utils.changeUrl(DataApp.baseTitle + Utils.capitalize(path), url);

  this.currentSection = $('.' + path + '-wrapper');

  this.oldItem && this.oldItem.removeClass('selected');
  this.oldViewer && this.oldViewer.suspend();
  this.oldSection && this.oldSection.hide();

  this.currentItem.addClass('selected');
  this.currentSection.show();

  if (this.paths.indexOf(path) === -1) {
    var template = this.getTemplate(path),
      section = $('.' + path + '-container');
    this.currentViewer = new APP.Viewer(template, section, 'infinite', null);
    this.currentViewer.navigationManager.navigator.needChangeUrl = true;
    this.viewers.push(this.currentViewer);
    this.paths.push(path);
  } else {
    this.currentViewer = this.viewers[this.paths.indexOf(path)]
    this.currentViewer.restart();
  }

  this.oldItem = this.currentItem;
  this.oldViewer = this.currentViewer;
  this.oldSection = this.currentSection;
}

APP.ProfileScreen.prototype.updateCoverComplete = function(response) {
  DataApp.currentUser.cover = this.uploaderCover.photo;
  $('.save-icon, .cancel-icon').hide();
  $('.cloudinary-fileupload, .upload').show();
};

APP.ProfileScreen.prototype.cancelClickHandler = function() {
  $('.preview > img').attr('src', DataApp.currentUser.cover);
  $('.save-icon, .cancel-icon').hide();
  $('.cloudinary-fileupload, .upload').show();
};

APP.ProfileScreen.prototype.followComplete = function(response) {
  if (!profile.following)
    $('.am-Follow-button').text('Siguiendo').addClass('following');
  else
    $('.am-Follow-button').text('+Seguir').removeClass('following');

  profile.following = !profile.following;
};
APP.ProfileScreen.prototype.uploadComplete = function(idImage) {
  var filters = {
    format: 'jpg',
    width: 1600,
    crop: "limit",
    quality: 80
  };
  var img = $.cloudinary.image(idImage, filters);
  img.addClass('am-Profile-banner-img').appendTo(this.$view.find('.preview'));
  this.photo = img.attr('src');
  $('.save-icon , .cancel-icon').show();
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.SellScreen = function() {
  APP.BaseScreen.call(this, 'sell');
};

APP.SellScreen.constructor = APP.SellScreen;
APP.SellScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.SellScreen.prototype.setupUI = function() {
  this.createBtn = $('.create-btn');

  this.product1 = new APP.CreatorProductItem(1);
  this.product2 = new APP.CreatorProductItem(2, categories[1]);
  this.product3 = new APP.CreatorProductItem(3, categories[2]);
  this.product4 = new APP.CreatorProductItem(4, categories[3]);

  this.products = [this.product1, this.product2, this.product3, this.product4];

  this.oldIndex = null;
  this.currentIndex = 0;
};

APP.SellScreen.prototype.listeners = function() {
  this.createBtn.click(this.createHandler.bind(this));

  var scope = this;
  $('.product-creator').click(function(e) {
    e.preventDefault();

    scope.currentIndex = parseInt($(this).data('prod'), 10);

    // if(scope.currentIndex === scope.oldIndex)) {
    //   return scope['product' + scope.oldIndex].close();
    // }

    if (scope.oldIndex)
      scope['product' + scope.oldIndex].close();

    scope['product' + scope.currentIndex].open();

    scope.oldIndex = scope.currentIndex;
  });
};

APP.SellScreen.prototype.createHandler = function(e) {
  e.preventDefault();

  $('.create-btn').addClass('hide');
  $('.create-btn-loading').removeClass('hide');

  var url = DataApp.currentUser.url + '/product/create';

  var i, payload = [];
  for (i = 0; i < this.products.length; i++) {
    payload = _.union(payload, this.products[i].getPayload());
  }
  this.requestHandler(url, {
    products: JSON.stringify(payload)
  }, this.productCreatedComplete);
};


APP.SellScreen.prototype.productCreatedComplete = function(response) {
  this.showFlash('succes', 'Su producto se envió a revisión');
  var timeout = setTimeout(function () {
    clearTimeout(timeout);
    window.location.href = DataApp.currentUser.url + '/products';
  }, 2000);
};

/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.Viewer = function(id, container, navigation, data, options) {
  this.container = container;
  this.options = options;

  if (id === 'carrouselItem' || id === 'action' || id === 'notificationItem' || id === 'tableUser' || id === 'tableWork' || id === 'post' || id === 'postMinimal' || id === 'tableProductApplying') {} else {
    this.setupMasonry();
  }

  this.id = id;
  this.navigation = navigation;
  this.initialize = true;
  this.fromExternal = false;
  if (this.navigation) {
    this.navigationManager = new APP.NavigationManager(navigation);
    if (data) {
      this.navigationManager.navigator.currentPage = data.pagination.page;
      this.navigationManager.navigator.totalPages = data.pagination.pages;
    } else {
      this.navigationManager.navigator.currentPage = 1;
      this.navigationManager.navigator.totalPages = 1;
    }
    this.navigationManager.navigator.start();
    this.listeners();
    if (data) {
      this.addItems(data.items);
    } else {
      this.fromExternal = true;
      this.navigationManager.navigator.gotoPage(1, true);
    }
  } else {
    if (data)
      this.addItems(data);
    else {
      this.fromExternal = true;
      this.navigationManager.navigator.gotoPage(1, true);
    }
  }
};

APP.Viewer.constructor = APP.Viewer;

APP.Viewer.prototype.setupMasonry = function() {
  var scope = this;
  scope.container.masonry({
    itemSelector: '.grid-item',
    columnWidth: '.grid-sizer',
    percentPosition: true
  });

  $('.discover-content').on('resetLayout', function() {
    console.log('expand');
    scope.container.masonry();
  })
};

APP.Viewer.prototype.listeners = function() {
  this.pageStart = this.pageLoadStartHandler.bind(this);
  this.navigationManager.navigator.addEventListener(Events.LOAD_START, this.pageStart);

  this.pageEnd = this.pageLoadEndHandler.bind(this);
  this.navigationManager.navigator.addEventListener(Events.LOAD_END, this.pageEnd);
};

APP.Viewer.prototype.pageLoadStartHandler = function() {
  this.container.parent().find('.bare-message').hide();
  this.container.parent().find('.loading').show();
};

APP.Viewer.prototype.pageLoadEndHandler = function(event) {
  if (this.fromExternal) {
    this.initialize = true;
  } else {
    this.initialize = false;
  }
  this.addItems(event.data.items);
  if (this.options && this.options.getTotal) {
    this.options.getTotal(event.data.pagination.total);
  }
};

APP.Viewer.prototype.addItems = function(items) {
  this.container.parent().find('.loading').show();
  if (this.navigation === APP.NavigationManager.PAGINATION && !this.initialize) {
    this.clean();
  }
  if (items.length < 1) {
    if (this.container.parent().find('.bare-message').hasClass('hide')) {
      this.container.parent().find('.bare-message').removeClass('hide');
    }
    var display = this.container.parent().find('.bare-message').show().css('display');
    this.container.parent().find('.bare-message').show().css('display', display);
    this.container.parent().height('auto');
    this.container.parent().find('.loading').hide();
  }
  var scopetemp = this;
  var i = 0,
    item, counter = 0,
    lel = [];
  for (i; i < items.length; i++) {
    if (this.id === 'action') {
      if (items[i].verb === 'create-work' || items[i].verb === 'like-work') {
        item = new APP.FeedWorkCreated(items[i], this.options);
      }
      if (items[i].verb === 'follow-user') {
        item = new APP.FeedUserFollow(items[i], this.options);
      }
    } else if (this.id === 'notificationItem') {
      if (items[i].verb === 'review-work') {
        item = new APP.NotificationReview(items[i], this.options);
      }
      if (items[i].verb === 'follow-user') {
        item = new APP.NotificationFollow(items[i], this.options);
      }
      if (items[i].verb === 'like-work') {
        item = new APP.NotificationLike(items[i], this.options);
      }
      if (items[i].verb === 'request-work') {
        item = new APP.NotificationRequest(items[i], this.options);
      }
      if (items[i].verb === 'denied-product') {
        item = new APP.NotificationDeniedProduct(items[i], this.options);
      }
      if (items[i].verb === 'accepted-product') {
        item = new APP.NotificationAcceptedProduct(items[i], this.options);
      }

    } else {
      item = new APP[Utils.capitalize(this.id)](items[i], this.options);
    }
    if (item.view.children().hasClass("work-card")) {
      var $items = item.view;
      $items.attr('id', item.data.id);
      $items.hide();
      this.container.append($items);
      lel.push(item.data.id);
      var scope = this.container;
      $items.imagesLoaded().progress(function(imgLoad, image) {
        ++counter;
        $(image.img).parents('.grid-item');
        if (counter === items.length) {
          var timeout = setTimeout(function() {
            clearTimeout(timeout);
            for (i = 0; i < lel.length; i++) {
              var it = $('#' + lel[i]);
              it.show();
              scope.masonry('appended', it);
              scope.masonry();
              if (scopetemp.navigationManager)
                scopetemp.navigationManager.navigator.restart();
              scope.parent().find('.loading').hide();
            }
          }, 1000);
        }
      });
    } else {
      if (this.id === 'carrouselItem' || this.id === 'action' || this.id === 'notificationItem' || this.id === 'post' || this.id === 'postMinimal' || this.id === 'tableUser' || this.id === 'tableWork' || this.id === 'tableProductApplying') {
        this.container.append(item.view);
      } else {
        this.container.append(item.view).masonry('appended', item.view);
        this.container.masonry();
      }
      if (scopetemp.navigationManager) {
        scopetemp.navigationManager.navigator.restart();
      }
      this.container.parent().find('.loading').hide();
    }
  }
};

APP.Viewer.prototype.reset = function() {
  this.clean();
  this.navigationManager.navigator.reset();
};

APP.Viewer.prototype.clean = function() {
  if (this.id === 'carrouselItem' || this.id === 'action' || this.id === 'notificationItem' || this.id === 'post' || this.id === 'postMinimal' || this.id === 'tableUser' || this.id === 'tableWork' || this.id === 'tableProductApplying') {
    this.container.empty();
  } else {
    this.container.masonry('remove', this.container.find('.grid-item')).masonry();
  }
  this.initialize = false;
};

APP.Viewer.prototype.suspend = function() {
  this.navigationManager.navigator.suspend();
  this.navigationManager.navigator.removeEventListener(Events.LOAD_START, this.pageStart);
  this.navigationManager.navigator.removeEventListener(Events.LOAD_END, this.pageEnd);
};

APP.Viewer.prototype.restart = function() {
  this.navigationManager.navigator.addEventListener(Events.LOAD_START, this.pageStart);
  this.navigationManager.navigator.addEventListener(Events.LOAD_END, this.pageEnd);
  this.navigationManager.navigator.restart();
  this.container.masonry();
};
/**
 *Author : www.juliocanares.com/cv
 *Email : juliocanares@gmail.com
 */
var APP = APP || {};

APP.WorkScreen = function() {
  APP.BaseScreen.call(this, 'work');

  this.currentItem = this.oldItem;
  this.currentSection, this.oldSection;
  this.collections = [];
  this.idCollections = [];

  this.following = false;
};

APP.WorkScreen.constructor = APP.WorkScreen;
APP.WorkScreen.prototype = Object.create(APP.BaseScreen.prototype);

APP.WorkScreen.prototype.setupUI = function() {
  new APP.Viewer('carrouselItem', $('.more'), null, more);
  new APP.Viewer('carrouselItem', $('.similar'), null, similar);

  new APP.Carrousel($('.js-more-carousel'), $('.more'));
  new APP.Carrousel($('.js-similar-carousel'), $('.similar'));

  new APP.PhotoSwipe('work');

  this.reviewsContainer = $('.reviews-items-container');
  for (var i = 0; i < reviews.length; i++)
    this.reviewsContainer.append(new APP.Review(reviews[i]).view);

  this.shareFb = $('.share-fb');
  this.askBtn = $('.ask-availability');
  this.loginReview = $('.login-review');
  this.askRequester = $('.ask-requester');
  this.thanksRequester = $('.thanks-requester');
  this.likeBtn = $('.like-btn');
  this.afterLike = $('.after-like');
  this.saveBtn = $('.save-collections');
  this.saveBtnLoading = $('.save-collections-loading');
  this.followBtn = $('.am-Follow-button');
  this.collectionsContainer = $('.collections');
  this.collectionForm = $('.add-collection-form');
  this.reviewForm = $('.review-form');
  this.reviewContainer = $('.reviews-items-container');

  this.prevBtn = $('.prev-btn');
  this.nextBtn = $('.next-btn');

  new Clipboard('.copy', {
    text: this.copyHandler.bind(this)
  });
}

APP.WorkScreen.prototype.listeners = function() {
  APP.BaseScreen.prototype.listeners.call(this);
  this.shareFb.click(this.shareFBHandler.bind(this));

  $('.menu-item').click(this.menuItemHandler.bind(this));
  $('.menu-item[data-name=' + currentPath + ']').click();

  this.askBtn.click(this.askAvailabilityHandler.bind(this));
  this.loginReview.click(this.loginReviewHandler.bind(this));
  this.saveBtn.click(this.saveClickHandler.bind(this));

  if (DataApp.currentUser) {
    var collectionsUrl = DataApp.currentUser.url + '/collection/all';
    this.requestHandler(collectionsUrl, {
      meta: 'works'
    }, this.collectionsHandlerComplete);
    if (!owner) {
      var followingUrl = DataApp.currentUser.url + '/isFollowing';
      this.requestHandler(followingUrl, {
        idUser: work.User.id
      }, this.isFollowingComplete);
    }
  }

  this.likeBtn.click(this.likeBtnHandler.bind(this));

  this.followBtn.click(this.followHandler.bind(this));
  this.collectionForm.submit(this.collectionFormHandler.bind(this));
  this.reviewForm.submit(this.reviewFormHandler.bind(this));

  $(document).bind('keyup', this.documentKeyupHandler.bind(this));
};

APP.WorkScreen.prototype.documentKeyupHandler = function(event) {
  if (event.keyCode === 39 && this.prevBtn.length > 0)
    window.location.href = this.prevBtn.attr('href');

  if (event.keyCode === 37 && this.nextBtn.length > 0)
    window.location.href = this.nextBtn.attr('href');
};

APP.WorkScreen.prototype.copyHandler = function(trigger) {
  $('#lean_overlay').trigger("click");
  this.showFlash('succes', 'Link Copiado');
  return window.location.href;
};

APP.WorkScreen.prototype.reviewFormHandler = function(event) {
  event.preventDefault();
  var url = DataApp.currentUser.url + '/work/review/create';
  this.requestHandler(url, $(event.target).serialize(), this.reviewComplete);
};

APP.WorkScreen.prototype.reviewComplete = function(response) {
  $('.value-input').val('');
  this.reviewContainer.append(new APP.Review(response.data.review).view);
}


APP.WorkScreen.prototype.followHandler = function() {
  Utils.checkAuthentication();
  var url = DataApp.currentUser.url + (this.isFollowing ? '/unfollow/' : '/follow/');
  this.requestHandler(url, {
    idUser: work.User.id
  }, this.followComplete);
};

APP.WorkScreen.prototype.followComplete = function(response) {
  console.log(response);
  if (this.isFollowing) {
    this.followBtn.removeClass('following').text('+ SEGUIR');
  } else {
    this.followBtn.addClass('following').text('Siguiendo');
  }

  this.isFollowing = !this.isFollowing;
}

APP.WorkScreen.prototype.isFollowingComplete = function(response) {
  this.isFollowing = response.data.following;
  this.isFollowing && this.followBtn.addClass('following').text('Siguiendo');
}

APP.WorkScreen.prototype.saveClickHandler = function() {
  this.saveBtn.hide();
  this.saveBtnLoading.show();

  var url = DataApp.currentUser.url + '/work/add_to_collection';
  var payload = {
    collections: JSON.stringify(this.idCollections),
    idWork: work.id
  };
  this.requestHandler(url, payload, this.saveRequestComplete);
};

APP.WorkScreen.prototype.saveRequestComplete = function() {
  this.saveBtn.show();
  this.saveBtnLoading.hide();
  this.showFlash('succes', 'Su actualizo tus colecciones');

  $('#lean_overlay').trigger('click');
};


APP.WorkScreen.prototype.collectionFormHandler = function(event) {
  event.preventDefault();
  var url = DataApp.currentUser.url + '/collection/create';
  this.requestHandler(url, $(event.target).serialize(), this.collectionFormComplete);
};

APP.WorkScreen.prototype.collectionFormComplete = function(response) {
  var item = new APP.CollectionItem(response.data.collection);
  item.addEventListener(Events.COLLECTION_ITEM_SELECTED, this.collectionItemSelected.bind(this));
  this.collections.push(item);
  this.collectionsContainer.append(item.view);
};


APP.WorkScreen.prototype.likeBtnHandler = function() {
  Utils.checkAuthentication();
  if (!work.liked) {
    var url = DataApp.currentUser.url + '/work/like';
    this.requestHandler(url, {
      idWork: work.id
    }, this.likeComplete);
  }
};

APP.WorkScreen.prototype.likeComplete = function(response) {
  console.log(response);
  work.liked = !work.liked;
  $('.likes').text(response.data.likes);
  this.likeBtn.parent().addClass('active');
  this.afterLike.show();
};

APP.WorkScreen.prototype.collectionsHandlerComplete = function(response) {
  var collections = response.data.collections;
  var i, item;
  for (i = 0; i < collections.length; i++) {
    item = new APP.CollectionItem(collections[i]);
    this.collections.push(item);
    item.addEventListener(Events.COLLECTION_ITEM_SELECTED, this.collectionItemSelected.bind(this));
    this.collectionsContainer.append(item.view);
  }

  var url = DataApp.currentUser.url + '/work/inside_collection';
  this.requestHandler(url, {
    idWork: work.id
  }, this.insideCollectionHandler);
};

APP.WorkScreen.prototype.insideCollectionHandler = function(response) {
  var collections = response.data.collections;
  var i, j;
  for (i = 0; i < this.collections.length; i++)
    this.collections[i].view.removeClass('selected');

  this.idCollections = [];
  for (i = 0; i < collections.length; i++) {
    for (j = 0; j < this.collections.length; j++) {
      if (collections[i].id === this.collections[j].data.id) {
        this.idCollections.push(collections[i].id);
        this.collections[j].view.addClass('selected');
      }
    }
  }
};

APP.WorkScreen.prototype.collectionItemSelected = function(event) {
  var item = event.target;
  var index = this.idCollections.indexOf(item.data.id);
  if (index === -1)
    this.idCollections.push(item.data.id);
  else
    this.idCollections.splice(index, 1);
};

APP.WorkScreen.prototype.askAvailabilityHandler = function(event) {
  Utils.checkAuthentication();
  var url = DataApp.currentUser.url + '/work/availability';
  this.requestHandler(url, {
    idWork: work.id
  }, this.askAvailabilityComplete);
};

APP.WorkScreen.prototype.loginReviewHandler = function() {
  Utils.checkAuthentication();
};

APP.WorkScreen.prototype.askAvailabilityComplete = function(response) {
  this.askRequester.hide();
  this.thanksRequester.show();
};

APP.WorkScreen.prototype.menuItemHandler = function(event) {
  this.currentItem = $(event.currentTarget);
  var path = this.currentItem.data('name');
  this.currentSection = $('.' + path + '-container');
  this.currentSection.show();
  var url = '/user/' + work.User.username + '/work/' + work.nameSlugify +
    '/' + (path === 'index' ? '' : path);

  $('.menu-item').removeClass('selected');
  this.currentItem.addClass('selected');

  this.oldSection && this.oldSection.hide();
  this.oldSection = this.currentSection;
  Utils.changeUrl(DataApp.baseTitle + Utils.capitalize(path), url);
};

APP.WorkScreen.prototype.shareFBHandler = function() {
  Utils.shareFBWork(work);
};
/**
 * @author www.juliocanares.com/cv
 * @email juliocanares@gmail.com
 */
Utils = {
  isMobile: {
    Android: function() {
      return navigator.userAgent.match(/Android/i);
    },
    BlackBerry: function() {
      return navigator.userAgent.match(/BlackBerry/i);
    },
    iOS: function() {
      return navigator.userAgent.match(/iPhone|iPad|iPod/i);
    },
    Opera: function() {
      return navigator.userAgent.match(/Opera Mini/i);
    },
    Windows: function() {
      return navigator.userAgent.match(/IEMobile/i);
    },
    any: function() {
      return (Utils.isMobile.Android() || Utils.isMobile.BlackBerry() ||
        Utils.isMobile.iOS() || Utils.isMobile.Opera() || Utils.isMobile.Windows());
    }
  },
  paginationButtons: function(currentPage, totalPages, maxButtons) {
    var i, result = [1],
      middle = Math.floor(maxButtons / 2);

    if (currentPage > totalPages)
      return null;

    if (totalPages < maxButtons) {
      for (i = 2; i < totalPages + 1; i++)
        result.push(i);
      return result;
    }

    if (currentPage <= middle && currentPage > 0)
      for (i = 2; i < maxButtons; i++)
        result.push(i);

    var maxLimit = (totalPages - middle);

    if (currentPage > middle && currentPage < maxLimit) {
      var steps = ((maxButtons - 3) / 2);
      for (i = currentPage - steps; i < currentPage + steps + 1; i++)
        result.push(i);
    }

    if (currentPage >= maxLimit && currentPage <= totalPages) {
      for (i = (totalPages - (maxButtons - 2)); i < totalPages; i++)
        result.push(i);
    }

    result.push(totalPages);
    return result;
  },
  getUrlParameter: function(sParam) {
    var sPageURL = window.location.search.substring(1)
    var sURLVariables = sPageURL.split('&')
    for (var i = 0; i < sURLVariables.length; i++) {
      var sParameterName = sURLVariables[i].split('=')
      if (sParameterName[0] == sParam)
        return sParameterName[1]
    }
  },
  capitalize: function(text) {
    return text.charAt(0).toUpperCase() + text.substring(1);
  },
  getData: function(params) {
    return APP.RestClientManager.instance.execute(params);
  },
  changeUrl: function(page, url) {
    DataApp.currentUrl = url;
    if (typeof(history.pushState) != 'undefined') {
      var tempUrl = {
        page: page,
        url: url
      };
      // history.pushState(tempUrl, tempUrl.page, tempUrl.url);
      history.replaceState(tempUrl, tempUrl.page, tempUrl.url);
    } else {
      window.location.href = "/";
    }
  },
  addImageFilter: function(url, filter) {
    return url.replace('upload/', 'upload/' + filter + '/');
  },
  checkAuthentication: function() {
    if (!DataApp.currentUser) {
      if (window.location.href.indexOf('auth') === -1)
        Cookies.set('return_to', window.location.href, {
          maxAge: 3600000,
          domain: '.' + document.domain
        });

      window.location.href = DataApp.loginUrl;
    }
  },
  share: {
    facebook: function(options, complete) {
      options.method = 'feed';
      window.FB && FB.ui(options, complete);
    }
  },
  shareFBWork: function(work) {
    $('#lean_overlay').trigger("click");
    Utils.share.facebook({
      link: DataApp.baseUrl + 'user/' + work.User.username + '/work/' + work.nameSlugify,
      picture: Utils.addImageFilter(work.photo, 'w_1200,h_630,q_60,c_crop'),
      name: work.name,
      caption: 'Arte Manifiesto',
      description: work.description
    });
  },
  shareTWWork: function(work) {
    var link = DataApp.baseUrl + 'user/' + work.User.username + '/work/' + work.nameSlugify;
    var text = encodeURIComponent(work.name + ' vía (@artemanifiesto)');
    var url = "https://twitter.com/intent/tweet?text=" + text;
    url += "&url=" + encodeURIComponent(link);
    window.open(url, "_blank", "height=300,width=550,resizable=1");
  },
  shareFBPost: function(post) {
    Utils.share.facebook({
      link: DataApp.baseUrl + 'blog/post/' + post.nameSlugify,
      picture: Utils.addImageFilter(post.photo, 'w_1200,h_630,q_60,c_crop'),
      name: post.name,
      caption: 'Arte Manifiesto | Blog',
      description: post.description
    });
  },
  shareTWPost: function(post) {
    var link = DataApp.baseUrl + 'blog/post/' + post.nameSlugify;
    var text = encodeURIComponent(post.name + ' vía (@artemanifiesto)');
    var url = "https://twitter.com/intent/tweet?text=" + text;
    url += "&url=" + encodeURIComponent(link);
    window.open(url, "_blank", "height=300,width=550,resizable=1");
  },
  removeURLParameter: function(url, parameter) {
    var urlparts = url.split('?');
    if (urlparts.length >= 2) {
      var prefix = encodeURIComponent(parameter) + '=';
      var pars = urlparts[1].split(/[&;]/g);

      for (var i = pars.length; i-- > 0;) {
        if (pars[i].lastIndexOf(prefix, 0) !== -1) {
          pars.splice(i, 1);
        }
      }

      url = urlparts[0] + '?' + pars.join('&');
      return url;
    } else {
      return url;
    }
  },
  updateQueryStringParameter: function(uri, key, value) {
    var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
    var separator = uri.indexOf('?') !== -1 ? "&" : "?";
    if (uri.match(re)) {
      return uri.replace(re, '$1' + key + "=" + value + '$2');
    } else {
      return uri + separator + key + "=" + value;
    }
  }
};
>>>>>>> ecommerce
