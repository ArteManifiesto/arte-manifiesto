var APP=APP||{};APP.AM=function(){this.setupData(),this.setupUI(),this.listeners()},APP.AM.constructor=APP.AM,APP.AM.prototype.setupData=function(){new APP.RestClientManager,new APP.TemplateManager,$("."+path+"-menu").addClass("selected"),DataApp.currentUser=user||null,null!==DataApp.currentUser&&(DataApp.currentUser.url="/user/"+DataApp.currentUser.username);var e,t;errorMessage.length>0&&(e=$(".error"),t=errorMessage[0]),successMessage.length>0&&(e=$(".succes"),t=successMessage[0]),e&&(e.find(".content-text").text(t),e.addClass("fadeIn"))},APP.AM.prototype.setupUI=function(){this.signInBtn=$(".am-Signin-button"),this.closeFlashBtn=$(".close-flash"),this.flashMessage=$(".flash-message"),this.closeModalBtn=$(".closed-modal"),this.generalSearch=$(".general-search"),this.generalSearchBtn=$(".search-general-btn"),this.generalSearchOptions=$(".general-search-options"),this.subscriptionForm=$(".subscription-form"),this.subscriptionBtn=$(".subscription-btn"),this.body=$(".body"),this.searchBox=$(".search-box"),this.headerBars=$(".am-header-mobile .bars"),this.headerAvatar=$(".am-header-mobile .avatar"),this.headerCover=$(".body-inner .cover"),this.worksOption=this.generalSearchOptions.find(".works-option"),this.usersOption=this.generalSearchOptions.find(".users-option"),this.collectionsOption=this.generalSearchOptions.find(".collections-option"),this.emailSubscription=this.subscriptionForm.find("input[name=email]")},APP.AM.prototype.listeners=function(){this.generalSearch.focus(this.searchFocusHandler.bind(this)),this.generalSearch.blur(this.searchBlurHandler.bind(this)),this.generalSearch.keyup(this.searchKeyUpHandler.bind(this)),this.generalSearchBtn.click(this.generalSearchBtnClickHandler.bind(this)),this.subscriptionForm.submit(this.subscriptionFormHandler.bind(this)),this.subscriptionBtn.click(this.subscriptionHandler.bind(this)),this.signInBtn.click(this.signInHandler),this.closeFlashBtn.click(this.closeFlashHandler.bind(this)),this.headerBars.click(this.headerBarsHandler.bind(this)),this.headerAvatar.click(this.headerAvatarHandler.bind(this)),this.headerCover.click(this.headerCoverHandler.bind(this)),this.closeModalBtn.click(this.closeModal.bind(this)),this.searchBox.submit(this.searchBoxHandler.bind(this)),$(document).keyup(this.escapeHandler.bind(this))},APP.AM.prototype.headerCoverHandler=function(e){this.body.removeClass("open-right"),this.body.removeClass("open-left")},APP.AM.prototype.headerAvatarHandler=function(e){e.preventDefault(),this.body.removeClass("open-left"),this.body.toggleClass("open-right")},APP.AM.prototype.headerBarsHandler=function(e){e.preventDefault(),this.body.removeClass("open-right"),this.body.toggleClass("open-left")},APP.AM.prototype.searchBoxHandler=function(e){e.preventDefault(),window.location.href=DataApp.discoverWorks+"?term="+$(".search-box-value").val()},APP.AM.prototype.escapeHandler=function(e){27==e.keyCode&&this.closeModal()},APP.AM.prototype.closeModal=function(){$("#lean_overlay").trigger("click")},APP.AM.prototype.signInHandler=function(e){e.preventDefault(),Utils.checkAuthentication()},APP.AM.prototype.closeFlashHandler=function(e){e.preventDefault(),this.flashMessage.css("visibility","hidden")},APP.AM.prototype.subscriptionHandler=function(e){e.preventDefault(),this.subscriptionForm.submit()},APP.AM.prototype.subscriptionFormHandler=function(e){e.preventDefault();var t=[],s=this.emailSubscription.val();return Validations.notBlank(s)&&t.push("Ingrese un correo"),Validations.email(s)||t.push("Formato de correo no valido"),t.length>0?APP.BaseScreen.prototype.showFlash.call(this,"error",t):void $.post("/subscribe",{email:s}).then(this.subscriptionComplete.bind(this))},APP.AM.prototype.subscriptionComplete=function(e){e.data.created?APP.BaseScreen.prototype.showFlash.call(this,"succes","Suscripcion exitosa"):APP.BaseScreen.prototype.showFlash.call(this,"error",["Ya estas Suscrito"])},APP.AM.prototype.searchFocusHandler=function(e){this.generalSearchOptions.show()},APP.AM.prototype.searchBlurHandler=function(e){var t=this,s=setTimeout(function(){clearTimeout(s),t.generalSearchOptions.hide()},200)},APP.AM.prototype.generalSearchBtnClickHandler=function(e){var t=this.getBaseUrl();window.location.href="/works/category"+t},APP.AM.prototype.searchKeyUpHandler=function(e){var t=this.generalSearch.val();this.generalSearchOptions.show(),this.worksOption.text(t),this.usersOption.text(t),this.collectionsOption.text(t);var s=this.getBaseUrl();this.worksOption.parent().attr("href","/works/category"+s),this.usersOption.parent().attr("href","/users/specialty"+s),this.collectionsOption.parent().attr("href","/collections/category"+s)},APP.AM.prototype.getBaseUrl=function(){var e="/all/page-1",t=this.generalSearch.val();return t.length>0&&(e+="?term="+encodeURIComponent(t)),e};
var APP=APP||{};APP.BaseElement=function(e,t,a){this.options=a||{context:"normal"},this.template=APP.TemplateManager.instance.getFromDoc(t),this.data=e,this.id=t;var s={addFilter:Utils.addImageFilter,formatDate:function(e){return moment(e).fromNow()},viewer:DataApp.currentUser};_.extend(this.data,this.options),_.extend(this.data,s),this.view=$(this.template(this.data)),this.rawView=this.view[0],this.listeners()},APP.BaseElement.prototype=Object.create(EventDispatcher.prototype),APP.BaseElement.constructor=APP.BaseElement,APP.BaseElement.prototype.listeners=function(){this.featuredBtn=this.view.find(".featured"),this.featuredBtn.click(this.featuredHandler.bind(this))},APP.BaseElement.prototype.featuredHandler=function(){var e,t=this.id;"table-work"===this.id&&(t="work"),"table-user"===this.id&&(t="user"),e=this.data.featured?"user"===t?"/user/"+this.data.username+"/unfeatured":"/user/"+this.data.User.username+"/"+t+"/unfeatured":"user"===t?"/user/"+this.data.username+"/featured":"/user/"+this.data.User.username+"/"+t+"/featured";var a=this,s={};s["id"+Utils.capitalize(t)]=this.data.id,$.post(e,s,function(e){200===e.status&&(e.data[t].featured?a.id.indexOf("table")>-1?a.featuredBtn.removeClass("btn-default").addClass("btn-primary"):a.featuredBtn.removeClass("disabled"):a.id.indexOf("table")>-1?a.featuredBtn.removeClass("btn-primary").addClass("btn-default"):a.featuredBtn.addClass("disabled"),a.data.featured=e.data[t].featured)})},APP.BaseElement.prototype.callToApi=function(e){return APP.RestClientManager.instance.execute(e)},APP.BaseElement.prototype.isLogged=function(){return Utils.checkAuthentication(),null!==DataApp.currentUser};
var APP=APP||{};APP.BaseScreen=function(e){this.id=e,this.setupUI(),this.listeners()},APP.BaseScreen.prototype=Object.create(Object.prototype),APP.BaseScreen.constructor=APP.BaseScreen,APP.BaseScreen.prototype.setupUI=function(){},APP.BaseScreen.prototype.listeners=function(){},APP.BaseScreen.prototype.requestHandler=function(e,t,s,o,r){!r&&Utils.checkAuthentication(),$.post(e,t).then(this.requestComplete.bind(this,s,o))},APP.BaseScreen.prototype.requestComplete=function(e,t,s){if(200!==s.status){var o=s.data.errors||["Algo sucedió mal"];return t&&t.bind(this)(),this.showFlash("error",o)}e.bind(this)(s)},APP.BaseScreen.prototype.showFlash=function(e,t){var s=$("."+e);$(".flash-message").css("visibility","hidden");var o=s.find(".content-text");if(o.empty(),"error"===e)for(var r=0;r<t.length;r++)o.append($("<p>").text("✘ "+t[r]));else o.text(t);s.css("visibility","visible"),s.removeClass("fadeIn");var n=setTimeout(function(){clearTimeout(n),s.addClass("fadeIn")},100)},APP.BaseScreen.prototype.getTemplate=function(e){var t="";return-1!==["followings","followers"].indexOf(e)&&(t="user"),"portfolio"===e&&(t="work"),"store"===e&&(t="product"),"collections"===e&&(t="collection"),t},APP.BaseScreen.prototype.clean=function(){};
var DataApp={};DataApp.currentUser=null,DataApp.baseUrl=window.location.origin+"/",DataApp.baseTitle="Arte Manifiesto | ",DataApp.loginUrl=DataApp.baseUrl+"auth/login",DataApp.discoverWorks=DataApp.baseUrl+"works/category/all/page-1/",DataApp.discoverUsers=DataApp.baseUrl+"users/specialties/all/page-1/",DataApp.discoverProducts=DataApp.baseUrl+"products/type/all/page-1/",DataApp.searchCollections=DataApp.baseUrl+"artjam/collections/page-1",DataApp.currentUrl=window.location.href.replace(/\/$/g,""),DataApp.currentUrl=DataApp.currentUrl.replace(/#_=_$/g,""),DataApp.fbAppID="1473636902857068";var Events={};Events.LOAD_START="loadStart",Events.LOAD_END="loadEnd",Events.COLLECTION_ITEM_SELECTED="collectionItemSelected",Events.ADD_COLLECTION="addCollection",Events.SHARE="share",Events.FILTER_CHANGED="filterChanged",Events.CREATOR_READY="creatorReady";var Validations={notBlank:function(a){return a?""===a.replace(/^\s+/g,"").replace(/\s+$/g,""):!0},username:function(a){var e=new RegExp(/^[a-zA-Z0-9]+$/);return e.test(a)},email:function(a){var e=new RegExp(/^\w+@\w+\.\w{2,3}$/);return e.test(a)}};
var APP=APP||{};APP.Carrousel=function(t,i){this.view=t,this.container=i,this.nextBtn=this.view.find(".nextButton"),this.prevBtn=this.view.find(".prevButton"),this.carrousel=this.view.find(".more-images"),this.setup()},APP.Carrousel.constructor=APP.Carrousel,APP.Carrousel.prototype.checkArrows=function(){clearTimeout(this.timeout),this.container[0].scrollWidth>this.container.innerWidth()?(this.nextBtn.show(),this.prevBtn.show()):(this.nextBtn.hide(),this.prevBtn.hide()),this.animationComplete()},APP.Carrousel.prototype.setup=function(){this.nextBtn.click(this.nextHandler.bind(this)),this.prevBtn.click(this.prevHandler.bind(this)),this.carrousel.scroll(this.animationComplete.bind(this)),$(window).resize(this.checkArrows.bind(this)),this.timeout=setTimeout(this.checkArrows.bind(this),1e3)},APP.Carrousel.prototype.nextHandler=function(){this.carrousel.animate({scrollLeft:this.carrousel.scrollLeft()+230},400,this.animationComplete.bind(this))},APP.Carrousel.prototype.prevHandler=function(){this.carrousel.animate({scrollLeft:this.carrousel.scrollLeft()-230},400,this.animationComplete.bind(this))},APP.Carrousel.prototype.animationComplete=function(){this.carrousel.scrollLeft()<=0?this.prevBtn.hide():this.prevBtn.show();var t=this.carrousel.scrollLeft()+this.carrousel.innerWidth();t>=this.carrousel[0].scrollWidth?this.nextBtn.hide():this.nextBtn.show()};
var APP=APP||{};APP.CarrouselItem=function(e,t){APP.BaseElement.call(this,e,"carrousel-item",t)},APP.CarrouselItem.prototype=Object.create(APP.BaseElement.prototype),APP.CarrouselItem.constructor=APP.CarrouselItem;
var APP=APP||{};APP.Collection=function(o,t){APP.BaseElement.call(this,o,"collection",t)},APP.Collection.prototype=Object.create(APP.BaseElement.prototype),APP.Collection.constructor=APP.Collection;
var APP=APP||{};APP.CollectionItem=function(t,e){APP.BaseElement.call(this,t,"collection-item",e)},APP.CollectionItem.prototype=Object.create(APP.BaseElement.prototype),APP.CollectionItem.constructor=APP.CollectionItem,APP.CollectionItem.prototype.listeners=function(){this.view.click(this.clickViewHandler.bind(this))},APP.CollectionItem.prototype.clickViewHandler=function(){this.view.toggleClass("selected"),this.dispatchEvent({type:Events.COLLECTION_ITEM_SELECTED})};
var APP=APP||{};APP.FeedUserFollow=function(e,l){var o=e.element.friends;o.length>0?e.element.currentFriend=o[_.random(0,o.length-1)]:e.element.currentFriend=null,APP.BaseElement.call(this,e,"feed-user-follow",l)},APP.FeedUserFollow.prototype=Object.create(APP.BaseElement.prototype),APP.FeedUserFollow.constructor=APP.FeedUserFollow,APP.FeedUserFollow.prototype.listeners=function(){this.followBtn=this.view.find(".am-Follow-button"),this.followBtn.click(this.followClickHandler.bind(this))},APP.FeedUserFollow.prototype.followClickHandler=function(){var e=this;if(this.data.element.following){var l=DataApp.currentUser.url+"/unfollow/";$.post(l,{idUser:this.data.element.id},function(l){200===l.status&&(e.data.element.following=!1,$(".am-Follow-button").removeClass("following").text("+Seguir"))})}else{var l=DataApp.currentUser.url+"/follow/";$.post(l,{idUser:this.data.element.id},function(l){200===l.status&&(e.data.element.following=!0,$(".am-Follow-button").addClass("following").text("Siguiendo"))})}console.log("following")};
var APP=APP||{};APP.FeedWorkCreated=function(e,t){APP.BaseElement.call(this,e,"feed-work-created",t)},APP.FeedWorkCreated.prototype=Object.create(APP.BaseElement.prototype),APP.FeedWorkCreated.constructor=APP.FeedWorkCreated,APP.FeedWorkCreated.prototype.listeners=function(){this.addCollectionBtn=this.view.find(".add-collection"),this.likeBtn=this.view.find(".like"),this.shareBtn=this.view.find(".share"),this.afterLike=this.view.find(".after-like"),this.followBtn=this.view.find(".am-Follow-button"),this.data.element.User.following&&this.followBtn.addClass("following").text("Siguiendo"),this.addCollectionBtn.click(this.addCollectionHandler.bind(this)),this.likeBtn.click(this.likeHandler.bind(this)),this.shareBtn.click(this.shareHandler.bind(this)),this.followBtn.click(this.followHandler.bind(this))},APP.FeedWorkCreated.prototype.addCollectionHandler=function(){$("#go-collection-modal").click(),Broadcaster.dispatchEvent(Events.ADD_COLLECTION,{data:{work:this.data.element}})},APP.FeedWorkCreated.prototype.likeHandler=function(){if(!this.likeBtn.hasClass("active")){var e=DataApp.currentUser.url+"/work/like",t=this;$.post(e,{idWork:this.data.element.id},function(e){200===e.status&&(t.likeBtn.addClass("active"),t.afterLike.show())})}},APP.FeedWorkCreated.prototype.shareHandler=function(){$("#go-share-modal").click(),Broadcaster.dispatchEvent(Events.SHARE,{data:{work:this.data.element}})},APP.FeedWorkCreated.prototype.followHandler=function(){var e=this;if(this.data.element.User.following){var t=DataApp.currentUser.url+"/unfollow/";$.post(t,{idUser:this.data.element.User.id},function(t){200===t.status&&(e.data.element.User.following=!1,$(".am-Follow-button").removeClass("following").text("+Seguir"))})}else{var t=DataApp.currentUser.url+"/follow/";$.post(t,{idUser:this.data.element.User.id},function(t){200===t.status&&(e.data.element.User.following=!0,$(".am-Follow-button").addClass("following").text("Siguiendo"))})}};
var APP=APP||{};APP.NotificationFollow=function(o,t){APP.BaseElement.call(this,o,"notification-follow",t)},APP.NotificationFollow.prototype=Object.create(APP.BaseElement.prototype),APP.NotificationFollow.constructor=APP.NotificationFollow;
var APP=APP||{};APP.NotificationLike=function(i,t){APP.BaseElement.call(this,i,"notification-like",t)},APP.NotificationLike.prototype=Object.create(APP.BaseElement.prototype),APP.NotificationLike.constructor=APP.NotificationLike;
var APP=APP||{};APP.NotificationRequest=function(t,e){APP.BaseElement.call(this,t,"notification-request",e)},APP.NotificationRequest.prototype=Object.create(APP.BaseElement.prototype),APP.NotificationRequest.constructor=APP.NotificationRequest;
var APP=APP||{};APP.NotificationReview=function(i,t){APP.BaseElement.call(this,i,"notification-review",t)},APP.NotificationReview.prototype=Object.create(APP.BaseElement.prototype),APP.NotificationReview.constructor=APP.NotificationReview;
var APP=APP||{};APP.PhotoSwipe=function(){this.filter="w_1500,h_800,c_limit,q_80",this.isLoading=!1,this.zoom=!1,this.meta=null,this.setupUI(),this.listeners()},APP.PhotoSwipe.constructor=APP.PhotoSwipe,APP.PhotoSwipe.prototype.setupUI=function(){this.image=$("#work-image"),this.pswp=$(".pswp")[0],this.modal=$("#go-preload-modal")},APP.PhotoSwipe.prototype.listeners=function(){this.image.click(this.imageHandler.bind(this))},APP.PhotoSwipe.prototype.imageHandler=function(){if(this.zoom)this.isLoading&&this.modal.click();else{this.modal.click(),this.isLoading=!0;var i=Utils.addImageFilter(work.photo,this.filter),t=this;$("<img>").load(function(){t.imageLoadHandler(this)}).attr("src",i),this.zoom=!0}},APP.PhotoSwipe.prototype.imageLoadHandler=function(i){$("#lean_overlay").click(),this.isLoading=!1,this.meta={width:i.width,height:i.height},this.image.click(this.openPhotoSwipeHandler.bind(this)),this.image.click()},APP.PhotoSwipe.prototype.openPhotoSwipeHandler=function(){var i=[{src:Utils.addImageFilter(work.photo,this.filter),w:this.meta.width,h:this.meta.height}],t=this,o={getThumbBoundsFn:function(){return{x:t.image.offset.left,y:t.image.offset.top+50,w:t.image.width()}}};new PhotoSwipe(this.pswp,PhotoSwipeUI_Default,i,o).init()};
var APP=APP||{};APP.Post=function(P,t){APP.BaseElement.call(this,P,"post",t)},APP.Post.prototype=Object.create(APP.BaseElement.prototype),APP.Post.constructor=APP.Post;
var APP=APP||{};APP.PostMinimal=function(P,t){APP.BaseElement.call(this,P,"post-minimal",t)},APP.PostMinimal.prototype=Object.create(APP.BaseElement.prototype),APP.PostMinimal.constructor=APP.PostMinimal;
var APP=APP||{};APP.Product=function(t,e){APP.BaseElement.call(this,t,"product",e)},APP.Product.prototype=Object.create(APP.BaseElement.prototype),APP.Product.constructor=APP.Product,APP.Product.prototype.listeners=function(){APP.BaseElement.prototype.listeners.call(this),this.view.find(".delete").click(this.deleteHandler.bind(this)),this.view.find(".edit").click(this.editHandler.bind(this))},APP.Product.prototype.deleteHandler=function(){var t="/user/"+this.data.User.username+"/product/delete",e=this;$.post(t,{idProduct:this.data.id},function(t){200===t.status&&$(e.view.parent()).masonry("remove",e.view).masonry()})},APP.Product.prototype.editHandler=function(){location.href="/user/"+this.data.User.username+"/product/"+this.data.nameSlugify+"/edit"};
var APP=APP||{};APP.Review=function(e,P){APP.BaseElement.call(this,e,"review",P)},APP.Review.prototype=Object.create(APP.BaseElement.prototype),APP.Review.constructor=APP.Review;
var APP=APP||{};APP.TableBlog=function(e,P){APP.BaseElement.call(this,e,"table-blog",P)},APP.TableBlog.prototype=Object.create(APP.BaseElement.prototype),APP.TableBlog.constructor=APP.TableBlog;
var APP=APP||{};APP.TableUser=function(e,t){APP.BaseElement.call(this,e,"table-user",t)},APP.TableUser.prototype=Object.create(APP.BaseElement.prototype),APP.TableUser.constructor=APP.TableUser,APP.TableUser.prototype.listeners=function(){this.featuredBtn=this.view.find(".featured-btn"),this.featuredBtn.click(this.featuredHandler.bind(this))};
var APP=APP||{};APP.TableWork=function(e,t){APP.BaseElement.call(this,e,"table-work",t)},APP.TableWork.prototype=Object.create(APP.BaseElement.prototype),APP.TableWork.constructor=APP.TableWork,APP.TableWork.prototype.listeners=function(){this.featuredBtn=this.view.find(".featured-btn"),this.featuredBtn.click(this.featuredHandler.bind(this))};
var APP=APP||{};APP.UploaderImage=function(e,i,o){this.$view=e,this.photo=null,this.options=o||{uploader:$(".cloudinary-fileupload")},this.uploader=this.options.uploader,this.listeners(),this.onComplete=i},APP.UploaderImage.constructor=APP.UploaderImage,APP.UploaderImage.prototype.listeners=function(){var e=this;this.uploader.fileupload({start:function(i){e.$view.find(".upload").hide(),$(this).hide(),e.$view.find(".preload").removeClass("hide"),e.$view.find(".preload").show()},fail:function(i,o){e.$view.find(".upload").show(),$(this).show(),e.$view.find(".preload").hide()}}).off("cloudinarydone").on("cloudinarydone",function(i,o){if(console.log("data======>"),console.log(o),e.$view.find(".preload").hide(),e.$view.find(".preview").html(""),e.photo=o.result.url,e.onComplete)e.onComplete(o.result.public_id);else{var l=Utils.addImageFilter(o.result.url,"w_200,h_200,c_thumb");this.$view.find(".preview").append($("<img>",{src:l}))}})};
var APP=APP||{};APP.User=function(t,o){APP.BaseElement.call(this,t,"user",o)},APP.User.prototype=Object.create(APP.BaseElement.prototype),APP.User.constructor=APP.User,APP.User.prototype.listeners=function(){APP.BaseElement.prototype.listeners.call(this),this.view.find(".am-Follow-button").click(this.followHandler.bind(this))},APP.User.prototype.followHandler=function(){if(this.isLogged()){var t=this.data.following?"unfollow":"follow",o={url:DataApp.currentUser.url+"/"+t,data:{idUser:this.data.id}};Utils.getData(o).then(this.followHandlerComplete.bind(this))}},APP.User.prototype.followHandlerComplete=function(t){200===t.status&&(this.data.following?this.view.find(".am-Follow-button").removeClass("following").text("+Seguir"):this.view.find(".am-Follow-button").addClass("following").text("Siguiendo"),this.data.following=!this.data.following)};
var APP=APP||{};APP.Work=function(e,t){APP.BaseElement.call(this,e,"work",t)},APP.Work.prototype=Object.create(APP.BaseElement.prototype),APP.Work.constructor=APP.Work,APP.Work.prototype.listeners=function(){APP.BaseElement.prototype.listeners.call(this),this.view.find(".delete").click(this.deleteHandler.bind(this)),this.view.find(".delete-force").click(this.deleteForceHandler.bind(this)),this.view.find(".cancel").click(this.cancelHandler.bind(this)),this.view.find(".edit").click(this.editHandler.bind(this))},APP.Work.prototype.deleteHandler=function(){this.view.find(".delete").hide(),this.view.find(".delete-confirm").show()},APP.Work.prototype.deleteForceHandler=function(){if("single-collection"===this.options.context){var e="/user/"+this.data.User.username+"/work/remove_from_collection",t=this;$.post(e,{idWork:this.data.id,idCollection:collection.id},function(e){200===e.status&&$(t.view.parent()).masonry("remove",t.view).masonry()})}else{var e="/user/"+this.data.User.username+"/work/delete",t=this;$.post(e,{idWork:this.data.id},function(e){200===e.status&&$(t.view.parent()).masonry("remove",t.view).masonry()})}},APP.Work.prototype.cancelHandler=function(){this.view.find(".delete").show(),this.view.find(".delete-confirm").hide()},APP.Work.prototype.editHandler=function(){location.href="/user/"+this.data.User.username+"/work/"+this.data.nameSlugify+"/edit"};
var APP=APP||{};APP.NavigationManager=function(a){switch(this.navigator,a){case APP.NavigationManager.PAGINATION:this.navigator=new APP.PaginationNavigation;break;case APP.NavigationManager.INFINITE:default:this.navigator=new APP.InfiniteNavigation}},APP.NavigationManager.INFINITE="infinite",APP.NavigationManager.PAGINATION="pagination",APP.NavigationManager.prototype=Object.create(Object.prototype),APP.NavigationManager.constructor=APP.NavigationManager;
var APP=APP||{};APP.RestClientManager=function(){APP.RestClientManager.instance=this},APP.RestClientManager.prototype=Object.create(Object.prototype),APP.RestClientManager.constructor=APP.RestClientManager,APP.RestClientManager.prototype.execute=function(e){return e.method=e.method||"post",$.ajax(e)};
var APP=APP||{};APP.TemplateManager=function(){APP.TemplateManager.instance=this,this.templates={}},APP.TemplateManager.prototype=Object.create(Object.prototype),APP.TemplateManager.constructor=APP.TemplateManager,APP.TemplateManager.prototype.loadTemplates=function(t){var e,a=this,p=[];for(e=0;e<t.length;e++)p.push($.get(DataApp.templatesUrl+t[e]+".html"));return $.when.apply(null,p).done(function(){if(t.length<=1)return a.templates[t[0]]=arguments[0];for(e=0;e<t.length;e++)a.templates[t[e]]=_.template(arguments[e][0])})},APP.TemplateManager.prototype.getFromDoc=function(t){return this.templates[t]?this.templates[t]:(this.templates[t]=_.template($("#template-"+t).html()),this.templates[t])};
var APP=APP||{};APP.BaseNavigation=function(){this.currentPage=0,this.totalPages=null,this.currentPageData,this.listeners(),this.needChangeUrl=!1},APP.BaseNavigation.constructor=APP.BaseNavigation,APP.BaseNavigation.prototype=Object.create(EventDispatcher.prototype),APP.BaseNavigation.prototype.start=function(){},APP.BaseNavigation.prototype.listeners=function(){},APP.BaseNavigation.prototype.suspend=function(){},APP.BaseNavigation.prototype.restart=function(){},APP.BaseNavigation.prototype.gotoPage=function(t,a){var e=t||this.currentPage+1;if(!a){if(this.currentPage===e)return;0===this.currentPage&&(this.currentPage=1)}this.totalPages&&e>this.totalPages||(this.dispatchEvent({type:Events.LOAD_START}),this.newPageUrl(e),Utils.getData({url:DataApp.currentUrl}).done(this.afterGetData.bind(this)))},APP.BaseNavigation.prototype.afterGetData=function(t){console.log(t),this.currentPage=t.pagination.page,this.totalPages=t.pagination.pages,this.currentPageData=t,this.dispatchEvent({type:Events.LOAD_END,data:t})},APP.BaseNavigation.prototype.newPageUrl=function(t){DataApp.currentUrl=DataApp.currentUrl.replace(/\/$/g,""),-1===DataApp.currentUrl.indexOf("/page-")&&(DataApp.currentUrl+="/page-"+this.currentPage),DataApp.currentUrl=DataApp.currentUrl.replace("page-"+this.currentPage,"page-"+t)},APP.BaseNavigation.prototype.reset=function(){this.currentPageData=null,this.gotoPage(1,!0),Utils.changeUrl("",DataApp.currentUrl)};
var APP=APP||{};APP.InfiniteNavigation=function(){APP.BaseNavigation.call(this),this.counter=0},APP.InfiniteNavigation.prototype=Object.create(APP.BaseNavigation.prototype),APP.InfiniteNavigation.constructor=APP.InfiniteNavigation,APP.InfiniteNavigation.prototype.listeners=function(){this.scrollHandler=this.scrollHandler.bind(this),$(window).on("scroll",this.scrollHandler)},APP.InfiniteNavigation.prototype.scrollHandler=function(){$(window).scrollTop()>=$(document).height()-$(window).height()-$(".am-Footer").height()&&(++this.counter,1===this.counter&&(this.suspend(),this.gotoPage(this.currentPage+1)))},APP.InfiniteNavigation.prototype.suspend=function(){$(window).off("scroll",this.scrollHandler)},APP.InfiniteNavigation.prototype.restart=function(){this.counter=0,$(window).on("scroll",this.scrollHandler)};
var APP=APP||{};APP.PaginationNavigation=function(){this.maxButtons=6,APP.BaseNavigation.call(this)},APP.PaginationNavigation.prototype=Object.create(APP.BaseNavigation.prototype),APP.PaginationNavigation.constructor=APP.PaginationNavigation,APP.PaginationNavigation.prototype.start=function(){this.makeButtons()},APP.PaginationNavigation.prototype.listeners=function(){$(document).on("click",".np-page-button",this.pagesHandler.bind(this))},APP.PaginationNavigation.prototype.pagesHandler=function(t){t.preventDefault();var a=$(t.currentTarget).attr("id");this.gotoPage(a)},APP.PaginationNavigation.prototype.build=function(){this.makeButtons()},APP.PaginationNavigation.prototype.makeButtons=function(){$(".am-Pagination").empty();var t=Utils.paginationButtons(this.currentPage,this.totalPages,this.maxButtons);if(t){var a=0;for(a;a<t.length;a++){var i=DataApp.currentUrl.replace("page-"+ +this.currentPage,"page-"+t[a]),n=$('<li style="display:inline-block;margin:10px;"><a class="np-page-button" href="'+i+'">'+t[a]+"</a></li>");$(".am-Pagination").append(n)}}};
var APP=APP||{};APP.AccountIndexScreen=function(){APP.BaseScreen.call(this,"accountIndex"),this.timeout=null,this.isUserAvailable=!0},APP.AccountIndexScreen.constructor=APP.AccountIndexScreen,APP.AccountIndexScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AccountIndexScreen.prototype.setupUI=function(){this.uploaderImage=new APP.UploaderImage($(".uploader-profile"),this.uploaderImageComplete),this.uploaderImage.photo=DataApp.currentUser.photo,this.save=$(".save"),this.saveLoading=$(".save-loading"),this.isArtist=$("input[name=isArtist]"),this.firstname=$("input[name=firstname]"),this.lastname=$("input[name=lastname]"),this.pseudonimo=$("input[name=pseudonimo]"),this.username=$("input[name=username]"),this.gender=$("select[name=gender]"),this.birthday=$("input[name=birthday]"),this.country=$("select[name=country]"),this.city=$("input[name=city]"),this.biography=$("textarea[name=biography]"),this.completeForm=$(".complete-form"),this.artistData=$(".artist-data"),this.gender.find("option:contains("+DataApp.currentUser.gender+")").attr("selected",!0),this.country.find("option:contains("+DataApp.currentUser.country+")").attr("selected",!0),this.typeName=$("select[name=typeName]");var e=DataApp.currentUser.isArtist?1:0;$("input[name=isArtist][value="+e+"]").attr("checked",!0);for(var t=0;t<interests.length;t++)$("input[type=checkbox][value="+interests[t].id+"]").attr("checked",!0);this.typeName.val(DataApp.currentUser.typeName),$("#date").mask("99/99/9999")},APP.AccountIndexScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.username.keyup(this.usernameKeyUpHandler.bind(this)),this.completeForm.submit(this.completeFormHandler.bind(this)),this.isArtist.change(this.isArtistHandler.bind(this))},APP.AccountIndexScreen.prototype.isArtistHandler=function(e){var t=parseInt($(e.target).val(),10);this.artistData[0===t?"hide":"show"]()},APP.AccountIndexScreen.prototype.usernameKeyUpHandler=function(e){Validations.notBlank(this.username.val())||(clearTimeout(this.timeout),this.timeout=setTimeout(this.timeoutHandler.bind(this),100))},APP.AccountIndexScreen.prototype.timeoutHandler=function(){var e={property:"username",value:this.username.val()};this.requestHandler("/auth/check",e,this.checkUsernameComplete)},APP.AccountIndexScreen.prototype.checkUsernameComplete=function(e){this.isUserAvailable=e.data.available},APP.AccountIndexScreen.prototype.completeFormHandler=function(e){e.preventDefault();var t=[],a=this;Validations.notBlank(this.firstname.val())&&t.push("Ingrese sus nombre"),Validations.notBlank(this.lastname.val())&&t.push("Ingrese sus apellidos"),Validations.notBlank(this.username.val())&&t.push("Ingrese su nombre de usuario"),Validations.username(this.username.val())||t.push("Nombre de usuario solo acepta numeros y letras"),Validations.notBlank(this.gender.val())&&t.push("Ingrese su genero"),Validations.notBlank(this.birthday.val())&&t.push("Ingrese su cumpleaños"),Validations.notBlank(this.country.val())&&t.push("Ingrese su pais"),Validations.notBlank(this.city.val())&&t.push("Ingrese su ciudad"),"2"===this.typeName.val()&&Validations.notBlank(this.pseudonimo.val())&&t.push("Ingrese su pseudonimo");var n=[];if($("input[name=interests]:checked").each(function(){n.push(parseInt($(this).val(),10))}),n.length<2&&t.push("Seleccione al menos 2 intereses"),this.isUserAvailable||t.push("Usuario no disponible"),t.length>0)return this.showFlash("error",t);this.saveLoading.show(),this.save.hide();var s=this.completeForm.serializeArray();$.each(s,function(e,t){if("photo"===t.name){var n="w_150,h_150,c_thumb,d_am_avatar.jpg";t.value=Utils.addImageFilter(a.uploaderImage.photo,n)}"typeName"===t.name&&(t.value=parseInt(t.value,10))});var i="/user/"+profile.username+"/account/update";this.requestHandler(i,s,this.afterSaveHandler)},APP.AccountIndexScreen.prototype.afterSaveHandler=function(e){this.showFlash("succes","Se actualizo su perfil"),this.saveLoading.hide(),this.save.show();var t=e.data.user,a=setTimeout(function(){clearTimeout(a),window.location.href="/user/"+t.username},1e3)},APP.AccountIndexScreen.prototype.uploaderImageComplete=function(e){this.$view.find(".upload").show(),$(".cloudinary-fileupload").show();var t={width:150,height:150,crop:"thumb"};$.cloudinary.image(e,t).appendTo(this.$view.find(".preview"))};
var APP=APP||{};APP.AccountPasswordScreen=function(){APP.BaseScreen.call(this,"accountPassword"),this.timeout=null,this.isUserAvailable=!0},APP.AccountPasswordScreen.constructor=APP.AccountPasswordScreen,APP.AccountPasswordScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AccountPasswordScreen.prototype.setupUI=function(){this.uploaderImage=new APP.UploaderImage($(".uploader-profile"),this.uploaderImageComplete),this.uploaderImage.photo=DataApp.currentUser.photo,this.save=$(".save"),this.saveLoading=$(".save-loading"),this.password=$(".password"),this.rePassword=$(".rePassword"),this.form=$(".password-form"),this.form.submit(this.formHandler.bind(this))},APP.AccountPasswordScreen.prototype.formHandler=function(s){if(s.preventDefault(),this.password.val()!==this.rePassword.val())return this.showFlash("error","Las contraseñas no coinciden");var e="/user/"+profile.username+"/account/password";this.requestHandler(e,this.form.serialize(),this.changePasswordHandler)},APP.AccountPasswordScreen.prototype.changePasswordHandler=function(s){this.showFlash("succes","Contraseña cambiada")};
var APP=APP||{};APP.AddWorkScreen=function(){APP.BaseScreen.call(this,"addWork"),this.work=null},APP.AddWorkScreen.constructor=APP.AddWorkScreen,APP.AddWorkScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AddWorkScreen.prototype.setupUI=function(){this.workForm=$(".work-form"),this.uploader=$(".uploader-work"),this.name=$("input[name=name]"),this.category=$("select[name=category]"),this.description=$("textarea[name=description]"),this.tags=$("input[name=tags]"),this.tags.tagsInput({height:"50px",width:"100%",defaultText:"+Etiqueta"}),this.send=$(".send"),this.sendLoading=$(".send-loading"),this.workDelete=$(".work-delete"),this.workDeleteConfirm=$(".work-delete-confirm"),this.workDeleteCancel=$(".work-delete-cancel"),this.workDeleteForce=$(".work-delete-force"),this.workPhotoPublished=$(".work-photo-published"),this.workNamePublished=$(".work-name-published"),this.workUserPublished=$(".work-user-published"),this.workPublished=$(".work-published"),this.workView=$(".work-view"),this.workNew=$(".work-new"),this.workEdit=$(".work-edit"),this.uploaderImage=new APP.UploaderImage(this.uploader,this.imgComplete)},APP.AddWorkScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.workForm.submit(this.workFormSubmitHandler.bind(this)),this.workDelete.click(this.deleteHandler.bind(this)),this.workDeleteForce.click(this.workDeleteForceHandler.bind(this)),this.workDeleteCancel.click(this.deleteCancel.bind(this)),$("input[type=checkbox]").change(this.publicHandler)},APP.AddWorkScreen.prototype.publicHandler=function(){$(this).parent().find(".value").text(this.checked?"On":"Off")},APP.AddWorkScreen.prototype.workFormSubmitHandler=function(e){e.preventDefault();var t=[],r=this;if(this.uploaderImage.photo||t.push("Ingrese una foto"),Validations.notBlank(this.name.val())&&t.push("Ingrese un nombre"),Validations.notBlank(this.category.val())&&t.push("Ingrese una categoria"),Validations.notBlank(this.description.val())&&t.push("Ingrese una descripcion"),this.tags.val().split(",")[0].length<1&&t.push("Ingrese etiquetas"),t.length>0)return this.showFlash("error",t);this.sendLoading.show(),this.send.hide();var o=this.workForm.serializeArray();$.each(o,function(e,t){"photo"===t.name&&(t.value=r.uploaderImage.photo),("nsfw"===t.name||"public"===t.name)&&(t.value="on"===t.value)});var i=DataApp.currentUser.url+"/work/create";this.requestHandler(i,o,this.workCreatedComplete)},APP.AddWorkScreen.prototype.workCreatedComplete=function(e){this.showFlash("succes","Su obra se subió exitosamente"),this.work=e.data.work,this.workForm.hide(),this.sendLoading.hide(),this.send.show();var t=DataApp.currentUser.url+"/work/"+this.work.nameSlugify,r=Utils.addImageFilter(this.work.photo,"w_300,c_limit");this.workView.attr("href",t),this.workNew.attr("href",DataApp.currentUser.url+"/work/add"),this.workEdit.attr("href",t+"/edit"),this.workPhotoPublished.attr("src",r),this.workNamePublished.text(this.work.name),this.workUserPublished.text(DataApp.currentUser.fullname),this.workPublished.show()},APP.AddWorkScreen.prototype.deleteHandler=function(e){this.workDelete.hide(),this.workDeleteConfirm.show()},APP.AddWorkScreen.prototype.workDeleteForceHandler=function(){var e=DataApp.currentUser.url+"/work/delete";this.requestHandler(e,{idWork:this.work.id},this.forceComplete)},APP.AddWorkScreen.prototype.forceComplete=function(){this.showFlash("succes","Se elimino tu obra"),setTimeout(function(){window.location.href=DataApp.currentUser.url},1e3)},APP.AddWorkScreen.prototype.deleteCancel=function(e){this.workDelete.show(),this.workDeleteConfirm.hide()},APP.AddWorkScreen.prototype.imgComplete=function(e){this.$view.find(".upload").show();var t={format:"jpg",width:300,crop:"limit"};img=$.cloudinary.image(e,t).appendTo(this.$view.find(".preview")),this.photo=img.attr("src"),$(".cloudinary-fileupload").show()};
var APP=APP||{};APP.AdminBlogScreen=function(){APP.BaseScreen.call(this,"adminBlog")},APP.AdminBlogScreen.constructor=APP.AdminBlogScreen,APP.AdminBlogScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AdminBlogScreen.prototype.setupUI=function(){if(this.searchBtn=$(".search-btn"),this.start=$(".start"),this.end=$(".end"),this.startValue=null,this.endValue=null,this.term=null,Utils.getUrlParameter("start")){var t=Utils.getUrlParameter("start");this.startValue=new Date(t),this.start.find("input").val(t.replace(/-/gi,"/"))}if(Utils.getUrlParameter("end")){var e=Utils.getUrlParameter("end");this.endValue=new Date(e),this.end.find("input").val(e.replace(/-/gi,"/"))}this.viewer=new APP.Viewer("tableWork",$(".container-items"),"infinite",data,{getTotal:function(t){$(".total").text("("+t+")")}}),this.searchBox=$(".search-box")},APP.AdminBlogScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.start.datepicker().on("changeDate",this.startDateChange.bind(this)),this.end.datepicker().on("changeDate",this.endDateChange.bind(this)),this.searchBtn.click(this.searchHander.bind(this)),$(".dropdown-menu li a").click(this.dropdownChange.bind(this)),Utils.getUrlParameter("term")&&(this.term=Utils.getUrlParameter("term"),$("."+this.term).click()),Utils.getUrlParameter("termValue")&&this.searchBox.val(decodeURI(Utils.getUrlParameter("termValue")))},APP.AdminBlogScreen.prototype.startDateChange=function(t){this.startValue=t.date},APP.AdminBlogScreen.prototype.endDateChange=function(t){this.endValue=t.date},APP.AdminBlogScreen.prototype.dropdownChange=function(t){var e=$(t.target).text();switch($(".btn-drop .property").text(e),$(".btn-drop .property").val(e),e){case"publicado":this.term="published"}},APP.AdminBlogScreen.prototype.searchHander=function(){var t=this.searchBox.val().trim();if(this.term&&this.term.trim().length>0){if("featured"===this.term&&t.length>0&&isNaN(parseInt(t,10)))return this.showFlash("error",["El valor necesita ser 1 o 0"]);t.length>0?(DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"term",this.term),DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"termValue",t)):(DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"term"),DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"termValue"))}else if(DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"term"),DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"termValue"),t.length>0)return this.showFlash("error",["Necesitas seleccionar una propiedad"]);if(this.startValue){if(!this.endValue)return this.showFlash("error",["Ingresa una fecha de fin"]);var e=this.startValue.getMonth()+1+"-"+this.startValue.getDate()+"-"+this.startValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"start",e)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"start");if(this.endValue){if(!this.startValue)return this.showFlash("error",["Ingresa una fecha de inicio"]);var r=this.endValue.getMonth()+1+"-"+this.endValue.getDate()+"-"+this.endValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"end",r)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"end");DataApp.currentUrl!==window.location.href&&(Utils.changeUrl(this.id,DataApp.currentUrl),this.viewer.reset())};
var APP=APP||{};APP.AdminEditBannerScreen=function(){APP.BaseScreen.call(this,"adminEditBanner")},APP.AdminEditBannerScreen.constructor=APP.AdminEditBannerScreen,APP.AdminEditBannerScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AdminEditBannerScreen.prototype.setupUI=function(){this.uploader=$(".uploader-image"),this.uploaderImage=new APP.UploaderImage(this.uploader,this.imgComplete),this.sendBtn=$(".send-btn"),this.uploaderImage.photo=banner.image},APP.AdminEditBannerScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.sendBtn.click(this.sendHandler.bind(this))},APP.AdminEditBannerScreen.prototype.sendHandler=function(e){e.preventDefault();var n=[];if(Validations.notBlank($("input[name=link]").val())&&n.push("Ingrese un link"),this.uploaderImage.photo||n.push("Ingrese una foto"),n.length>0)return this.showFlash("error",n);var t=this,i=$("form").serializeArray();$.each(i,function(e,n){"image"===n.name&&(n.value=t.uploaderImage.photo)});var r="/report/banners/update";this.requestHandler(r,i,this.updateComplete)},APP.AdminEditBannerScreen.prototype.updateComplete=function(e){this.showFlash("succes","Se edito el banner"),setTimeout(function(){window.location.href="/report/banners/"},1e3)},APP.AdminEditBannerScreen.prototype.imgComplete=function(e){this.$view.find(".upload").show(),$(".cloudinary-fileupload").show();var n={width:300,crop:"limit"};$.cloudinary.image(e,n).appendTo(this.$view.find(".preview"))};
var APP=APP||{};APP.AdminEditUserScreen=function(){APP.BaseScreen.call(this,"adminEditUser")},APP.AdminEditUserScreen.constructor=APP.AdminEditUserScreen,APP.AdminEditUserScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AdminEditUserScreen.prototype.setupUI=function(){this.amBtn=$(".am-btn"),this.deleteBtn=$(".delete-btn"),this.updateBtn=$(".update-btn")},APP.AdminEditUserScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.amBtn.click(this.amHandler.bind(this)),this.deleteBtn.click(this.deleteHandler.bind(this)),this.updateBtn.click(this.updateHandler.bind(this))},APP.AdminEditUserScreen.prototype.amHandler=function(e){e.preventDefault();var t="/user/"+userToEdit.username+"/"+(userToEdit.featured?"unfeatured":"featured");this.requestHandler(t,{idUser:userToEdit.id},this.featuredComplete)},APP.AdminEditUserScreen.prototype.featuredComplete=function(e){userToEdit=e.data.user,userToEdit.featured?this.amBtn.addClass("btn-primary").val("Recomendado"):this.amBtn.removeClass("btn-primary").val("Recomendar"),this.showFlash("succes","Se actualizo el usuario")},APP.AdminEditUserScreen.prototype.deleteHandler=function(e){e.preventDefault();var t=confirm("Quiero eliminar este usuario?");if(t){var r="/user/"+userToEdit.username+"/delete";this.requestHandler(r,{idUser:userToEdit.id},this.deleteComplete)}},APP.AdminEditUserScreen.prototype.deleteComplete=function(){this.showFlash("succes","Se elimino el usuario"),setTimeout(function(){window.location.href="/report"},1e3)},APP.AdminEditUserScreen.prototype.updateHandler=function(e){e.preventDefault();var t="/user/"+userToEdit.username+"/account/update";this.requestHandler(t,$("form").serialize(),this.updateComplete)},APP.AdminEditUserScreen.prototype.updateComplete=function(e){this.showFlash("succes","Se actualizo el usuario")};
var APP=APP||{};APP.AdminGeneralScreen=function(){APP.BaseScreen.call(this,"adminGeneral")},APP.AdminGeneralScreen.constructor=APP.AdminGeneralScreen,APP.AdminGeneralScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AdminGeneralScreen.prototype.setupUI=function(){if(this.searchBtn=$(".search-btn"),this.start=$(".start"),this.end=$(".end"),this.startValue=null,this.endValue=null,Utils.getUrlParameter("start")){var e=Utils.getUrlParameter("start");this.startValue=new Date(e),this.start.find("input").val(e.replace(/-/gi,"/"))}if(Utils.getUrlParameter("end")){var t=Utils.getUrlParameter("end");this.endValue=new Date(t),this.end.find("input").val(t.replace(/-/gi,"/"))}},APP.AdminGeneralScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.start.datepicker().on("changeDate",this.startDateChange.bind(this)),this.end.datepicker().on("changeDate",this.endDateChange.bind(this)),this.searchBtn.click(this.searchHander.bind(this))},APP.AdminGeneralScreen.prototype.startDateChange=function(e){this.startValue=e.date},APP.AdminGeneralScreen.prototype.endDateChange=function(e){this.endValue=e.date},APP.AdminGeneralScreen.prototype.searchHander=function(){if(this.startValue){if(!this.endValue)return this.showFlash("error",["Ingresa una fecha de fin"]);var e=this.startValue.getMonth()+1+"-"+this.startValue.getDate()+"-"+this.startValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"start",e)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"start");if(this.endValue){if(!this.startValue)return this.showFlash("error",["Ingresa una fecha de inicio"]);var t=this.endValue.getMonth()+1+"-"+this.endValue.getDate()+"-"+this.endValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"end",t)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"end");DataApp.currentUrl!==window.location.href&&(window.location.href=DataApp.currentUrl)};
var APP=APP||{};APP.AdminUsersScreen=function(){APP.BaseScreen.call(this,"adminUsers")},APP.AdminUsersScreen.constructor=APP.AdminUsersScreen,APP.AdminUsersScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AdminUsersScreen.prototype.setupUI=function(){if(this.searchBtn=$(".search-btn"),this.start=$(".start"),this.end=$(".end"),this.startValue=null,this.endValue=null,this.term=null,Utils.getUrlParameter("start")){var e=Utils.getUrlParameter("start");this.startValue=new Date(e),this.start.find("input").val(e.replace(/-/gi,"/"))}if(Utils.getUrlParameter("end")){var t=Utils.getUrlParameter("end");this.endValue=new Date(t),this.end.find("input").val(t.replace(/-/gi,"/"))}this.viewer=new APP.Viewer("tableUser",$(".container-items"),"infinite",data,{getTotal:function(e){$(".total").text("("+e+")")}}),this.searchBox=$(".search-box")},APP.AdminUsersScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.start.datepicker().on("changeDate",this.startDateChange.bind(this)),this.end.datepicker().on("changeDate",this.endDateChange.bind(this)),this.searchBtn.click(this.searchHander.bind(this)),$(".dropdown-menu li a").click(this.dropdownChange.bind(this)),Utils.getUrlParameter("term")&&(this.term=Utils.getUrlParameter("term"),$("."+this.term).click()),Utils.getUrlParameter("termValue")&&this.searchBox.val(decodeURI(Utils.getUrlParameter("termValue")))},APP.AdminUsersScreen.prototype.startDateChange=function(e){this.startValue=e.date},APP.AdminUsersScreen.prototype.endDateChange=function(e){this.endValue=e.date},APP.AdminUsersScreen.prototype.dropdownChange=function(e){var t=$(e.target).text();switch($(".btn-drop .property").text(t),$(".btn-drop .property").val(t),t){case"username":this.term="username";break;case"email":this.term="email";break;case"ciudad":this.term="city";break;case"pais":this.term="country";break;case"artista":this.term="isArtist";break;case"verificado":this.term="verified";break;case"completo":this.term="filled";break;case"recomendado":this.term="featured"}},APP.AdminUsersScreen.prototype.searchHander=function(){var e=this.searchBox.val().trim();if(this.term&&this.term.trim().length>0){if(("isArtist"===this.term||"verified"===this.term||"filled"===this.term)&&isNaN(parseInt(e,10)))return this.showFlash("error",["El valor necesita ser 1 o 0"]);e.length>0?(DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"term",this.term),DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"termValue",e)):(DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"term"),DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"termValue"))}else if(DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"term"),DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"termValue"),e.length>0)return this.showFlash("error",["Necesitas seleccionar una propiedad"]);if(this.startValue){if(!this.endValue)return this.showFlash("error",["Ingresa una fecha de fin"]);var t=this.startValue.getMonth()+1+"-"+this.startValue.getDate()+"-"+this.startValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"start",t)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"start");if(this.endValue){if(!this.startValue)return this.showFlash("error",["Ingresa una fecha de inicio"]);var r=this.endValue.getMonth()+1+"-"+this.endValue.getDate()+"-"+this.endValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"end",r)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"end");DataApp.currentUrl!==window.location.href&&(Utils.changeUrl(this.id,DataApp.currentUrl),this.viewer.reset())};
var APP=APP||{};APP.AdminWorksScreen=function(){APP.BaseScreen.call(this,"adminWorks")},APP.AdminWorksScreen.constructor=APP.AdminWorksScreen,APP.AdminWorksScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AdminWorksScreen.prototype.setupUI=function(){if(this.searchBtn=$(".search-btn"),this.start=$(".start"),this.end=$(".end"),this.startValue=null,this.endValue=null,this.term=null,Utils.getUrlParameter("start")){var e=Utils.getUrlParameter("start");this.startValue=new Date(e),this.start.find("input").val(e.replace(/-/gi,"/"))}if(Utils.getUrlParameter("end")){var t=Utils.getUrlParameter("end");this.endValue=new Date(t),this.end.find("input").val(t.replace(/-/gi,"/"))}this.viewer=new APP.Viewer("tableWork",$(".container-items"),"infinite",data,{getTotal:function(e){$(".total").text("("+e+")")}}),this.searchBox=$(".search-box")},APP.AdminWorksScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.start.datepicker().on("changeDate",this.startDateChange.bind(this)),this.end.datepicker().on("changeDate",this.endDateChange.bind(this)),this.searchBtn.click(this.searchHander.bind(this)),$(".dropdown-menu li a").click(this.dropdownChange.bind(this)),Utils.getUrlParameter("term")&&(this.term=Utils.getUrlParameter("term"),$("."+this.term).click()),Utils.getUrlParameter("termValue")&&this.searchBox.val(decodeURI(Utils.getUrlParameter("termValue")))},APP.AdminWorksScreen.prototype.startDateChange=function(e){this.startValue=e.date},APP.AdminWorksScreen.prototype.endDateChange=function(e){this.endValue=e.date},APP.AdminWorksScreen.prototype.dropdownChange=function(e){var t=$(e.target).text();switch($(".btn-drop .property").text(t),$(".btn-drop .property").val(t),t){case"nombre":this.term="name";break;case"recomendado":this.term="featured"}},APP.AdminWorksScreen.prototype.searchHander=function(){var e=this.searchBox.val().trim();if(this.term&&this.term.trim().length>0){if("featured"===this.term&&e.length>0&&isNaN(parseInt(e,10)))return this.showFlash("error",["El valor necesita ser 1 o 0"]);e.length>0?(DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"term",this.term),DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"termValue",e)):(DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"term"),DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"termValue"))}else if(DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"term"),DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"termValue"),e.length>0)return this.showFlash("error",["Necesitas seleccionar una propiedad"]);if(this.startValue){if(!this.endValue)return this.showFlash("error",["Ingresa una fecha de fin"]);var t=this.startValue.getMonth()+1+"-"+this.startValue.getDate()+"-"+this.startValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"start",t)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"start");if(this.endValue){if(!this.startValue)return this.showFlash("error",["Ingresa una fecha de inicio"]);var r=this.endValue.getMonth()+1+"-"+this.endValue.getDate()+"-"+this.endValue.getFullYear();DataApp.currentUrl=Utils.updateQueryStringParameter(DataApp.currentUrl,"end",r)}else DataApp.currentUrl=Utils.removeURLParameter(DataApp.currentUrl,"end");DataApp.currentUrl!==window.location.href&&(Utils.changeUrl(this.id,DataApp.currentUrl),this.viewer.reset())};
var APP=APP||{};APP.AuthScreen=function(e){this.meta=e,APP.BaseScreen.call(this,"auth"),console.log(Cookies.get("return_to"))},APP.AuthScreen.constructor=APP.AuthScreen,APP.AuthScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.AuthScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),$(".fb").click(this.fbHandler.bind(this)),$(".auth-form").submit(this.formHandler.bind(this))},APP.AuthScreen.prototype.fbHandler=function(){$(".fb").hide(),$(".fb-loading").show()},APP.AuthScreen.prototype.formHandler=function(e){e.preventDefault(),$(".submit").hide(),$(".submit-loading").show();var t="/auth/"+this.meta,r=$(".auth-form").serialize();this.requestHandler(t,r,this.requestAuthComplete,this.requestAuthError,!0)},APP.AuthScreen.prototype.requestAuthError=function(e){"signup"===this.meta&&grecaptcha.reset(),$(".submit").show(),$(".submit-loading").hide()},APP.AuthScreen.prototype.requestAuthComplete=function(e){if($(".submit").show(),$(".submit-loading").hide(),"reset"===this.meta){this.showFlash("succes","Contraseña cambiada");var t=setTimeout(function(){return clearTimeout(t),location.href="/auth/login"},1e3)}else{if("forgot"!==this.meta)return location.href=e.data.returnTo;this.showFlash("succes","Se envio el correo")}};
var APP=APP||{};APP.BlogScreen=function(){APP.BaseScreen.call(this,"blog")},APP.BlogScreen.constructor=APP.BlogScreen,APP.BlogScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.BlogScreen.prototype.setupUI=function(){this.viewer=new APP.Viewer("post",$(".articles-container"),"infinite",posts)};
var APP=APP||{};APP.CollectionScreen=function(){APP.BaseScreen.call(this,"collection")},APP.CollectionScreen.constructor=APP.CollectionScreen,APP.CollectionScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.CollectionScreen.prototype.setupUI=function(){this.viewer=new APP.Viewer("work",$(".grid"),null,works,{context:"single-collection"}),this.workDelete=$(".work-delete"),this.workDeleteConfirm=$(".work-delete-confirm"),this.workDeleteCancel=$(".work-delete-cancel"),this.workDeleteForce=$(".work-delete-force"),this.collectionForm=$(".collection-form"),this.collectionName=$(".collection-name"),this.collectionDescription=$(".collection-description"),this.save=$(".save"),this.saveLoading=$(".save-loading"),this["public"]=$("input[name=public]"),$("#go-collection-modal").leanModal()},APP.CollectionScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.workDelete.click(this.workDeleteHandler.bind(this)),this.workDeleteForce.click(this.workDeleteForceHandler.bind(this)),this.workDeleteCancel.click(this.workDeleteCancelHandler.bind(this)),this.save.click(this.saveHandler.bind(this)),this.collectionForm.submit(this.collectionFormHandler.bind(this)),this["public"].change(this.publicChangeHandler),this["public"].change()},APP.CollectionScreen.prototype.saveHandler=function(){this.collectionForm.submit()},APP.CollectionScreen.prototype.publicChangeHandler=function(){$(this).parent().find(".value").text(this.checked?"On":"Off")},APP.CollectionScreen.prototype.collectionFormHandler=function(e){e.preventDefault(),this.save.hide(),this.saveLoading.show();var t=DataApp.currentUser.url+"/collection/update",o={name:$("input[name=name]").val(),description:$("textarea[name=description]").val(),"public":void 0!==$("input[name=public]:checked").val(),idCollection:collection.id};this.requestHandler(t,o,this.collectionUpdateComplete)},APP.CollectionScreen.prototype.collectionUpdateComplete=function(e){this.save.show(),this.saveLoading.hide();var t=e.data.collection,o="/user/"+collection.User.username+"/collection/"+t.nameSlugify;this.collectionName.text(t.name),this.collectionDescription.text(t.description),$("#lean_overlay").trigger("click"),this.showFlash("succes","Se actualizo tu coleccion"),Utils.changeUrl(collection.name,o)},APP.CollectionScreen.prototype.workDeleteCancelHandler=function(){this.workDelete.show(),this.workDeleteConfirm.hide()},APP.CollectionScreen.prototype.workDeleteHandler=function(){this.workDelete.hide(),this.workDeleteConfirm.show()},APP.CollectionScreen.prototype.workDeleteForceHandler=function(){var e=DataApp.currentUser.url+"/collection/delete";this.requestHandler(e,{idCollection:collection.id},this.collectionDeleteComplete)},APP.CollectionScreen.prototype.collectionDeleteComplete=function(){$("#lean_overlay").trigger("click"),this.showFlash("succes","Se elimino tu coleccion"),setTimeout(function(){window.location.href="/user/"+collection.User.username+"/collections"},1e3)};
var APP=APP||{};APP.ConfirmEmailScreen=function(){APP.BaseScreen.call(this,"confirmEmail")},APP.ConfirmEmailScreen.constructor=APP.ConfirmEmailScreen,APP.ConfirmEmailScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.ConfirmEmailScreen.prototype.setupUI=function(){this.messageSuccess=$(".msg-succes"),this.resend=$(".resend-btn"),this.resendLoading=$(".resend-loading")},APP.ConfirmEmailScreen.prototype.listeners=function(){this.resend.click(this.resendHandler.bind(this))},APP.ConfirmEmailScreen.prototype.resendHandler=function(){this.messageSuccess.hide(),this.resendLoading.show(),this.resend.hide(),this.requestHandler("/auth/resend",{},this.resendComplete)},APP.ConfirmEmailScreen.prototype.resendComplete=function(e){this.messageSuccess.show(),this.resendLoading.hide(),this.resend.show()};
var APP=APP||{},scope,timeout;APP.CreatorPostScreen=function(){APP.BaseScreen.call(this,"creatorPost"),scope=this},APP.CreatorPostScreen.constructor=APP.CreatorPostScreen,APP.CreatorPostScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.CreatorPostScreen.prototype.setupUI=function(){this.category=$("select[name=category]"),this.name=$("input[name=name]"),this.status=$(".status"),this["delete"]=$(".delete-btn"),this.deleteConfirm=$(".delete-confirm"),this.deleteForce=$(".delete-force"),this.cancel=$(".cancel"),this.previewBtn=$(".preview-btn"),this.publishBtn=$(".publish-btn"),this.amBtn=$(".am-btn"),this.cover=new APP.UploaderImage($(".uploader-cover"),this.coverComplete,{uploader:$(".editor-cover")}),edit&&(this.category.find("option[value="+post.Category.id+"]").attr("selected",!0),this.cover.photo=post.photo),this.editable=$(".editable"),this.editor=new MediumEditor(".editable",{buttonLabels:"fontawesome",targetBlank:!0,imageDragging:!1,placeholder:{text:"Ingresa el contenido del post :)"},toolbar:{buttons:["h2","h3","bold","italic","quote","anchor","justifyLeft","justifyCenter","justifyRight"]}}),this.editable.mediumInsert({editor:this.editor,addons:{embeds:{placeholder:"Inserta el código de embebido de youtube y luego presiona enter"}}}),this.isUploading=!1},APP.CreatorPostScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),Broadcaster.addEventListener("imageStarted",this.imageStarted.bind(this)),Broadcaster.addEventListener("imageProgressComplete",this.progressComplete.bind(this)),Broadcaster.addEventListener("imageLoaded",this.imageLoaded.bind(this));var e=MediumEditor.util.throttle(this.autoSave.bind(this),2e3);this.editor.subscribe("editableInput",e),window.onbeforeunload=this.beforeUnLoad.bind(this),this.category.change(this.inputChange.bind(this)),this.name.keyup(this.nameKeyUp.bind(this)),this["delete"].click(this.deleteHandler.bind(this)),this.cancel.click(this.cancelHandler.bind(this)),this.deleteForce.click(this.deleteForceHandler.bind(this)),this.publishBtn.click(this.publishHandler.bind(this)),this.amBtn.click(this.featuredHandler.bind(this))},APP.CreatorPostScreen.prototype.publishHandler=function(){if(!post)return this.showFlash("error",["Rellena todos los campos del post"]);var e="/blog/post/"+(post.published?"unpublish":"publish");this.requestHandler(e,{idPost:post.id},this.publishComplete)},APP.CreatorPostScreen.prototype.publishComplete=function(e){post=e.data.post,post.published?this.publishBtn.addClass("publish").text("PUBLICADO"):this.publishBtn.removeClass("publish").text("PUBLICAR")},APP.CreatorPostScreen.prototype.featuredHandler=function(){if(!post)return this.showFlash("error",["Rellena todos los campos del post"]);var e="/blog/post/"+(post.featured?"unfeatured":"featured");this.requestHandler(e,{idPost:post.id},this.featuredComplete)},APP.CreatorPostScreen.prototype.featuredComplete=function(e){post=e.data.post,post.featured?this.amBtn.addClass("am"):this.amBtn.removeClass("am")},APP.CreatorPostScreen.prototype.imageStarted=function(){this.isUploading=!0,this.status.text("Cargando imagenes....")},APP.CreatorPostScreen.prototype.progressComplete=function(){this.status.text("Procesando imagenes....")},APP.CreatorPostScreen.prototype.imageLoaded=function(){this.isUploading=!1,this.autoSave(null,this.editable),this.status.text("Imagenes cargadas")},APP.CreatorPostScreen.prototype.autoSave=function(e,t){if(this.isUploading)return this.showFlash("error",["Las imágenes aún se estan cargando"]);var o=[],s=this.name.val(),i=this.category.val();if(this.editable=t,s.trim().length<1&&o.push("Agrega un titulo"),null===i&&o.push("Selecciona una categoria"),null===this.cover.photo&&o.push("Selecciona una imagen de cover"),o.length>0)return this.showFlash("error",o);var r=this.editor.serialize()["element-0"].value;t=$(t);var a={body:r,name:s,category:i,description:t.find("p").text().substr(0,180),photo:this.cover.photo};this.status.text("Guardando.....");var n;post?(n="/blog/post/update",a.idPost=post.id):n="/blog/post/create",this.requestHandler(n,a,this.saveRequestComplete)},APP.CreatorPostScreen.prototype.saveRequestComplete=function(e){post=e.data.post;var t="/blog/post/"+post.nameSlugify;edit&&Utils.changeUrl(post.name,t+"/edit"),this.previewBtn.attr("href",t),this.status.text("✓ guardado")},APP.CreatorPostScreen.prototype.beforeUnLoad=function(e){if(this.isUploading){var t="Aun no se han guardado tus cambios!";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=t),t}},APP.CreatorPostScreen.prototype.coverComplete=function(e){this.$view.find(".upload").show(),$(".cloudinary-fileupload").show();var t={format:"jpg",width:1600,crop:"limit",quality:80},o=$.cloudinary.image(e,t);o.addClass("am-Profile-banner-img").appendTo(this.$view.find(".preview")),this.photo=o.attr("src"),scope.autoSave(null,scope.editable)},APP.CreatorPostScreen.prototype.inputChange=function(){this.autoSave(null,this.editable)},APP.CreatorPostScreen.prototype.nameKeyUp=function(){clearTimeout(timeout),timeout=setTimeout(function(){scope.autoSave(null,scope.editable)},1e3)},APP.CreatorPostScreen.prototype.deleteHandler=function(e){e.preventDefault(),this["delete"].hide(),this.previewBtn.hide(),this.publishBtn.hide(),this.amBtn.hide(),this.deleteConfirm.show()},APP.CreatorPostScreen.prototype.cancelHandler=function(e){e.preventDefault(),this["delete"].show(),this.previewBtn.show(),this.publishBtn.show(),this.amBtn.show(),this.deleteConfirm.hide()},APP.CreatorPostScreen.prototype.deleteForceHandler=function(e){e.preventDefault();var t="/blog/post/delete";this.requestHandler(t,{idPost:post.id},this.deleteForceComplete)},APP.CreatorPostScreen.prototype.deleteForceComplete=function(){this.showFlash("succes","Se elimino tu post"),setTimeout(function(){window.location.href="/blog"},1e3)};
var APP=APP||{};APP.DiscoverScreen=function(t,e,i,r){this.container=e,this.navigation=i,this.data=r,APP.BaseScreen.call(this,t)},APP.DiscoverScreen.constructor=APP.DiscoverScreen,APP.DiscoverScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.DiscoverScreen.prototype.setupUI=function(){DataApp.currentUrl=this.data.url,Utils.changeUrl(this.id,this.data.url),this.searchText=$(".search-text"),this.featuredText=$(".featured-text"),this.viewer=new APP.Viewer(this.id,this.container,this.navigation,this.data),this.filters=new APP.Filters(this.data.filters)},APP.DiscoverScreen.prototype.listeners=function(){Broadcaster.addEventListener(Events.FILTER_CHANGED,this.filterChangedHandler.bind(this)),this.filters.start()},APP.DiscoverScreen.prototype.filterChangedHandler=function(t){t.meta&&$("."+t.meta+"-text").text(t.newValue),this.filters.term&&this.filters.term.length>0?(this.searchText.show(),this.searchText.text(decodeURIComponent(this.filters.term))):(this.searchText.hide(),this.searchText.text("")),this.filters.isFeatured?(this.featuredText.show(),this.featuredText.text("AM")):(this.featuredText.hide(),this.featuredText.text(""));var e=[];$(".navigation > span").filter(function(t,i){"none"!==$(i).css("display")&&e.push($(i))});var i;for(i=0;i<e.length;i++)-1!==e[i].text().indexOf(" >")&&e[i].text(e[i].text().replace(" >","")).removeClass("link");for(i=0;i<e.length-1;i++)e[i].text(e[i].text()+" >").addClass("link");DataApp.currentUrl!==window.location.href&&(Utils.changeUrl(this.id,DataApp.currentUrl),this.filters.isInitialized&&this.viewer.reset())};
var APP=APP||{};APP.EditWorkScreen=function(){APP.BaseScreen.call(this,"editWork"),this.work=work,this.userWork=work.User},APP.EditWorkScreen.constructor=APP.EditWorkScreen,APP.EditWorkScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.EditWorkScreen.prototype.setupUI=function(){this.workForm=$(".work-form"),this.uploaderImage=new APP.UploaderImage($(".uploader-work"),this.uploaderImageComplete),this.uploaderImage.photo=work.photo,this.name=$("input[name=name]"),this.category=$("select[name=category]"),$("select[name=category]").find("option[value="+category.id+"]").attr("selected",!0),$("input[name=public]").attr("checked",work["public"]),$("input[name=nsfw]").attr("checked",work.nsfw),this.description=$("textarea[name=description]"),this.tags=$("input[name=tags]"),this.tags.tagsInput({height:"50px",width:"100%",defaultText:"+Etiqueta"}),this.send=$(".send"),this.sendLoading=$(".send-loading"),this.workDelete=$(".work-delete"),this.workDeleteConfirm=$(".work-delete-confirm"),this.workDeleteCancel=$(".work-delete-cancel"),this.workDeleteForce=$(".work-delete-force")},APP.EditWorkScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.workForm.submit(this.workFormSubmitHandler.bind(this)),this.workDelete.click(this.workDeleteHandler.bind(this)),this.workDeleteForce.click(this.workDeleteForceHandler.bind(this)),this.workDeleteCancel.click(this.workDeleteCancelHandler.bind(this)),$("input[type=checkbox]").change(this.checkPublicHandler),$("input[type=checkbox]").change()},APP.EditWorkScreen.prototype.checkPublicHandler=function(){$(this).parent().find(".value").text(this.checked?"On":"Off")},APP.EditWorkScreen.prototype.workFormSubmitHandler=function(e){e.preventDefault();var t=[],o=this;if(this.uploaderImage.photo||t.push("Ingrese una foto"),Validations.notBlank(this.name.val())&&t.push("Ingrese un nombre"),Validations.notBlank(this.category.val())&&t.push("Ingrese una categoria"),Validations.notBlank(this.description.val())&&t.push("Ingrese una descripcion"),this.tags.val().split(",")[0].length<1&&t.push("Ingrese etiquetas"),t.length>0)return this.showFlash("error",t);this.sendLoading.show(),this.send.hide();var r=this.workForm.serializeArray();$.each(r,function(e,t){"photo"===t.name&&(t.value=o.uploaderImage.photo),("nsfw"===t.name||"public"===t.name)&&(t.value="on"===t.value)}),console.log(r);var i=DataApp.currentUser.url+"/work/update";this.requestHandler(i,r,this.workUpdatedComplete)},APP.EditWorkScreen.prototype.workUpdatedComplete=function(e){this.showFlash("succes","Su obra se actualizo exitosamente"),this.work=e.data.work,this.sendLoading.hide(),this.send.show();var t="/user/"+this.userWork.username+"/work/"+this.work.nameSlugify,o=setTimeout(function(){clearTimeout(o),window.location.href=t},1e3)},APP.EditWorkScreen.prototype.workDeleteHandler=function(e){e.preventDefault(),this.workDelete.hide(),this.workDeleteConfirm.show()},APP.EditWorkScreen.prototype.workDeleteForceHandler=function(){var e=DataApp.currentUser.url+"/work/delete";this.requestHandler(e,{idWork:this.work.id},this.workDeleteForceComplete)},APP.EditWorkScreen.prototype.workDeleteForceComplete=function(){this.showFlash("succes","Se elimino tu obra");var e=setTimeout(function(){clearTimeout(e),DataApp.currentUser.isAdmin?window.location.href="/":window.location.href=DataApp.currentUser.url},1e3)},APP.EditWorkScreen.prototype.workDeleteCancelHandler=function(e){this.workDelete.show(),this.workDeleteConfirm.hide()},APP.EditWorkScreen.prototype.uploaderImageComplete=function(e){this.$view.find(".upload").show(),$(".cloudinary-fileupload").show();var t={width:300,crop:"limit"};$.cloudinary.image(e,t).appendTo(this.$view.find(".preview"))};
var APP=APP||{};APP.EditorScreen=function(){APP.BaseScreen.call(this,"home")},APP.EditorScreen.constructor=APP.EditorScreen,APP.EditorScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.EditorScreen.prototype.setupUI=function(){var t={scaleFactor:5,width:567,height:211,offsetX:0,offsetY:60},e="000000",r=new fabric.Canvas("c1",{backgroundColor:e,width:t.width+2*t.offsetX,height:t.height+2*t.offsetY}),o=new fabric.Rect({width:t.width,height:t.offsetY,left:0,top:0,fill:"red",opacity:.5}),c=new fabric.Rect({width:t.width,height:t.offsetY,left:0,top:t.height+t.offsetY,fill:"red",opacity:.5});o.selectable=c.selectable=!1;var a,_=function(t,e){return t.replace("upload/","upload/"+e+"/")},i="http://res.cloudinary.com/hackdudes/image/upload/v1449719700/prueba2_e4tx4f.jpg",h=i.replace(/^.*\/|\.[^.]*$/g,"");url=_(i,"w_0.2,h_0.2"),fabric.Image.fromURL(url,function(t){a=t,r.add(t),r.calcOffset(),r.sendToBack(t),r.setActiveObject(r.item(0)),r.item(0).lockRotation=!0,r.item(0).hasRotatingPoint=!1,r.item(0).lockUniScaling=!0,r.centerObject(t),t.setCoords()},{crossOrigin:"Anonymous"}),r.add(o),r.add(c),$("input[type=color]").change(function(){e=$(this).val().replace("#",""),r.backgroundColor="#"+e,r.renderAll()});var n,l,s,d,g=function(){var e=r.toDataURL({top:t.offsetY,left:t.offsetX,height:t.height,width:t.weight});$(".preview").attr("src",e)},u=function(){var r=a.getBoundingRect(),o=Math.round(r.left*t.scaleFactor),c=Math.round(r.top*t.scaleFactor)-60*t.scaleFactor,g=Math.round(t.width*t.scaleFactor),u=Math.round(t.height*t.scaleFactor),f=Math.round(a.getWidth()*t.scaleFactor),w=Math.round(a.getHeight()*t.scaleFactor),p=Math.round(g/3),b="w_"+g+",h_"+u+",e_colorize,co_rgb:"+e+"/l_"+h+",b_rgb:"+e+",w_"+f+",h_"+w+",x_"+o+",y_"+c+",g_north_west/x_"+(0>o?-1*o:0)+",y_"+(0>c?-1*c:0)+",w_"+g+",h_"+u+",c_crop,g_north_west";n=_(i,b),t.scaleFactor=1.5,o=Math.round(r.left*t.scaleFactor),c=Math.round(r.top*t.scaleFactor)-60*t.scaleFactor,g=Math.round(t.width*t.scaleFactor),u=Math.round(t.height*t.scaleFactor),f=Math.round(a.getWidth()*t.scaleFactor),w=Math.round(a.getHeight()*t.scaleFactor),p=Math.round(g/3);var y=8,P=-13;b="w_"+g+",h_"+u+",e_colorize,co_rgb:"+e+"/l_"+h+",b_rgb:"+e+",w_"+f+",h_"+w+",x_"+o+",y_"+c+",g_north_west/x_"+(0>o?-1*o:0)+",y_"+(0>c?-1*c:0)+",w_"+p+",h_"+u+",c_crop,g_north_west/e_distort:0:0:"+p+":0:"+(p-y)+":"+u+":"+y+":"+u+"/c_pad,h_2.0,w_1.0/l_radial,e_displace,y_"+P+"/e_trim/u_mugleft/w_0.7",l=_(i,b),b="w_"+g+",h_"+u+",e_colorize,co_rgb:"+e+"/l_"+h+",b_rgb:"+e+",w_"+f+",h_"+w+",x_"+o+",y_"+c+",g_north_west/x_"+((0>o?-1*o:0)+1*Math.round(p))+",y_"+(0>c?-1*c:0)+",w_"+p+",h_"+u+",c_crop,g_north_west/e_distort:0:0:"+p+":0:"+(p-y)+":"+u+":"+y+":"+u+"/c_pad,h_2.0,w_1.0/l_radial,e_displace,y_"+P+"/e_trim/u_mugcenter/w_0.7",s=_(i,b),b="w_"+g+",h_"+u+",e_colorize,co_rgb:"+e+"/l_"+h+",b_rgb:"+e+",w_"+f+",h_"+w+",x_"+o+",y_"+c+",g_north_west/x_"+((0>o?-1*o:0)+2*Math.round(p))+",y_"+(0>c?-1*c:0)+",w_"+p+",h_"+u+",c_crop,g_north_west/e_distort:0:0:"+p+":0:"+(p-y)+":"+u+":"+y+":"+u+"/c_pad,h_2.0,w_1.0/l_radial,e_displace,y_"+P+"/e_trim/u_mugright/w_0.7",d=_(i,b),$(".original").attr("src",n),$(".left").attr("src",l),$(".center").attr("src",s),$(".right").attr("src",d)};$(".save-btn").click(u),r.on({"mouse:up":g,"object:resizing":g})};
var APP=APP||{};APP.FeedScreen=function(){APP.BaseScreen.call(this,"feed"),this.idCollections=[],this.collections=[],this.currentWork=null},APP.FeedScreen.constructor=APP.FeedScreen,APP.FeedScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.FeedScreen.prototype.setupUI=function(){APP.BaseScreen.prototype.setupUI.call(this),this.saveBtn=$(".save-collections"),this.saveBtnLoading=$(".save-collections-loading"),this.collectionsContainer=$(".collections"),this.collectionForm=$(".add-collection-form"),this.shareFB=$(".share-fb"),this.viewer=new APP.Viewer("action",$(".feed-inner"),"infinite",actions),new Clipboard(".copy",{text:this.copyHandler.bind(this)})},APP.FeedScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.saveBtn.click(this.saveClickHandler.bind(this));var e=DataApp.currentUser.url+"/collection/all";this.requestHandler(e,{},this.collectionsHandlerComplete),this.collectionForm.submit(this.collectionFormHandler.bind(this));var t=this.addCollectionHandler.bind(this);Broadcaster.addEventListener(Events.ADD_COLLECTION,t);var i=this.feedShareHandler.bind(this);Broadcaster.addEventListener(Events.SHARE,i),this.shareFB.click(this.shareFBHandler.bind(this))},APP.FeedScreen.prototype.copyHandler=function(e){return $("#lean_overlay").trigger("click"),this.showFlash("succes","Link Copiado"),DataApp.baseUrl+"user/"+this.currentWork.User.username+"/work/"+this.currentWork.nameSlugify},APP.FeedScreen.prototype.feedShareHandler=function(e){this.currentWork=e.data.work},APP.FeedScreen.prototype.shareFBHandler=function(){Utils.shareFBWork(this.currentWork)},APP.FeedScreen.prototype.collectionFormHandler=function(e){e.preventDefault();var t=DataApp.currentUser.url+"/collection/create";this.requestHandler(t,$(e.target).serialize(),this.collectionFormComplete)},APP.FeedScreen.prototype.collectionFormComplete=function(e){var t=new APP.CollectionItem(e.data.collection);t.addEventListener(Events.COLLECTION_ITEM_SELECTED,this.collectionItemSelected.bind(this)),this.collections.push(t),this.collectionsContainer.append(t.view)},APP.FeedScreen.prototype.addCollectionHandler=function(e){this.currentWork=e.data.work;var t=DataApp.currentUser.url+"/work/inside_collection",i={idWork:this.currentWork.id};this.requestHandler(t,i,this.insideCollectionHandler)},APP.FeedScreen.prototype.insideCollectionHandler=function(e){var t,i,o=e.data.collections;for(t=0;t<this.collections.length;t++)this.collections[t].view.removeClass("selected");for(this.idCollections=[],t=0;t<o.length;t++)for(i=0;i<this.collections.length;i++)o[t].id===this.collections[i].data.id&&(this.idCollections.push(o[t].id),this.collections[i].view.addClass("selected"))},APP.FeedScreen.prototype.saveClickHandler=function(){this.saveBtn.hide(),this.saveBtnLoading.show();var e=DataApp.currentUser.url+"/work/add_to_collection",t={collections:JSON.stringify(this.idCollections),idWork:this.currentWork.id};this.requestHandler(e,t,this.saveRequestComplete)},APP.FeedScreen.prototype.saveRequestComplete=function(){this.saveBtn.show(),this.saveBtnLoading.hide(),this.showFlash("succes","Su actualizo tus colecciones"),$("#lean_overlay").trigger("click")},APP.FeedScreen.prototype.collectionsHandlerComplete=function(e){var t,i,o=e.data.collections;for(t=0;t<o.length;t++)i=new APP.CollectionItem(o[t]),this.collections.push(i),i.addEventListener(Events.COLLECTION_ITEM_SELECTED,this.collectionItemSelected.bind(this)),this.collectionsContainer.append(i.view)},APP.FeedScreen.prototype.collectionItemSelected=function(e){var t=e.target,i=this.idCollections.indexOf(t.data.id);-1===i?this.idCollections.push(t.data.id):this.idCollections.splice(i,1)};
var APP=APP||{};APP.Filters=function(t){this.filters=t,this.oldCategory=this.filters.currentCategory,this.oldOrder=this.filters.currentOrder,this.isFeatured=void 0!==Utils.getUrlParameter("featured"),this.term=Utils.getUrlParameter("term"),this.currentCategory=this.currentOrder=null,this.setupUI(),this.listeners(),this.isInitialized=!1},APP.Filters.constructor=APP.Filters,APP.Filters.prototype.setupUI=function(){function t(t){function e(){return r}var r=window.innerWidth<1e3?"mobile":"desktop",i=t.toDesktop,a=t.toMobile;return window.addEventListener("resize",function(){var t=r;r=window.innerWidth<1e3?"mobile":"desktop","mobile"==t&&"desktop"==r&&i(),"desktop"==t&&"mobile"==r&&a()}),{getVal:e}}var e,r=$(".filter.right"),i=$(".filter.right .am-Select");setTimeout(function(){e=$(".filter.right .am-Filter-item"),$(e).click(function(){setTimeout(function(){$(i).trigger("click")},300)})},500),$(i).click(function(){var t=r.attr("data-state");"closed"==t?r.attr("data-state","open"):r.attr("data-state","closed")});var a=$(".filter.left"),s=$(".filter.left .am-Select"),n=$(".discover-content");$(s).click(function(){var t=a.attr("data-state");"closed"==t?(a.attr("data-state","open"),n.attr("data-state","expand").trigger("resetLayout")):(a.attr("data-state","closed"),n.attr("data-state","reduce").trigger("resetLayout"))});var l=new t({toDesktop:function(){console.log("toDesktop!")},toMobile:function(){console.log("toMobile!"),$(".filter.left .left-menu").css("display","block")}});"mobile"==l.getVal()&&($(s).trigger("click"),$(".filter.left .left-menu").css("display","block")),this.filters.categories.unshift({name:"Todo",nameSlugify:"all"}),this.itemFilterRenderer(this.filters.categories,"category"),this.itemFilterRenderer(this.filters.order,"order"),this.featuredBtn=$(".am-Switch-button"),this.searchInput=$(".am-Search-input input"),this.searchBtn=$(".search-btn"),this.closeBtn=$(".close-btn"),this.categories=$("[data-meta=category]"),this.orders=$("[data-meta=order]"),$("[data-value="+this.oldCategory+"]").parent().addClass("selected"),$("[data-value="+this.oldOrder+"]").parent().addClass("selected"),this.isFeatured&&$("input[type=checkbox]").prop("checked",!0),this.navigation=$(".am-navigation-text"),this.needsToClose=!1},APP.Filters.prototype.itemFilterRenderer=function(t,e){var r=APP.TemplateManager.instance.getFromDoc("filter-item");$.each(t,function(t,i){i.meta=e,$(".filter-"+e).append(r(i))})},APP.Filters.prototype.listeners=function(){this.categories.on("click",this.filterItemHandler.bind(this,"category")),this.orders.on("click",this.filterItemHandler.bind(this,"order")),this.featuredBtn.on("click",this.featuredHandler.bind(this)),this.term=void 0===this.term?"":this.term,this.searchInput.val(decodeURIComponent(this.term)),this.searchBtn.click(this.searchHandler.bind(this)),this.searchInput.keyup(this.searchKeyUpHandler.bind(this)),this.searchInput.keypress(this.searchKeyPressHandler.bind(this)),this.navigation.click(this.navigationClickHandler.bind(this)),this.closeBtn.click(this.closeClickHandler.bind(this)),this.searchInput.keyup()},APP.Filters.prototype.searchKeyUpHandler=function(t){this.searchInput.val().length>0?this.closeBtn.show():this.closeBtn.hide()},APP.Filters.prototype.closeClickHandler=function(t){this.searchInput.val(""),this.closeBtn.hide(),this.needsToClose=!0,this.searchBtn.click()},APP.Filters.prototype.navigationClickHandler=function(t){var e,r=$(t.target),i=DataApp.currentUrl;this.navigation.each(function(t,a){var s=$(a).attr("id");$(a).hasClass("link")&&r.attr("id")===s&&(e=t),t>e&&(i=Utils.removeURLParameter(i,s))}),window.location.href=i},APP.Filters.prototype.searchKeyPressHandler=function(t){if(13===t.which){var e=encodeURIComponent($(t.target).val());return e.length>0?(this.term?DataApp.currentUrl=DataApp.currentUrl.replace("term="+this.term,"term="+e):DataApp.currentUrl=DataApp.currentUrl+"&term="+e,this.term=e):(DataApp.currentUrl.indexOf("&term="+this.term)>-1&&(DataApp.currentUrl=DataApp.currentUrl.replace("&term="+this.term,"")),DataApp.currentUrl.indexOf("term="+this.term)>-1&&(DataApp.currentUrl=DataApp.currentUrl.replace("term="+this.term,"")),this.term=void 0),this.needsToClose?window.location.href=DataApp.currentUrl:void Broadcaster.dispatchEvent(Events.FILTER_CHANGED)}},APP.Filters.prototype.searchHandler=function(t){t.preventDefault(),this.searchInput.trigger({type:"keypress",which:13,keyCode:13})},APP.Filters.prototype.featuredHandler=function(){this.isFeatured?DataApp.currentUrl=DataApp.currentUrl.replace("&featured=1",""):DataApp.currentUrl=DataApp.currentUrl+"&featured=1",this.isFeatured=!this.isFeatured,Broadcaster.dispatchEvent(Events.FILTER_CHANGED)},APP.Filters.prototype.start=function(){$("[data-value="+this.oldCategory+"]").click(),$("[data-value="+this.oldOrder+"]").click(),this.isInitialized=!0},APP.Filters.prototype.filterItemHandler=function(t,e){var r=Utils.capitalize(t),i="old"+r,a="current"+r,s=$(e.currentTarget).find(".am-Filter-option");this[a]=s.attr("data-value"),$("[data-value="+this[i]+"]").parent().removeClass("selected"),$("[data-value="+this[a]+"]").parent().addClass("selected"),DataApp.currentUrl=DataApp.currentUrl.replace(this[i],this[a]),this[i]=this[a];var n=$(e.target).attr("data-name");Broadcaster.dispatchEvent(Events.FILTER_CHANGED,{meta:t,newValue:n})};
var APP=APP||{};APP.HomeScreen=function(){APP.BaseScreen.call(this,"home"),this.usersViewer=new APP.Viewer("user",$(".grid"),null,users),this.worksViewer=new APP.Viewer("work",$(".grid-works"),null,works);var e=$(".banner-user").detach();this.usersViewer.container.append(e).masonry("appended",e),this.slider=new Slider(document.querySelector(".slider"),{slideClass:"js-slide",sliderNavItemClass:"js-slideNavItem"})},APP.HomeScreen.constructor=APP.HomeScreen,APP.HomeScreen.prototype=Object.create(APP.BaseScreen.prototype);
var APP=APP||{};APP.NotificationsScreen=function(){APP.BaseScreen.call(this,"notifications")},APP.NotificationsScreen.constructor=APP.NotificationsScreen,APP.NotificationsScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.NotificationsScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this)};
var APP=APP||{};APP.PostScreen=function(){APP.BaseScreen.call(this,"post"),this.following=!1},APP.PostScreen.constructor=APP.PostScreen,APP.PostScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.PostScreen.prototype.setupUI=function(){this.viewer=new APP.Viewer("post",$(".blog-articles-container"),null,posts),this.loginReview=$(".login-review"),this.followBtn=$(".following"),this.shareFb=$(".share-fb"),this.shareTw=$(".share-tw"),this.editor=new MediumEditor(".editable",{buttonLabels:"fontawesome",toolbar:!1,spellcheck:!1,disableEditing:!0}),this.reviewForm=$(".review-form"),this.reviewContainer=$(".reviews-items-container");for(var e=0;e<reviews.length;e++)this.reviewContainer.append(new APP.Review(reviews[e]).view);if(this.likeBtn=$(".like-btn"),DataApp.currentUser){if(DataApp.currentUser.id===post.User.id)return this.followBtn.hide();var t=DataApp.currentUser.url+"/isFollowing";this.requestHandler(t,{idUser:post.User.id},this.isFollowingComplete)}},APP.PostScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),this.reviewForm.submit(this.reviewFormHandler.bind(this)),this.likeBtn.click(this.likeBtnHandler.bind(this)),this.loginReview.click(this.loginReviewHandler.bind(this)),this.followBtn.click(this.followHandler.bind(this)),this.shareFb.click(this.shareFBHandler.bind(this)),this.shareTw.click(this.shareTWHandler.bind(this))},APP.PostScreen.prototype.shareFBHandler=function(){Utils.shareFBPost(post)},APP.PostScreen.prototype.shareTWHandler=function(){Utils.shareTWPost(post)},APP.PostScreen.prototype.followHandler=function(){Utils.checkAuthentication();var e=DataApp.currentUser.url+(this.isFollowing?"/unfollow/":"/follow/");this.requestHandler(e,{idUser:post.User.id},this.followComplete)},APP.PostScreen.prototype.followComplete=function(e){this.isFollowing?this.followBtn.removeClass("following").text("+ SEGUIR"):this.followBtn.addClass("following").text("Siguiendo"),this.isFollowing=!this.isFollowing},APP.PostScreen.prototype.likeBtnHandler=function(e){if(e.preventDefault(),Utils.checkAuthentication(),!post.liked){var t="/blog/post/like";this.requestHandler(t,{idPost:post.id},this.likeComplete)}},APP.PostScreen.prototype.loginReviewHandler=function(){Utils.checkAuthentication()},APP.PostScreen.prototype.isFollowingComplete=function(e){this.isFollowing=e.data.following,this.isFollowing&&this.followBtn.addClass("following").text("Siguiendo")},APP.PostScreen.prototype.likeComplete=function(e){post.liked=!post.liked,$(".likes").text(e.data.likes),this.likeBtn.addClass("liked")},APP.PostScreen.prototype.reviewFormHandler=function(e){e.preventDefault();var t="/blog/post/review/create";this.requestHandler(t,$(e.target).serialize(),this.reviewComplete)},APP.PostScreen.prototype.reviewComplete=function(e){$(".value-input").val(""),this.reviewContainer.append(new APP.Review(e.data.review).view)};
var APP=APP||{};APP.ProfileScreen=function(){this.currentItem,this.oldItem,this.currentSection,this.oldSection,this.currentViewer,this.oldViewer,this.paths=[],this.viewers=[],this.uploaderCover=new APP.UploaderImage($(".uploader-cover"),this.uploadComplete),APP.BaseScreen.call(this,"profile")},APP.ProfileScreen.constructor=APP.ProfileScreen,APP.ProfileScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.ProfileScreen.prototype.listeners=function(){APP.BaseScreen.prototype.listeners.call(this),$(".am-Profile-menu-item").click(this.menuItemClickHandler.bind(this)),$(".am-Follow-button").click(this.followClickHandler.bind(this)),$(".cancel-icon").click(this.cancelClickHandler.bind(this)),$(".save-icon").click(this.saveClickHandler.bind(this)),$(".am-Profile-menu-item[data-name="+currentPath+"]").click()},APP.ProfileScreen.prototype.saveClickHandler=function(){var e=DataApp.currentUser.url+"/account/update_cover";this.requestHandler(e,{cover:this.uploaderCover.photo},this.updateCoverComplete),$(".save-icon, .cancel-icon").hide(),$(".cloudinary-fileupload, .upload").show()},APP.ProfileScreen.prototype.followClickHandler=function(){Utils.checkAuthentication();var e=DataApp.currentUser.url+(profile.following?"/unfollow/":"/follow/");this.requestHandler(e,{idUser:profile.id},this.followComplete)},APP.ProfileScreen.prototype.menuItemClickHandler=function(e){this.currentItem=$(e.currentTarget);var t=this.currentItem.data("name"),i="/user/"+profile.username+"/"+("portfolio"===t?"":t);if(Utils.changeUrl(DataApp.baseTitle+Utils.capitalize(t),i),this.currentSection=$("."+t+"-wrapper"),this.oldItem&&this.oldItem.removeClass("selected"),this.oldViewer&&this.oldViewer.suspend(),this.oldSection&&this.oldSection.hide(),this.currentItem.addClass("selected"),this.currentSection.show(),-1===this.paths.indexOf(t)){var r=this.getTemplate(t),o=$("."+t+"-container");this.currentViewer=new APP.Viewer(r,o,"infinite",null),this.currentViewer.navigationManager.navigator.needChangeUrl=!0,this.viewers.push(this.currentViewer),this.paths.push(t)}else this.currentViewer=this.viewers[this.paths.indexOf(t)],this.currentViewer.restart();this.oldItem=this.currentItem,this.oldViewer=this.currentViewer,this.oldSection=this.currentSection},APP.ProfileScreen.prototype.updateCoverComplete=function(e){DataApp.currentUser.cover=this.uploaderCover.photo,$(".save-icon, .cancel-icon").hide(),$(".cloudinary-fileupload, .upload").show()},APP.ProfileScreen.prototype.cancelClickHandler=function(){$(".preview > img").attr("src",DataApp.currentUser.cover),$(".save-icon, .cancel-icon").hide(),$(".cloudinary-fileupload, .upload").show()},APP.ProfileScreen.prototype.followComplete=function(e){profile.following?$(".am-Follow-button").text("+Seguir").removeClass("following"):$(".am-Follow-button").text("Siguiendo").addClass("following"),profile.following=!profile.following},APP.ProfileScreen.prototype.uploadComplete=function(e){var t={format:"jpg",width:1600,crop:"limit",quality:80},i=$.cloudinary.image(e,t);i.addClass("am-Profile-banner-img").appendTo(this.$view.find(".preview")),this.photo=i.attr("src"),$(".save-icon , .cancel-icon").show()};
var APP=APP||{};APP.Viewer=function(i,t,a,n,e){this.container=t,this.options=e,"carrouselItem"===i||"action"===i||"notificationItem"===i||"tableUser"===i||"tableWork"===i||"post"===i||"postMinimal"===i||this.setupMasonry(),this.id=i,this.navigation=a,this.initialize=!0,this.fromExternal=!1,this.navigation?(this.navigationManager=new APP.NavigationManager(a),n?(this.navigationManager.navigator.currentPage=n.pagination.page,this.navigationManager.navigator.totalPages=n.pagination.pages):(this.navigationManager.navigator.currentPage=1,this.navigationManager.navigator.totalPages=1),this.navigationManager.navigator.start(),this.listeners(),n?this.addItems(n.items):(this.fromExternal=!0,this.navigationManager.navigator.gotoPage(1,!0))):n?this.addItems(n):(this.fromExternal=!0,this.navigationManager.navigator.gotoPage(1,!0))},APP.Viewer.constructor=APP.Viewer,APP.Viewer.prototype.setupMasonry=function(){var i=this;i.container.masonry({itemSelector:".grid-item",columnWidth:".grid-sizer",percentPosition:!0}),$(".discover-content").on("resetLayout",function(){console.log("expand"),i.container.masonry()})},APP.Viewer.prototype.listeners=function(){this.pageStart=this.pageLoadStartHandler.bind(this),this.navigationManager.navigator.addEventListener(Events.LOAD_START,this.pageStart),this.pageEnd=this.pageLoadEndHandler.bind(this),this.navigationManager.navigator.addEventListener(Events.LOAD_END,this.pageEnd)},APP.Viewer.prototype.pageLoadStartHandler=function(){this.container.parent().find(".bare-message").hide(),this.container.parent().find(".loading").show()},APP.Viewer.prototype.pageLoadEndHandler=function(i){this.fromExternal?this.initialize=!0:this.initialize=!1,this.addItems(i.data.items),this.options&&this.options.getTotal&&this.options.getTotal(i.data.pagination.total)},APP.Viewer.prototype.addItems=function(i){if(this.container.parent().find(".loading").show(),this.navigation!==APP.NavigationManager.PAGINATION||this.initialize||this.clean(),i.length<1){this.container.parent().find(".bare-message").hasClass("hide")&&this.container.parent().find(".bare-message").removeClass("hide");var t=this.container.parent().find(".bare-message").show().css("display");this.container.parent().find(".bare-message").show().css("display",t),this.container.parent().height("auto"),this.container.parent().find(".loading").hide()}var a,n=this,e=0,o=0,s=[];for(e;e<i.length;e++)if("action"===this.id?(("create-work"===i[e].verb||"like-work"===i[e].verb)&&(a=new APP.FeedWorkCreated(i[e],this.options)),"follow-user"===i[e].verb&&(a=new APP.FeedUserFollow(i[e],this.options))):"notificationItem"===this.id?("review-work"===i[e].verb&&(a=new APP.NotificationReview(i[e],this.options)),"follow-user"===i[e].verb&&(a=new APP.NotificationFollow(i[e],this.options)),"like-work"===i[e].verb&&(a=new APP.NotificationLike(i[e],this.options)),"request-work"===i[e].verb&&(a=new APP.NotificationRequest(i[e],this.options))):a=new(APP[Utils.capitalize(this.id)])(i[e],this.options),a.view.children().hasClass("work-card")){var r=a.view;r.attr("id",a.data.id),r.hide(),this.container.append(r),s.push(a.data.id);var h=this.container;r.imagesLoaded().progress(function(t,a){if(++o,$(a.img).parents(".grid-item"),o===i.length)var r=setTimeout(function(){for(clearTimeout(r),e=0;e<s.length;e++){var i=$("#"+s[e]);i.show(),h.masonry("appended",i),h.masonry(),n.navigationManager&&n.navigationManager.navigator.restart(),h.parent().find(".loading").hide()}},1e3)})}else"carrouselItem"===this.id||"action"===this.id||"notificationItem"===this.id||"post"===this.id||"postMinimal"===this.id||"tableUser"===this.id||"tableWork"===this.id?this.container.append(a.view):(this.container.append(a.view).masonry("appended",a.view),this.container.masonry()),n.navigationManager&&n.navigationManager.navigator.restart(),this.container.parent().find(".loading").hide()},APP.Viewer.prototype.reset=function(){this.clean(),this.navigationManager.navigator.reset()},APP.Viewer.prototype.clean=function(){"carrouselItem"===this.id||"action"===this.id||"notificationItem"===this.id||"post"===this.id||"postMinimal"===this.id||"tableUser"===this.id||"tableWork"===this.id?this.container.empty():this.container.masonry("remove",this.container.find(".grid-item")).masonry(),this.initialize=!1},APP.Viewer.prototype.suspend=function(){this.navigationManager.navigator.suspend(),this.navigationManager.navigator.removeEventListener(Events.LOAD_START,this.pageStart),this.navigationManager.navigator.removeEventListener(Events.LOAD_END,this.pageEnd)},APP.Viewer.prototype.restart=function(){this.navigationManager.navigator.addEventListener(Events.LOAD_START,this.pageStart),this.navigationManager.navigator.addEventListener(Events.LOAD_END,this.pageEnd),this.navigationManager.navigator.restart(),this.container.masonry()};
var APP=APP||{};APP.WorkScreen=function(){APP.BaseScreen.call(this,"work"),this.currentItem=this.oldItem,this.currentSection,this.oldSection,this.collections=[],this.idCollections=[],this.following=!1},APP.WorkScreen.constructor=APP.WorkScreen,APP.WorkScreen.prototype=Object.create(APP.BaseScreen.prototype),APP.WorkScreen.prototype.setupUI=function(){new APP.Viewer("carrouselItem",$(".more"),null,more),new APP.Viewer("carrouselItem",$(".similar"),null,similar),new APP.Carrousel($(".js-more-carousel"),$(".more")),new APP.Carrousel($(".js-similar-carousel"),$(".similar")),new APP.PhotoSwipe,this.reviewsContainer=$(".reviews-items-container");for(var e=0;e<reviews.length;e++)this.reviewsContainer.append(new APP.Review(reviews[e]).view);this.shareFb=$(".share-fb"),this.askBtn=$(".ask-availability"),this.loginReview=$(".login-review"),this.askRequester=$(".ask-requester"),this.thanksRequester=$(".thanks-requester"),this.likeBtn=$(".like-btn"),this.afterLike=$(".after-like"),this.saveBtn=$(".save-collections"),this.saveBtnLoading=$(".save-collections-loading"),this.followBtn=$(".am-Follow-button"),this.collectionsContainer=$(".collections"),this.collectionForm=$(".add-collection-form"),this.reviewForm=$(".review-form"),this.reviewContainer=$(".reviews-items-container"),this.prevBtn=$(".prev-btn"),this.nextBtn=$(".next-btn"),new Clipboard(".copy",{text:this.copyHandler.bind(this)})},APP.WorkScreen.prototype.listeners=function(){if(APP.BaseScreen.prototype.listeners.call(this),this.shareFb.click(this.shareFBHandler.bind(this)),$(".menu-item").click(this.menuItemHandler.bind(this)),$(".menu-item[data-name="+currentPath+"]").click(),this.askBtn.click(this.askAvailabilityHandler.bind(this)),this.loginReview.click(this.loginReviewHandler.bind(this)),this.saveBtn.click(this.saveClickHandler.bind(this)),DataApp.currentUser){var e=DataApp.currentUser.url+"/collection/all";if(this.requestHandler(e,{},this.collectionsHandlerComplete),!owner){var t=DataApp.currentUser.url+"/isFollowing";this.requestHandler(t,{idUser:work.User.id},this.isFollowingComplete)}}this.likeBtn.click(this.likeBtnHandler.bind(this)),this.followBtn.click(this.followHandler.bind(this)),this.collectionForm.submit(this.collectionFormHandler.bind(this)),this.reviewForm.submit(this.reviewFormHandler.bind(this)),$(document).bind("keyup",this.documentKeyupHandler.bind(this))},APP.WorkScreen.prototype.documentKeyupHandler=function(e){39===e.keyCode&&this.prevBtn.length>0&&(window.location.href=this.prevBtn.attr("href")),37===e.keyCode&&this.nextBtn.length>0&&(window.location.href=this.nextBtn.attr("href"))},APP.WorkScreen.prototype.copyHandler=function(e){return $("#lean_overlay").trigger("click"),this.showFlash("succes","Link Copiado"),window.location.href},APP.WorkScreen.prototype.reviewFormHandler=function(e){e.preventDefault();var t=DataApp.currentUser.url+"/work/review/create";this.requestHandler(t,$(e.target).serialize(),this.reviewComplete)},APP.WorkScreen.prototype.reviewComplete=function(e){$(".value-input").val(""),this.reviewContainer.append(new APP.Review(e.data.review).view)},APP.WorkScreen.prototype.followHandler=function(){Utils.checkAuthentication();var e=DataApp.currentUser.url+(this.isFollowing?"/unfollow/":"/follow/");this.requestHandler(e,{idUser:work.User.id},this.followComplete)},APP.WorkScreen.prototype.followComplete=function(e){console.log(e),this.isFollowing?this.followBtn.removeClass("following").text("+ SEGUIR"):this.followBtn.addClass("following").text("Siguiendo"),this.isFollowing=!this.isFollowing},APP.WorkScreen.prototype.isFollowingComplete=function(e){this.isFollowing=e.data.following,this.isFollowing&&this.followBtn.addClass("following").text("Siguiendo")},APP.WorkScreen.prototype.saveClickHandler=function(){this.saveBtn.hide(),this.saveBtnLoading.show();var e=DataApp.currentUser.url+"/work/add_to_collection",t={collections:JSON.stringify(this.idCollections),idWork:work.id};this.requestHandler(e,t,this.saveRequestComplete)},APP.WorkScreen.prototype.saveRequestComplete=function(){this.saveBtn.show(),this.saveBtnLoading.hide(),this.showFlash("succes","Su actualizo tus colecciones"),$("#lean_overlay").trigger("click")},APP.WorkScreen.prototype.collectionFormHandler=function(e){e.preventDefault();var t=DataApp.currentUser.url+"/collection/create";this.requestHandler(t,$(e.target).serialize(),this.collectionFormComplete)},APP.WorkScreen.prototype.collectionFormComplete=function(e){var t=new APP.CollectionItem(e.data.collection);t.addEventListener(Events.COLLECTION_ITEM_SELECTED,this.collectionItemSelected.bind(this)),this.collections.push(t),this.collectionsContainer.append(t.view)},APP.WorkScreen.prototype.likeBtnHandler=function(){if(Utils.checkAuthentication(),!work.liked){var e=DataApp.currentUser.url+"/work/like";this.requestHandler(e,{idWork:work.id},this.likeComplete)}},APP.WorkScreen.prototype.likeComplete=function(e){console.log(e),work.liked=!work.liked,$(".likes").text(e.data.likes),this.likeBtn.parent().addClass("active"),this.afterLike.show()},APP.WorkScreen.prototype.collectionsHandlerComplete=function(e){var t,i,o=e.data.collections;for(t=0;t<o.length;t++)i=new APP.CollectionItem(o[t]),this.collections.push(i),i.addEventListener(Events.COLLECTION_ITEM_SELECTED,this.collectionItemSelected.bind(this)),this.collectionsContainer.append(i.view);var r=DataApp.currentUser.url+"/work/inside_collection";this.requestHandler(r,{idWork:work.id},this.insideCollectionHandler)},APP.WorkScreen.prototype.insideCollectionHandler=function(e){var t,i,o=e.data.collections;for(t=0;t<this.collections.length;t++)this.collections[t].view.removeClass("selected");for(this.idCollections=[],t=0;t<o.length;t++)for(i=0;i<this.collections.length;i++)o[t].id===this.collections[i].data.id&&(this.idCollections.push(o[t].id),this.collections[i].view.addClass("selected"))},APP.WorkScreen.prototype.collectionItemSelected=function(e){var t=e.target,i=this.idCollections.indexOf(t.data.id);-1===i?this.idCollections.push(t.data.id):this.idCollections.splice(i,1)},APP.WorkScreen.prototype.askAvailabilityHandler=function(e){Utils.checkAuthentication();var t=DataApp.currentUser.url+"/work/availability";this.requestHandler(t,{idWork:work.id},this.askAvailabilityComplete)},APP.WorkScreen.prototype.loginReviewHandler=function(){Utils.checkAuthentication()},APP.WorkScreen.prototype.askAvailabilityComplete=function(e){this.askRequester.hide(),this.thanksRequester.show()},APP.WorkScreen.prototype.menuItemHandler=function(e){this.currentItem=$(e.currentTarget);var t=this.currentItem.data("name");this.currentSection=$("."+t+"-container"),this.currentSection.show();var i="/user/"+work.User.username+"/work/"+work.nameSlugify+"/"+("index"===t?"":t);$(".menu-item").removeClass("selected"),this.currentItem.addClass("selected"),this.oldSection&&this.oldSection.hide(),this.oldSection=this.currentSection,Utils.changeUrl(DataApp.baseTitle+Utils.capitalize(t),i)},APP.WorkScreen.prototype.shareFBHandler=function(){Utils.shareFBWork(work)};
Utils={isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return Utils.isMobile.Android()||Utils.isMobile.BlackBerry()||Utils.isMobile.iOS()||Utils.isMobile.Opera()||Utils.isMobile.Windows()}},paginationButtons:function(e,t,n){var i,r=[1],a=Math.floor(n/2);if(e>t)return null;if(n>t){for(i=2;t+1>i;i++)r.push(i);return r}if(a>=e&&e>0)for(i=2;n>i;i++)r.push(i);var o=t-a;if(e>a&&o>e){var s=(n-3)/2;for(i=e-s;e+s+1>i;i++)r.push(i)}if(e>=o&&t>=e)for(i=t-(n-2);t>i;i++)r.push(i);return r.push(t),r},getUrlParameter:function(e){for(var t=window.location.search.substring(1),n=t.split("&"),i=0;i<n.length;i++){var r=n[i].split("=");if(r[0]==e)return r[1]}},capitalize:function(e){return e.charAt(0).toUpperCase()+e.substring(1)},getData:function(e){return APP.RestClientManager.instance.execute(e)},changeUrl:function(e,t){if(DataApp.currentUrl=t,"undefined"!=typeof history.pushState){var n={page:e,url:t};history.replaceState(n,n.page,n.url)}else window.location.href="/"},addImageFilter:function(e,t){return e.indexOf("upload")>-1?e.replace("upload/","upload/"+t+"/"):void 0},checkAuthentication:function(){DataApp.currentUser||(-1===window.location.href.indexOf("auth")&&Cookies.set("return_to",window.location.href,{maxAge:36e5,domain:"."+document.domain}),window.location.href=DataApp.loginUrl)},share:{facebook:function(e,t){e.method="feed",window.FB&&FB.ui(e,t)}},shareFBWork:function(e){$("#lean_overlay").trigger("click"),Utils.share.facebook({link:DataApp.baseUrl+"user/"+e.User.username+"/work/"+e.nameSlugify,picture:Utils.addImageFilter(e.photo,"w_1200,h_630,q_60,c_crop"),name:e.name,caption:"Arte Manifiesto",description:e.description})},shareTWWork:function(e){var t=DataApp.baseUrl+"user/"+e.User.username+"/work/"+e.nameSlugify,n=encodeURIComponent(e.name+" vía (@artemanifiesto)"),i="https://twitter.com/intent/tweet?text="+n;i+="&url="+encodeURIComponent(t),window.open(i,"_blank","height=300,width=550,resizable=1")},shareFBPost:function(e){Utils.share.facebook({link:DataApp.baseUrl+"blog/post/"+e.nameSlugify,picture:Utils.addImageFilter(e.photo,"w_1200,h_630,q_60,c_crop"),name:e.name,caption:"Arte Manifiesto | Blog",description:e.description})},shareTWPost:function(e){var t=DataApp.baseUrl+"blog/post/"+e.nameSlugify,n=encodeURIComponent(e.name+" vía (@artemanifiesto)"),i="https://twitter.com/intent/tweet?text="+n;i+="&url="+encodeURIComponent(t),window.open(i,"_blank","height=300,width=550,resizable=1")},removeURLParameter:function(e,t){var n=e.split("?");if(n.length>=2){for(var i=encodeURIComponent(t)+"=",r=n[1].split(/[&;]/g),a=r.length;a-- >0;)-1!==r[a].lastIndexOf(i,0)&&r.splice(a,1);return e=n[0]+"?"+r.join("&")}return e},updateQueryStringParameter:function(e,t,n){var i=new RegExp("([?&])"+t+"=.*?(&|$)","i"),r=-1!==e.indexOf("?")?"&":"?";return e.match(i)?e.replace(i,"$1"+t+"="+n+"$2"):e+r+t+"="+n}};